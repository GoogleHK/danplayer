(function (e, t) { typeof exports === 'object' && typeof module === 'object' ? module.exports = t() : typeof define === 'function' && define.amd ? define([], t) : typeof exports === 'object' ? exports['danplayer'] = t() : e['danplayer'] = t() })(typeof self !== 'undefined' ? self : this, function () {
  return (function (e) { var t = {}; function r (i) { if (t[i]) return t[i].exports; var n = t[i] = { i: i, l: !1, exports: {} }; return e[i].call(n.exports, n, n.exports, r), n.l = !0, n.exports } return r.m = e, r.c = t, r.d = function (e, t, i) { r.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: i }) }, r.r = function (e) { typeof Symbol !== 'undefined' && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: 'Module' }), Object.defineProperty(e, '__esModule', { value: !0 }) }, r.t = function (e, t) { if (1 & t && (e = r(e)), 8 & t) return e; if (4 & t && typeof e === 'object' && e && e.__esModule) return e; var i = Object.create(null); if (r.r(i), Object.defineProperty(i, 'default', { enumerable: !0, value: e }), 2 & t && typeof e !== 'string') for (var n in e)r.d(i, n, function (t) { return e[t] }.bind(null, n)); return i }, r.n = function (e) { var t = e && e.__esModule ? function () { return e['default'] } : function () { return e }; return r.d(t, 'a', t), t }, r.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, r.p = '', r(r.s = 'fae3') }({ 1441: function (e, t, r) {},
    '5fe9': function (e, t, r) { 'use strict'; function i (e, t) { return void 0 === t && (t = 12), +parseFloat(e.toPrecision(t)) } function n (e) { var t = e.toString().split(/[eE]/); var r = (t[0].split('.')[1] || '').length - +(t[1] || 0); return r > 0 ? r : 0 } function a (e) { if (e.toString().indexOf('e') === -1) return Number(e.toString().replace('.', '')); var t = n(e); return t > 0 ? i(e * Math.pow(10, t)) : e } function o (e) { f && (e > Number.MAX_SAFE_INTEGER || e < Number.MIN_SAFE_INTEGER) && console.warn(e + ' is beyond boundary when transfer to integer, the results may not be accurate') } function s (e, t) { for (var r = [], i = 2; i < arguments.length; i++)r[i - 2] = arguments[i]; if (r.length > 0) return s.apply(void 0, [s(e, t), r[0]].concat(r.slice(1))); var l = a(e); var u = a(t); var c = n(e) + n(t); var d = l * u; return o(d), d / Math.pow(10, c) } function l (e, t) { for (var r = [], i = 2; i < arguments.length; i++)r[i - 2] = arguments[i]; if (r.length > 0) return l.apply(void 0, [l(e, t), r[0]].concat(r.slice(1))); var a = Math.pow(10, Math.max(n(e), n(t))); return (s(e, a) + s(t, a)) / a } function u (e, t) { for (var r = [], i = 2; i < arguments.length; i++)r[i - 2] = arguments[i]; if (r.length > 0) return u.apply(void 0, [u(e, t), r[0]].concat(r.slice(1))); var a = Math.pow(10, Math.max(n(e), n(t))); return (s(e, a) - s(t, a)) / a } function c (e, t) { for (var r = [], i = 2; i < arguments.length; i++)r[i - 2] = arguments[i]; if (r.length > 0) return c.apply(void 0, [c(e, t), r[0]].concat(r.slice(1))); var l = a(e); var u = a(t); return o(l), o(u), s(l / u, Math.pow(10, n(t) - n(e))) } function d (e, t) { var r = Math.pow(10, t); return c(Math.round(s(e, r)), r) }Object.defineProperty(t, '__esModule', { value: !0 }); var f = !0; function h (e) { void 0 === e && (e = !0), f = e } var p = { strip: i, plus: l, minus: u, times: s, divide: c, round: d, digitLength: n, float2Fixed: a, enableBoundaryChecking: h }; t.strip = i, t.plus = l, t.minus = u, t.times = s, t.divide = c, t.round = d, t.digitLength = n, t.float2Fixed = a, t.enableBoundaryChecking = h, t['default'] = p },
    '96cf': function (e, t, r) { var i = (function (e) { 'use strict'; var t; var r = Object.prototype; var i = r.hasOwnProperty; var n = typeof Symbol === 'function' ? Symbol : {}; var a = n.iterator || '@@iterator'; var o = n.asyncIterator || '@@asyncIterator'; var s = n.toStringTag || '@@toStringTag'; function l (e, t, r, i) { var n = t && t.prototype instanceof g ? t : g; var a = Object.create(n.prototype); var o = new k(i || []); return a._invoke = w(e, r, o), a } function u (e, t, r) { try { return { type: 'normal', arg: e.call(t, r) } } catch (i) { return { type: 'throw', arg: i } } }e.wrap = l; var c = 'suspendedStart'; var d = 'suspendedYield'; var f = 'executing'; var h = 'completed'; var p = {}; function g () {} function v () {} function y () {} var m = {}; m[a] = function () { return this }; var b = Object.getPrototypeOf; var E = b && b(b(D([]))); E && E !== r && i.call(E, a) && (m = E); var _ = y.prototype = g.prototype = Object.create(m); function S (e) { ['next', 'throw', 'return'].forEach(function (t) { e[t] = function (e) { return this._invoke(t, e) } }) } function T (e) { function t (r, n, a, o) { var s = u(e[r], e, n); if (s.type !== 'throw') { var l = s.arg; var c = l.value; return c && typeof c === 'object' && i.call(c, '__await') ? Promise.resolve(c.__await).then(function (e) { t('next', e, a, o) }, function (e) { t('throw', e, a, o) }) : Promise.resolve(c).then(function (e) { l.value = e, a(l) }, function (e) { return t('throw', e, a, o) }) }o(s.arg) } var r; function n (e, i) { function n () { return new Promise(function (r, n) { t(e, i, r, n) }) } return r = r ? r.then(n, n) : n() } this._invoke = n } function w (e, t, r) { var i = c; return function (n, a) { if (i === f) throw new Error('Generator is already running'); if (i === h) { if (n === 'throw') throw a; return O() }r.method = n, r.arg = a; while (1) { var o = r.delegate; if (o) { var s = A(o, r); if (s) { if (s === p) continue; return s } } if (r.method === 'next')r.sent = r._sent = r.arg; else if (r.method === 'throw') { if (i === c) throw i = h, r.arg; r.dispatchException(r.arg) } else r.method === 'return' && r.abrupt('return', r.arg); i = f; var l = u(e, t, r); if (l.type === 'normal') { if (i = r.done ? h : d, l.arg === p) continue; return { value: l.arg, done: r.done } }l.type === 'throw' && (i = h, r.method = 'throw', r.arg = l.arg) } } } function A (e, r) { var i = e.iterator[r.method]; if (i === t) { if (r.delegate = null, r.method === 'throw') { if (e.iterator['return'] && (r.method = 'return', r.arg = t, A(e, r), r.method === 'throw')) return p; r.method = 'throw', r.arg = new TypeError("The iterator does not provide a 'throw' method") } return p } var n = u(i, e.iterator, r.arg); if (n.type === 'throw') return r.method = 'throw', r.arg = n.arg, r.delegate = null, p; var a = n.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, r.method !== 'return' && (r.method = 'next', r.arg = t), r.delegate = null, p) : a : (r.method = 'throw', r.arg = new TypeError('iterator result is not an object'), r.delegate = null, p) } function L (e) { var t = { tryLoc: e[0] }; 1 in e && (t.catchLoc = e[1]), 2 in e && (t.finallyLoc = e[2], t.afterLoc = e[3]), this.tryEntries.push(t) } function R (e) { var t = e.completion || {}; t.type = 'normal', delete t.arg, e.completion = t } function k (e) { this.tryEntries = [{ tryLoc: 'root' }], e.forEach(L, this), this.reset(!0) } function D (e) { if (e) { var r = e[a]; if (r) return r.call(e); if (typeof e.next === 'function') return e; if (!isNaN(e.length)) { var n = -1; var o = function r () { while (++n < e.length) if (i.call(e, n)) return r.value = e[n], r.done = !1, r; return r.value = t, r.done = !0, r }; return o.next = o } } return { next: O } } function O () { return { value: t, done: !0 } } return v.prototype = _.constructor = y, y.constructor = v, y[s] = v.displayName = 'GeneratorFunction', e.isGeneratorFunction = function (e) { var t = typeof e === 'function' && e.constructor; return !!t && (t === v || (t.displayName || t.name) === 'GeneratorFunction') }, e.mark = function (e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, y) : (e.__proto__ = y, s in e || (e[s] = 'GeneratorFunction')), e.prototype = Object.create(_), e }, e.awrap = function (e) { return { __await: e } }, S(T.prototype), T.prototype[o] = function () { return this }, e.AsyncIterator = T, e.async = function (t, r, i, n) { var a = new T(l(t, r, i, n)); return e.isGeneratorFunction(r) ? a : a.next().then(function (e) { return e.done ? e.value : a.next() }) }, S(_), _[s] = 'Generator', _[a] = function () { return this }, _.toString = function () { return '[object Generator]' }, e.keys = function (e) { var t = []; for (var r in e)t.push(r); return t.reverse(), function r () { while (t.length) { var i = t.pop(); if (i in e) return r.value = i, r.done = !1, r } return r.done = !0, r } }, e.values = D, k.prototype = { constructor: k, reset: function (e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = 'next', this.arg = t, this.tryEntries.forEach(R), !e) for (var r in this)r.charAt(0) === 't' && i.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t) }, stop: function () { this.done = !0; var e = this.tryEntries[0]; var t = e.completion; if (t.type === 'throw') throw t.arg; return this.rval }, dispatchException: function (e) { if (this.done) throw e; var r = this; function n (i, n) { return s.type = 'throw', s.arg = e, r.next = i, n && (r.method = 'next', r.arg = t), !!n } for (var a = this.tryEntries.length - 1; a >= 0; --a) { var o = this.tryEntries[a]; var s = o.completion; if (o.tryLoc === 'root') return n('end'); if (o.tryLoc <= this.prev) { var l = i.call(o, 'catchLoc'); var u = i.call(o, 'finallyLoc'); if (l && u) { if (this.prev < o.catchLoc) return n(o.catchLoc, !0); if (this.prev < o.finallyLoc) return n(o.finallyLoc) } else if (l) { if (this.prev < o.catchLoc) return n(o.catchLoc, !0) } else { if (!u) throw new Error('try statement without catch or finally'); if (this.prev < o.finallyLoc) return n(o.finallyLoc) } } } }, abrupt: function (e, t) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var n = this.tryEntries[r]; if (n.tryLoc <= this.prev && i.call(n, 'finallyLoc') && this.prev < n.finallyLoc) { var a = n; break } }a && (e === 'break' || e === 'continue') && a.tryLoc <= t && t <= a.finallyLoc && (a = null); var o = a ? a.completion : {}; return o.type = e, o.arg = t, a ? (this.method = 'next', this.next = a.finallyLoc, p) : this.complete(o) }, complete: function (e, t) { if (e.type === 'throw') throw e.arg; return e.type === 'break' || e.type === 'continue' ? this.next = e.arg : e.type === 'return' ? (this.rval = this.arg = e.arg, this.method = 'return', this.next = 'end') : e.type === 'normal' && t && (this.next = t), p }, finish: function (e) { for (var t = this.tryEntries.length - 1; t >= 0; --t) { var r = this.tryEntries[t]; if (r.finallyLoc === e) return this.complete(r.completion, r.afterLoc), R(r), p } }, catch: function (e) { for (var t = this.tryEntries.length - 1; t >= 0; --t) { var r = this.tryEntries[t]; if (r.tryLoc === e) { var i = r.completion; if (i.type === 'throw') { var n = i.arg; R(r) } return n } } throw new Error('illegal catch attempt') }, delegateYield: function (e, r, i) { return this.delegate = { iterator: D(e), resultName: r, nextLoc: i }, this.method === 'next' && (this.arg = t), p } }, e }(e.exports)); try { regeneratorRuntime = i } catch (n) { Function('r', 'regeneratorRuntime = r')(i) } },
    a34a: function (e, t, r) { e.exports = r('96cf') },
    ba56: function (e, t, r) {
      typeof window !== 'undefined' && (function (t, r) { e.exports = r() }(0, function () {
        return (function (e) { var t = {}; function r (i) { if (t[i]) return t[i].exports; var n = t[i] = { i: i, l: !1, exports: {} }; return e[i].call(n.exports, n, n.exports, r), n.l = !0, n.exports } return r.m = e, r.c = t, r.d = function (e, t, i) { r.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: i }) }, r.r = function (e) { typeof Symbol !== 'undefined' && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: 'Module' }), Object.defineProperty(e, '__esModule', { value: !0 }) }, r.t = function (e, t) { if (1 & t && (e = r(e)), 8 & t) return e; if (4 & t && typeof e === 'object' && e && e.__esModule) return e; var i = Object.create(null); if (r.r(i), Object.defineProperty(i, 'default', { enumerable: !0, value: e }), 2 & t && typeof e !== 'string') for (var n in e)r.d(i, n, function (t) { return e[t] }.bind(null, n)); return i }, r.n = function (e) { var t = e && e.__esModule ? function () { return e['default'] } : function () { return e }; return r.d(t, 'a', t), t }, r.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, r.p = '/dist/', r(r.s = './src/hls.js') }({ './node_modules/eventemitter3/index.js':
        /*! *********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = Object.prototype.hasOwnProperty; var n = '~'; function a () {} function o (e, t, r) { this.fn = e, this.context = t, this.once = r || !1 } function s (e, t, r, i, a) { if (typeof r !== 'function') throw new TypeError('The listener must be a function'); var s = new o(r, i || e, a); var l = n ? n + t : t; return e._events[l] ? e._events[l].fn ? e._events[l] = [e._events[l], s] : e._events[l].push(s) : (e._events[l] = s, e._eventsCount++), e } function l (e, t) { --e._eventsCount === 0 ? e._events = new a() : delete e._events[t] } function u () { this._events = new a(), this._eventsCount = 0 }Object.create && (a.prototype = Object.create(null), (new a()).__proto__ || (n = !1)), u.prototype.eventNames = function () { var e; var t; var r = []; if (this._eventsCount === 0) return r; for (t in e = this._events)i.call(e, t) && r.push(n ? t.slice(1) : t); return Object.getOwnPropertySymbols ? r.concat(Object.getOwnPropertySymbols(e)) : r }, u.prototype.listeners = function (e) { var t = n ? n + e : e; var r = this._events[t]; if (!r) return []; if (r.fn) return [r.fn]; for (var i = 0, a = r.length, o = new Array(a); i < a; i++)o[i] = r[i].fn; return o }, u.prototype.listenerCount = function (e) { var t = n ? n + e : e; var r = this._events[t]; return r ? r.fn ? 1 : r.length : 0 }, u.prototype.emit = function (e, t, r, i, a, o) { var s = n ? n + e : e; if (!this._events[s]) return !1; var l; var u; var c = this._events[s]; var d = arguments.length; if (c.fn) { switch (c.once && this.removeListener(e, c.fn, void 0, !0), d) { case 1:return c.fn.call(c.context), !0; case 2:return c.fn.call(c.context, t), !0; case 3:return c.fn.call(c.context, t, r), !0; case 4:return c.fn.call(c.context, t, r, i), !0; case 5:return c.fn.call(c.context, t, r, i, a), !0; case 6:return c.fn.call(c.context, t, r, i, a, o), !0 } for (u = 1, l = new Array(d - 1); u < d; u++)l[u - 1] = arguments[u]; c.fn.apply(c.context, l) } else { var f; var h = c.length; for (u = 0; u < h; u++) switch (c[u].once && this.removeListener(e, c[u].fn, void 0, !0), d) { case 1:c[u].fn.call(c[u].context); break; case 2:c[u].fn.call(c[u].context, t); break; case 3:c[u].fn.call(c[u].context, t, r); break; case 4:c[u].fn.call(c[u].context, t, r, i); break; default:if (!l) for (f = 1, l = new Array(d - 1); f < d; f++)l[f - 1] = arguments[f]; c[u].fn.apply(c[u].context, l) } } return !0 }, u.prototype.on = function (e, t, r) { return s(this, e, t, r, !1) }, u.prototype.once = function (e, t, r) { return s(this, e, t, r, !0) }, u.prototype.removeListener = function (e, t, r, i) { var a = n ? n + e : e; if (!this._events[a]) return this; if (!t) return l(this, a), this; var o = this._events[a]; if (o.fn)o.fn !== t || i && !o.once || r && o.context !== r || l(this, a); else { for (var s = 0, u = [], c = o.length; s < c; s++)(o[s].fn !== t || i && !o[s].once || r && o[s].context !== r) && u.push(o[s]); u.length ? this._events[a] = u.length === 1 ? u[0] : u : l(this, a) } return this }, u.prototype.removeAllListeners = function (e) { var t; return e ? (t = n ? n + e : e, this._events[t] && l(this, t)) : (this._events = new a(), this._eventsCount = 0), this }, u.prototype.off = u.prototype.removeListener, u.prototype.addListener = u.prototype.on, u.prefixed = n, u.EventEmitter = u, e.exports = u },
        './node_modules/node-libs-browser/node_modules/events/events.js':
        /*! **********************************************************************!*\
  !*** ./node_modules/node-libs-browser/node_modules/events/events.js ***!
  \**********************************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t) { function r () { this._events = this._events || {}, this._maxListeners = this._maxListeners || void 0 } function i (e) { return typeof e === 'function' } function n (e) { return typeof e === 'number' } function a (e) { return typeof e === 'object' && e !== null } function o (e) { return void 0 === e }e.exports = r, r.EventEmitter = r, r.prototype._events = void 0, r.prototype._maxListeners = void 0, r.defaultMaxListeners = 10, r.prototype.setMaxListeners = function (e) { if (!n(e) || e < 0 || isNaN(e)) throw TypeError('n must be a positive number'); return this._maxListeners = e, this }, r.prototype.emit = function (e) { var t, r, n, s, l, u; if (this._events || (this._events = {}), e === 'error' && (!this._events.error || a(this._events.error) && !this._events.error.length)) { if (t = arguments[1], t instanceof Error) throw t; var c = new Error('Uncaught, unspecified "error" event. (' + t + ')'); throw c.context = t, c } if (r = this._events[e], o(r)) return !1; if (i(r)) switch (arguments.length) { case 1:r.call(this); break; case 2:r.call(this, arguments[1]); break; case 3:r.call(this, arguments[1], arguments[2]); break; default:s = Array.prototype.slice.call(arguments, 1), r.apply(this, s) } else if (a(r)) for (s = Array.prototype.slice.call(arguments, 1), u = r.slice(), n = u.length, l = 0; l < n; l++)u[l].apply(this, s); return !0 }, r.prototype.addListener = function (e, t) { var n; if (!i(t)) throw TypeError('listener must be a function'); return this._events || (this._events = {}), this._events.newListener && this.emit('newListener', e, i(t.listener) ? t.listener : t), this._events[e] ? a(this._events[e]) ? this._events[e].push(t) : this._events[e] = [this._events[e], t] : this._events[e] = t, a(this._events[e]) && !this._events[e].warned && (n = o(this._maxListeners) ? r.defaultMaxListeners : this._maxListeners, n && n > 0 && this._events[e].length > n && (this._events[e].warned = !0, console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.', this._events[e].length), typeof console.trace === 'function' && console.trace())), this }, r.prototype.on = r.prototype.addListener, r.prototype.once = function (e, t) { if (!i(t)) throw TypeError('listener must be a function'); var r = !1; function n () { this.removeListener(e, n), r || (r = !0, t.apply(this, arguments)) } return n.listener = t, this.on(e, n), this }, r.prototype.removeListener = function (e, t) { var r, n, o, s; if (!i(t)) throw TypeError('listener must be a function'); if (!this._events || !this._events[e]) return this; if (r = this._events[e], o = r.length, n = -1, r === t || i(r.listener) && r.listener === t) delete this._events[e], this._events.removeListener && this.emit('removeListener', e, t); else if (a(r)) { for (s = o; s-- > 0;) if (r[s] === t || r[s].listener && r[s].listener === t) { n = s; break } if (n < 0) return this; r.length === 1 ? (r.length = 0, delete this._events[e]) : r.splice(n, 1), this._events.removeListener && this.emit('removeListener', e, t) } return this }, r.prototype.removeAllListeners = function (e) { var t, r; if (!this._events) return this; if (!this._events.removeListener) return arguments.length === 0 ? this._events = {} : this._events[e] && delete this._events[e], this; if (arguments.length === 0) { for (t in this._events)t !== 'removeListener' && this.removeAllListeners(t); return this.removeAllListeners('removeListener'), this._events = {}, this } if (r = this._events[e], i(r)) this.removeListener(e, r); else if (r) while (r.length) this.removeListener(e, r[r.length - 1]); return delete this._events[e], this }, r.prototype.listeners = function (e) { var t; return t = this._events && this._events[e] ? i(this._events[e]) ? [this._events[e]] : this._events[e].slice() : [], t }, r.prototype.listenerCount = function (e) { if (this._events) { var t = this._events[e]; if (i(t)) return 1; if (t) return t.length } return 0 }, r.listenerCount = function (e, t) { return e.listenerCount(t) } },
        './node_modules/url-toolkit/src/url-toolkit.js':
        /*! *****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { (function (t) { var r = /^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/; var i = /^([^\/?#]*)(.*)$/; var n = /(?:\/|^)\.(?=\/)/g; var a = /(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g; var o = { buildAbsoluteURL: function (e, t, r) { if (r = r || {}, e = e.trim(), t = t.trim(), !t) { if (!r.alwaysNormalize) return e; var n = o.parseURL(e); if (!n) throw new Error('Error trying to parse base URL.'); return n.path = o.normalizePath(n.path), o.buildURLFromParts(n) } var a = o.parseURL(t); if (!a) throw new Error('Error trying to parse relative URL.'); if (a.scheme) return r.alwaysNormalize ? (a.path = o.normalizePath(a.path), o.buildURLFromParts(a)) : t; var s = o.parseURL(e); if (!s) throw new Error('Error trying to parse base URL.'); if (!s.netLoc && s.path && s.path[0] !== '/') { var l = i.exec(s.path); s.netLoc = l[1], s.path = l[2] }s.netLoc && !s.path && (s.path = '/'); var u = { scheme: s.scheme, netLoc: a.netLoc, path: null, params: a.params, query: a.query, fragment: a.fragment }; if (!a.netLoc && (u.netLoc = s.netLoc, a.path[0] !== '/')) if (a.path) { var c = s.path; var d = c.substring(0, c.lastIndexOf('/') + 1) + a.path; u.path = o.normalizePath(d) } else u.path = s.path, a.params || (u.params = s.params, a.query || (u.query = s.query)); return u.path === null && (u.path = r.alwaysNormalize ? o.normalizePath(a.path) : a.path), o.buildURLFromParts(u) }, parseURL: function (e) { var t = r.exec(e); return t ? { scheme: t[1] || '', netLoc: t[2] || '', path: t[3] || '', params: t[4] || '', query: t[5] || '', fragment: t[6] || '' } : null }, normalizePath: function (e) { e = e.split('').reverse().join('').replace(n, ''); while (e.length !== (e = e.replace(a, '')).length);return e.split('').reverse().join('') }, buildURLFromParts: function (e) { return e.scheme + e.netLoc + e.path + e.params + e.query + e.fragment } }; e.exports = o })() },
        './node_modules/webworkify-webpack/index.js':
        /*! **************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { function i (e) { var t = {}; function r (i) { if (t[i]) return t[i].exports; var n = t[i] = { i: i, l: !1, exports: {} }; return e[i].call(n.exports, n, n.exports, r), n.l = !0, n.exports }r.m = e, r.c = t, r.i = function (e) { return e }, r.d = function (e, t, i) { r.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: i }) }, r.r = function (e) { Object.defineProperty(e, '__esModule', { value: !0 }) }, r.n = function (e) { var t = e && e.__esModule ? function () { return e['default'] } : function () { return e }; return r.d(t, 'a', t), t }, r.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, r.p = '/', r.oe = function (e) { throw console.error(e), e }; var i = r(r.s = ENTRY_MODULE); return i.default || i } var n = '[\\.|\\-|\\+|\\w|/|@]+'; var a = '\\((/\\*.*?\\*/)?s?.*?(' + n + ').*?\\)'; function o (e) { return (e + '').replace(/[.?*+^$[\]\\(){}|-]/g, '\\$&') } function s (e) { return !isNaN(1 * e) } function l (e, t, i) { var l = {}; l[i] = []; var u = t.toString(); var c = u.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/); if (!c) return l; var d; var f = c[1]; var h = new RegExp('(\\\\n|\\W)' + o(f) + a, 'g'); while (d = h.exec(u))d[3] !== 'dll-reference' && l[i].push(d[3]); h = new RegExp('\\(' + o(f) + '\\("(dll-reference\\s(' + n + '))"\\)\\)' + a, 'g'); while (d = h.exec(u))e[d[2]] || (l[i].push(d[1]), e[d[2]] = r(d[1]).m), l[d[2]] = l[d[2]] || [], l[d[2]].push(d[4]); for (var p = Object.keys(l), g = 0; g < p.length; g++) for (var v = 0; v < l[p[g]].length; v++)s(l[p[g]][v]) && (l[p[g]][v] = 1 * l[p[g]][v]); return l } function u (e) { var t = Object.keys(e); return t.reduce(function (t, r) { return t || e[r].length > 0 }, !1) } function c (e, t) { var r = { main: [t] }; var i = { main: [] }; var n = { main: {} }; while (u(r)) for (var a = Object.keys(r), o = 0; o < a.length; o++) { var s = a[o]; var c = r[s]; var d = c.pop(); if (n[s] = n[s] || {}, !n[s][d] && e[s][d]) { n[s][d] = !0, i[s] = i[s] || [], i[s].push(d); for (var f = l(e, e[s][d], s), h = Object.keys(f), p = 0; p < h.length; p++)r[h[p]] = r[h[p]] || [], r[h[p]] = r[h[p]].concat(f[h[p]]) } } return i }e.exports = function (e, t) { t = t || {}; var n = { main: r.m }; var a = t.all ? { main: Object.keys(n.main) } : c(n, e); var o = ''; Object.keys(a).filter(function (e) { return e !== 'main' }).forEach(function (e) { var t = 0; while (a[e][t])t++; a[e].push(t), n[e][t] = '(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })', o = o + 'var ' + e + ' = (' + i.toString().replace('ENTRY_MODULE', JSON.stringify(t)) + ')({' + a[e].map(function (t) { return JSON.stringify(t) + ': ' + n[e][t].toString() }).join(',') + '});\n' }), o = o + 'new ((' + i.toString().replace('ENTRY_MODULE', JSON.stringify(e)) + ')({' + a.main.map(function (e) { return JSON.stringify(e) + ': ' + n.main[e].toString() }).join(',') + '}))(self);'; var s = new window.Blob([o], { type: 'text/javascript' }); if (t.bare) return s; var l = window.URL || window.webkitURL || window.mozURL || window.msURL; var u = l.createObjectURL(s); var d = new window.Worker(u); return d.objectURL = u, d } },
        './src/config.js':
        /*! ***********************!*\
  !*** ./src/config.js ***!
  \***********************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./controller/abr-controller */'./src/controller/abr-controller.js'); var n = r(/*! ./controller/buffer-controller */'./src/controller/buffer-controller.js'); var a = r(/*! ./controller/cap-level-controller */'./src/controller/cap-level-controller.js'); var o = r(/*! ./controller/fps-controller */'./src/controller/fps-controller.js'); var s = r(/*! ./utils/xhr-loader */'./src/utils/xhr-loader.js'); var l = r(/*! ./controller/audio-track-controller */'./src/controller/audio-track-controller.js'); var u = r(/*! ./controller/audio-stream-controller */'./src/controller/audio-stream-controller.js'); var c = r(/*! ./utils/cues */'./src/utils/cues.js'); var d = r(/*! ./controller/timeline-controller */'./src/controller/timeline-controller.js'); var f = r(/*! ./controller/subtitle-track-controller */'./src/controller/subtitle-track-controller.js'); var h = r(/*! ./controller/subtitle-stream-controller */'./src/controller/subtitle-stream-controller.js'); var p = r(/*! ./controller/eme-controller */'./src/controller/eme-controller.js'); var g = r(/*! ./utils/mediakeys-helper */'./src/utils/mediakeys-helper.js'); t.hlsDefaultConfig = { autoStartLoad: !0, startPosition: -1, defaultAudioCodec: void 0, debug: !1, capLevelOnFPSDrop: !1, capLevelToPlayerSize: !1, initialLiveManifestSize: 1, maxBufferLength: 30, maxBufferSize: 6e7, maxBufferHole: 0.5, lowBufferWatchdogPeriod: 0.5, highBufferWatchdogPeriod: 3, nudgeOffset: 0.1, nudgeMaxRetry: 3, maxFragLookUpTolerance: 0.25, liveSyncDurationCount: 3, liveMaxLatencyDurationCount: 1 / 0, liveSyncDuration: void 0, liveMaxLatencyDuration: void 0, liveDurationInfinity: !1, liveBackBufferLength: 1 / 0, maxMaxBufferLength: 600, enableWorker: !0, enableSoftwareAES: !0, manifestLoadingTimeOut: 1e4, manifestLoadingMaxRetry: 1, manifestLoadingRetryDelay: 1e3, manifestLoadingMaxRetryTimeout: 64e3, startLevel: void 0, levelLoadingTimeOut: 1e4, levelLoadingMaxRetry: 4, levelLoadingRetryDelay: 1e3, levelLoadingMaxRetryTimeout: 64e3, fragLoadingTimeOut: 2e4, fragLoadingMaxRetry: 6, fragLoadingRetryDelay: 1e3, fragLoadingMaxRetryTimeout: 64e3, startFragPrefetch: !1, fpsDroppedMonitoringPeriod: 5e3, fpsDroppedMonitoringThreshold: 0.2, appendErrorMaxRetry: 3, loader: s.default, fLoader: void 0, pLoader: void 0, xhrSetup: void 0, licenseXhrSetup: void 0, abrController: i.default, bufferController: n.default, capLevelController: a.default, fpsController: o.default, stretchShortVideoTrack: !1, maxAudioFramesDrift: 1, forceKeyFrameOnDiscontinuity: !0, abrEwmaFastLive: 3, abrEwmaSlowLive: 9, abrEwmaFastVoD: 3, abrEwmaSlowVoD: 9, abrEwmaDefaultEstimate: 5e5, abrBandWidthFactor: 0.95, abrBandWidthUpFactor: 0.7, abrMaxWithRealBitrate: !1, maxStarvationDelay: 4, maxLoadingDelay: 4, minAutoBitrate: 0, emeEnabled: !1, widevineLicenseUrl: void 0, requestMediaKeySystemAccessFunc: g.requestMediaKeySystemAccess }, t.hlsDefaultConfig.subtitleStreamController = h.SubtitleStreamController, t.hlsDefaultConfig.subtitleTrackController = f.default, t.hlsDefaultConfig.timelineController = d.default, t.hlsDefaultConfig.cueHandler = c, t.hlsDefaultConfig.enableCEA708Captions = !0, t.hlsDefaultConfig.enableWebVTT = !0, t.hlsDefaultConfig.captionsTextTrack1Label = 'English', t.hlsDefaultConfig.captionsTextTrack1LanguageCode = 'en', t.hlsDefaultConfig.captionsTextTrack2Label = 'Spanish', t.hlsDefaultConfig.captionsTextTrack2LanguageCode = 'es', t.hlsDefaultConfig.audioStreamController = u.default, t.hlsDefaultConfig.audioTrackController = l.default, t.hlsDefaultConfig.emeController = p.default },
        './src/controller/abr-controller.js':
        /*! ******************************************!*\
  !*** ./src/controller/abr-controller.js ***!
  \******************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = r(/*! ../utils/buffer-helper */'./src/utils/buffer-helper.js'); var s = r(/*! ../errors */'./src/errors.js'); var l = r(/*! ../utils/logger */'./src/utils/logger.js'); var u = r(/*! ../utils/ewma-bandwidth-estimator */'./src/utils/ewma-bandwidth-estimator.js'); var c = window.performance; var d = (function (t) { function r (e) { var r = t.call(this, e, n.default.FRAG_LOADING, n.default.FRAG_LOADED, n.default.FRAG_BUFFERED, n.default.ERROR) || this; return r.lastLoadedFragLevel = 0, r._nextAutoLevel = -1, r.hls = e, r.timer = null, r._bwEstimator = null, r.onCheck = r._abandonRulesCheck.bind(r), r } return i(r, t), r.prototype.destroy = function () { this.clearTimer(), a.default.prototype.destroy.call(this) }, r.prototype.onFragLoading = function (e) { var t = e.frag; if (t.type === 'main' && (this.timer || (this.fragCurrent = t, this.timer = setInterval(this.onCheck, 100)), !this._bwEstimator)) { var r = this.hls; var i = r.config; var n = t.level; var a = r.levels[n].details.live; var o = void 0; var s = void 0; a ? (o = i.abrEwmaFastLive, s = i.abrEwmaSlowLive) : (o = i.abrEwmaFastVoD, s = i.abrEwmaSlowVoD), this._bwEstimator = new u.default(r, s, o, i.abrEwmaDefaultEstimate) } }, r.prototype._abandonRulesCheck = function () { var e = this.hls; var t = e.media; var r = this.fragCurrent; if (r) { var i = r.loader; var a = e.minAutoLevel; if (!i || i.stats && i.stats.aborted) return l.logger.warn('frag loader destroy or aborted, disarm abandonRules'), this.clearTimer(), void (this._nextAutoLevel = -1); var s = i.stats; if (t && s && (!t.paused && t.playbackRate !== 0 || !t.readyState) && r.autoLevel && r.level) { var u = c.now() - s.trequest; var d = Math.abs(t.playbackRate); if (u > 500 * r.duration / d) { var f = e.levels; var h = Math.max(1, s.bw ? s.bw / 8 : 1e3 * s.loaded / u); var p = f[r.level]; var g = p.realBitrate ? Math.max(p.realBitrate, p.bitrate) : p.bitrate; var v = s.total ? s.total : Math.max(s.loaded, Math.round(r.duration * g / 8)); var y = t.currentTime; var m = (v - s.loaded) / h; var b = (o.BufferHelper.bufferInfo(t, y, e.config.maxBufferHole).end - y) / d; if (b < 2 * r.duration / d && m > b) { var E = void 0; var _ = void 0; for (_ = r.level - 1; _ > a; _--) { var S = f[_].realBitrate ? Math.max(f[_].realBitrate, f[_].bitrate) : f[_].bitrate; if (E = r.duration * S / (6.4 * h), E < b) break }E < m && (l.logger.warn('loading too slow, abort fragment loading and switch to level ' + _ + ':fragLoadedDelay[' + _ + ']<fragLoadedDelay[' + (r.level - 1) + '];bufferStarvationDelay:' + E.toFixed(1) + '<' + m.toFixed(1) + ':' + b.toFixed(1)), e.nextLoadLevel = _, this._bwEstimator.sample(u, s.loaded), i.abort(), this.clearTimer(), e.trigger(n.default.FRAG_LOAD_EMERGENCY_ABORTED, { frag: r, stats: s })) } } } } }, r.prototype.onFragLoaded = function (t) { var r = t.frag; if (r.type === 'main' && e.isFinite(r.sn)) { if (this.clearTimer(), this.lastLoadedFragLevel = r.level, this._nextAutoLevel = -1, this.hls.config.abrMaxWithRealBitrate) { var i = this.hls.levels[r.level]; var n = (i.loaded ? i.loaded.bytes : 0) + t.stats.loaded; var a = (i.loaded ? i.loaded.duration : 0) + t.frag.duration; i.loaded = { bytes: n, duration: a }, i.realBitrate = Math.round(8 * n / a) } if (t.frag.bitrateTest) { var o = t.stats; o.tparsed = o.tbuffered = o.tload, this.onFragBuffered(t) } } }, r.prototype.onFragBuffered = function (t) { var r = t.stats; var i = t.frag; if (!0 !== r.aborted && i.type === 'main' && e.isFinite(i.sn) && (!i.bitrateTest || r.tload === r.tbuffered)) { var n = r.tparsed - r.trequest; l.logger.log('latency/loading/parsing/append/kbps:' + Math.round(r.tfirst - r.trequest) + '/' + Math.round(r.tload - r.tfirst) + '/' + Math.round(r.tparsed - r.tload) + '/' + Math.round(r.tbuffered - r.tparsed) + '/' + Math.round(8 * r.loaded / (r.tbuffered - r.trequest))), this._bwEstimator.sample(n, r.loaded), r.bwEstimate = this._bwEstimator.getEstimate(), i.bitrateTest ? this.bitrateTestDelay = n / 1e3 : this.bitrateTestDelay = 0 } }, r.prototype.onError = function (e) { switch (e.details) { case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer(); break; default:break } }, r.prototype.clearTimer = function () { clearInterval(this.timer), this.timer = null }, Object.defineProperty(r.prototype, 'nextAutoLevel', { get: function () { var e = this._nextAutoLevel; var t = this._bwEstimator; if (e !== -1 && (!t || !t.canEstimate())) return e; var r = this._nextABRAutoLevel; return e !== -1 && (r = Math.min(e, r)), r }, set: function (e) { this._nextAutoLevel = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, '_nextABRAutoLevel', { get: function () { var e = this.hls; var t = e.maxAutoLevel; var r = e.levels; var i = e.config; var n = e.minAutoLevel; var a = e.media; var s = this.lastLoadedFragLevel; var u = this.fragCurrent ? this.fragCurrent.duration : 0; var c = a ? a.currentTime : 0; var d = a && a.playbackRate !== 0 ? Math.abs(a.playbackRate) : 1; var f = this._bwEstimator ? this._bwEstimator.getEstimate() : i.abrEwmaDefaultEstimate; var h = (o.BufferHelper.bufferInfo(a, c, i.maxBufferHole).end - c) / d; var p = this._findBestLevel(s, u, f, n, t, h, i.abrBandWidthFactor, i.abrBandWidthUpFactor, r); if (p >= 0) return p; l.logger.trace('rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering'); var g = u ? Math.min(u, i.maxStarvationDelay) : i.maxStarvationDelay; var v = i.abrBandWidthFactor; var y = i.abrBandWidthUpFactor; if (h === 0) { var m = this.bitrateTestDelay; if (m) { var b = u ? Math.min(u, i.maxLoadingDelay) : i.maxLoadingDelay; g = b - m, l.logger.trace('bitrate test took ' + Math.round(1e3 * m) + 'ms, set first fragment max fetchDuration to ' + Math.round(1e3 * g) + ' ms'), v = y = 1 } } return p = this._findBestLevel(s, u, f, n, t, h + g, v, y, r), Math.max(p, 0) }, enumerable: !0, configurable: !0 }), r.prototype._findBestLevel = function (e, t, r, i, n, a, o, s, u) { for (var c = n; c >= i; c--) { var d = u[c]; if (d) { var f = d.details; var h = f ? f.totalduration / f.fragments.length : t; var p = !!f && f.live; var g = void 0; g = c <= e ? o * r : s * r; var v = u[c].realBitrate ? Math.max(u[c].realBitrate, u[c].bitrate) : u[c].bitrate; var y = v * h / g; if (l.logger.trace('level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: ' + c + '/' + Math.round(g) + '/' + v + '/' + h + '/' + a + '/' + y), g > v && (!y || p && !this.bitrateTestDelay || y < a)) return c } } return -1 }, r }(a.default)); t.default = d }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/audio-stream-controller.js':
        /*! ***************************************************!*\
  !*** ./src/controller/audio-stream-controller.js ***!
  \***************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../utils/binary-search */'./src/utils/binary-search.js'); var a = r(/*! ../utils/buffer-helper */'./src/utils/buffer-helper.js'); var o = r(/*! ../demux/demuxer */'./src/demux/demuxer.js'); var s = r(/*! ../events */'./src/events.js'); var l = r(/*! ./level-helper */'./src/controller/level-helper.js'); var u = r(/*! ../utils/time-ranges */'./src/utils/time-ranges.js'); var c = r(/*! ../errors */'./src/errors.js'); var d = r(/*! ../utils/logger */'./src/utils/logger.js'); var f = r(/*! ../utils/discontinuities */'./src/utils/discontinuities.js'); var h = r(/*! ./fragment-tracker */'./src/controller/fragment-tracker.js'); var p = r(/*! ../loader/fragment */'./src/loader/fragment.js'); var g = r(/*! ./base-stream-controller */'./src/controller/base-stream-controller.js'); var v = window.performance; var y = 100; var m = (function (t) { function r (e, r) { var i = t.call(this, e, s.default.MEDIA_ATTACHED, s.default.MEDIA_DETACHING, s.default.AUDIO_TRACKS_UPDATED, s.default.AUDIO_TRACK_SWITCHING, s.default.AUDIO_TRACK_LOADED, s.default.KEY_LOADED, s.default.FRAG_LOADED, s.default.FRAG_PARSING_INIT_SEGMENT, s.default.FRAG_PARSING_DATA, s.default.FRAG_PARSED, s.default.ERROR, s.default.BUFFER_RESET, s.default.BUFFER_CREATED, s.default.BUFFER_APPENDED, s.default.BUFFER_FLUSHED, s.default.INIT_PTS_FOUND) || this; return i.fragmentTracker = r, i.config = e.config, i.audioCodecSwap = !1, i._state = g.State.STOPPED, i.initPTS = [], i.waitingFragment = null, i.videoTrackCC = null, i } return i(r, t), r.prototype.onInitPtsFound = function (e) { var t = e.id; var r = e.frag.cc; var i = e.initPTS; t === 'main' && (this.initPTS[r] = i, this.videoTrackCC = r, d.logger.log('InitPTS for cc: ' + r + ' found from video track: ' + i), this.state === g.State.WAITING_INIT_PTS && this.tick()) }, r.prototype.startLoad = function (e) { if (this.tracks) { var t = this.lastCurrentTime; this.stopLoad(), this.setInterval(y), this.fragLoadError = 0, t > 0 && e === -1 ? (d.logger.log('audio:override startPosition with lastCurrentTime @' + t.toFixed(3)), this.state = g.State.IDLE) : (this.lastCurrentTime = this.startPosition ? this.startPosition : e, this.state = g.State.STARTING), this.nextLoadPosition = this.startPosition = this.lastCurrentTime, this.tick() } else this.startPosition = e, this.state = g.State.STOPPED }, Object.defineProperty(r.prototype, 'state', { get: function () { return this._state }, set: function (e) { if (this.state !== e) { var t = this.state; this._state = e, d.logger.log('audio stream:' + t + '->' + e) } }, enumerable: !0, configurable: !0 }), r.prototype.doTick = function () { var t; var r; var i; var o = this.hls; var l = o.config; switch (this.state) { case g.State.ERROR:case g.State.PAUSED:case g.State.BUFFER_FLUSHING:break; case g.State.STARTING:this.state = g.State.WAITING_TRACK, this.loadedmetadata = !1; break; case g.State.IDLE:var u = this.tracks; if (!u) break; if (!this.media && (this.startFragRequested || !l.startFragPrefetch)) break; if (this.loadedmetadata)t = this.media.currentTime; else if (t = this.nextLoadPosition, void 0 === t) break; var c = this.mediaBuffer ? this.mediaBuffer : this.media; var p = this.videoBuffer ? this.videoBuffer : this.media; var y = a.BufferHelper.bufferInfo(c, t, l.maxBufferHole); var m = a.BufferHelper.bufferInfo(p, t, l.maxBufferHole); var b = y.len; var E = y.end; var _ = this.fragPrevious; var S = Math.min(l.maxBufferLength, l.maxMaxBufferLength); var T = Math.max(S, m.len); var w = this.audioSwitch; var A = this.trackId; if ((b < T || w) && A < u.length) { if (i = u[A].details, typeof i === 'undefined') { this.state = g.State.WAITING_TRACK; break } if (!w && this._streamEnded(y, i)) return this.hls.trigger(s.default.BUFFER_EOS, { type: 'audio' }), void (this.state = g.State.ENDED); var L = i.fragments; var R = L.length; var k = L[0].start; var D = L[R - 1].start + L[R - 1].duration; var O = void 0; if (w) if (i.live && !i.PTSKnown)d.logger.log('switching audiotrack, live stream, unknown PTS,load first fragment'), E = 0; else if (E = t, i.PTSKnown && t < k) { if (!(y.end > k || y.nextStart)) return; d.logger.log('alt audio track ahead of main track, seek to start of alt audio track'), this.media.currentTime = k + 0.05 } if (i.initSegment && !i.initSegment.data)O = i.initSegment; else if (E <= k) { if (O = L[0], this.videoTrackCC !== null && O.cc !== this.videoTrackCC && (O = f.findFragWithCC(L, this.videoTrackCC)), i.live && O.loadIdx && O.loadIdx === this.fragLoadIdx) { var P = y.nextStart ? y.nextStart : k; return d.logger.log('no alt audio available @currentTime:' + this.media.currentTime + ', seeking @' + (P + 0.05)), void (this.media.currentTime = P + 0.05) } } else { var I = void 0; var x = l.maxFragLookUpTolerance; var C = _ ? L[_.sn - L[0].sn + 1] : void 0; var F = function (e) { var t = Math.min(x, e.duration); return e.start + e.duration - t <= E ? 1 : e.start - t > E && e.start ? -1 : 0 }; E < D ? (E > D - x && (x = 0), I = C && !F(C) ? C : n.default.search(L, F)) : I = L[R - 1], I && (O = I, k = I.start, _ && O.level === _.level && O.sn === _.sn && (O.sn < i.endSN ? (O = L[O.sn + 1 - i.startSN], d.logger.log('SN just loaded, load next one: ' + O.sn)) : O = null)) }O && (O.encrypted ? (d.logger.log('Loading key for ' + O.sn + ' of [' + i.startSN + ' ,' + i.endSN + '],track ' + A), this.state = g.State.KEY_LOADING, o.trigger(s.default.KEY_LOADING, { frag: O })) : (d.logger.log('Loading ' + O.sn + ', cc: ' + O.cc + ' of [' + i.startSN + ' ,' + i.endSN + '],track ' + A + ', currentTime:' + t + ',bufferEnd:' + E.toFixed(3)), this.fragCurrent = O, (w || this.fragmentTracker.getState(O) === h.FragmentState.NOT_LOADED) && (this.startFragRequested = !0, e.isFinite(O.sn) && (this.nextLoadPosition = O.start + O.duration), o.trigger(s.default.FRAG_LOADING, { frag: O }), this.state = g.State.FRAG_LOADING))) } break; case g.State.WAITING_TRACK:r = this.tracks[this.trackId], r && r.details && (this.state = g.State.IDLE); break; case g.State.FRAG_LOADING_WAITING_RETRY:var M = v.now(); var j = this.retryDate; c = this.media; var N = c && c.seeking; (!j || M >= j || N) && (d.logger.log('audioStreamController: retryDate reached, switch back to IDLE state'), this.state = g.State.IDLE); break; case g.State.WAITING_INIT_PTS:var B = this.videoTrackCC; if (void 0 === this.initPTS[B]) break; var U = this.waitingFragment; if (U) { var G = U.frag.cc; B !== G ? (r = this.tracks[this.trackId], r.details && r.details.live && (d.logger.warn('Waiting fragment CC (' + G + ') does not match video track CC (' + B + ')'), this.waitingFragment = null, this.state = g.State.IDLE)) : (this.state = g.State.FRAG_LOADING, this.onFragLoaded(this.waitingFragment), this.waitingFragment = null) } else this.state = g.State.IDLE; break; case g.State.STOPPED:case g.State.FRAG_LOADING:case g.State.PARSING:case g.State.PARSED:case g.State.ENDED:break; default:break } }, r.prototype.onMediaAttached = function (e) { var t = this.media = this.mediaBuffer = e.media; this.onvseeking = this.onMediaSeeking.bind(this), this.onvended = this.onMediaEnded.bind(this), t.addEventListener('seeking', this.onvseeking), t.addEventListener('ended', this.onvended); var r = this.config; this.tracks && r.autoStartLoad && this.startLoad(r.startPosition) }, r.prototype.onMediaDetaching = function () { var e = this.media; e && e.ended && (d.logger.log('MSE detaching and video ended, reset startPosition'), this.startPosition = this.lastCurrentTime = 0), e && (e.removeEventListener('seeking', this.onvseeking), e.removeEventListener('ended', this.onvended), this.onvseeking = this.onvseeked = this.onvended = null), this.media = this.mediaBuffer = this.videoBuffer = null, this.loadedmetadata = !1, this.stopLoad() }, r.prototype.onAudioTracksUpdated = function (e) { d.logger.log('audio tracks updated'), this.tracks = e.audioTracks }, r.prototype.onAudioTrackSwitching = function (e) { var t = !!e.url; this.trackId = e.id, this.fragCurrent = null, this.state = g.State.PAUSED, this.waitingFragment = null, t ? this.setInterval(y) : this.demuxer && (this.demuxer.destroy(), this.demuxer = null), t && (this.audioSwitch = !0, this.state = g.State.IDLE), this.tick() }, r.prototype.onAudioTrackLoaded = function (t) { var r = t.details; var i = t.id; var n = this.tracks[i]; var a = r.totalduration; var o = 0; if (d.logger.log('track ' + i + ' loaded [' + r.startSN + ',' + r.endSN + '],duration:' + a), r.live) { var s = n.details; s && r.fragments.length > 0 ? (l.mergeDetails(s, r), o = r.fragments[0].start, r.PTSKnown ? d.logger.log('live audio playlist sliding:' + o.toFixed(3)) : d.logger.log('live audio playlist - outdated PTS, unknown sliding')) : (r.PTSKnown = !1, d.logger.log('live audio playlist - first load, unknown sliding')) } else r.PTSKnown = !1; if (n.details = r, !this.startFragRequested) { if (this.startPosition === -1) { var u = r.startTimeOffset; e.isFinite(u) ? (d.logger.log('start time offset found in playlist, adjust startPosition to ' + u), this.startPosition = u) : this.startPosition = 0 } this.nextLoadPosition = this.startPosition } this.state === g.State.WAITING_TRACK && (this.state = g.State.IDLE), this.tick() }, r.prototype.onKeyLoaded = function () { this.state === g.State.KEY_LOADING && (this.state = g.State.IDLE, this.tick()) }, r.prototype.onFragLoaded = function (e) { var t = this.fragCurrent; var r = e.frag; if (this.state === g.State.FRAG_LOADING && t && r.type === 'audio' && r.level === t.level && r.sn === t.sn) { var i = this.tracks[this.trackId]; var n = i.details; var a = n.totalduration; var l = t.level; var u = t.sn; var c = t.cc; var f = this.config.defaultAudioCodec || i.audioCodec || 'mp4a.40.2'; var h = this.stats = e.stats; if (u === 'initSegment') this.state = g.State.IDLE, h.tparsed = h.tbuffered = v.now(), n.initSegment.data = e.payload, this.hls.trigger(s.default.FRAG_BUFFERED, { stats: h, frag: t, id: 'audio' }), this.tick(); else { this.state = g.State.PARSING, this.appended = !1, this.demuxer || (this.demuxer = new o.default(this.hls, 'audio')); var p = this.initPTS[c]; var y = n.initSegment ? n.initSegment.data : []; if (n.initSegment || void 0 !== p) { this.pendingBuffering = !0, d.logger.log('Demuxing ' + u + ' of [' + n.startSN + ' ,' + n.endSN + '],track ' + l); var m = !1; this.demuxer.push(e.payload, y, f, null, t, a, m, p) } else d.logger.log('unknown video PTS for continuity counter ' + c + ', waiting for video PTS before demuxing audio frag ' + u + ' of [' + n.startSN + ' ,' + n.endSN + '],track ' + l), this.waitingFragment = e, this.state = g.State.WAITING_INIT_PTS } } this.fragLoadError = 0 }, r.prototype.onFragParsingInitSegment = function (e) { var t = this.fragCurrent; var r = e.frag; if (t && e.id === 'audio' && r.sn === t.sn && r.level === t.level && this.state === g.State.PARSING) { var i = e.tracks; var n = void 0; if (i.video && delete i.video, n = i.audio, n) { n.levelCodec = n.codec, n.id = e.id, this.hls.trigger(s.default.BUFFER_CODECS, i), d.logger.log('audio track:audio,container:' + n.container + ',codecs[level/parsed]=[' + n.levelCodec + '/' + n.codec + ']'); var a = n.initSegment; if (a) { var o = { type: 'audio', data: a, parent: 'audio', content: 'initSegment' }; this.audioSwitch ? this.pendingData = [o] : (this.appended = !0, this.pendingBuffering = !0, this.hls.trigger(s.default.BUFFER_APPENDING, o)) } this.tick() } } }, r.prototype.onFragParsingData = function (t) { var r = this; var i = this.fragCurrent; var n = t.frag; if (i && t.id === 'audio' && t.type === 'audio' && n.sn === i.sn && n.level === i.level && this.state === g.State.PARSING) { var a = this.trackId; var o = this.tracks[a]; var u = this.hls; e.isFinite(t.endPTS) || (t.endPTS = t.startPTS + i.duration, t.endDTS = t.startDTS + i.duration), i.addElementaryStream(p.default.ElementaryStreamTypes.AUDIO), d.logger.log('parsed ' + t.type + ',PTS:[' + t.startPTS.toFixed(3) + ',' + t.endPTS.toFixed(3) + '],DTS:[' + t.startDTS.toFixed(3) + '/' + t.endDTS.toFixed(3) + '],nb:' + t.nb), l.updateFragPTSDTS(o.details, i, t.startPTS, t.endPTS); var f = this.audioSwitch; var h = this.media; var v = !1; if (f && h) if (h.readyState) { var y = h.currentTime; d.logger.log('switching audio track : currentTime:' + y), y >= t.startPTS && (d.logger.log('switching audio track : flushing all audio'), this.state = g.State.BUFFER_FLUSHING, u.trigger(s.default.BUFFER_FLUSHING, { startOffset: 0, endOffset: e.POSITIVE_INFINITY, type: 'audio' }), v = !0, this.audioSwitch = !1, u.trigger(s.default.AUDIO_TRACK_SWITCHED, { id: a })) } else this.audioSwitch = !1, u.trigger(s.default.AUDIO_TRACK_SWITCHED, { id: a }); var m = this.pendingData; if (!m) return d.logger.warn('Apparently attempt to enqueue media payload without codec initialization data upfront'), void u.trigger(s.default.ERROR, { type: c.ErrorTypes.MEDIA_ERROR, details: null, fatal: !0 }); this.audioSwitch || ([t.data1, t.data2].forEach(function (e) { e && e.length && m.push({ type: t.type, data: e, parent: 'audio', content: 'data' }) }), !v && m.length && (m.forEach(function (e) { r.state === g.State.PARSING && (r.pendingBuffering = !0, r.hls.trigger(s.default.BUFFER_APPENDING, e)) }), this.pendingData = [], this.appended = !0)), this.tick() } }, r.prototype.onFragParsed = function (e) { var t = this.fragCurrent; var r = e.frag; t && e.id === 'audio' && r.sn === t.sn && r.level === t.level && this.state === g.State.PARSING && (this.stats.tparsed = v.now(), this.state = g.State.PARSED, this._checkAppendedParsed()) }, r.prototype.onBufferReset = function () { this.mediaBuffer = this.videoBuffer = null, this.loadedmetadata = !1 }, r.prototype.onBufferCreated = function (e) { var t = e.tracks.audio; t && (this.mediaBuffer = t.buffer, this.loadedmetadata = !0), e.tracks.video && (this.videoBuffer = e.tracks.video.buffer) }, r.prototype.onBufferAppended = function (e) { if (e.parent === 'audio') { var t = this.state; t !== g.State.PARSING && t !== g.State.PARSED || (this.pendingBuffering = e.pending > 0, this._checkAppendedParsed()) } }, r.prototype._checkAppendedParsed = function () { if (this.state === g.State.PARSED && (!this.appended || !this.pendingBuffering)) { var e = this.fragCurrent; var t = this.stats; var r = this.hls; if (e) { this.fragPrevious = e, t.tbuffered = v.now(), r.trigger(s.default.FRAG_BUFFERED, { stats: t, frag: e, id: 'audio' }); var i = this.mediaBuffer ? this.mediaBuffer : this.media; d.logger.log('audio buffered : ' + u.default.toString(i.buffered)), this.audioSwitch && this.appended && (this.audioSwitch = !1, r.trigger(s.default.AUDIO_TRACK_SWITCHED, { id: this.trackId })), this.state = g.State.IDLE } this.tick() } }, r.prototype.onError = function (t) { var r = t.frag; if (!r || r.type === 'audio') switch (t.details) { case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:var i = t.frag; if (i && i.type !== 'audio') break; if (!t.fatal) { var n = this.fragLoadError; n ? n++ : n = 1; var o = this.config; if (n <= o.fragLoadingMaxRetry) { this.fragLoadError = n; var l = Math.min(Math.pow(2, n - 1) * o.fragLoadingRetryDelay, o.fragLoadingMaxRetryTimeout); d.logger.warn('AudioStreamController: frag loading failed, retry in ' + l + ' ms'), this.retryDate = v.now() + l, this.state = g.State.FRAG_LOADING_WAITING_RETRY } else d.logger.error('AudioStreamController: ' + t.details + ' reaches max retry, redispatch as fatal ...'), t.fatal = !0, this.state = g.State.ERROR } break; case c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:this.state !== g.State.ERROR && (this.state = t.fatal ? g.State.ERROR : g.State.IDLE, d.logger.warn('AudioStreamController: ' + t.details + ' while loading frag, now switching to ' + this.state + ' state ...')); break; case c.ErrorDetails.BUFFER_FULL_ERROR:if (t.parent === 'audio' && (this.state === g.State.PARSING || this.state === g.State.PARSED)) { var u = this.mediaBuffer; var f = this.media.currentTime; var h = u && a.BufferHelper.isBuffered(u, f) && a.BufferHelper.isBuffered(u, f + 0.5); if (h) { o = this.config; o.maxMaxBufferLength >= o.maxBufferLength && (o.maxMaxBufferLength /= 2, d.logger.warn('AudioStreamController: reduce max buffer length to ' + o.maxMaxBufferLength + 's')), this.state = g.State.IDLE } else d.logger.warn('AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer'), this.fragCurrent = null, this.state = g.State.BUFFER_FLUSHING, this.hls.trigger(s.default.BUFFER_FLUSHING, { startOffset: 0, endOffset: e.POSITIVE_INFINITY, type: 'audio' }) } break; default:break } }, r.prototype.onBufferFlushed = function () { var e = this; var t = this.pendingData; t && t.length ? (d.logger.log('AudioStreamController: appending pending audio data after buffer flushed'), t.forEach(function (t) { e.hls.trigger(s.default.BUFFER_APPENDING, t) }), this.appended = !0, this.pendingData = [], this.state = g.State.PARSED) : (this.state = g.State.IDLE, this.fragPrevious = null, this.tick()) }, r }(g.default)); t.default = m }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/audio-track-controller.js':
        /*! **************************************************!*\
  !*** ./src/controller/audio-track-controller.js ***!
  \**************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../task-loop */'./src/task-loop.js'); var o = r(/*! ../utils/logger */'./src/utils/logger.js'); var s = r(/*! ../errors */'./src/errors.js'); var l = (function (e) { function t (t) { var r = e.call(this, t, n.default.MANIFEST_LOADING, n.default.MANIFEST_PARSED, n.default.AUDIO_TRACK_LOADED, n.default.AUDIO_TRACK_SWITCHED, n.default.LEVEL_LOADED, n.default.ERROR) || this; return r._trackId = -1, r._selectDefaultTrack = !0, r.tracks = [], r.trackIdBlacklist = Object.create(null), r.audioGroupId = null, r } return i(t, e), t.prototype.onManifestLoading = function () { this.tracks = [], this._trackId = -1, this._selectDefaultTrack = !0 }, t.prototype.onManifestParsed = function (e) { var t = this.tracks = e.audioTracks || []; this.hls.trigger(n.default.AUDIO_TRACKS_UPDATED, { audioTracks: t }) }, t.prototype.onAudioTrackLoaded = function (e) { if (e.id >= this.tracks.length)o.logger.warn('Invalid audio track id:', e.id); else { if (o.logger.log('audioTrack ' + e.id + ' loaded'), this.tracks[e.id].details = e.details, e.details.live && !this.hasInterval()) { var t = 1e3 * e.details.targetduration; this.setInterval(t) }!e.details.live && this.hasInterval() && this.clearInterval() } }, t.prototype.onAudioTrackSwitched = function (e) { var t = this.tracks[e.id].groupId; t && this.audioGroupId !== t && (this.audioGroupId = t) }, t.prototype.onLevelLoaded = function (e) { var t = this.hls.levels[e.level]; if (t.audioGroupIds) { var r = t.audioGroupIds[t.urlId]; this.audioGroupId !== r && (this.audioGroupId = r, this._selectInitialAudioTrack()) } }, t.prototype.onError = function (e) { e.type === s.ErrorTypes.NETWORK_ERROR && (e.fatal && this.clearInterval(), e.details === s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR && (o.logger.warn('Network failure on audio-track id:', e.context.id), this._handleLoadError())) }, Object.defineProperty(t.prototype, 'audioTracks', { get: function () { return this.tracks }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'audioTrack', { get: function () { return this._trackId }, set: function (e) { this._setAudioTrack(e), this._selectDefaultTrack = !1 }, enumerable: !0, configurable: !0 }), t.prototype._setAudioTrack = function (e) { if (this._trackId === e && this.tracks[this._trackId].details)o.logger.debug('Same id as current audio-track passed, and track details available -> no-op'); else if (e < 0 || e >= this.tracks.length)o.logger.warn('Invalid id passed to audio-track controller'); else { var t = this.tracks[e]; o.logger.log('Now switching to audio-track index ' + e), this.clearInterval(), this._trackId = e; var r = t.url; var i = t.type; var a = t.id; this.hls.trigger(n.default.AUDIO_TRACK_SWITCHING, { id: a, type: i, url: r }), this._loadTrackDetailsIfNeeded(t) } }, t.prototype.doTick = function () { this._updateTrack(this._trackId) }, t.prototype._selectInitialAudioTrack = function () { var e = this; var t = this.tracks; if (t.length) { var r = this.tracks[this._trackId]; var i = null; if (r && (i = r.name), this._selectDefaultTrack) { var a = t.filter(function (e) { return e.default }); a.length ? t = a : o.logger.warn('No default audio tracks defined') } var l = !1; var u = function () { t.forEach(function (t) { l || e.audioGroupId && t.groupId !== e.audioGroupId || i && i !== t.name || (e._setAudioTrack(t.id), l = !0) }) }; u(), l || (i = null, u()), l || (o.logger.error('No track found for running audio group-ID: ' + this.audioGroupId), this.hls.trigger(n.default.ERROR, { type: s.ErrorTypes.MEDIA_ERROR, details: s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR, fatal: !0 })) } }, t.prototype._needsTrackLoading = function (e) { var t = e.details; var r = e.url; return !(t && !t.live) && !!r }, t.prototype._loadTrackDetailsIfNeeded = function (e) { if (this._needsTrackLoading(e)) { var t = e.url; var r = e.id; o.logger.log('loading audio-track playlist for id: ' + r), this.hls.trigger(n.default.AUDIO_TRACK_LOADING, { url: t, id: r }) } }, t.prototype._updateTrack = function (e) { if (!(e < 0 || e >= this.tracks.length)) { this.clearInterval(), this._trackId = e, o.logger.log('trying to update audio-track ' + e); var t = this.tracks[e]; this._loadTrackDetailsIfNeeded(t) } }, t.prototype._handleLoadError = function () { this.trackIdBlacklist[this._trackId] = !0; var e = this._trackId; var t = this.tracks[e]; var r = t.name; var i = t.language; var n = t.groupId; o.logger.warn('Loading failed on audio track id: ' + e + ', group-id: ' + n + ', name/language: "' + r + '" / "' + i + '"'); for (var a = e, s = 0; s < this.tracks.length; s++) if (!this.trackIdBlacklist[s]) { var l = this.tracks[s]; if (l.name === r) { a = s; break } }a !== e ? (o.logger.log('Attempting audio-track fallback id:', a, 'group-id:', this.tracks[a].groupId), this._setAudioTrack(a)) : o.logger.warn('No fallback audio-track found for name/language: "' + r + '" / "' + i + '"') }, t }(a.default)); t.default = l },
        './src/controller/base-stream-controller.js':
        /*! **************************************************!*\
  !*** ./src/controller/base-stream-controller.js ***!
  \**************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../task-loop */'./src/task-loop.js'); var a = r(/*! ./fragment-tracker */'./src/controller/fragment-tracker.js'); var o = r(/*! ../utils/buffer-helper */'./src/utils/buffer-helper.js'); var s = r(/*! ../utils/logger */'./src/utils/logger.js'); t.State = { STOPPED: 'STOPPED', STARTING: 'STARTING', IDLE: 'IDLE', PAUSED: 'PAUSED', KEY_LOADING: 'KEY_LOADING', FRAG_LOADING: 'FRAG_LOADING', FRAG_LOADING_WAITING_RETRY: 'FRAG_LOADING_WAITING_RETRY', WAITING_TRACK: 'WAITING_TRACK', PARSING: 'PARSING', PARSED: 'PARSED', BUFFER_FLUSHING: 'BUFFER_FLUSHING', ENDED: 'ENDED', ERROR: 'ERROR', WAITING_INIT_PTS: 'WAITING_INIT_PTS', WAITING_LEVEL: 'WAITING_LEVEL' }; var l = (function (r) { function n () { return r !== null && r.apply(this, arguments) || this } return i(n, r), n.prototype.doTick = function () {}, n.prototype.startLoad = function () {}, n.prototype.stopLoad = function () { var e = this.fragCurrent; e && (e.loader && e.loader.abort(), this.fragmentTracker.removeFragment(e)), this.demuxer && (this.demuxer.destroy(), this.demuxer = null), this.fragCurrent = null, this.fragPrevious = null, this.clearInterval(), this.clearNextTick(), this.state = t.State.STOPPED }, n.prototype._streamEnded = function (e, t) { var r = this; var i = r.fragCurrent; var n = r.fragmentTracker; if (!t.live && i && !i.backtracked && i.sn === t.endSN && !e.nextStart) { var o = n.getState(i); return o === a.FragmentState.PARTIAL || o === a.FragmentState.OK } return !1 }, n.prototype.onMediaSeeking = function () { var r = this; var i = r.config; var n = r.media; var a = r.mediaBuffer; var l = r.state; var u = n ? n.currentTime : null; var c = o.BufferHelper.bufferInfo(a || n, u, this.config.maxBufferHole); if (e.isFinite(u) && s.logger.log('media seeking to ' + u.toFixed(3)), l === t.State.FRAG_LOADING) { var d = this.fragCurrent; if (c.len === 0 && d) { var f = i.maxFragLookUpTolerance; var h = d.start - f; var p = d.start + d.duration + f; u < h || u > p ? (d.loader && (s.logger.log('seeking outside of buffer while fragment load in progress, cancel fragment load'), d.loader.abort()), this.fragCurrent = null, this.fragPrevious = null, this.state = t.State.IDLE) : s.logger.log('seeking outside of buffer but within currently loaded fragment range') } } else l === t.State.ENDED && (c.len === 0 && (this.fragPrevious = null, this.fragCurrent = null), this.state = t.State.IDLE); n && (this.lastCurrentTime = u), this.loadedmetadata || (this.nextLoadPosition = this.startPosition = u), this.tick() }, n.prototype.onMediaEnded = function () { this.startPosition = this.lastCurrentTime = 0 }, n.prototype.onHandlerDestroying = function () { this.stopLoad(), r.prototype.onHandlerDestroying.call(this) }, n.prototype.onHandlerDestroyed = function () { this.state = t.State.STOPPED, this.fragmentTracker = null }, n }(n.default)); t.default = l }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/buffer-controller.js':
        /*! *********************************************!*\
  !*** ./src/controller/buffer-controller.js ***!
  \*********************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = r(/*! ../utils/logger */'./src/utils/logger.js'); var s = r(/*! ../errors */'./src/errors.js'); var l = r(/*! ../utils/mediasource-helper */'./src/utils/mediasource-helper.js'); var u = l.getMediaSource(); var c = (function (t) { function r (e) { var r = t.call(this, e, n.default.MEDIA_ATTACHING, n.default.MEDIA_DETACHING, n.default.MANIFEST_PARSED, n.default.BUFFER_RESET, n.default.BUFFER_APPENDING, n.default.BUFFER_CODECS, n.default.BUFFER_EOS, n.default.BUFFER_FLUSHING, n.default.LEVEL_PTS_UPDATED, n.default.LEVEL_UPDATED) || this; return r._msDuration = null, r._levelDuration = null, r._levelTargetDuration = 10, r._live = null, r._objectUrl = null, r.bufferCodecEventsExpected = 0, r.onsbue = r.onSBUpdateEnd.bind(r), r.onsbe = r.onSBUpdateError.bind(r), r.pendingTracks = {}, r.tracks = {}, r } return i(r, t), r.prototype.destroy = function () { a.default.prototype.destroy.call(this) }, r.prototype.onLevelPtsUpdated = function (e) { var t = e.type; var r = this.tracks.audio; if (t === 'audio' && r && r.container === 'audio/mpeg') { var i = this.sourceBuffer.audio; var n = Math.abs(i.timestampOffset - e.start); if (n > 0.1) { var a = i.updating; try { i.abort() } catch (s) { o.logger.warn('can not abort audio buffer: ' + s) }a ? this.audioTimestampOffset = e.start : (o.logger.warn('change mpeg audio timestamp offset from ' + i.timestampOffset + ' to ' + e.start), i.timestampOffset = e.start) } } }, r.prototype.onManifestParsed = function (e) { this.bufferCodecEventsExpected = e.altAudio ? 2 : 1, o.logger.log(this.bufferCodecEventsExpected + ' bufferCodec event(s) expected') }, r.prototype.onMediaAttaching = function (e) { var t = this.media = e.media; if (t) { var r = this.mediaSource = new u(); this.onmso = this.onMediaSourceOpen.bind(this), this.onmse = this.onMediaSourceEnded.bind(this), this.onmsc = this.onMediaSourceClose.bind(this), r.addEventListener('sourceopen', this.onmso), r.addEventListener('sourceended', this.onmse), r.addEventListener('sourceclose', this.onmsc), t.src = window.URL.createObjectURL(r), this._objectUrl = t.src } }, r.prototype.onMediaDetaching = function () { o.logger.log('media source detaching'); var e = this.mediaSource; if (e) { if (e.readyState === 'open') try { e.endOfStream() } catch (t) { o.logger.warn('onMediaDetaching:' + t.message + ' while calling endOfStream') }e.removeEventListener('sourceopen', this.onmso), e.removeEventListener('sourceended', this.onmse), e.removeEventListener('sourceclose', this.onmsc), this.media && (window.URL.revokeObjectURL(this._objectUrl), this.media.src === this._objectUrl ? (this.media.removeAttribute('src'), this.media.load()) : o.logger.warn('media.src was changed by a third party - skip cleanup')), this.mediaSource = null, this.media = null, this._objectUrl = null, this.pendingTracks = {}, this.tracks = {}, this.sourceBuffer = {}, this.flushRange = [], this.segments = [], this.appended = 0 } this.onmso = this.onmse = this.onmsc = null, this.hls.trigger(n.default.MEDIA_DETACHED) }, r.prototype.onMediaSourceOpen = function () { o.logger.log('media source opened'), this.hls.trigger(n.default.MEDIA_ATTACHED, { media: this.media }); var e = this.mediaSource; e && e.removeEventListener('sourceopen', this.onmso), this.checkPendingTracks() }, r.prototype.checkPendingTracks = function () { var e = this; var t = e.bufferCodecEventsExpected; var r = e.pendingTracks; var i = Object.keys(r).length; (i && !t || i === 2) && (this.createSourceBuffers(r), this.pendingTracks = {}, this.doAppending()) }, r.prototype.onMediaSourceClose = function () { o.logger.log('media source closed') }, r.prototype.onMediaSourceEnded = function () { o.logger.log('media source ended') }, r.prototype.onSBUpdateEnd = function () { if (this.audioTimestampOffset) { var e = this.sourceBuffer.audio; o.logger.warn('change mpeg audio timestamp offset from ' + e.timestampOffset + ' to ' + this.audioTimestampOffset), e.timestampOffset = this.audioTimestampOffset, delete this.audioTimestampOffset } this._needsFlush && this.doFlush(), this._needsEos && this.checkEos(), this.appending = !1; var t = this.parent; var r = this.segments.reduce(function (e, r) { return r.parent === t ? e + 1 : e }, 0); var i = {}; var a = this.sourceBuffer; for (var s in a)i[s] = a[s].buffered; this.hls.trigger(n.default.BUFFER_APPENDED, { parent: t, pending: r, timeRanges: i }), this._needsFlush || this.doAppending(), this.updateMediaElementDuration(), r === 0 && this.flushLiveBackBuffer() }, r.prototype.onSBUpdateError = function (e) { o.logger.error('sourceBuffer error:', e), this.hls.trigger(n.default.ERROR, { type: s.ErrorTypes.MEDIA_ERROR, details: s.ErrorDetails.BUFFER_APPENDING_ERROR, fatal: !1 }) }, r.prototype.onBufferReset = function () { var e = this.sourceBuffer; for (var t in e) { var r = e[t]; try { this.mediaSource.removeSourceBuffer(r), r.removeEventListener('updateend', this.onsbue), r.removeEventListener('error', this.onsbe) } catch (i) {} } this.sourceBuffer = {}, this.flushRange = [], this.segments = [], this.appended = 0 }, r.prototype.onBufferCodecs = function (e) { var t = this; if (!Object.keys(this.sourceBuffer).length) { Object.keys(e).forEach(function (r) { t.pendingTracks[r] = e[r] }); var r = this.mediaSource; this.bufferCodecEventsExpected = Math.max(this.bufferCodecEventsExpected - 1, 0), r && r.readyState === 'open' && this.checkPendingTracks() } }, r.prototype.createSourceBuffers = function (e) { var t = this.sourceBuffer; var r = this.mediaSource; for (var i in e) if (!t[i]) { var a = e[i]; var l = a.levelCodec || a.codec; var u = a.container + ';codecs=' + l; o.logger.log('creating sourceBuffer(' + u + ')'); try { var c = t[i] = r.addSourceBuffer(u); c.addEventListener('updateend', this.onsbue), c.addEventListener('error', this.onsbe), this.tracks[i] = { codec: l, container: a.container }, a.buffer = c } catch (d) { o.logger.error('error while trying to add sourceBuffer:' + d.message), this.hls.trigger(n.default.ERROR, { type: s.ErrorTypes.MEDIA_ERROR, details: s.ErrorDetails.BUFFER_ADD_CODEC_ERROR, fatal: !1, err: d, mimeType: u }) } } this.hls.trigger(n.default.BUFFER_CREATED, { tracks: e }) }, r.prototype.onBufferAppending = function (e) { this._needsFlush || (this.segments ? this.segments.push(e) : this.segments = [e], this.doAppending()) }, r.prototype.onBufferAppendFail = function (e) { o.logger.error('sourceBuffer error:', e.event), this.hls.trigger(n.default.ERROR, { type: s.ErrorTypes.MEDIA_ERROR, details: s.ErrorDetails.BUFFER_APPENDING_ERROR, fatal: !1 }) }, r.prototype.onBufferEos = function (e) { var t = this.sourceBuffer; var r = e.type; for (var i in t)r && i !== r || t[i].ended || (t[i].ended = !0, o.logger.log(i + ' sourceBuffer now EOS')); this.checkEos() }, r.prototype.checkEos = function () { var e = this.sourceBuffer; var t = this.mediaSource; if (t && t.readyState === 'open') { for (var r in e) { var i = e[r]; if (!i.ended) return; if (i.updating) return void (this._needsEos = !0) }o.logger.log('all media data are available, signal endOfStream() to MediaSource and stop loading fragment'); try { t.endOfStream() } catch (n) { o.logger.warn('exception while calling mediaSource.endOfStream()') } this._needsEos = !1 } else this._needsEos = !1 }, r.prototype.onBufferFlushing = function (e) { this.flushRange.push({ start: e.startOffset, end: e.endOffset, type: e.type }), this.flushBufferCounter = 0, this.doFlush() }, r.prototype.flushLiveBackBuffer = function () { if (this._live) { var e = this.hls.config.liveBackBufferLength; if (isFinite(e) && !(e < 0)) for (var t = this.media.currentTime, r = this.sourceBuffer, i = Object.keys(r), n = t - Math.max(e, this._levelTargetDuration), a = i.length - 1; a >= 0; a--) { var o = i[a]; var s = r[o].buffered; s.length > 0 && n > s.start(0) && this.removeBufferRange(o, r[o], 0, n) } } }, r.prototype.onLevelUpdated = function (e) { var t = e.details; t.fragments.length > 0 && (this._levelDuration = t.totalduration + t.fragments[0].start, this._levelTargetDuration = t.averagetargetduration || t.targetduration || 10, this._live = t.live, this.updateMediaElementDuration()) }, r.prototype.updateMediaElementDuration = function () { var t; var r = this.hls.config; if (this._levelDuration !== null && this.media && this.mediaSource && this.sourceBuffer && this.media.readyState !== 0 && this.mediaSource.readyState === 'open') { for (var i in this.sourceBuffer) if (!0 === this.sourceBuffer[i].updating) return; t = this.media.duration, this._msDuration === null && (this._msDuration = this.mediaSource.duration), !0 === this._live && !0 === r.liveDurationInfinity ? (o.logger.log('Media Source duration is set to Infinity'), this._msDuration = this.mediaSource.duration = 1 / 0) : (this._levelDuration > this._msDuration && this._levelDuration > t || !e.isFinite(t)) && (o.logger.log('Updating Media Source duration to ' + this._levelDuration.toFixed(3)), this._msDuration = this.mediaSource.duration = this._levelDuration) } }, r.prototype.doFlush = function () { while (this.flushRange.length) { var e = this.flushRange[0]; if (!this.flushBuffer(e.start, e.end, e.type)) return void (this._needsFlush = !0); this.flushRange.shift(), this.flushBufferCounter = 0 } if (this.flushRange.length === 0) { this._needsFlush = !1; var t = 0; var r = this.sourceBuffer; try { for (var i in r)t += r[i].buffered.length } catch (a) { o.logger.error('error while accessing sourceBuffer.buffered') } this.appended = t, this.hls.trigger(n.default.BUFFER_FLUSHED) } }, r.prototype.doAppending = function () { var e = this; var t = e.hls; var r = e.segments; var i = e.sourceBuffer; if (Object.keys(i).length) { if (this.media.error) return this.segments = [], void o.logger.error('trying to append although a media error occured, flush segment and abort'); if (this.appending) return; if (r && r.length) { var a = r.shift(); try { var l = a.type; var u = i[l]; u ? u.updating ? r.unshift(a) : (u.ended = !1, this.parent = a.parent, u.appendBuffer(a.data), this.appendError = 0, this.appended++, this.appending = !0) : this.onSBUpdateEnd() } catch (d) { o.logger.error('error while trying to append buffer:' + d.message), r.unshift(a); var c = { type: s.ErrorTypes.MEDIA_ERROR, parent: a.parent }; d.code !== 22 ? (this.appendError ? this.appendError++ : this.appendError = 1, c.details = s.ErrorDetails.BUFFER_APPEND_ERROR, this.appendError > t.config.appendErrorMaxRetry ? (o.logger.log('fail ' + t.config.appendErrorMaxRetry + ' times to append segment in sourceBuffer'), this.segments = [], c.fatal = !0, t.trigger(n.default.ERROR, c)) : (c.fatal = !1, t.trigger(n.default.ERROR, c))) : (this.segments = [], c.details = s.ErrorDetails.BUFFER_FULL_ERROR, c.fatal = !1, t.trigger(n.default.ERROR, c)) } } } }, r.prototype.flushBuffer = function (e, t, r) { var i; var n = this.sourceBuffer; if (Object.keys(n).length) { if (o.logger.log('flushBuffer,pos/start/end: ' + this.media.currentTime.toFixed(3) + '/' + e + '/' + t), this.flushBufferCounter < this.appended) { for (var a in n) if (!r || a === r) { if (i = n[a], i.ended = !1, i.updating) return o.logger.warn('cannot flush, sb updating in progress'), !1; if (this.removeBufferRange(a, i, e, t)) return this.flushBufferCounter++, !1 } } else o.logger.warn('abort flushing too many retries'); o.logger.log('buffer flushed') } return !0 }, r.prototype.removeBufferRange = function (e, t, r, i) { try { for (var n = 0; n < t.buffered.length; n++) { var a = t.buffered.start(n); var s = t.buffered.end(n); var l = Math.max(a, r); var u = Math.min(s, i); if (Math.min(u, s) - l > 0.5) return o.logger.log('sb remove ' + e + ' [' + l + ',' + u + '], of [' + a + ',' + s + '], pos:' + this.media.currentTime), t.remove(l, u), !0 } } catch (c) { o.logger.warn('removeBufferRange failed', c) } return !1 }, r }(a.default)); t.default = c }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/cap-level-controller.js':
        /*! ************************************************!*\
  !*** ./src/controller/cap-level-controller.js ***!
  \************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = (function (t) { function r (r) { var i = t.call(this, r, n.default.FPS_DROP_LEVEL_CAPPING, n.default.MEDIA_ATTACHING, n.default.MANIFEST_PARSED, n.default.BUFFER_CODECS, n.default.MEDIA_DETACHING) || this; return i.autoLevelCapping = e.POSITIVE_INFINITY, i.firstLevel = null, i.levels = [], i.media = null, i.restrictedLevels = [], i.timer = null, i } return i(r, t), r.prototype.destroy = function () { this.hls.config.capLevelToPlayerSize && (this.media = null, this._stopCapping()) }, r.prototype.onFpsDropLevelCapping = function (e) { r.isLevelAllowed(e.droppedLevel, this.restrictedLevels) && this.restrictedLevels.push(e.droppedLevel) }, r.prototype.onMediaAttaching = function (e) { this.media = e.media instanceof window.HTMLVideoElement ? e.media : null }, r.prototype.onManifestParsed = function (e) { var t = this.hls; this.restrictedLevels = [], this.levels = e.levels, this.firstLevel = e.firstLevel, t.config.capLevelToPlayerSize && e.video && this._startCapping() }, r.prototype.onBufferCodecs = function (e) { var t = this.hls; t.config.capLevelToPlayerSize && e.video && this._startCapping() }, r.prototype.onLevelsUpdated = function (e) { this.levels = e.levels }, r.prototype.onMediaDetaching = function () { this._stopCapping() }, r.prototype.detectPlayerSize = function () { if (this.media) { var e = this.levels ? this.levels.length : 0; if (e) { var t = this.hls; t.autoLevelCapping = this.getMaxLevel(e - 1), t.autoLevelCapping > this.autoLevelCapping && t.streamController.nextLevelSwitch(), this.autoLevelCapping = t.autoLevelCapping } } }, r.prototype.getMaxLevel = function (e) { var t = this; if (!this.levels) return -1; var i = this.levels.filter(function (i, n) { return r.isLevelAllowed(n, t.restrictedLevels) && n <= e }); return r.getMaxLevelByMediaSize(i, this.mediaWidth, this.mediaHeight) }, r.prototype._startCapping = function () { this.timer || (this.autoLevelCapping = e.POSITIVE_INFINITY, this.hls.firstLevel = this.getMaxLevel(this.firstLevel), clearInterval(this.timer), this.timer = setInterval(this.detectPlayerSize.bind(this), 1e3), this.detectPlayerSize()) }, r.prototype._stopCapping = function () { this.restrictedLevels = [], this.firstLevel = null, this.autoLevelCapping = e.POSITIVE_INFINITY, this.timer && (this.timer = clearInterval(this.timer), this.timer = null) }, Object.defineProperty(r.prototype, 'mediaWidth', { get: function () { var e; var t = this.media; return t && (e = t.width || t.clientWidth || t.offsetWidth, e *= r.contentScaleFactor), e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, 'mediaHeight', { get: function () { var e; var t = this.media; return t && (e = t.height || t.clientHeight || t.offsetHeight, e *= r.contentScaleFactor), e }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, 'contentScaleFactor', { get: function () { var e = 1; try { e = window.devicePixelRatio } catch (t) {} return e }, enumerable: !0, configurable: !0 }), r.isLevelAllowed = function (e, t) { return void 0 === t && (t = []), t.indexOf(e) === -1 }, r.getMaxLevelByMediaSize = function (e, t, r) { if (!e || e && !e.length) return -1; for (var i = function (e, t) { return !t || (e.width !== t.width || e.height !== t.height) }, n = e.length - 1, a = 0; a < e.length; a += 1) { var o = e[a]; if ((o.width >= t || o.height >= r) && i(o, e[a + 1])) { n = a; break } } return n }, r }(a.default)); t.default = o }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/eme-controller.js':
        /*! ******************************************!*\
  !*** ./src/controller/eme-controller.js ***!
  \******************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../event-handler */'./src/event-handler.js'); var a = r(/*! ../events */'./src/events.js'); var o = r(/*! ../errors */'./src/errors.js'); var s = r(/*! ../utils/logger */'./src/utils/logger.js'); var l = window.XMLHttpRequest; var u = 3; var c = { WIDEVINE: 'com.widevine.alpha', PLAYREADY: 'com.microsoft.playready' }; var d = function (e, t, r) { var i = { videoCapabilities: [] }; return t.forEach(function (e) { i.videoCapabilities.push({ contentType: 'video/mp4; codecs="' + e + '"' }) }), [i] }; var f = function (e, t, r) { switch (e) { case c.WIDEVINE:return d(t, r); default:throw Error('Unknown key-system: ' + e) } }; var h = (function (e) { function t (t) { var r = e.call(this, t, a.default.MEDIA_ATTACHED, a.default.MANIFEST_PARSED) || this; return r._widevineLicenseUrl = t.config.widevineLicenseUrl, r._licenseXhrSetup = t.config.licenseXhrSetup, r._emeEnabled = t.config.emeEnabled, r._requestMediaKeySystemAccess = t.config.requestMediaKeySystemAccessFunc, r._mediaKeysList = [], r._media = null, r._hasSetMediaKeys = !1, r._isMediaEncrypted = !1, r._requestLicenseFailureCount = 0, r } return i(t, e), t.prototype.getLicenseServerUrl = function (e) { var t; switch (e) { case c.WIDEVINE:t = this._widevineLicenseUrl; break; default:t = null; break } return t || (s.logger.error('No license server URL configured for key-system "' + e + '"'), this.hls.trigger(a.default.ERROR, { type: o.ErrorTypes.KEY_SYSTEM_ERROR, details: o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED, fatal: !0 })), t }, t.prototype._attemptKeySystemAccess = function (e, t, r) { var i = this; var n = f(e, t, r); n ? (s.logger.log('Requesting encrypted media key-system access'), this.requestMediaKeySystemAccess(e, n).then(function (t) { i._onMediaKeySystemAccessObtained(e, t) }).catch(function (t) { s.logger.error('Failed to obtain key-system "' + e + '" access:', t) })) : s.logger.warn('Can not create config for key-system (maybe because platform is not supported):', e) }, Object.defineProperty(t.prototype, 'requestMediaKeySystemAccess', { get: function () { if (!this._requestMediaKeySystemAccess) throw new Error('No requestMediaKeySystemAccess function configured'); return this._requestMediaKeySystemAccess }, enumerable: !0, configurable: !0 }), t.prototype._onMediaKeySystemAccessObtained = function (e, t) { var r = this; s.logger.log('Access for key-system "' + e + '" obtained'); var i = { mediaKeys: null, mediaKeysSession: null, mediaKeysSessionInitialized: !1, mediaKeySystemAccess: t, mediaKeySystemDomain: e }; this._mediaKeysList.push(i), t.createMediaKeys().then(function (t) { i.mediaKeys = t, s.logger.log('Media-keys created for key-system "' + e + '"'), r._onMediaKeysCreated() }).catch(function (e) { s.logger.error('Failed to create media-keys:', e) }) }, t.prototype._onMediaKeysCreated = function () { var e = this; this._mediaKeysList.forEach(function (t) { t.mediaKeysSession || (t.mediaKeysSession = t.mediaKeys.createSession(), e._onNewMediaKeySession(t.mediaKeysSession)) }) }, t.prototype._onNewMediaKeySession = function (e) { var t = this; s.logger.log('New key-system session ' + e.sessionId), e.addEventListener('message', function (r) { t._onKeySessionMessage(e, r.message) }, !1) }, t.prototype._onKeySessionMessage = function (e, t) { s.logger.log('Got EME message event, creating license request'), this._requestLicense(t, function (t) { s.logger.log('Received license data, updating key-session'), e.update(t) }) }, t.prototype._onMediaEncrypted = function (e, t) { s.logger.log('Media is encrypted using "' + e + '" init data type'), this._isMediaEncrypted = !0, this._mediaEncryptionInitDataType = e, this._mediaEncryptionInitData = t, this._attemptSetMediaKeys(), this._generateRequestWithPreferredKeySession() }, t.prototype._attemptSetMediaKeys = function () { if (!this._hasSetMediaKeys) { var e = this._mediaKeysList[0]; if (!e || !e.mediaKeys) return s.logger.error('Fatal: Media is encrypted but no CDM access or no keys have been obtained yet'), void this.hls.trigger(a.default.ERROR, { type: o.ErrorTypes.KEY_SYSTEM_ERROR, details: o.ErrorDetails.KEY_SYSTEM_NO_KEYS, fatal: !0 }); s.logger.log('Setting keys for encrypted media'), this._media.setMediaKeys(e.mediaKeys), this._hasSetMediaKeys = !0 } }, t.prototype._generateRequestWithPreferredKeySession = function () { var e = this; var t = this._mediaKeysList[0]; if (!t) return s.logger.error('Fatal: Media is encrypted but not any key-system access has been obtained yet'), void this.hls.trigger(a.default.ERROR, { type: o.ErrorTypes.KEY_SYSTEM_ERROR, details: o.ErrorDetails.KEY_SYSTEM_NO_ACCESS, fatal: !0 }); if (t.mediaKeysSessionInitialized)s.logger.warn('Key-Session already initialized but requested again'); else { var r = t.mediaKeysSession; r || (s.logger.error('Fatal: Media is encrypted but no key-session existing'), this.hls.trigger(a.default.ERROR, { type: o.ErrorTypes.KEY_SYSTEM_ERROR, details: o.ErrorDetails.KEY_SYSTEM_NO_SESSION, fatal: !0 })); var i = this._mediaEncryptionInitDataType; var n = this._mediaEncryptionInitData; s.logger.log('Generating key-session request for "' + i + '" init data type'), t.mediaKeysSessionInitialized = !0, r.generateRequest(i, n).then(function () { s.logger.debug('Key-session generation succeeded') }).catch(function (t) { s.logger.error('Error generating key-session request:', t), e.hls.trigger(a.default.ERROR, { type: o.ErrorTypes.KEY_SYSTEM_ERROR, details: o.ErrorDetails.KEY_SYSTEM_NO_SESSION, fatal: !1 }) }) } }, t.prototype._createLicenseXhr = function (e, t, r) { var i = new l(); var n = this._licenseXhrSetup; try { if (n) try { n(i, e) } catch (u) { i.open('POST', e, !0), n(i, e) }i.readyState || i.open('POST', e, !0) } catch (u) { return s.logger.error('Error setting up key-system license XHR', u), void this.hls.trigger(a.default.ERROR, { type: o.ErrorTypes.KEY_SYSTEM_ERROR, details: o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED, fatal: !0 }) } return i.responseType = 'arraybuffer', i.onreadystatechange = this._onLicenseRequestReadyStageChange.bind(this, i, e, t, r), i }, t.prototype._onLicenseRequestReadyStageChange = function (e, t, r, i) { switch (e.readyState) { case 4:if (e.status === 200) this._requestLicenseFailureCount = 0, s.logger.log('License request succeeded'), i(e.response); else { if (s.logger.error('License Request XHR failed (' + t + '). Status: ' + e.status + ' (' + e.statusText + ')'), this._requestLicenseFailureCount++, this._requestLicenseFailureCount <= u) { var n = u - this._requestLicenseFailureCount + 1; return s.logger.warn('Retrying license request, ' + n + ' attempts left'), void this._requestLicense(r, i) } this.hls.trigger(a.default.ERROR, { type: o.ErrorTypes.KEY_SYSTEM_ERROR, details: o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED, fatal: !0 }) } break } }, t.prototype._generateLicenseRequestChallenge = function (e, t) { var r; return e.mediaKeySystemDomain === c.PLAYREADY ? s.logger.error('PlayReady is not supported (yet)') : e.mediaKeySystemDomain === c.WIDEVINE ? r = t : s.logger.error('Unsupported key-system:', e.mediaKeySystemDomain), r }, t.prototype._requestLicense = function (e, t) { s.logger.log('Requesting content license for key-system'); var r = this._mediaKeysList[0]; if (!r) return s.logger.error('Fatal error: Media is encrypted but no key-system access has been obtained yet'), void this.hls.trigger(a.default.ERROR, { type: o.ErrorTypes.KEY_SYSTEM_ERROR, details: o.ErrorDetails.KEY_SYSTEM_NO_ACCESS, fatal: !0 }); var i = this.getLicenseServerUrl(r.mediaKeySystemDomain); var n = this._createLicenseXhr(i, e, t); s.logger.log('Sending license request to URL: ' + i), n.send(this._generateLicenseRequestChallenge(r, e)) }, t.prototype.onMediaAttached = function (e) { var t = this; if (this._emeEnabled) { var r = e.media; this._media = r, r.addEventListener('encrypted', function (e) { t._onMediaEncrypted(e.initDataType, e.initData) }) } }, t.prototype.onManifestParsed = function (e) { if (this._emeEnabled) { var t = e.levels.map(function (e) { return e.audioCodec }); var r = e.levels.map(function (e) { return e.videoCodec }); this._attemptKeySystemAccess(c.WIDEVINE, t, r) } }, t }(n.default)); t.default = h },
        './src/controller/fps-controller.js':
        /*! ******************************************!*\
  !*** ./src/controller/fps-controller.js ***!
  \******************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = r(/*! ../utils/logger */'./src/utils/logger.js'); var s = window.performance; var l = (function (e) { function t (t) { return e.call(this, t, n.default.MEDIA_ATTACHING) || this } return i(t, e), t.prototype.destroy = function () { this.timer && clearInterval(this.timer), this.isVideoPlaybackQualityAvailable = !1 }, t.prototype.onMediaAttaching = function (e) { var t = this.hls.config; if (t.capLevelOnFPSDrop) { var r = this.video = e.media instanceof window.HTMLVideoElement ? e.media : null; typeof r.getVideoPlaybackQuality === 'function' && (this.isVideoPlaybackQualityAvailable = !0), clearInterval(this.timer), this.timer = setInterval(this.checkFPSInterval.bind(this), t.fpsDroppedMonitoringPeriod) } }, t.prototype.checkFPS = function (e, t, r) { var i = s.now(); if (t) { if (this.lastTime) { var a = i - this.lastTime; var l = r - this.lastDroppedFrames; var u = t - this.lastDecodedFrames; var c = 1e3 * l / a; var d = this.hls; if (d.trigger(n.default.FPS_DROP, { currentDropped: l, currentDecoded: u, totalDroppedFrames: r }), c > 0 && l > d.config.fpsDroppedMonitoringThreshold * u) { var f = d.currentLevel; o.logger.warn('drop FPS ratio greater than max allowed value for currentLevel: ' + f), f > 0 && (d.autoLevelCapping === -1 || d.autoLevelCapping >= f) && (f -= 1, d.trigger(n.default.FPS_DROP_LEVEL_CAPPING, { level: f, droppedLevel: d.currentLevel }), d.autoLevelCapping = f, d.streamController.nextLevelSwitch()) } } this.lastTime = i, this.lastDroppedFrames = r, this.lastDecodedFrames = t } }, t.prototype.checkFPSInterval = function () { var e = this.video; if (e) if (this.isVideoPlaybackQualityAvailable) { var t = e.getVideoPlaybackQuality(); this.checkFPS(e, t.totalVideoFrames, t.droppedVideoFrames) } else this.checkFPS(e, e.webkitDecodedFrameCount, e.webkitDroppedFrameCount) }, t }(a.default)); t.default = l },
        './src/controller/fragment-finders.js':
        /*! ********************************************!*\
  !*** ./src/controller/fragment-finders.js ***!
  \********************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../utils/binary-search */'./src/utils/binary-search.js'); function n (t, r, i) { if (!Array.isArray(t) || !t.length || !e.isFinite(r)) return null; if (r < t[0].programDateTime) return null; if (r >= t[t.length - 1].endProgramDateTime) return null; i = i || 0; for (var n = 0; n < t.length; ++n) { var a = t[n]; if (s(r, i, a)) return a } return null } function a (e, t, r, n) { void 0 === r && (r = 0), void 0 === n && (n = 0); var a = e ? t[e.sn - t[0].sn + 1] : null; return a && !o(r, n, a) ? a : i.default.search(t, o.bind(null, r, n)) } function o (e, t, r) { void 0 === e && (e = 0), void 0 === t && (t = 0); var i = Math.min(t, r.duration + (r.deltaPTS ? r.deltaPTS : 0)); return r.start + r.duration - i <= e ? 1 : r.start - i > e && r.start ? -1 : 0 } function s (e, t, r) { var i = 1e3 * Math.min(t, r.duration + (r.deltaPTS ? r.deltaPTS : 0)); return r.endProgramDateTime - i > e }t.findFragmentByPDT = n, t.findFragmentByPTS = a, t.fragmentWithinToleranceTest = o, t.pdtWithinToleranceTest = s }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/fragment-tracker.js':
        /*! ********************************************!*\
  !*** ./src/controller/fragment-tracker.js ***!
  \********************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../event-handler */'./src/event-handler.js'); var a = r(/*! ../events */'./src/events.js'); t.FragmentState = { NOT_LOADED: 'NOT_LOADED', APPENDING: 'APPENDING', PARTIAL: 'PARTIAL', OK: 'OK' }; var o = (function (r) { function o (e) { var t = r.call(this, e, a.default.BUFFER_APPENDED, a.default.FRAG_BUFFERED, a.default.FRAG_LOADED) || this; return t.bufferPadding = 0.2, t.fragments = Object.create(null), t.timeRanges = Object.create(null), t.config = e.config, t } return i(o, r), o.prototype.destroy = function () { this.fragments = Object.create(null), this.timeRanges = Object.create(null), this.config = null, n.default.prototype.destroy.call(this), r.prototype.destroy.call(this) }, o.prototype.getBufferedFrag = function (e, t) { var r = this.fragments; var i = Object.keys(r).filter(function (i) { var n = r[i]; if (n.body.type !== t) return !1; if (!n.buffered) return !1; var a = n.body; return a.startPTS <= e && e <= a.endPTS }); if (i.length === 0) return null; var n = i.pop(); return r[n].body }, o.prototype.detectEvictedFragments = function (e, t) { var r; var i; var n = this; Object.keys(this.fragments).forEach(function (a) { var o = n.fragments[a]; if (!0 === o.buffered) { var s = o.range[e]; if (s) { r = s.time; for (var l = 0; l < r.length; l++) if (i = r[l], !1 === n.isTimeBuffered(i.startPTS, i.endPTS, t)) { n.removeFragment(o.body); break } } } }) }, o.prototype.detectPartialFragments = function (e) { var t = this; var r = this.getFragmentKey(e); var i = this.fragments[r]; i && (i.buffered = !0, Object.keys(this.timeRanges).forEach(function (r) { if (e.hasElementaryStream(r)) { var n = t.timeRanges[r]; i.range[r] = t.getBufferedTimes(e.startPTS, e.endPTS, n) } })) }, o.prototype.getBufferedTimes = function (e, t, r) { for (var i, n, a = [], o = !1, s = 0; s < r.length; s++) { if (i = r.start(s) - this.bufferPadding, n = r.end(s) + this.bufferPadding, e >= i && t <= n) { a.push({ startPTS: Math.max(e, r.start(s)), endPTS: Math.min(t, r.end(s)) }); break } if (e < n && t > i)a.push({ startPTS: Math.max(e, r.start(s)), endPTS: Math.min(t, r.end(s)) }), o = !0; else if (t <= i) break } return { time: a, partial: o } }, o.prototype.getFragmentKey = function (e) { return e.type + '_' + e.level + '_' + e.urlId + '_' + e.sn }, o.prototype.getPartialFragment = function (e) { var t; var r; var i; var n = this; var a = null; var o = 0; return Object.keys(this.fragments).forEach(function (s) { var l = n.fragments[s]; n.isPartial(l) && (r = l.body.startPTS - n.bufferPadding, i = l.body.endPTS + n.bufferPadding, e >= r && e <= i && (t = Math.min(e - r, i - e), o <= t && (a = l.body, o = t))) }), a }, o.prototype.getState = function (e) { var r = this.getFragmentKey(e); var i = this.fragments[r]; var n = t.FragmentState.NOT_LOADED; return void 0 !== i && (n = i.buffered ? !0 === this.isPartial(i) ? t.FragmentState.PARTIAL : t.FragmentState.OK : t.FragmentState.APPENDING), n }, o.prototype.isPartial = function (e) { return !0 === e.buffered && (void 0 !== e.range.video && !0 === e.range.video.partial || void 0 !== e.range.audio && !0 === e.range.audio.partial) }, o.prototype.isTimeBuffered = function (e, t, r) { for (var i, n, a = 0; a < r.length; a++) { if (i = r.start(a) - this.bufferPadding, n = r.end(a) + this.bufferPadding, e >= i && t <= n) return !0; if (t <= i) return !1 } return !1 }, o.prototype.onFragLoaded = function (t) { var r = t.frag; e.isFinite(r.sn) && !r.bitrateTest && (this.fragments[this.getFragmentKey(r)] = { body: r, range: Object.create(null), buffered: !1 }) }, o.prototype.onBufferAppended = function (e) { var t = this; this.timeRanges = e.timeRanges, Object.keys(this.timeRanges).forEach(function (e) { var r = t.timeRanges[e]; t.detectEvictedFragments(e, r) }) }, o.prototype.onFragBuffered = function (e) { this.detectPartialFragments(e.frag) }, o.prototype.hasFragment = function (e) { var t = this.getFragmentKey(e); return void 0 !== this.fragments[t] }, o.prototype.removeFragment = function (e) { var t = this.getFragmentKey(e); delete this.fragments[t] }, o.prototype.removeAllFragments = function () { this.fragments = Object.create(null) }, o }(n.default)); t.FragmentTracker = o }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/gap-controller.js':
        /*! ******************************************!*\
  !*** ./src/controller/gap-controller.js ***!
  \******************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../utils/buffer-helper */'./src/utils/buffer-helper.js'); var n = r(/*! ../errors */'./src/errors.js'); var a = r(/*! ../events */'./src/events.js'); var o = r(/*! ../utils/logger */'./src/utils/logger.js'); var s = 1e3; var l = 0.5; var u = (function () { function e (e, t, r, i) { this.config = e, this.media = t, this.fragmentTracker = r, this.hls = i, this.stallReported = !1 } return e.prototype.poll = function (e, t) { var r = this; var n = r.config; var a = r.media; var l = a.currentTime; var u = window.performance.now(); if (l !== e) return this.stallReported && (o.logger.warn('playback not stuck anymore @' + l + ', after ' + Math.round(u - this.stalled) + 'ms'), this.stallReported = !1), this.stalled = null, void (this.nudgeRetry = 0); if (!(a.ended || !a.buffered.length || a.readyState > 2) && (!a.seeking || !i.BufferHelper.isBuffered(a, l))) { var c = u - this.stalled; var d = i.BufferHelper.bufferInfo(a, l, n.maxBufferHole); this.stalled ? (c >= s && this._reportStall(d.len), this._tryFixBufferStall(d, c)) : this.stalled = u } }, e.prototype._tryFixBufferStall = function (e, t) { var r = this; var i = r.config; var n = r.fragmentTracker; var a = r.media; var o = a.currentTime; var s = n.getPartialFragment(o); s && this._trySkipBufferHole(s), e.len > l && t > 1e3 * i.highBufferWatchdogPeriod && (this.stalled = null, this._tryNudgeBuffer()) }, e.prototype._reportStall = function (e) { var t = this; var r = t.hls; var i = t.media; var s = t.stallReported; s || (this.stallReported = !0, o.logger.warn('Playback stalling at @' + i.currentTime + ' due to low buffer'), r.trigger(a.default.ERROR, { type: n.ErrorTypes.MEDIA_ERROR, details: n.ErrorDetails.BUFFER_STALLED_ERROR, fatal: !1, buffer: e })) }, e.prototype._trySkipBufferHole = function (e) { for (var t = this, r = t.hls, i = t.media, s = i.currentTime, l = 0, u = 0; u < i.buffered.length; u++) { var c = i.buffered.start(u); if (s >= l && s < c) return i.currentTime = Math.max(c, i.currentTime + 0.1), o.logger.warn('skipping hole, adjusting currentTime from ' + s + ' to ' + i.currentTime), this.stalled = null, void r.trigger(a.default.ERROR, { type: n.ErrorTypes.MEDIA_ERROR, details: n.ErrorDetails.BUFFER_SEEK_OVER_HOLE, fatal: !1, reason: 'fragment loaded with buffer holes, seeking from ' + s + ' to ' + i.currentTime, frag: e }); l = i.buffered.end(u) } }, e.prototype._tryNudgeBuffer = function () { var e = this; var t = e.config; var r = e.hls; var i = e.media; var s = i.currentTime; var l = (this.nudgeRetry || 0) + 1; if (this.nudgeRetry = l, l < t.nudgeMaxRetry) { var u = s + l * t.nudgeOffset; o.logger.log('adjust currentTime from ' + s + ' to ' + u), i.currentTime = u, r.trigger(a.default.ERROR, { type: n.ErrorTypes.MEDIA_ERROR, details: n.ErrorDetails.BUFFER_NUDGE_ON_STALL, fatal: !1 }) } else o.logger.error('still stuck in high buffer @' + s + ' after ' + t.nudgeMaxRetry + ', raise fatal error'), r.trigger(a.default.ERROR, { type: n.ErrorTypes.MEDIA_ERROR, details: n.ErrorDetails.BUFFER_STALLED_ERROR, fatal: !0 }) }, e }()); t.default = u },
        './src/controller/id3-track-controller.js':
        /*! ************************************************!*\
  !*** ./src/controller/id3-track-controller.js ***!
  \************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = r(/*! ../demux/id3 */'./src/demux/id3.js'); var s = r(/*! ../utils/texttrack-utils */'./src/utils/texttrack-utils.js'); var l = (function (e) { function t (t) { var r = e.call(this, t, n.default.MEDIA_ATTACHED, n.default.MEDIA_DETACHING, n.default.FRAG_PARSING_METADATA) || this; return r.id3Track = void 0, r.media = void 0, r } return i(t, e), t.prototype.destroy = function () { a.default.prototype.destroy.call(this) }, t.prototype.onMediaAttached = function (e) { this.media = e.media, this.media }, t.prototype.onMediaDetaching = function () { s.clearCurrentCues(this.id3Track), this.id3Track = void 0, this.media = void 0 }, t.prototype.getID3Track = function (e) { for (var t = 0; t < e.length; t++) { var r = e[t]; if (r.kind === 'metadata' && r.label === 'id3') return s.sendAddTrackEvent(r, this.media), r } return this.media.addTextTrack('metadata', 'id3') }, t.prototype.onFragParsingMetadata = function (e) { var t = e.frag; var r = e.samples; this.id3Track || (this.id3Track = this.getID3Track(this.media.textTracks), this.id3Track.mode = 'hidden'); for (var i = window.WebKitDataCue || window.VTTCue || window.TextTrackCue, n = 0; n < r.length; n++) { var a = o.default.getID3Frames(r[n].data); if (a) { var s = r[n].pts; var l = n < r.length - 1 ? r[n + 1].pts : t.endPTS; s === l && (l += 1e-4); for (var u = 0; u < a.length; u++) { var c = a[u]; if (!o.default.isTimeStampFrame(c)) { var d = new i(s, l, ''); d.value = c, this.id3Track.addCue(d) } } } } }, t }(a.default)); t.default = l },
        './src/controller/level-controller.js':
        /*! ********************************************!*\
  !*** ./src/controller/level-controller.js ***!
  \********************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n; var a = r(/*! ../events */'./src/events.js'); var o = r(/*! ../event-handler */'./src/event-handler.js'); var s = r(/*! ../utils/logger */'./src/utils/logger.js'); var l = r(/*! ../errors */'./src/errors.js'); var u = r(/*! ../utils/codecs */'./src/utils/codecs.js'); var c = r(/*! ./level-helper */'./src/controller/level-helper.js'); var d = (window.performance, (function (e) { function t (t) { var r = e.call(this, t, a.default.MANIFEST_LOADED, a.default.LEVEL_LOADED, a.default.AUDIO_TRACK_SWITCHED, a.default.FRAG_LOADED, a.default.ERROR) || this; return r.canload = !1, r.currentLevelIndex = null, r.manualLevelIndex = -1, r.timer = null, n = /chrome|firefox/.test(navigator.userAgent.toLowerCase()), r } return i(t, e), t.prototype.onHandlerDestroying = function () { this.clearTimer(), this.manualLevelIndex = -1 }, t.prototype.clearTimer = function () { this.timer !== null && (clearTimeout(this.timer), this.timer = null) }, t.prototype.startLoad = function () { var e = this._levels; this.canload = !0, this.levelRetryCount = 0, e && e.forEach(function (e) { e.loadError = 0; var t = e.details; t && t.live && (e.details = void 0) }), this.timer !== null && this.loadLevel() }, t.prototype.stopLoad = function () { this.canload = !1 }, t.prototype.onManifestLoaded = function (e) { var t; var r = []; var i = []; var o = {}; var d = null; var f = !1; var h = !1; if (e.levels.forEach(function (e) { var t = e.attrs; e.loadError = 0, e.fragmentError = !1, f = f || !!e.videoCodec, h = h || !!e.audioCodec, n && e.audioCodec && e.audioCodec.indexOf('mp4a.40.34') !== -1 && (e.audioCodec = void 0), d = o[e.bitrate], d ? d.url.push(e.url) : (e.url = [e.url], e.urlId = 0, o[e.bitrate] = e, r.push(e)), t && (t.AUDIO && (h = !0, c.addGroupId(d || e, 'audio', t.AUDIO)), t.SUBTITLES && c.addGroupId(d || e, 'text', t.SUBTITLES)) }), f && h && (r = r.filter(function (e) { var t = e.videoCodec; return !!t })), r = r.filter(function (e) { var t = e.audioCodec; var r = e.videoCodec; return (!t || u.isCodecSupportedInMp4(t, 'audio')) && (!r || u.isCodecSupportedInMp4(r, 'video')) }), e.audioTracks && (i = e.audioTracks.filter(function (e) { return !e.audioCodec || u.isCodecSupportedInMp4(e.audioCodec, 'audio') }), i.forEach(function (e, t) { e.id = t })), r.length > 0) { t = r[0].bitrate, r.sort(function (e, t) { return e.bitrate - t.bitrate }), this._levels = r; for (var p = 0; p < r.length; p++) if (r[p].bitrate === t) { this._firstLevel = p, s.logger.log('manifest loaded,' + r.length + ' level(s) found, first bitrate:' + t); break } this.hls.trigger(a.default.MANIFEST_PARSED, { levels: r, audioTracks: i, firstLevel: this._firstLevel, stats: e.stats, audio: h, video: f, altAudio: i.some(function (e) { return !!e.url }) }) } else this.hls.trigger(a.default.ERROR, { type: l.ErrorTypes.MEDIA_ERROR, details: l.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR, fatal: !0, url: this.hls.url, reason: 'no level with compatible codecs found in manifest' }) }, Object.defineProperty(t.prototype, 'levels', { get: function () { return this._levels }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'level', { get: function () { return this.currentLevelIndex }, set: function (e) { var t = this._levels; t && (e = Math.min(e, t.length - 1), this.currentLevelIndex === e && t[e].details || this.setLevelInternal(e)) }, enumerable: !0, configurable: !0 }), t.prototype.setLevelInternal = function (e) { var t = this._levels; var r = this.hls; if (e >= 0 && e < t.length) { if (this.clearTimer(), this.currentLevelIndex !== e) { s.logger.log('switching to level ' + e), this.currentLevelIndex = e; var i = t[e]; i.level = e, r.trigger(a.default.LEVEL_SWITCHING, i) } var n = t[e]; var o = n.details; if (!o || o.live) { var u = n.urlId; r.trigger(a.default.LEVEL_LOADING, { url: n.url[u], level: e, id: u }) } } else r.trigger(a.default.ERROR, { type: l.ErrorTypes.OTHER_ERROR, details: l.ErrorDetails.LEVEL_SWITCH_ERROR, level: e, fatal: !1, reason: 'invalid level idx' }) }, Object.defineProperty(t.prototype, 'manualLevel', { get: function () { return this.manualLevelIndex }, set: function (e) { this.manualLevelIndex = e, void 0 === this._startLevel && (this._startLevel = e), e !== -1 && (this.level = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'firstLevel', { get: function () { return this._firstLevel }, set: function (e) { this._firstLevel = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'startLevel', { get: function () { if (void 0 === this._startLevel) { var e = this.hls.config.startLevel; return void 0 !== e ? e : this._firstLevel } return this._startLevel }, set: function (e) { this._startLevel = e }, enumerable: !0, configurable: !0 }), t.prototype.onError = function (e) { if (e.fatal)e.type === l.ErrorTypes.NETWORK_ERROR && this.clearTimer(); else { var t; var r = !1; var i = !1; switch (e.details) { case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:t = e.frag.level, i = !0; break; case l.ErrorDetails.LEVEL_LOAD_ERROR:case l.ErrorDetails.LEVEL_LOAD_TIMEOUT:t = e.context.level, r = !0; break; case l.ErrorDetails.REMUX_ALLOC_ERROR:t = e.level, r = !0; break } void 0 !== t && this.recoverLevel(e, t, r, i) } }, t.prototype.recoverLevel = function (e, t, r, i) { var n; var a; var o; var l = this; var u = this.hls.config; var c = e.details; var d = this._levels[t]; if (d.loadError++, d.fragmentError = i, r) { if (!(this.levelRetryCount + 1 <= u.levelLoadingMaxRetry)) return s.logger.error('level controller, cannot recover from ' + c + ' error'), this.currentLevelIndex = null, this.clearTimer(), void (e.fatal = !0); a = Math.min(Math.pow(2, this.levelRetryCount) * u.levelLoadingRetryDelay, u.levelLoadingMaxRetryTimeout), this.timer = setTimeout(function () { return l.loadLevel() }, a), e.levelRetry = !0, this.levelRetryCount++, s.logger.warn('level controller, ' + c + ', retry in ' + a + ' ms, current retry count is ' + this.levelRetryCount) }(r || i) && (n = d.url.length, n > 1 && d.loadError < n ? (d.urlId = (d.urlId + 1) % n, d.details = void 0, s.logger.warn('level controller, ' + c + ' for level ' + t + ': switching to redundant URL-id ' + d.urlId)) : this.manualLevelIndex === -1 ? (o = t === 0 ? this._levels.length - 1 : t - 1, s.logger.warn('level controller, ' + c + ': switch to ' + o), this.hls.nextAutoLevel = this.currentLevelIndex = o) : i && (s.logger.warn('level controller, ' + c + ': reload a fragment'), this.currentLevelIndex = null)) }, t.prototype.onFragLoaded = function (e) { var t = e.frag; if (void 0 !== t && t.type === 'main') { var r = this._levels[t.level]; void 0 !== r && (r.fragmentError = !1, r.loadError = 0, this.levelRetryCount = 0) } }, t.prototype.onLevelLoaded = function (e) { var t = this; var r = e.level; var i = e.details; if (r === this.currentLevelIndex) { var n = this._levels[r]; if (n.fragmentError || (n.loadError = 0, this.levelRetryCount = 0), i.live) { var a = c.computeReloadInterval(n.details, i, e.stats.trequest); s.logger.log('live playlist, reload in ' + Math.round(a) + ' ms'), this.timer = setTimeout(function () { return t.loadLevel() }, a) } else this.clearTimer() } }, t.prototype.onAudioTrackSwitched = function (e) { var t = this.hls.audioTracks[e.id].groupId; var r = this.hls.levels[this.currentLevelIndex]; if (r && r.audioGroupIds) { for (var i = -1, n = 0; n < r.audioGroupIds.length; n++) if (r.audioGroupIds[n] === t) { i = n; break }i !== r.urlId && (r.urlId = i, this.startLoad()) } }, t.prototype.loadLevel = function () { if (s.logger.debug('call to loadLevel'), this.currentLevelIndex !== null && this.canload) { var e = this._levels[this.currentLevelIndex]; if (typeof e === 'object' && e.url.length > 0) { var t = this.currentLevelIndex; var r = e.urlId; var i = e.url[r]; s.logger.log('Attempt loading level index ' + t + ' with URL-id ' + r), this.hls.trigger(a.default.LEVEL_LOADING, { url: i, level: t, id: r }) } } }, Object.defineProperty(t.prototype, 'nextLoadLevel', { get: function () { return this.manualLevelIndex !== -1 ? this.manualLevelIndex : this.hls.nextAutoLevel }, set: function (e) { this.level = e, this.manualLevelIndex === -1 && (this.hls.nextAutoLevel = e) }, enumerable: !0, configurable: !0 }), t }(o.default))); t.default = d },
        './src/controller/level-helper.js':
        /*! ****************************************!*\
  !*** ./src/controller/level-helper.js ***!
  \****************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../utils/logger */'./src/utils/logger.js'); function n (e, t, r) { switch (t) { case 'audio':e.audioGroupIds || (e.audioGroupIds = []), e.audioGroupIds.push(r); break; case 'text':e.textGroupIds || (e.textGroupIds = []), e.textGroupIds.push(r); break } } function a (t, r, n) { var a = t[r]; var o = t[n]; var s = o.startPTS; e.isFinite(s) ? n > r ? (a.duration = s - a.start, a.duration < 0 && i.logger.warn('negative duration computed for frag ' + a.sn + ',level ' + a.level + ', there should be some duration drift between playlist and fragment!')) : (o.duration = a.start - s, o.duration < 0 && i.logger.warn('negative duration computed for frag ' + o.sn + ',level ' + o.level + ', there should be some duration drift between playlist and fragment!')) : o.start = n > r ? a.start + a.duration : Math.max(a.start - o.duration, 0) } function o (t, r, i, n, o, s) { var l = i; if (e.isFinite(r.startPTS)) { var u = Math.abs(r.startPTS - i); e.isFinite(r.deltaPTS) ? r.deltaPTS = Math.max(u, r.deltaPTS) : r.deltaPTS = u, l = Math.max(i, r.startPTS), i = Math.min(i, r.startPTS), n = Math.max(n, r.endPTS), o = Math.min(o, r.startDTS), s = Math.max(s, r.endDTS) } var c = i - r.start; r.start = r.startPTS = i, r.maxStartPTS = l, r.endPTS = n, r.startDTS = o, r.endDTS = s, r.duration = n - i; var d; var f; var h; var p = r.sn; if (!t || p < t.startSN || p > t.endSN) return 0; for (d = p - t.startSN, f = t.fragments, f[d] = r, h = d; h > 0; h--)a(f, h, h - 1); for (h = d; h < f.length - 1; h++)a(f, h, h + 1); return t.PTSKnown = !0, c } function s (t, r) { r.initSegment && t.initSegment && (r.initSegment = t.initSegment); var n; var a = 0; if (u(t, r, function (t, i) { a = t.cc - i.cc, e.isFinite(t.startPTS) && (i.start = i.startPTS = t.startPTS, i.endPTS = t.endPTS, i.duration = t.duration, i.backtracked = t.backtracked, i.dropped = t.dropped, n = i), r.PTSKnown = !0 }), r.PTSKnown) { if (a) { i.logger.log('discontinuity sliding from playlist, take drift into account'); for (var s = r.fragments, l = 0; l < s.length; l++)s[l].cc += a }n ? o(r, n, n.startPTS, n.endPTS, n.startDTS, n.endDTS) : c(t, r), r.PTSKnown = t.PTSKnown } } function l (e, t, r) { void 0 === r && (r = 0); var i = -1; u(e, t, function (e, t, r) { t.start = e.start, i = r }); var n = t.fragments; if (i < 0)n.forEach(function (e) { e.start += r }); else for (var a = i + 1; a < n.length; a++)n[a].start = n[a - 1].start + n[a - 1].duration } function u (e, t, r) { if (e && t) for (var i = Math.max(e.startSN, t.startSN) - t.startSN, n = Math.min(e.endSN, t.endSN) - t.startSN, a = t.startSN - e.startSN, o = i; o <= n; o++) { var s = e.fragments[a + o]; var l = t.fragments[o]; if (!s || !l) break; r(s, l, o) } } function c (e, t) { var r = t.startSN - e.startSN; var i = e.fragments; var n = t.fragments; if (!(r < 0 || r > i.length)) for (var a = 0; a < n.length; a++)n[a].start += i[r].start } function d (e, t, r) { var i = 1e3 * (t.averagetargetduration ? t.averagetargetduration : t.targetduration); var n = i / 2; return e && t.endSN === e.endSN && (i = n), r && (i = Math.max(n, i - (window.performance.now() - r))), Math.round(i) }t.addGroupId = n, t.updatePTS = a, t.updateFragPTSDTS = o, t.mergeDetails = s, t.mergeSubtitlePlaylists = l, t.mapFragmentIntersection = u, t.adjustSliding = c, t.computeReloadInterval = d }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/stream-controller.js':
        /*! *********************************************!*\
  !*** ./src/controller/stream-controller.js ***!
  \*********************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../utils/binary-search */'./src/utils/binary-search.js'); var a = r(/*! ../utils/buffer-helper */'./src/utils/buffer-helper.js'); var o = r(/*! ../demux/demuxer */'./src/demux/demuxer.js'); var s = r(/*! ../events */'./src/events.js'); var l = r(/*! ./fragment-tracker */'./src/controller/fragment-tracker.js'); var u = r(/*! ../loader/fragment */'./src/loader/fragment.js'); var c = r(/*! ../loader/playlist-loader */'./src/loader/playlist-loader.js'); var d = r(/*! ./level-helper */'./src/controller/level-helper.js'); var f = r(/*! ../utils/time-ranges */'./src/utils/time-ranges.js'); var h = r(/*! ../errors */'./src/errors.js'); var p = r(/*! ../utils/logger */'./src/utils/logger.js'); var g = r(/*! ../utils/discontinuities */'./src/utils/discontinuities.js'); var v = r(/*! ./fragment-finders */'./src/controller/fragment-finders.js'); var y = r(/*! ./gap-controller */'./src/controller/gap-controller.js'); var m = r(/*! ./base-stream-controller */'./src/controller/base-stream-controller.js'); var b = 100; var E = (function (t) { function r (e, r) { var i = t.call(this, e, s.default.MEDIA_ATTACHED, s.default.MEDIA_DETACHING, s.default.MANIFEST_LOADING, s.default.MANIFEST_PARSED, s.default.LEVEL_LOADED, s.default.KEY_LOADED, s.default.FRAG_LOADED, s.default.FRAG_LOAD_EMERGENCY_ABORTED, s.default.FRAG_PARSING_INIT_SEGMENT, s.default.FRAG_PARSING_DATA, s.default.FRAG_PARSED, s.default.ERROR, s.default.AUDIO_TRACK_SWITCHING, s.default.AUDIO_TRACK_SWITCHED, s.default.BUFFER_CREATED, s.default.BUFFER_APPENDED, s.default.BUFFER_FLUSHED) || this; return i.fragmentTracker = r, i.config = e.config, i.audioCodecSwap = !1, i._state = m.State.STOPPED, i.stallReported = !1, i.gapController = null, i } return i(r, t), r.prototype.startLoad = function (e) { if (this.levels) { var t = this.lastCurrentTime; var r = this.hls; if (this.stopLoad(), this.setInterval(b), this.level = -1, this.fragLoadError = 0, !this.startFragRequested) { var i = r.startLevel; i === -1 && (i = 0, this.bitrateTest = !0), this.level = r.nextLoadLevel = i, this.loadedmetadata = !1 }t > 0 && e === -1 && (p.logger.log('override startPosition with lastCurrentTime @' + t.toFixed(3)), e = t), this.state = m.State.IDLE, this.nextLoadPosition = this.startPosition = this.lastCurrentTime = e, this.tick() } else this.forceStartLoad = !0, this.state = m.State.STOPPED }, r.prototype.stopLoad = function () { this.forceStartLoad = !1, t.prototype.stopLoad.call(this) }, r.prototype.doTick = function () { switch (this.state) { case m.State.BUFFER_FLUSHING:this.fragLoadError = 0; break; case m.State.IDLE:this._doTickIdle(); break; case m.State.WAITING_LEVEL:var e = this.levels[this.level]; e && e.details && (this.state = m.State.IDLE); break; case m.State.FRAG_LOADING_WAITING_RETRY:var t = window.performance.now(); var r = this.retryDate; (!r || t >= r || this.media && this.media.seeking) && (p.logger.log('mediaController: retryDate reached, switch back to IDLE state'), this.state = m.State.IDLE); break; case m.State.ERROR:case m.State.STOPPED:case m.State.FRAG_LOADING:case m.State.PARSING:case m.State.PARSED:case m.State.ENDED:break; default:break } this._checkBuffer(), this._checkFragmentChanged() }, r.prototype._doTickIdle = function () { var e = this.hls; var t = e.config; var r = this.media; if (void 0 !== this.levelLastLoaded && (r || !this.startFragRequested && t.startFragPrefetch)) { var i; i = this.loadedmetadata ? r.currentTime : this.nextLoadPosition; var n = e.nextLoadLevel; var o = this.levels[n]; if (o) { var l; var u = o.bitrate; l = u ? Math.max(8 * t.maxBufferSize / u, t.maxBufferLength) : t.maxBufferLength, l = Math.min(l, t.maxMaxBufferLength); var c = a.BufferHelper.bufferInfo(this.mediaBuffer ? this.mediaBuffer : r, i, t.maxBufferHole); var d = c.len; if (!(d >= l)) { p.logger.trace('buffer length of ' + d.toFixed(3) + ' is below max of ' + l.toFixed(3) + '. checking for more payload ...'), this.level = e.nextLoadLevel = n; var f = o.details; if (!f || f.live && this.levelLastLoaded !== n) this.state = m.State.WAITING_LEVEL; else { if (this._streamEnded(c, f)) { var h = {}; return this.altAudio && (h.type = 'video'), this.hls.trigger(s.default.BUFFER_EOS, h), void (this.state = m.State.ENDED) } this._fetchPayloadOrEos(i, c, f) } } } } }, r.prototype._fetchPayloadOrEos = function (e, t, r) { var i = this.fragPrevious; var n = this.level; var a = r.fragments; var o = a.length; if (o !== 0) { var s; var l = a[0].start; var u = a[o - 1].start + a[o - 1].duration; var c = t.end; if (r.initSegment && !r.initSegment.data)s = r.initSegment; else if (r.live) { var d = this.config.initialLiveManifestSize; if (o < d) return void p.logger.warn('Can not start playback of a level, reason: not enough fragments ' + o + ' < ' + d); if (s = this._ensureFragmentAtLivePoint(r, c, l, u, i, a, o), s === null) return } else c < l && (s = a[0]); s || (s = this._findFragment(l, i, o, a, c, u, r)), s && (s.encrypted ? (p.logger.log('Loading key for ' + s.sn + ' of [' + r.startSN + ' ,' + r.endSN + '],level ' + n), this._loadKey(s)) : (p.logger.log('Loading ' + s.sn + ' of [' + r.startSN + ' ,' + r.endSN + '],level ' + n + ', currentTime:' + e.toFixed(3) + ',bufferEnd:' + c.toFixed(3)), this._loadFragment(s))) } }, r.prototype._ensureFragmentAtLivePoint = function (e, t, r, i, a, o, s) { var l; var u = this.hls.config; var c = this.media; var d = void 0 !== u.liveMaxLatencyDuration ? u.liveMaxLatencyDuration : u.liveMaxLatencyDurationCount * e.targetduration; if (t < Math.max(r - u.maxFragLookUpTolerance, i - d)) { var f = this.liveSyncPosition = this.computeLivePosition(r, e); p.logger.log('buffer end: ' + t.toFixed(3) + ' is located too far from the end of live sliding playlist, reset currentTime to : ' + f.toFixed(3)), t = f, c && c.readyState && c.duration > f && (c.currentTime = f), this.nextLoadPosition = f } if (e.PTSKnown && t > i && c && c.readyState) return null; if (this.startFragRequested && !e.PTSKnown) { if (a) if (e.hasProgramDateTime)p.logger.log('live playlist, switching playlist, load frag with same PDT: ' + a.programDateTime), l = v.findFragmentByPDT(o, a.endProgramDateTime, u.maxFragLookUpTolerance); else { var h = a.sn + 1; if (h >= e.startSN && h <= e.endSN) { var g = o[h - e.startSN]; a.cc === g.cc && (l = g, p.logger.log('live playlist, switching playlist, load frag with next SN: ' + l.sn)) }l || (l = n.default.search(o, function (e) { return a.cc - e.cc }), l && p.logger.log('live playlist, switching playlist, load frag with same CC: ' + l.sn)) }l || (l = o[Math.min(s - 1, Math.round(s / 2))], p.logger.log('live playlist, switching playlist, unknown, load middle frag : ' + l.sn)) } return l }, r.prototype._findFragment = function (e, t, r, i, n, a, o) { var s; var l = this.hls.config; if (n < a) { var u = n > a - l.maxFragLookUpTolerance ? 0 : l.maxFragLookUpTolerance; s = v.findFragmentByPTS(t, i, n, u) } else s = i[r - 1]; if (s) { var c = s.sn - o.startSN; var d = t && s.level === t.level; var f = i[c - 1]; var h = i[c + 1]; if (t && s.sn === t.sn) if (d && !s.backtracked) if (s.sn < o.endSN) { var g = t.deltaPTS; g && g > l.maxBufferHole && t.dropped && c ? (s = f, p.logger.warn('SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this')) : (s = h, p.logger.log('SN just loaded, load next one: ' + s.sn, s)) } else s = null; else s.backtracked && (h && h.backtracked ? (p.logger.warn('Already backtracked from fragment ' + h.sn + ', will not backtrack to fragment ' + s.sn + '. Loading fragment ' + h.sn), s = h) : (p.logger.warn('Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe'), s.dropped = 0, f ? (s = f, s.backtracked = !0) : c && (s = null))) } return s }, r.prototype._loadKey = function (e) { this.state = m.State.KEY_LOADING, this.hls.trigger(s.default.KEY_LOADING, { frag: e }) }, r.prototype._loadFragment = function (t) { var r = this.fragmentTracker.getState(t); this.fragCurrent = t, this.startFragRequested = !0, e.isFinite(t.sn) && !t.bitrateTest && (this.nextLoadPosition = t.start + t.duration), t.backtracked || r === l.FragmentState.NOT_LOADED || r === l.FragmentState.PARTIAL ? (t.autoLevel = this.hls.autoLevelEnabled, t.bitrateTest = this.bitrateTest, this.hls.trigger(s.default.FRAG_LOADING, { frag: t }), this.demuxer || (this.demuxer = new o.default(this.hls, 'main')), this.state = m.State.FRAG_LOADING) : r === l.FragmentState.APPENDING && this._reduceMaxBufferLength(t.duration) && this.fragmentTracker.removeFragment(t) }, Object.defineProperty(r.prototype, 'state', { get: function () { return this._state }, set: function (e) { if (this.state !== e) { var t = this.state; this._state = e, p.logger.log('main stream:' + t + '->' + e), this.hls.trigger(s.default.STREAM_STATE_TRANSITION, { previousState: t, nextState: e }) } }, enumerable: !0, configurable: !0 }), r.prototype.getBufferedFrag = function (e) { return this.fragmentTracker.getBufferedFrag(e, c.default.LevelType.MAIN) }, Object.defineProperty(r.prototype, 'currentLevel', { get: function () { var e = this.media; if (e) { var t = this.getBufferedFrag(e.currentTime); if (t) return t.level } return -1 }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, 'nextBufferedFrag', { get: function () { var e = this.media; return e ? this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)) : null }, enumerable: !0, configurable: !0 }), r.prototype.followingBufferedFrag = function (e) { return e ? this.getBufferedFrag(e.endPTS + 0.5) : null }, Object.defineProperty(r.prototype, 'nextLevel', { get: function () { var e = this.nextBufferedFrag; return e ? e.level : -1 }, enumerable: !0, configurable: !0 }), r.prototype._checkFragmentChanged = function () { var e; var t; var r = this.media; if (r && r.readyState && !1 === r.seeking && (t = r.currentTime, t > this.lastCurrentTime && (this.lastCurrentTime = t), a.BufferHelper.isBuffered(r, t) ? e = this.getBufferedFrag(t) : a.BufferHelper.isBuffered(r, t + 0.1) && (e = this.getBufferedFrag(t + 0.1)), e)) { var i = e; if (i !== this.fragPlaying) { this.hls.trigger(s.default.FRAG_CHANGED, { frag: i }); var n = i.level; this.fragPlaying && this.fragPlaying.level === n || this.hls.trigger(s.default.LEVEL_SWITCHED, { level: n }), this.fragPlaying = i } } }, r.prototype.immediateLevelSwitch = function () { if (p.logger.log('immediateLevelSwitch'), !this.immediateSwitch) { this.immediateSwitch = !0; var t = this.media; var r = void 0; t ? (r = t.paused, t.pause()) : r = !0, this.previouslyPaused = r } var i = this.fragCurrent; i && i.loader && i.loader.abort(), this.fragCurrent = null, this.flushMainBuffer(0, e.POSITIVE_INFINITY) }, r.prototype.immediateLevelSwitchEnd = function () { var e = this.media; e && e.buffered.length && (this.immediateSwitch = !1, a.BufferHelper.isBuffered(e, e.currentTime) && (e.currentTime -= 1e-4), this.previouslyPaused || e.play()) }, r.prototype.nextLevelSwitch = function () { var t = this.media; if (t && t.readyState) { var r = void 0; var i = void 0; var n = void 0; if (i = this.getBufferedFrag(t.currentTime), i && i.startPTS > 1 && this.flushMainBuffer(0, i.startPTS - 1), t.paused)r = 0; else { var a = this.hls.nextLoadLevel; var o = this.levels[a]; var s = this.fragLastKbps; r = s && this.fragCurrent ? this.fragCurrent.duration * o.bitrate / (1e3 * s) + 1 : 0 } if (n = this.getBufferedFrag(t.currentTime + r), n && (n = this.followingBufferedFrag(n), n)) { var l = this.fragCurrent; l && l.loader && l.loader.abort(), this.fragCurrent = null, this.flushMainBuffer(n.maxStartPTS, e.POSITIVE_INFINITY) } } }, r.prototype.flushMainBuffer = function (e, t) { this.state = m.State.BUFFER_FLUSHING; var r = { startOffset: e, endOffset: t }; this.altAudio && (r.type = 'video'), this.hls.trigger(s.default.BUFFER_FLUSHING, r) }, r.prototype.onMediaAttached = function (e) { var t = this.media = this.mediaBuffer = e.media; this.onvseeking = this.onMediaSeeking.bind(this), this.onvseeked = this.onMediaSeeked.bind(this), this.onvended = this.onMediaEnded.bind(this), t.addEventListener('seeking', this.onvseeking), t.addEventListener('seeked', this.onvseeked), t.addEventListener('ended', this.onvended); var r = this.config; this.levels && r.autoStartLoad && this.hls.startLoad(r.startPosition), this.gapController = new y.default(r, t, this.fragmentTracker, this.hls) }, r.prototype.onMediaDetaching = function () { var e = this.media; e && e.ended && (p.logger.log('MSE detaching and video ended, reset startPosition'), this.startPosition = this.lastCurrentTime = 0); var t = this.levels; t && t.forEach(function (e) { e.details && e.details.fragments.forEach(function (e) { e.backtracked = void 0 }) }), e && (e.removeEventListener('seeking', this.onvseeking), e.removeEventListener('seeked', this.onvseeked), e.removeEventListener('ended', this.onvended), this.onvseeking = this.onvseeked = this.onvended = null), this.media = this.mediaBuffer = null, this.loadedmetadata = !1, this.stopLoad() }, r.prototype.onMediaSeeked = function () { var t = this.media; var r = t ? t.currentTime : void 0; e.isFinite(r) && p.logger.log('media seeked to ' + r.toFixed(3)), this.tick() }, r.prototype.onManifestLoading = function () { p.logger.log('trigger BUFFER_RESET'), this.hls.trigger(s.default.BUFFER_RESET), this.fragmentTracker.removeAllFragments(), this.stalled = !1, this.startPosition = this.lastCurrentTime = 0 }, r.prototype.onManifestParsed = function (e) { var t; var r = !1; var i = !1; e.levels.forEach(function (e) { t = e.audioCodec, t && (t.indexOf('mp4a.40.2') !== -1 && (r = !0), t.indexOf('mp4a.40.5') !== -1 && (i = !0)) }), this.audioCodecSwitch = r && i, this.audioCodecSwitch && p.logger.log('both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC'), this.levels = e.levels, this.startFragRequested = !1; var n = this.config; (n.autoStartLoad || this.forceStartLoad) && this.hls.startLoad(n.startPosition) }, r.prototype.onLevelLoaded = function (t) { var r = t.details; var i = t.level; var n = this.levels[this.levelLastLoaded]; var a = this.levels[i]; var o = r.totalduration; var l = 0; if (p.logger.log('level ' + i + ' loaded [' + r.startSN + ',' + r.endSN + '],duration:' + o), r.live) { var u = a.details; u && r.fragments.length > 0 ? (d.mergeDetails(u, r), l = r.fragments[0].start, this.liveSyncPosition = this.computeLivePosition(l, u), r.PTSKnown && e.isFinite(l) ? p.logger.log('live playlist sliding:' + l.toFixed(3)) : (p.logger.log('live playlist - outdated PTS, unknown sliding'), g.alignStream(this.fragPrevious, n, r))) : (p.logger.log('live playlist - first load, unknown sliding'), r.PTSKnown = !1, g.alignStream(this.fragPrevious, n, r)) } else r.PTSKnown = !1; if (a.details = r, this.levelLastLoaded = i, this.hls.trigger(s.default.LEVEL_UPDATED, { details: r, level: i }), !1 === this.startFragRequested) { if (this.startPosition === -1 || this.lastCurrentTime === -1) { var c = r.startTimeOffset; e.isFinite(c) ? (c < 0 && (p.logger.log('negative start time offset ' + c + ', count from end of last fragment'), c = l + o + c), p.logger.log('start time offset found in playlist, adjust startPosition to ' + c), this.startPosition = c) : r.live ? (this.startPosition = this.computeLivePosition(l, r), p.logger.log('configure startPosition to ' + this.startPosition)) : this.startPosition = 0, this.lastCurrentTime = this.startPosition } this.nextLoadPosition = this.startPosition } this.state === m.State.WAITING_LEVEL && (this.state = m.State.IDLE), this.tick() }, r.prototype.onKeyLoaded = function () { this.state === m.State.KEY_LOADING && (this.state = m.State.IDLE, this.tick()) }, r.prototype.onFragLoaded = function (e) { var t = this; var r = t.fragCurrent; var i = t.hls; var n = t.levels; var a = t.media; var l = e.frag; if (this.state === m.State.FRAG_LOADING && r && l.type === 'main' && l.level === r.level && l.sn === r.sn) { var u = e.stats; var c = n[r.level]; var d = c.details; if (this.bitrateTest = !1, this.stats = u, p.logger.log('Loaded ' + r.sn + ' of [' + d.startSN + ' ,' + d.endSN + '],level ' + r.level), l.bitrateTest && i.nextLoadLevel) this.state = m.State.IDLE, this.startFragRequested = !1, u.tparsed = u.tbuffered = window.performance.now(), i.trigger(s.default.FRAG_BUFFERED, { stats: u, frag: r, id: 'main' }), this.tick(); else if (l.sn === 'initSegment') this.state = m.State.IDLE, u.tparsed = u.tbuffered = window.performance.now(), d.initSegment.data = e.payload, i.trigger(s.default.FRAG_BUFFERED, { stats: u, frag: r, id: 'main' }), this.tick(); else { p.logger.log('Parsing ' + r.sn + ' of [' + d.startSN + ' ,' + d.endSN + '],level ' + r.level + ', cc ' + r.cc), this.state = m.State.PARSING, this.pendingBuffering = !0, this.appended = !1, l.bitrateTest && (l.bitrateTest = !1, this.fragmentTracker.onFragLoaded({ frag: l })); var f = !(a && a.seeking) && (d.PTSKnown || !d.live); var h = d.initSegment ? d.initSegment.data : []; var g = this._getAudioCodec(c); var v = this.demuxer = this.demuxer || new o.default(this.hls, 'main'); v.push(e.payload, h, g, c.videoCodec, r, d.totalduration, f) } } this.fragLoadError = 0 }, r.prototype.onFragParsingInitSegment = function (e) { var t = this.fragCurrent; var r = e.frag; if (t && e.id === 'main' && r.sn === t.sn && r.level === t.level && this.state === m.State.PARSING) { var i = e.tracks; var n = void 0; var a = void 0; if (i.audio && this.altAudio && delete i.audio, a = i.audio, a) { var o = this.levels[this.level].audioCodec; var l = navigator.userAgent.toLowerCase(); o && this.audioCodecSwap && (p.logger.log('swapping playlist audio codec'), o = o.indexOf('mp4a.40.5') !== -1 ? 'mp4a.40.2' : 'mp4a.40.5'), this.audioCodecSwitch && a.metadata.channelCount !== 1 && l.indexOf('firefox') === -1 && (o = 'mp4a.40.5'), l.indexOf('android') !== -1 && a.container !== 'audio/mpeg' && (o = 'mp4a.40.2', p.logger.log('Android: force audio codec to ' + o)), a.levelCodec = o, a.id = e.id } for (n in a = i.video, a && (a.levelCodec = this.levels[this.level].videoCodec, a.id = e.id), this.hls.trigger(s.default.BUFFER_CODECS, i), i) { a = i[n], p.logger.log('main track:' + n + ',container:' + a.container + ',codecs[level/parsed]=[' + a.levelCodec + '/' + a.codec + ']'); var u = a.initSegment; u && (this.appended = !0, this.pendingBuffering = !0, this.hls.trigger(s.default.BUFFER_APPENDING, { type: n, data: u, parent: 'main', content: 'initSegment' })) } this.tick() } }, r.prototype.onFragParsingData = function (t) { var r = this; var i = this.fragCurrent; var n = t.frag; if (i && t.id === 'main' && n.sn === i.sn && n.level === i.level && (t.type !== 'audio' || !this.altAudio) && this.state === m.State.PARSING) { var a = this.levels[this.level]; var o = i; if (e.isFinite(t.endPTS) || (t.endPTS = t.startPTS + i.duration, t.endDTS = t.startDTS + i.duration), !0 === t.hasAudio && o.addElementaryStream(u.default.ElementaryStreamTypes.AUDIO), !0 === t.hasVideo && o.addElementaryStream(u.default.ElementaryStreamTypes.VIDEO), p.logger.log('Parsed ' + t.type + ',PTS:[' + t.startPTS.toFixed(3) + ',' + t.endPTS.toFixed(3) + '],DTS:[' + t.startDTS.toFixed(3) + '/' + t.endDTS.toFixed(3) + '],nb:' + t.nb + ',dropped:' + (t.dropped || 0)), t.type === 'video') if (o.dropped = t.dropped, o.dropped) if (o.backtracked)p.logger.warn('Already backtracked on this fragment, appending with the gap', o.sn); else { var l = a.details; if (!l || o.sn !== l.startSN) return p.logger.warn('missing video frame(s), backtracking fragment', o.sn), this.fragmentTracker.removeFragment(o), o.backtracked = !0, this.nextLoadPosition = t.startPTS, this.state = m.State.IDLE, this.fragPrevious = o, void this.tick(); p.logger.warn('missing video frame(s) on first frag, appending with gap', o.sn) } else o.backtracked = !1; var c = d.updateFragPTSDTS(a.details, o, t.startPTS, t.endPTS, t.startDTS, t.endDTS); var f = this.hls; f.trigger(s.default.LEVEL_PTS_UPDATED, { details: a.details, level: this.level, drift: c, type: t.type, start: t.startPTS, end: t.endPTS }), [t.data1, t.data2].forEach(function (e) { e && e.length && r.state === m.State.PARSING && (r.appended = !0, r.pendingBuffering = !0, f.trigger(s.default.BUFFER_APPENDING, { type: t.type, data: e, parent: 'main', content: 'data' })) }), this.tick() } }, r.prototype.onFragParsed = function (e) { var t = this.fragCurrent; var r = e.frag; t && e.id === 'main' && r.sn === t.sn && r.level === t.level && this.state === m.State.PARSING && (this.stats.tparsed = window.performance.now(), this.state = m.State.PARSED, this._checkAppendedParsed()) }, r.prototype.onAudioTrackSwitching = function (t) { var r = !!t.url; var i = t.id; if (!r) { if (this.mediaBuffer !== this.media) { p.logger.log('switching on main audio, use media.buffered to schedule main fragment loading'), this.mediaBuffer = this.media; var n = this.fragCurrent; n.loader && (p.logger.log('switching to main audio track, cancel main fragment load'), n.loader.abort()), this.fragCurrent = null, this.fragPrevious = null, this.demuxer && (this.demuxer.destroy(), this.demuxer = null), this.state = m.State.IDLE } var a = this.hls; a.trigger(s.default.BUFFER_FLUSHING, { startOffset: 0, endOffset: e.POSITIVE_INFINITY, type: 'audio' }), a.trigger(s.default.AUDIO_TRACK_SWITCHED, { id: i }), this.altAudio = !1 } }, r.prototype.onAudioTrackSwitched = function (e) { var t = e.id; var r = !!this.hls.audioTracks[t].url; if (r) { var i = this.videoBuffer; i && this.mediaBuffer !== i && (p.logger.log('switching on alternate audio, use video.buffered to schedule main fragment loading'), this.mediaBuffer = i) } this.altAudio = r, this.tick() }, r.prototype.onBufferCreated = function (e) { var t; var r; var i = e.tracks; var n = !1; for (var a in i) { var o = i[a]; o.id === 'main' ? (r = a, t = o, a === 'video' && (this.videoBuffer = i[a].buffer)) : n = !0 }n && t ? (p.logger.log('alternate track found, use ' + r + '.buffered to schedule main fragment loading'), this.mediaBuffer = t.buffer) : this.mediaBuffer = this.media }, r.prototype.onBufferAppended = function (e) { if (e.parent === 'main') { var t = this.state; t !== m.State.PARSING && t !== m.State.PARSED || (this.pendingBuffering = e.pending > 0, this._checkAppendedParsed()) } }, r.prototype._checkAppendedParsed = function () { if (this.state === m.State.PARSED && (!this.appended || !this.pendingBuffering)) { var e = this.fragCurrent; if (e) { var t = this.mediaBuffer ? this.mediaBuffer : this.media; p.logger.log('main buffered : ' + f.default.toString(t.buffered)), this.fragPrevious = e; var r = this.stats; r.tbuffered = window.performance.now(), this.fragLastKbps = Math.round(8 * r.total / (r.tbuffered - r.tfirst)), this.hls.trigger(s.default.FRAG_BUFFERED, { stats: r, frag: e, id: 'main' }), this.state = m.State.IDLE } this.tick() } }, r.prototype.onError = function (t) { var r = t.frag || this.fragCurrent; if (!r || r.type === 'main') { var i = !!this.media && a.BufferHelper.isBuffered(this.media, this.media.currentTime) && a.BufferHelper.isBuffered(this.media, this.media.currentTime + 0.5); switch (t.details) { case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:if (!t.fatal) if (this.fragLoadError + 1 <= this.config.fragLoadingMaxRetry) { var n = Math.min(Math.pow(2, this.fragLoadError) * this.config.fragLoadingRetryDelay, this.config.fragLoadingMaxRetryTimeout); p.logger.warn('mediaController: frag loading failed, retry in ' + n + ' ms'), this.retryDate = window.performance.now() + n, this.loadedmetadata || (this.startFragRequested = !1, this.nextLoadPosition = this.startPosition), this.fragLoadError++, this.state = m.State.FRAG_LOADING_WAITING_RETRY } else p.logger.error('mediaController: ' + t.details + ' reaches max retry, redispatch as fatal ...'), t.fatal = !0, this.state = m.State.ERROR; break; case h.ErrorDetails.LEVEL_LOAD_ERROR:case h.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state !== m.State.ERROR && (t.fatal ? (this.state = m.State.ERROR, p.logger.warn('streamController: ' + t.details + ',switch to ' + this.state + ' state ...')) : t.levelRetry || this.state !== m.State.WAITING_LEVEL || (this.state = m.State.IDLE)); break; case h.ErrorDetails.BUFFER_FULL_ERROR:t.parent !== 'main' || this.state !== m.State.PARSING && this.state !== m.State.PARSED || (i ? (this._reduceMaxBufferLength(this.config.maxBufferLength), this.state = m.State.IDLE) : (p.logger.warn('buffer full error also media.currentTime is not buffered, flush everything'), this.fragCurrent = null, this.flushMainBuffer(0, e.POSITIVE_INFINITY))); break; default:break } } }, r.prototype._reduceMaxBufferLength = function (e) { var t = this.config; return t.maxMaxBufferLength >= e && (t.maxMaxBufferLength /= 2, p.logger.warn('main:reduce max buffer length to ' + t.maxMaxBufferLength + 's'), !0) }, r.prototype._checkBuffer = function () { var e = this.media; if (e && e.readyState !== 0) { var t = this.mediaBuffer ? this.mediaBuffer : e; var r = t.buffered; !this.loadedmetadata && r.length ? (this.loadedmetadata = !0, this._seekToStartPos()) : this.immediateSwitch ? this.immediateLevelSwitchEnd() : this.gapController.poll(this.lastCurrentTime, r) } }, r.prototype.onFragLoadEmergencyAborted = function () { this.state = m.State.IDLE, this.loadedmetadata || (this.startFragRequested = !1, this.nextLoadPosition = this.startPosition), this.tick() }, r.prototype.onBufferFlushed = function () { var e = this.mediaBuffer ? this.mediaBuffer : this.media; e && this.fragmentTracker.detectEvictedFragments(u.default.ElementaryStreamTypes.VIDEO, e.buffered), this.state = m.State.IDLE, this.fragPrevious = null }, r.prototype.swapAudioCodec = function () { this.audioCodecSwap = !this.audioCodecSwap }, r.prototype.computeLivePosition = function (e, t) { var r = void 0 !== this.config.liveSyncDuration ? this.config.liveSyncDuration : this.config.liveSyncDurationCount * t.targetduration; return e + Math.max(0, t.totalduration - r) }, r.prototype._seekToStartPos = function () { var e = this.media; var t = e.currentTime; var r = e.seeking ? t : this.startPosition; t !== r && (p.logger.log('target start position not buffered, seek to buffered.start(0) ' + r + ' from current time ' + t + ' '), e.currentTime = r) }, r.prototype._getAudioCodec = function (e) { var t = this.config.defaultAudioCodec || e.audioCodec; return this.audioCodecSwap && (p.logger.log('swapping playlist audio codec'), t && (t = t.indexOf('mp4a.40.5') !== -1 ? 'mp4a.40.2' : 'mp4a.40.5')), t }, Object.defineProperty(r.prototype, 'liveSyncPosition', { get: function () { return this._liveSyncPosition }, set: function (e) { this._liveSyncPosition = e }, enumerable: !0, configurable: !0 }), r }(m.default)); t.default = E }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/subtitle-stream-controller.js':
        /*! ******************************************************!*\
  !*** ./src/controller/subtitle-stream-controller.js ***!
  \******************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../utils/logger */'./src/utils/logger.js'); var o = r(/*! ../crypt/decrypter */'./src/crypt/decrypter.js'); var s = r(/*! ../utils/buffer-helper */'./src/utils/buffer-helper.js'); var l = r(/*! ./fragment-finders */'./src/controller/fragment-finders.js'); var u = r(/*! ./fragment-tracker */'./src/controller/fragment-tracker.js'); var c = r(/*! ./base-stream-controller */'./src/controller/base-stream-controller.js'); var d = r(/*! ./level-helper */'./src/controller/level-helper.js'); var f = window.performance; var h = 500; var p = (function (e) { function t (t, r) { var i = e.call(this, t, n.default.MEDIA_ATTACHED, n.default.MEDIA_DETACHING, n.default.ERROR, n.default.KEY_LOADED, n.default.FRAG_LOADED, n.default.SUBTITLE_TRACKS_UPDATED, n.default.SUBTITLE_TRACK_SWITCH, n.default.SUBTITLE_TRACK_LOADED, n.default.SUBTITLE_FRAG_PROCESSED, n.default.LEVEL_UPDATED) || this; return i.fragmentTracker = r, i.config = t.config, i.state = c.State.STOPPED, i.tracks = [], i.tracksBuffered = [], i.currentTrackId = -1, i.decrypter = new o.default(t, t.config), i.lastAVStart = 0, i._onMediaSeeking = i.onMediaSeeking.bind(i), i } return i(t, e), t.prototype.onSubtitleFragProcessed = function (e) { var t = e.frag; var r = e.success; if (this.fragPrevious = t, this.state = c.State.IDLE, r) { var i = this.tracksBuffered[this.currentTrackId]; if (i) { for (var n, a = t.start, o = 0; o < i.length; o++) if (a >= i[o].start && a <= i[o].end) { n = i[o]; break } var s = t.start + t.duration; n ? n.end = s : (n = { start: a, end: s }, i.push(n)) } } }, t.prototype.onMediaAttached = function (e) { var t = e.media; this.media = t, t.addEventListener('seeking', this._onMediaSeeking), this.state = c.State.IDLE }, t.prototype.onMediaDetaching = function () { this.media.removeEventListener('seeking', this._onMediaSeeking), this.media = null, this.state = c.State.STOPPED }, t.prototype.onError = function (e) { var t = e.frag; t && t.type === 'subtitle' && (this.state = c.State.IDLE) }, t.prototype.onSubtitleTracksUpdated = function (e) { var t = this; a.logger.log('subtitle tracks updated'), this.tracksBuffered = [], this.tracks = e.subtitleTracks, this.tracks.forEach(function (e) { t.tracksBuffered[e.id] = [] }) }, t.prototype.onSubtitleTrackSwitch = function (e) { if (this.currentTrackId = e.id, this.tracks && this.currentTrackId !== -1) { var t = this.tracks[this.currentTrackId]; t && t.details && this.setInterval(h) } else this.clearInterval() }, t.prototype.onSubtitleTrackLoaded = function (e) { var t = e.id; var r = e.details; var i = this; var n = i.currentTrackId; var a = i.tracks; var o = a[n]; t >= a.length || t !== n || !o || (r.live && d.mergeSubtitlePlaylists(o.details, r, this.lastAVStart), o.details = r, this.setInterval(h)) }, t.prototype.onKeyLoaded = function () { this.state === c.State.KEY_LOADING && (this.state = c.State.IDLE) }, t.prototype.onFragLoaded = function (e) { var t = this.fragCurrent; var r = e.frag.decryptdata; var i = e.frag; var a = this.hls; if (this.state === c.State.FRAG_LOADING && t && e.frag.type === 'subtitle' && t.sn === e.frag.sn && e.payload.byteLength > 0 && r && r.key && r.method === 'AES-128') { var o = f.now(); this.decrypter.decrypt(e.payload, r.key.buffer, r.iv.buffer, function (e) { var t = f.now(); a.trigger(n.default.FRAG_DECRYPTED, { frag: i, payload: e, stats: { tstart: o, tdecrypt: t } }) }) } }, t.prototype.onLevelUpdated = function (e) { var t = e.details; var r = t.fragments; this.lastAVStart = r.length ? r[0].start : 0 }, t.prototype.doTick = function () { if (this.media) switch (this.state) { case c.State.IDLE:var e = this; var t = e.config; var r = e.currentTrackId; var i = e.fragmentTracker; var o = e.media; var d = e.tracks; if (!d || !d[r] || !d[r].details) break; var f = t.maxBufferHole; var h = t.maxFragLookUpTolerance; var p = Math.min(t.maxBufferLength, t.maxMaxBufferLength); var g = s.BufferHelper.bufferedInfo(this._getBuffered(), o.currentTime, f); var v = g.end; var y = g.len; var m = d[r].details; var b = m.fragments; var E = b.length; var _ = b[E - 1].start + b[E - 1].duration; if (y > p) return; var S = void 0; var T = this.fragPrevious; v < _ ? (T && m.hasProgramDateTime && (S = l.findFragmentByPDT(b, T.endProgramDateTime, h)), S || (S = l.findFragmentByPTS(T, b, v, h))) : S = b[E - 1], S && S.encrypted ? (a.logger.log('Loading key for ' + S.sn), this.state = c.State.KEY_LOADING, this.hls.trigger(n.default.KEY_LOADING, { frag: S })) : S && i.getState(S) === u.FragmentState.NOT_LOADED && (this.fragCurrent = S, this.state = c.State.FRAG_LOADING, this.hls.trigger(n.default.FRAG_LOADING, { frag: S })) } else this.state = c.State.IDLE }, t.prototype.stopLoad = function () { this.lastAVStart = 0, e.prototype.stopLoad.call(this) }, t.prototype._getBuffered = function () { return this.tracksBuffered[this.currentTrackId] || [] }, t.prototype.onMediaSeeking = function () { this.fragPrevious = null }, t }(c.default)); t.SubtitleStreamController = p },
        './src/controller/subtitle-track-controller.js':
        /*! *****************************************************!*\
  !*** ./src/controller/subtitle-track-controller.js ***!
  \*****************************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = r(/*! ../utils/logger */'./src/utils/logger.js'); var s = r(/*! ./level-helper */'./src/controller/level-helper.js'); var l = (function (t) { function r (e) { var r = t.call(this, e, n.default.MEDIA_ATTACHED, n.default.MEDIA_DETACHING, n.default.MANIFEST_LOADED, n.default.SUBTITLE_TRACK_LOADED) || this; return r.tracks = [], r.trackId = -1, r.media = null, r.stopped = !0, r.subtitleDisplay = !0, r } return i(r, t), r.prototype.destroy = function () { a.default.prototype.destroy.call(this) }, r.prototype.onMediaAttached = function (e) { var t = this; this.media = e.media, this.media && (this.queuedDefaultTrack && (this.subtitleTrack = this.queuedDefaultTrack, delete this.queuedDefaultTrack), this.trackChangeListener = this._onTextTracksChanged.bind(this), this.useTextTrackPolling = !(this.media.textTracks && 'onchange' in this.media.textTracks), this.useTextTrackPolling ? this.subtitlePollingInterval = setInterval(function () { t.trackChangeListener() }, 500) : this.media.textTracks.addEventListener('change', this.trackChangeListener)) }, r.prototype.onMediaDetaching = function () { this.media && (this.useTextTrackPolling ? clearInterval(this.subtitlePollingInterval) : this.media.textTracks.removeEventListener('change', this.trackChangeListener), this.media = null) }, r.prototype.onManifestLoaded = function (e) { var t = this; var r = e.subtitles || []; this.tracks = r, this.hls.trigger(n.default.SUBTITLE_TRACKS_UPDATED, { subtitleTracks: r }), r.forEach(function (e) { e.default && (t.media ? t.subtitleTrack = e.id : t.queuedDefaultTrack = e.id) }) }, r.prototype.onSubtitleTrackLoaded = function (e) { var t = this; var r = e.id; var i = e.details; var n = this; var a = n.trackId; var l = n.tracks; var u = l[a]; if (r >= l.length || r !== a || !u || this.stopped) this._clearReloadTimer(); else if (o.logger.log('subtitle track ' + r + ' loaded'), i.live) { var c = s.computeReloadInterval(u.details, i, e.stats.trequest); o.logger.log('Reloading live subtitle playlist in ' + c + 'ms'), this.timer = setTimeout(function () { t._loadCurrentTrack() }, c) } else this._clearReloadTimer() }, r.prototype.startLoad = function () { this.stopped = !1, this._loadCurrentTrack() }, r.prototype.stopLoad = function () { this.stopped = !0, this._clearReloadTimer() }, Object.defineProperty(r.prototype, 'subtitleTracks', { get: function () { return this.tracks }, enumerable: !0, configurable: !0 }), Object.defineProperty(r.prototype, 'subtitleTrack', { get: function () { return this.trackId }, set: function (e) { this.trackId !== e && (this._toggleTrackModes(e), this._setSubtitleTrackInternal(e)) }, enumerable: !0, configurable: !0 }), r.prototype._clearReloadTimer = function () { this.timer && (clearTimeout(this.timer), this.timer = null) }, r.prototype._loadCurrentTrack = function () { var e = this; var t = e.trackId; var r = e.tracks; var i = e.hls; var a = r[t]; t < 0 || !a || a.details && !a.details.live || (o.logger.log('Loading subtitle track ' + t), i.trigger(n.default.SUBTITLE_TRACK_LOADING, { url: a.url, id: t })) }, r.prototype._toggleTrackModes = function (e) { var t = this; var r = t.media; var i = t.subtitleDisplay; var n = t.trackId; if (r) { var a = u(r.textTracks); if (e === -1)[].slice.call(a).forEach(function (e) { e.mode = 'disabled' }); else { var o = a[n]; o && (o.mode = 'disabled') } var s = a[e]; s && (s.mode = i ? 'showing' : 'hidden') } }, r.prototype._setSubtitleTrackInternal = function (t) { var r = this; var i = r.hls; var a = r.tracks; !e.isFinite(t) || t < -1 || t >= a.length || (this.trackId = t, o.logger.log('Switching to subtitle track ' + t), i.trigger(n.default.SUBTITLE_TRACK_SWITCH, { id: t }), this._loadCurrentTrack()) }, r.prototype._onTextTracksChanged = function () { if (this.media) { for (var e = -1, t = u(this.media.textTracks), r = 0; r < t.length; r++) if (t[r].mode === 'hidden')e = r; else if (t[r].mode === 'showing') { e = r; break } this.subtitleTrack = e } }, r }(a.default)); function u (e) { for (var t = [], r = 0; r < e.length; r++) { var i = e[r]; i.kind === 'subtitles' && i.label && t.push(e[r]) } return t }t.default = l }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/controller/timeline-controller.js':
        /*! ***********************************************!*\
  !*** ./src/controller/timeline-controller.js ***!
  \***********************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = r(/*! ../utils/cea-608-parser */'./src/utils/cea-608-parser.js'); var s = r(/*! ../utils/output-filter */'./src/utils/output-filter.js'); var l = r(/*! ../utils/webvtt-parser */'./src/utils/webvtt-parser.js'); var u = r(/*! ../utils/logger */'./src/utils/logger.js'); var c = r(/*! ../utils/texttrack-utils */'./src/utils/texttrack-utils.js'); function d (e, t) { return e && e.label === t.name && !(e.textTrack1 || e.textTrack2) } function f (e, t, r, i) { return Math.min(t, i) - Math.max(e, r) } var h = (function (t) { function r (e) { var r = t.call(this, e, n.default.MEDIA_ATTACHING, n.default.MEDIA_DETACHING, n.default.FRAG_PARSING_USERDATA, n.default.FRAG_DECRYPTED, n.default.MANIFEST_LOADING, n.default.MANIFEST_LOADED, n.default.FRAG_LOADED, n.default.LEVEL_SWITCHING, n.default.INIT_PTS_FOUND) || this; if (r.hls = e, r.config = e.config, r.enabled = !0, r.Cues = e.config.cueHandler, r.textTracks = [], r.tracks = [], r.unparsedVttFrags = [], r.initPTS = [], r.cueRanges = [], r.captionsTracks = {}, r.captionsProperties = { textTrack1: { label: r.config.captionsTextTrack1Label, languageCode: r.config.captionsTextTrack1LanguageCode }, textTrack2: { label: r.config.captionsTextTrack2Label, languageCode: r.config.captionsTextTrack2LanguageCode } }, r.config.enableCEA708Captions) { var i = new s.default(r, 'textTrack1'); var a = new s.default(r, 'textTrack2'); r.cea608Parser = new o.default(0, i, a) } return r } return i(r, t), r.prototype.addCues = function (e, t, r, i) { for (var n = this.cueRanges, a = !1, o = n.length; o--;) { var s = n[o]; var l = f(s[0], s[1], t, r); if (l >= 0 && (s[0] = Math.min(s[0], t), s[1] = Math.max(s[1], r), a = !0, l / (r - t) > 0.5)) return }a || n.push([t, r]), this.Cues.newCue(this.captionsTracks[e], t, r, i) }, r.prototype.onInitPtsFound = function (e) { var t = this; if (e.id === 'main' && (this.initPTS[e.frag.cc] = e.initPTS), this.unparsedVttFrags.length) { var r = this.unparsedVttFrags; this.unparsedVttFrags = [], r.forEach(function (e) { t.onFragLoaded(e) }) } }, r.prototype.getExistingTrack = function (e) { var t = this.media; if (t) for (var r = 0; r < t.textTracks.length; r++) { var i = t.textTracks[r]; if (i[e]) return i } return null }, r.prototype.createCaptionsTrack = function (e) { var t = this.captionsProperties[e]; var r = t.label; var i = t.languageCode; var n = this.captionsTracks; if (!n[e]) { var a = this.getExistingTrack(e); if (a)n[e] = a, c.clearCurrentCues(n[e]), c.sendAddTrackEvent(n[e], this.media); else { var o = this.createTextTrack('captions', r, i); o && (o[e] = !0, n[e] = o) } } }, r.prototype.createTextTrack = function (e, t, r) { var i = this.media; if (i) return i.addTextTrack(e, t, r) }, r.prototype.destroy = function () { a.default.prototype.destroy.call(this) }, r.prototype.onMediaAttaching = function (e) { this.media = e.media, this._cleanTracks() }, r.prototype.onMediaDetaching = function () { var e = this.captionsTracks; Object.keys(e).forEach(function (t) { c.clearCurrentCues(e[t]), delete e[t] }) }, r.prototype.onManifestLoading = function () { this.lastSn = -1, this.prevCC = -1, this.vttCCs = { ccOffset: 0, presentationOffset: 0, 0: { start: 0, prevCC: -1, new: !1 } }, this._cleanTracks() }, r.prototype._cleanTracks = function () { var e = this.media; if (e) { var t = e.textTracks; if (t) for (var r = 0; r < t.length; r++)c.clearCurrentCues(t[r]) } }, r.prototype.onManifestLoaded = function (e) { var t = this; if (this.textTracks = [], this.unparsedVttFrags = this.unparsedVttFrags || [], this.initPTS = [], this.cueRanges = [], this.config.enableWebVTT) { this.tracks = e.subtitles || []; var r = this.media ? this.media.textTracks : []; this.tracks.forEach(function (e, i) { var n; if (i < r.length) { for (var a = null, o = 0; o < r.length; o++) if (d(r[o], e)) { a = r[o]; break }a && (n = a) }n || (n = t.createTextTrack('subtitles', e.name, e.lang)), e.default ? n.mode = t.hls.subtitleDisplay ? 'showing' : 'hidden' : n.mode = 'disabled', t.textTracks.push(n) }) } }, r.prototype.onLevelSwitching = function () { this.enabled = this.hls.currentLevel.closedCaptions !== 'NONE' }, r.prototype.onFragLoaded = function (t) { var r = t.frag; var i = t.payload; if (r.type === 'main') { var a = r.sn; if (a !== this.lastSn + 1) { var o = this.cea608Parser; o && o.reset() } this.lastSn = a } else if (r.type === 'subtitle') if (i.byteLength) { if (!e.isFinite(this.initPTS[r.cc])) return this.unparsedVttFrags.push(t), void (this.initPTS.length && this.hls.trigger(n.default.SUBTITLE_FRAG_PROCESSED, { success: !1, frag: r })); var s = r.decryptdata; s != null && s.key != null && s.method === 'AES-128' || this._parseVTTs(r, i) } else this.hls.trigger(n.default.SUBTITLE_FRAG_PROCESSED, { success: !1, frag: r }) }, r.prototype._parseVTTs = function (e, t) { var r = this.vttCCs; r[e.cc] || (r[e.cc] = { start: e.start, prevCC: this.prevCC, new: !0 }, this.prevCC = e.cc); var i = this.textTracks; var a = this.hls; l.default.parse(t, this.initPTS[e.cc], r, e.cc, function (t) { var r = i[e.level]; r.mode !== 'disabled' ? (t.forEach(function (e) { if (!r.cues.getCueById(e.id)) try { r.addCue(e) } catch (i) { var t = new window.TextTrackCue(e.startTime, e.endTime, e.text); t.id = e.id, r.addCue(t) } }), a.trigger(n.default.SUBTITLE_FRAG_PROCESSED, { success: !0, frag: e })) : a.trigger(n.default.SUBTITLE_FRAG_PROCESSED, { success: !1, frag: e }) }, function (t) { u.logger.log('Failed to parse VTT cue: ' + t), a.trigger(n.default.SUBTITLE_FRAG_PROCESSED, { success: !1, frag: e }) }) }, r.prototype.onFragDecrypted = function (t) { var r = t.payload; var i = t.frag; if (i.type === 'subtitle') { if (!e.isFinite(this.initPTS[i.cc])) return void this.unparsedVttFrags.push(t); this._parseVTTs(i, r) } }, r.prototype.onFragParsingUserdata = function (e) { if (this.enabled && this.config.enableCEA708Captions) for (var t = 0; t < e.samples.length; t++) { var r = this.extractCea608Data(e.samples[t].bytes); this.cea608Parser.addData(e.samples[t].pts, r) } }, r.prototype.extractCea608Data = function (e) { for (var t, r, i, n, a, o = 31 & e[0], s = 2, l = [], u = 0; u < o; u++)t = e[s++], r = 127 & e[s++], i = 127 & e[s++], n = (4 & t) !== 0, a = 3 & t, r === 0 && i === 0 || n && a === 0 && (l.push(r), l.push(i)); return l }, r }(a.default)); t.default = h }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/crypt/aes-crypto.js':
        /*! *********************************!*\
  !*** ./src/crypt/aes-crypto.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = (function () { function e (e, t) { this.subtle = e, this.aesIV = t } return e.prototype.decrypt = function (e, t) { return this.subtle.decrypt({ name: 'AES-CBC', iv: this.aesIV }, t, e) }, e }()); t.default = i },
        './src/crypt/aes-decryptor.js':
        /*! ************************************!*\
  !*** ./src/crypt/aes-decryptor.js ***!
  \************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; function i (e) { var t = e.byteLength; var r = t && new DataView(e).getUint8(t - 1); return r ? e.slice(0, t - r) : e }Object.defineProperty(t, '__esModule', { value: !0 }), t.removePadding = i; var n = (function () { function e () { this.rcon = [0, 1, 2, 4, 8, 16, 32, 64, 128, 27, 54], this.subMix = [new Uint32Array(256), new Uint32Array(256), new Uint32Array(256), new Uint32Array(256)], this.invSubMix = [new Uint32Array(256), new Uint32Array(256), new Uint32Array(256), new Uint32Array(256)], this.sBox = new Uint32Array(256), this.invSBox = new Uint32Array(256), this.key = new Uint32Array(0), this.initTable() } return e.prototype.uint8ArrayToUint32Array_ = function (e) { for (var t = new DataView(e), r = new Uint32Array(4), i = 0; i < 4; i++)r[i] = t.getUint32(4 * i); return r }, e.prototype.initTable = function () { var e = this.sBox; var t = this.invSBox; var r = this.subMix; var i = r[0]; var n = r[1]; var a = r[2]; var o = r[3]; var s = this.invSubMix; var l = s[0]; var u = s[1]; var c = s[2]; var d = s[3]; var f = new Uint32Array(256); var h = 0; var p = 0; var g = 0; for (g = 0; g < 256; g++)f[g] = g < 128 ? g << 1 : g << 1 ^ 283; for (g = 0; g < 256; g++) { var v = p ^ p << 1 ^ p << 2 ^ p << 3 ^ p << 4; v = v >>> 8 ^ 255 & v ^ 99, e[h] = v, t[v] = h; var y = f[h]; var m = f[y]; var b = f[m]; var E = 257 * f[v] ^ 16843008 * v; i[h] = E << 24 | E >>> 8, n[h] = E << 16 | E >>> 16, a[h] = E << 8 | E >>> 24, o[h] = E, E = 16843009 * b ^ 65537 * m ^ 257 * y ^ 16843008 * h, l[v] = E << 24 | E >>> 8, u[v] = E << 16 | E >>> 16, c[v] = E << 8 | E >>> 24, d[v] = E, h ? (h = y ^ f[f[f[b ^ y]]], p ^= f[f[p]]) : h = p = 1 } }, e.prototype.expandKey = function (e) { var t = this.uint8ArrayToUint32Array_(e); var r = !0; var i = 0; while (i < t.length && r)r = t[i] === this.key[i], i++; if (!r) { this.key = t; var n = this.keySize = t.length; if (n !== 4 && n !== 6 && n !== 8) throw new Error('Invalid aes key size=' + n); var a; var o; var s; var l; var u = this.ksRows = 4 * (n + 6 + 1); var c = this.keySchedule = new Uint32Array(u); var d = this.invKeySchedule = new Uint32Array(u); var f = this.sBox; var h = this.rcon; var p = this.invSubMix; var g = p[0]; var v = p[1]; var y = p[2]; var m = p[3]; for (a = 0; a < u; a++)a < n ? s = c[a] = t[a] : (l = s, a % n === 0 ? (l = l << 8 | l >>> 24, l = f[l >>> 24] << 24 | f[l >>> 16 & 255] << 16 | f[l >>> 8 & 255] << 8 | f[255 & l], l ^= h[a / n | 0] << 24) : n > 6 && a % n === 4 && (l = f[l >>> 24] << 24 | f[l >>> 16 & 255] << 16 | f[l >>> 8 & 255] << 8 | f[255 & l]), c[a] = s = (c[a - n] ^ l) >>> 0); for (o = 0; o < u; o++)a = u - o, l = 3 & o ? c[a] : c[a - 4], d[o] = o < 4 || a <= 4 ? l : g[f[l >>> 24]] ^ v[f[l >>> 16 & 255]] ^ y[f[l >>> 8 & 255]] ^ m[f[255 & l]], d[o] = d[o] >>> 0 } }, e.prototype.networkToHostOrderSwap = function (e) { return e << 24 | (65280 & e) << 8 | (16711680 & e) >> 8 | e >>> 24 }, e.prototype.decrypt = function (e, t, r, n) { var a; var o; var s; var l; var u; var c; var d; var f; var h; var p; var g; var v; var y; var m; var b = this.keySize + 6; var E = this.invKeySchedule; var _ = this.invSBox; var S = this.invSubMix; var T = S[0]; var w = S[1]; var A = S[2]; var L = S[3]; var R = this.uint8ArrayToUint32Array_(r); var k = R[0]; var D = R[1]; var O = R[2]; var P = R[3]; var I = new Int32Array(e); var x = new Int32Array(I.length); var C = this.networkToHostOrderSwap; while (t < I.length) { for (h = C(I[t]), p = C(I[t + 1]), g = C(I[t + 2]), v = C(I[t + 3]), u = h ^ E[0], c = v ^ E[1], d = g ^ E[2], f = p ^ E[3], y = 4, m = 1; m < b; m++)a = T[u >>> 24] ^ w[c >> 16 & 255] ^ A[d >> 8 & 255] ^ L[255 & f] ^ E[y], o = T[c >>> 24] ^ w[d >> 16 & 255] ^ A[f >> 8 & 255] ^ L[255 & u] ^ E[y + 1], s = T[d >>> 24] ^ w[f >> 16 & 255] ^ A[u >> 8 & 255] ^ L[255 & c] ^ E[y + 2], l = T[f >>> 24] ^ w[u >> 16 & 255] ^ A[c >> 8 & 255] ^ L[255 & d] ^ E[y + 3], u = a, c = o, d = s, f = l, y += 4; a = _[u >>> 24] << 24 ^ _[c >> 16 & 255] << 16 ^ _[d >> 8 & 255] << 8 ^ _[255 & f] ^ E[y], o = _[c >>> 24] << 24 ^ _[d >> 16 & 255] << 16 ^ _[f >> 8 & 255] << 8 ^ _[255 & u] ^ E[y + 1], s = _[d >>> 24] << 24 ^ _[f >> 16 & 255] << 16 ^ _[u >> 8 & 255] << 8 ^ _[255 & c] ^ E[y + 2], l = _[f >>> 24] << 24 ^ _[u >> 16 & 255] << 16 ^ _[c >> 8 & 255] << 8 ^ _[255 & d] ^ E[y + 3], y += 3, x[t] = C(a ^ k), x[t + 1] = C(l ^ D), x[t + 2] = C(s ^ O), x[t + 3] = C(o ^ P), k = h, D = p, O = g, P = v, t += 4 } return n ? i(x.buffer) : x.buffer }, e.prototype.destroy = function () { this.key = void 0, this.keySize = void 0, this.ksRows = void 0, this.sBox = void 0, this.invSBox = void 0, this.subMix = void 0, this.invSubMix = void 0, this.keySchedule = void 0, this.invKeySchedule = void 0, this.rcon = void 0 }, e }()); t.default = n },
        './src/crypt/decrypter.js':
        /*! ********************************!*\
  !*** ./src/crypt/decrypter.js ***!
  \********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./aes-crypto */'./src/crypt/aes-crypto.js'); var n = r(/*! ./fast-aes-key */'./src/crypt/fast-aes-key.js'); var a = r(/*! ./aes-decryptor */'./src/crypt/aes-decryptor.js'); var o = r(/*! ../errors */'./src/errors.js'); var s = r(/*! ../utils/logger */'./src/utils/logger.js'); var l = r(/*! ../events */'./src/events.js'); var u = r(/*! ../utils/get-self-scope */'./src/utils/get-self-scope.js'); var c = u.getSelfScope(); var d = (function () { function e (e, t, r) { var i = (void 0 === r ? {} : r).removePKCS7Padding; var n = void 0 === i || i; if (this.logEnabled = !0, this.observer = e, this.config = t, this.removePKCS7Padding = n, n) try { var a = c.crypto; a && (this.subtle = a.subtle || a.webkitSubtle) } catch (o) {} this.disableWebCrypto = !this.subtle } return e.prototype.isSync = function () { return this.disableWebCrypto && this.config.enableSoftwareAES }, e.prototype.decrypt = function (e, t, r, o) { var l = this; if (this.disableWebCrypto && this.config.enableSoftwareAES) { this.logEnabled && (s.logger.log('JS AES decrypt'), this.logEnabled = !1); var u = this.decryptor; u || (this.decryptor = u = new a.default()), u.expandKey(t), o(u.decrypt(e, 0, r, this.removePKCS7Padding)) } else { this.logEnabled && (s.logger.log('WebCrypto AES decrypt'), this.logEnabled = !1); var c = this.subtle; this.key !== t && (this.key = t, this.fastAesKey = new n.default(c, t)), this.fastAesKey.expandKey().then(function (n) { var a = new i.default(c, r); a.decrypt(e, n).catch(function (i) { l.onWebCryptoError(i, e, t, r, o) }).then(function (e) { o(e) }) }).catch(function (i) { l.onWebCryptoError(i, e, t, r, o) }) } }, e.prototype.onWebCryptoError = function (e, t, r, i, n) { this.config.enableSoftwareAES ? (s.logger.log('WebCrypto Error, disable WebCrypto API'), this.disableWebCrypto = !0, this.logEnabled = !0, this.decrypt(t, r, i, n)) : (s.logger.error('decrypting error : ' + e.message), this.observer.trigger(l.default.ERROR, { type: o.ErrorTypes.MEDIA_ERROR, details: o.ErrorDetails.FRAG_DECRYPT_ERROR, fatal: !0, reason: e.message })) }, e.prototype.destroy = function () { var e = this.decryptor; e && (e.destroy(), this.decryptor = void 0) }, e }()); t.default = d },
        './src/crypt/fast-aes-key.js':
        /*! ***********************************!*\
  !*** ./src/crypt/fast-aes-key.js ***!
  \***********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = (function () { function e (e, t) { this.subtle = e, this.key = t } return e.prototype.expandKey = function () { return this.subtle.importKey('raw', this.key, { name: 'AES-CBC' }, !1, ['encrypt', 'decrypt']) }, e }()); t.default = i },
        './src/demux/aacdemuxer.js':
        /*! *********************************!*\
  !*** ./src/demux/aacdemuxer.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./adts */'./src/demux/adts.js'); var n = r(/*! ../utils/logger */'./src/utils/logger.js'); var a = r(/*! ../demux/id3 */'./src/demux/id3.js'); var o = (function () { function t (e, t, r) { this.observer = e, this.config = r, this.remuxer = t } return t.prototype.resetInitSegment = function (e, t, r, i) { this._audioTrack = { container: 'audio/adts', type: 'audio', id: 0, sequenceNumber: 0, isAAC: !0, samples: [], len: 0, manifestCodec: t, duration: i, inputTimeScale: 9e4 } }, t.prototype.resetTimeStamp = function () {}, t.probe = function (e) { if (!e) return !1; for (var t = a.default.getID3Data(e, 0) || [], r = t.length, o = e.length; r < o; r++) if (i.probe(e, r)) return n.logger.log('ADTS sync word found !'), !0; return !1 }, t.prototype.append = function (t, r, o, s) { var l = this._audioTrack; var u = a.default.getID3Data(t, 0) || []; var c = a.default.getTimeStamp(u); var d = e.isFinite(c) ? 90 * c : 9e4 * r; var f = 0; var h = d; var p = t.length; var g = u.length; var v = [{ pts: h, dts: h, data: u }]; while (g < p - 1) if (i.isHeader(t, g) && g + 5 < p) { i.initTrackConfig(l, this.observer, t, g, l.manifestCodec); var y = i.appendFrame(l, t, g, d, f); if (!y) { n.logger.log('Unable to parse AAC frame'); break }g += y.length, h = y.sample.pts, f++ } else a.default.isHeader(t, g) ? (u = a.default.getID3Data(t, g), v.push({ pts: h, dts: h, data: u }), g += u.length) : g++; this.remuxer.remux(l, { samples: [] }, { samples: v, inputTimeScale: 9e4 }, { samples: [] }, r, o, s) }, t.prototype.destroy = function () {}, t }()); t.default = o }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/demux/adts.js':
        /*! ***************************!*\
  !*** ./src/demux/adts.js ***!
  \***************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../utils/logger */'./src/utils/logger.js'); var n = r(/*! ../errors */'./src/errors.js'); var a = r(/*! ../events */'./src/events.js'); function o (e, t, r, o) { var s; var l; var u; var c; var d; var f = navigator.userAgent.toLowerCase(); var h = o; var p = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350]; if (s = 1 + ((192 & t[r + 2]) >>> 6), l = (60 & t[r + 2]) >>> 2, !(l > p.length - 1)) return c = (1 & t[r + 2]) << 2, c |= (192 & t[r + 3]) >>> 6, i.logger.log('manifest codec:' + o + ',ADTS data:type:' + s + ',sampleingIndex:' + l + '[' + p[l] + 'Hz],channelConfig:' + c), /firefox/i.test(f) ? l >= 6 ? (s = 5, d = new Array(4), u = l - 3) : (s = 2, d = new Array(2), u = l) : f.indexOf('android') !== -1 ? (s = 2, d = new Array(2), u = l) : (s = 5, d = new Array(4), o && (o.indexOf('mp4a.40.29') !== -1 || o.indexOf('mp4a.40.5') !== -1) || !o && l >= 6 ? u = l - 3 : ((o && o.indexOf('mp4a.40.2') !== -1 && (l >= 6 && c === 1 || /vivaldi/i.test(f)) || !o && c === 1) && (s = 2, d = new Array(2)), u = l)), d[0] = s << 3, d[0] |= (14 & l) >> 1, d[1] |= (1 & l) << 7, d[1] |= c << 3, s === 5 && (d[1] |= (14 & u) >> 1, d[2] = (1 & u) << 7, d[2] |= 8, d[3] = 0), { config: d, samplerate: p[l], channelCount: c, codec: 'mp4a.40.' + s, manifestCodec: h }; e.trigger(a.default.ERROR, { type: n.ErrorTypes.MEDIA_ERROR, details: n.ErrorDetails.FRAG_PARSING_ERROR, fatal: !0, reason: 'invalid ADTS sampling index:' + l }) } function s (e, t) { return e[t] === 255 && (246 & e[t + 1]) === 240 } function l (e, t) { return 1 & e[t + 1] ? 7 : 9 } function u (e, t) { return (3 & e[t + 3]) << 11 | e[t + 4] << 3 | (224 & e[t + 5]) >>> 5 } function c (e, t) { return !!(t + 1 < e.length && s(e, t)) } function d (e, t) { if (t + 1 < e.length && s(e, t)) { var r = l(e, t); var i = r; t + 5 < e.length && (i = u(e, t)); var n = t + i; if (n === e.length || n + 1 < e.length && s(e, n)) return !0 } return !1 } function f (e, t, r, n, a) { if (!e.samplerate) { var s = o(t, r, n, a); e.config = s.config, e.samplerate = s.samplerate, e.channelCount = s.channelCount, e.codec = s.codec, e.manifestCodec = s.manifestCodec, i.logger.log('parsed codec:' + e.codec + ',rate:' + s.samplerate + ',nb channel:' + s.channelCount) } } function h (e) { return 9216e4 / e } function p (e, t, r, i, n) { var a; var o; var s; var c = e.length; if (a = l(e, t), o = u(e, t), o -= a, o > 0 && t + a + o <= c) return s = r + i * n, { headerLength: a, frameLength: o, stamp: s } } function g (e, t, r, i, n) { var a = h(e.samplerate); var o = p(t, r, i, n, a); if (o) { var s = o.stamp; var l = o.headerLength; var u = o.frameLength; var c = { unit: t.subarray(r + l, r + l + u), pts: s, dts: s }; return e.samples.push(c), e.len += u, { sample: c, length: u + l } } }t.getAudioConfig = o, t.isHeaderPattern = s, t.getHeaderLength = l, t.getFullFrameLength = u, t.isHeader = c, t.probe = d, t.initTrackConfig = f, t.getFrameDuration = h, t.parseFrameHeader = p, t.appendFrame = g },
        './src/demux/demuxer-inline.js':
        /*! *************************************!*\
  !*** ./src/demux/demuxer-inline.js ***!
  \*************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i; var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../errors */'./src/errors.js'); var o = r(/*! ../crypt/decrypter */'./src/crypt/decrypter.js'); var s = r(/*! ../demux/aacdemuxer */'./src/demux/aacdemuxer.js'); var l = r(/*! ../demux/mp4demuxer */'./src/demux/mp4demuxer.js'); var u = r(/*! ../demux/tsdemuxer */'./src/demux/tsdemuxer.js'); var c = r(/*! ../demux/mp3demuxer */'./src/demux/mp3demuxer.js'); var d = r(/*! ../remux/mp4-remuxer */'./src/remux/mp4-remuxer.js'); var f = r(/*! ../remux/passthrough-remuxer */'./src/remux/passthrough-remuxer.js'); var h = r(/*! ../utils/get-self-scope */'./src/utils/get-self-scope.js'); var p = r(/*! ../utils/logger */'./src/utils/logger.js'); var g = h.getSelfScope(); try { i = g.performance.now.bind(g.performance) } catch (y) { p.logger.debug('Unable to use Performance API on this environment'), i = g.Date.now } var v = (function () { function e (e, t, r, i) { this.observer = e, this.typeSupported = t, this.config = r, this.vendor = i } return e.prototype.destroy = function () { var e = this.demuxer; e && e.destroy() }, e.prototype.push = function (e, t, r, a, s, l, u, c, d, f, h, p) { var g = this; if (e.byteLength > 0 && t != null && t.key != null && t.method === 'AES-128') { var v = this.decrypter; v == null && (v = this.decrypter = new o.default(this.observer, this.config)); var y = i(); v.decrypt(e, t.key.buffer, t.iv.buffer, function (e) { var o = i(); g.observer.trigger(n.default.FRAG_DECRYPTED, { stats: { tstart: y, tdecrypt: o } }), g.pushDecrypted(new Uint8Array(e), t, new Uint8Array(r), a, s, l, u, c, d, f, h, p) }) } else this.pushDecrypted(new Uint8Array(e), t, new Uint8Array(r), a, s, l, u, c, d, f, h, p) }, e.prototype.pushDecrypted = function (e, t, r, i, o, h, p, g, v, y, m, b) { var E = this.demuxer; if (!E || (p || g) && !this.probe(e)) { for (var _ = this.observer, S = this.typeSupported, T = this.config, w = [{ demux: u.default, remux: d.default }, { demux: l.default, remux: f.default }, { demux: s.default, remux: d.default }, { demux: c.default, remux: d.default }], A = 0, L = w.length; A < L; A++) { var R = w[A]; var k = R.demux.probe; if (k(e)) { var D = this.remuxer = new R.remux(_, T, S, this.vendor); E = new R.demux(_, D, T, S), this.probe = k; break } } if (!E) return void _.trigger(n.default.ERROR, { type: a.ErrorTypes.MEDIA_ERROR, details: a.ErrorDetails.FRAG_PARSING_ERROR, fatal: !0, reason: 'no demux matching with content found' }); this.demuxer = E } var O = this.remuxer; (p || g) && (E.resetInitSegment(r, i, o, y), O.resetInitSegment()), p && (E.resetTimeStamp(b), O.resetTimeStamp(b)), typeof E.setDecryptData === 'function' && E.setDecryptData(t), E.append(e, h, v, m) }, e }()); t.default = v },
        './src/demux/demuxer-worker.js':
        /*! *************************************!*\
  !*** ./src/demux/demuxer-worker.js ***!
  \*************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../demux/demuxer-inline */'./src/demux/demuxer-inline.js'); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../utils/logger */'./src/utils/logger.js'); var o = r(/*! events */'./node_modules/node-libs-browser/node_modules/events/events.js'); var s = function (e) { var t = new o.EventEmitter(); t.trigger = function (e) { for (var r = [], i = 1; i < arguments.length; i++)r[i - 1] = arguments[i]; t.emit.apply(t, [e, e].concat(r)) }, t.off = function (e) { for (var r = [], i = 1; i < arguments.length; i++)r[i - 1] = arguments[i]; t.removeListener.apply(t, [e].concat(r)) }; var r = function (t, r) { e.postMessage({ event: t, data: r }) }; e.addEventListener('message', function (n) { var o = n.data; switch (o.cmd) { case 'init':var s = JSON.parse(o.config); e.demuxer = new i.default(t, o.typeSupported, s, o.vendor), a.enableLogs(s.debug), r('init', null); break; case 'demux':e.demuxer.push(o.data, o.decryptdata, o.initSegment, o.audioCodec, o.videoCodec, o.timeOffset, o.discontinuity, o.trackSwitch, o.contiguous, o.duration, o.accurateTimeOffset, o.defaultInitPTS); break; default:break } }), t.on(n.default.FRAG_DECRYPTED, r), t.on(n.default.FRAG_PARSING_INIT_SEGMENT, r), t.on(n.default.FRAG_PARSED, r), t.on(n.default.ERROR, r), t.on(n.default.FRAG_PARSING_METADATA, r), t.on(n.default.FRAG_PARSING_USERDATA, r), t.on(n.default.INIT_PTS_FOUND, r), t.on(n.default.FRAG_PARSING_DATA, function (t, r) { var i = []; var n = { event: t, data: r }; r.data1 && (n.data1 = r.data1.buffer, i.push(r.data1.buffer), delete r.data1), r.data2 && (n.data2 = r.data2.buffer, i.push(r.data2.buffer), delete r.data2), e.postMessage(n, i) }) }; t.default = s },
        './src/demux/demuxer.js':
        /*! ******************************!*\
  !*** ./src/demux/demuxer.js ***!
  \******************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! webworkify-webpack */'./node_modules/webworkify-webpack/index.js'); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../demux/demuxer-inline */'./src/demux/demuxer-inline.js'); var o = r(/*! ../utils/logger */'./src/utils/logger.js'); var s = r(/*! ../errors */'./src/errors.js'); var l = r(/*! ../utils/mediasource-helper */'./src/utils/mediasource-helper.js'); var u = r(/*! ../utils/get-self-scope */'./src/utils/get-self-scope.js'); var c = r(/*! ../observer */'./src/observer.js'); var d = u.getSelfScope(); var f = l.getMediaSource(); var h = (function () { function t (e, t) { var r = this; this.hls = e, this.id = t; var l = this.observer = new c.Observer(); var u = e.config; var h = function (t, i) { i = i || {}, i.frag = r.frag, i.id = r.id, e.trigger(t, i) }; l.on(n.default.FRAG_DECRYPTED, h), l.on(n.default.FRAG_PARSING_INIT_SEGMENT, h), l.on(n.default.FRAG_PARSING_DATA, h), l.on(n.default.FRAG_PARSED, h), l.on(n.default.ERROR, h), l.on(n.default.FRAG_PARSING_METADATA, h), l.on(n.default.FRAG_PARSING_USERDATA, h), l.on(n.default.INIT_PTS_FOUND, h); var p = { mp4: f.isTypeSupported('video/mp4'), mpeg: f.isTypeSupported('audio/mpeg'), mp3: f.isTypeSupported('audio/mp4; codecs="mp3"') }; var g = navigator.vendor; if (u.enableWorker && typeof Worker !== 'undefined') { o.logger.log('demuxing in webworker'); var v = void 0; try { v = this.w = i(/*! ../demux/demuxer-worker.js */'./src/demux/demuxer-worker.js'), this.onwmsg = this.onWorkerMessage.bind(this), v.addEventListener('message', this.onwmsg), v.onerror = function (t) { e.trigger(n.default.ERROR, { type: s.ErrorTypes.OTHER_ERROR, details: s.ErrorDetails.INTERNAL_EXCEPTION, fatal: !0, event: 'demuxerWorker', err: { message: t.message + ' (' + t.filename + ':' + t.lineno + ')' } }) }, v.postMessage({ cmd: 'init', typeSupported: p, vendor: g, id: t, config: JSON.stringify(u) }) } catch (y) { o.logger.warn('Error in worker:', y), o.logger.error('Error while initializing DemuxerWorker, fallback on DemuxerInline'), v && d.URL.revokeObjectURL(v.objectURL), this.demuxer = new a.default(l, p, u, g), this.w = void 0 } } else this.demuxer = new a.default(l, p, u, g) } return t.prototype.destroy = function () { var e = this.w; if (e)e.removeEventListener('message', this.onwmsg), e.terminate(), this.w = null; else { var t = this.demuxer; t && (t.destroy(), this.demuxer = null) } var r = this.observer; r && (r.removeAllListeners(), this.observer = null) }, t.prototype.push = function (t, r, i, n, a, s, l, u) { var c = this.w; var d = e.isFinite(a.startPTS) ? a.startPTS : a.start; var f = a.decryptdata; var h = this.frag; var p = !(h && a.cc === h.cc); var g = !(h && a.level === h.level); var v = h && a.sn === h.sn + 1; var y = !g && v; if (p && o.logger.log(this.id + ':discontinuity detected'), g && o.logger.log(this.id + ':switch detected'), this.frag = a, c)c.postMessage({ cmd: 'demux', data: t, decryptdata: f, initSegment: r, audioCodec: i, videoCodec: n, timeOffset: d, discontinuity: p, trackSwitch: g, contiguous: y, duration: s, accurateTimeOffset: l, defaultInitPTS: u }, t instanceof ArrayBuffer ? [t] : []); else { var m = this.demuxer; m && m.push(t, f, r, i, n, d, p, g, y, s, l, u) } }, t.prototype.onWorkerMessage = function (e) { var t = e.data; var r = this.hls; switch (t.event) { case 'init':d.URL.revokeObjectURL(this.w.objectURL); break; case n.default.FRAG_PARSING_DATA:t.data.data1 = new Uint8Array(t.data1), t.data2 && (t.data.data2 = new Uint8Array(t.data2)); default:t.data = t.data || {}, t.data.frag = this.frag, t.data.id = this.id, r.trigger(t.event, t.data); break } }, t }()); t.default = h }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/demux/exp-golomb.js':
        /*! *********************************!*\
  !*** ./src/demux/exp-golomb.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../utils/logger */'./src/utils/logger.js'); var n = (function () { function e (e) { this.data = e, this.bytesAvailable = e.byteLength, this.word = 0, this.bitsAvailable = 0 } return e.prototype.loadWord = function () { var e = this.data; var t = this.bytesAvailable; var r = e.byteLength - t; var i = new Uint8Array(4); var n = Math.min(4, t); if (n === 0) throw new Error('no bytes available'); i.set(e.subarray(r, r + n)), this.word = new DataView(i.buffer).getUint32(0), this.bitsAvailable = 8 * n, this.bytesAvailable -= n }, e.prototype.skipBits = function (e) { var t; this.bitsAvailable > e ? (this.word <<= e, this.bitsAvailable -= e) : (e -= this.bitsAvailable, t = e >> 3, e -= t >> 3, this.bytesAvailable -= t, this.loadWord(), this.word <<= e, this.bitsAvailable -= e) }, e.prototype.readBits = function (e) { var t = Math.min(this.bitsAvailable, e); var r = this.word >>> 32 - t; return e > 32 && i.logger.error('Cannot read more than 32 bits at a time'), this.bitsAvailable -= t, this.bitsAvailable > 0 ? this.word <<= t : this.bytesAvailable > 0 && this.loadWord(), t = e - t, t > 0 && this.bitsAvailable ? r << t | this.readBits(t) : r }, e.prototype.skipLZ = function () { var e; for (e = 0; e < this.bitsAvailable; ++e) if ((this.word & 2147483648 >>> e) !== 0) return this.word <<= e, this.bitsAvailable -= e, e; return this.loadWord(), e + this.skipLZ() }, e.prototype.skipUEG = function () { this.skipBits(1 + this.skipLZ()) }, e.prototype.skipEG = function () { this.skipBits(1 + this.skipLZ()) }, e.prototype.readUEG = function () { var e = this.skipLZ(); return this.readBits(e + 1) - 1 }, e.prototype.readEG = function () { var e = this.readUEG(); return 1 & e ? 1 + e >>> 1 : -1 * (e >>> 1) }, e.prototype.readBoolean = function () { return this.readBits(1) === 1 }, e.prototype.readUByte = function () { return this.readBits(8) }, e.prototype.readUShort = function () { return this.readBits(16) }, e.prototype.readUInt = function () { return this.readBits(32) }, e.prototype.skipScalingList = function (e) { var t; var r; var i = 8; var n = 8; for (t = 0; t < e; t++)n !== 0 && (r = this.readEG(), n = (i + r + 256) % 256), i = n === 0 ? i : n }, e.prototype.readSPS = function () { var e; var t; var r; var i; var n; var a; var o; var s = 0; var l = 0; var u = 0; var c = 0; var d = this.readUByte.bind(this); var f = this.readBits.bind(this); var h = this.readUEG.bind(this); var p = this.readBoolean.bind(this); var g = this.skipBits.bind(this); var v = this.skipEG.bind(this); var y = this.skipUEG.bind(this); var m = this.skipScalingList.bind(this); if (d(), e = d(), f(5), g(3), d(), y(), e === 100 || e === 110 || e === 122 || e === 244 || e === 44 || e === 83 || e === 86 || e === 118 || e === 128) { var b = h(); if (b === 3 && g(1), y(), y(), g(1), p()) for (a = b !== 3 ? 8 : 12, o = 0; o < a; o++)p() && m(o < 6 ? 16 : 64) }y(); var E = h(); if (E === 0)h(); else if (E === 1) for (g(1), v(), v(), t = h(), o = 0; o < t; o++)v(); y(), g(1), r = h(), i = h(), n = f(1), n === 0 && g(1), g(1), p() && (s = h(), l = h(), u = h(), c = h()); var _ = [1, 1]; if (p() && p()) { var S = d(); switch (S) { case 1:_ = [1, 1]; break; case 2:_ = [12, 11]; break; case 3:_ = [10, 11]; break; case 4:_ = [16, 11]; break; case 5:_ = [40, 33]; break; case 6:_ = [24, 11]; break; case 7:_ = [20, 11]; break; case 8:_ = [32, 11]; break; case 9:_ = [80, 33]; break; case 10:_ = [18, 11]; break; case 11:_ = [15, 11]; break; case 12:_ = [64, 33]; break; case 13:_ = [160, 99]; break; case 14:_ = [4, 3]; break; case 15:_ = [3, 2]; break; case 16:_ = [2, 1]; break; case 255:_ = [d() << 8 | d(), d() << 8 | d()]; break } } return { width: Math.ceil(16 * (r + 1) - 2 * s - 2 * l), height: (2 - n) * (i + 1) * 16 - (n ? 2 : 4) * (u + c), pixelRatio: _ } }, e.prototype.readSliceType = function () { return this.readUByte(), this.readUEG(), this.readUEG() }, e }()); t.default = n },
        './src/demux/id3.js':
        /*! **************************!*\
  !*** ./src/demux/id3.js ***!
  \**************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = (function () { function e () {} return e.isHeader = function (e, t) { return t + 10 <= e.length && e[t] === 73 && e[t + 1] === 68 && e[t + 2] === 51 && e[t + 3] < 255 && e[t + 4] < 255 && e[t + 6] < 128 && e[t + 7] < 128 && e[t + 8] < 128 && e[t + 9] < 128 }, e.isFooter = function (e, t) { return t + 10 <= e.length && e[t] === 51 && e[t + 1] === 68 && e[t + 2] === 73 && e[t + 3] < 255 && e[t + 4] < 255 && e[t + 6] < 128 && e[t + 7] < 128 && e[t + 8] < 128 && e[t + 9] < 128 }, e.getID3Data = function (t, r) { var i = r; var n = 0; while (e.isHeader(t, r)) { n += 10; var a = e._readSize(t, r + 6); n += a, e.isFooter(t, r + 10) && (n += 10), r += n } if (n > 0) return t.subarray(i, i + n) }, e._readSize = function (e, t) { var r = 0; return r = (127 & e[t]) << 21, r |= (127 & e[t + 1]) << 14, r |= (127 & e[t + 2]) << 7, r |= 127 & e[t + 3], r }, e.getTimeStamp = function (t) { for (var r = e.getID3Frames(t), i = 0; i < r.length; i++) { var n = r[i]; if (e.isTimeStampFrame(n)) return e._readTimeStamp(n) } }, e.isTimeStampFrame = function (e) { return e && e.key === 'PRIV' && e.info === 'com.apple.streaming.transportStreamTimestamp' }, e._getFrameData = function (t) { var r = String.fromCharCode(t[0], t[1], t[2], t[3]); var i = e._readSize(t, 4); var n = 10; return { type: r, size: i, data: t.subarray(n, n + i) } }, e.getID3Frames = function (t) { var r = 0; var i = []; while (e.isHeader(t, r)) { var n = e._readSize(t, r + 6); r += 10; var a = r + n; while (r + 8 < a) { var o = e._getFrameData(t.subarray(r)); var s = e._decodeFrame(o); s && i.push(s), r += o.size + 10 }e.isFooter(t, r) && (r += 10) } return i }, e._decodeFrame = function (t) { return t.type === 'PRIV' ? e._decodePrivFrame(t) : t.type[0] === 'T' ? e._decodeTextFrame(t) : t.type[0] === 'W' ? e._decodeURLFrame(t) : void 0 }, e._readTimeStamp = function (e) { if (e.data.byteLength === 8) { var t = new Uint8Array(e.data); var r = 1 & t[3]; var i = (t[4] << 23) + (t[5] << 15) + (t[6] << 7) + t[7]; return i /= 45, r && (i += 47721858.84), Math.round(i) } }, e._decodePrivFrame = function (t) { if (!(t.size < 2)) { var r = e._utf8ArrayToStr(t.data, !0); var i = new Uint8Array(t.data.subarray(r.length + 1)); return { key: t.type, info: r, data: i.buffer } } }, e._decodeTextFrame = function (t) { if (!(t.size < 2)) { if (t.type === 'TXXX') { var r = 1; var i = e._utf8ArrayToStr(t.data.subarray(r)); r += i.length + 1; var n = e._utf8ArrayToStr(t.data.subarray(r)); return { key: t.type, info: i, data: n } } var a = e._utf8ArrayToStr(t.data.subarray(1)); return { key: t.type, data: a } } }, e._decodeURLFrame = function (t) { if (t.type === 'WXXX') { if (t.size < 2) return; var r = 1; var i = e._utf8ArrayToStr(t.data.subarray(r)); r += i.length + 1; var n = e._utf8ArrayToStr(t.data.subarray(r)); return { key: t.type, info: i, data: n } } var a = e._utf8ArrayToStr(t.data); return { key: t.type, data: a } }, e._utf8ArrayToStr = function (e, t) { void 0 === t && (t = !1); var r; var i; var n; var a = e.length; var o = ''; var s = 0; while (s < a) { if (r = e[s++], r === 0 && t) return o; if (r !== 0 && r !== 3) switch (r >> 4) { case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o += String.fromCharCode(r); break; case 12:case 13:i = e[s++], o += String.fromCharCode((31 & r) << 6 | 63 & i); break; case 14:i = e[s++], n = e[s++], o += String.fromCharCode((15 & r) << 12 | (63 & i) << 6 | (63 & n) << 0); break; default: } } return o }, e }()); var n = i._utf8ArrayToStr; t.utf8ArrayToStr = n, t.default = i },
        './src/demux/mp3demuxer.js':
        /*! *********************************!*\
  !*** ./src/demux/mp3demuxer.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../demux/id3 */'./src/demux/id3.js'); var n = r(/*! ../utils/logger */'./src/utils/logger.js'); var a = r(/*! ./mpegaudio */'./src/demux/mpegaudio.js'); var o = (function () { function e (e, t, r) { this.observer = e, this.config = r, this.remuxer = t } return e.prototype.resetInitSegment = function (e, t, r, i) { this._audioTrack = { container: 'audio/mpeg', type: 'audio', id: -1, sequenceNumber: 0, isAAC: !1, samples: [], len: 0, manifestCodec: t, duration: i, inputTimeScale: 9e4 } }, e.prototype.resetTimeStamp = function () {}, e.probe = function (e) { var t; var r; var o = i.default.getID3Data(e, 0); if (o && void 0 !== i.default.getTimeStamp(o)) for (t = o.length, r = Math.min(e.length - 1, t + 100); t < r; t++) if (a.default.probe(e, t)) return n.logger.log('MPEG Audio sync word found !'), !0; return !1 }, e.prototype.append = function (e, t, r, n) { var o = i.default.getID3Data(e, 0); var s = i.default.getTimeStamp(o); var l = s ? 90 * s : 9e4 * t; var u = o.length; var c = e.length; var d = 0; var f = 0; var h = this._audioTrack; var p = [{ pts: l, dts: l, data: o }]; while (u < c) if (a.default.isHeader(e, u)) { var g = a.default.appendFrame(h, e, u, l, d); if (!g) break; u += g.length, f = g.sample.pts, d++ } else i.default.isHeader(e, u) ? (o = i.default.getID3Data(e, u), p.push({ pts: f, dts: f, data: o }), u += o.length) : u++; this.remuxer.remux(h, { samples: [] }, { samples: p, inputTimeScale: 9e4 }, { samples: [] }, t, r, n) }, e.prototype.destroy = function () {}, e }()); t.default = o },
        './src/demux/mp4demuxer.js':
        /*! *********************************!*\
  !*** ./src/demux/mp4demuxer.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../utils/logger */'./src/utils/logger.js'); var n = r(/*! ../events */'./src/events.js'); var a = Math.pow(2, 32) - 1; var o = (function () { function e (e, t) { this.observer = e, this.remuxer = t } return e.prototype.resetTimeStamp = function (e) { this.initPTS = e }, e.prototype.resetInitSegment = function (t, r, i, a) { if (t && t.byteLength) { var o = this.initData = e.parseInitSegment(t); r == null && (r = 'mp4a.40.5'), i == null && (i = 'avc1.42e01e'); var s = {}; o.audio && o.video ? s.audiovideo = { container: 'video/mp4', codec: r + ',' + i, initSegment: a ? t : null } : (o.audio && (s.audio = { container: 'audio/mp4', codec: r, initSegment: a ? t : null }), o.video && (s.video = { container: 'video/mp4', codec: i, initSegment: a ? t : null })), this.observer.trigger(n.default.FRAG_PARSING_INIT_SEGMENT, { tracks: s }) } else r && (this.audioCodec = r), i && (this.videoCodec = i) }, e.probe = function (t) { return e.findBox({ data: t, start: 0, end: Math.min(t.length, 16384) }, ['moof']).length > 0 }, e.bin2str = function (e) { return String.fromCharCode.apply(null, e) }, e.readUint16 = function (e, t) { e.data && (t += e.start, e = e.data); var r = e[t] << 8 | e[t + 1]; return r < 0 ? 65536 + r : r }, e.readUint32 = function (e, t) { e.data && (t += e.start, e = e.data); var r = e[t] << 24 | e[t + 1] << 16 | e[t + 2] << 8 | e[t + 3]; return r < 0 ? 4294967296 + r : r }, e.writeUint32 = function (e, t, r) { e.data && (t += e.start, e = e.data), e[t] = r >> 24, e[t + 1] = r >> 16 & 255, e[t + 2] = r >> 8 & 255, e[t + 3] = 255 & r }, e.findBox = function (t, r) { var i; var n; var a; var o; var s; var l; var u; var c = []; if (t.data ? (l = t.start, o = t.end, t = t.data) : (l = 0, o = t.byteLength), !r.length) return null; for (i = l; i < o;)n = e.readUint32(t, i), a = e.bin2str(t.subarray(i + 4, i + 8)), u = n > 1 ? i + n : o, a === r[0] && (r.length === 1 ? c.push({ data: t, start: i + 8, end: u }) : (s = e.findBox({ data: t, start: i + 8, end: u }, r.slice(1)), s.length && (c = c.concat(s)))), i = u; return c }, e.parseSegmentIndex = function (t) { var r; var i = e.findBox(t, ['moov'])[0]; var n = i ? i.end : null; var a = 0; var o = e.findBox(t, ['sidx']); if (!o || !o[0]) return null; r = [], o = o[0]; var s = o.data[0]; a = s === 0 ? 8 : 16; var l = e.readUint32(o, a); a += 4; var u = 0; var c = 0; a += s === 0 ? 8 : 16, a += 2; var d = o.end + c; var f = e.readUint16(o, a); a += 2; for (var h = 0; h < f; h++) { var p = a; var g = e.readUint32(o, p); p += 4; var v = 2147483647 & g; var y = (2147483648 & g) >>> 31; if (y === 1) return void console.warn('SIDX has hierarchical references (not supported)'); var m = e.readUint32(o, p); p += 4, r.push({ referenceSize: v, subsegmentDuration: m, info: { duration: m / l, start: d, end: d + v - 1 } }), d += v, p += 4, a = p } return { earliestPresentationTime: u, timescale: l, version: s, referencesCount: f, references: r, moovEndOffset: n } }, e.parseInitSegment = function (t) { var r = []; var n = e.findBox(t, ['moov', 'trak']); return n.forEach(function (t) { var n = e.findBox(t, ['tkhd'])[0]; if (n) { var a = n.data[n.start]; var o = a === 0 ? 12 : 20; var s = e.readUint32(n, o); var l = e.findBox(t, ['mdia', 'mdhd'])[0]; if (l) { a = l.data[l.start], o = a === 0 ? 12 : 20; var u = e.readUint32(l, o); var c = e.findBox(t, ['mdia', 'hdlr'])[0]; if (c) { var d = e.bin2str(c.data.subarray(c.start + 8, c.start + 12)); var f = { soun: 'audio', vide: 'video' }[d]; if (f) { var h = e.findBox(t, ['mdia', 'minf', 'stbl', 'stsd']); if (h.length) { h = h[0]; var p = e.bin2str(h.data.subarray(h.start + 12, h.start + 16)); i.logger.log('MP4Demuxer:' + f + ':' + p + ' found') }r[s] = { timescale: u, type: f }, r[f] = { timescale: u, id: s } } } } } }), r }, e.getStartDTS = function (t, r) { var i, n, a; return i = e.findBox(r, ['moof', 'traf']), n = [].concat.apply([], i.map(function (r) { return e.findBox(r, ['tfhd']).map(function (i) { var n, a, o; return n = e.readUint32(i, 4), a = t[n].timescale || 9e4, o = e.findBox(r, ['tfdt']).map(function (t) { var r, i; return r = t.data[t.start], i = e.readUint32(t, 4), r === 1 && (i *= Math.pow(2, 32), i += e.readUint32(t, 8)), i })[0], o / a }) })), a = Math.min.apply(null, n), isFinite(a) ? a : 0 }, e.offsetStartDTS = function (t, r, i) { e.findBox(r, ['moof', 'traf']).map(function (r) { return e.findBox(r, ['tfhd']).map(function (n) { var o = e.readUint32(n, 4); var s = t[o].timescale || 9e4; e.findBox(r, ['tfdt']).map(function (t) { var r = t.data[t.start]; var n = e.readUint32(t, 4); if (r === 0)e.writeUint32(t, 4, n - i * s); else { n *= Math.pow(2, 32), n += e.readUint32(t, 8), n -= i * s, n = Math.max(n, 0); var o = Math.floor(n / (a + 1)); var l = Math.floor(n % (a + 1)); e.writeUint32(t, 4, o), e.writeUint32(t, 8, l) } }) }) }) }, e.prototype.append = function (t, r, i, a) { var o = this.initData; o || (this.resetInitSegment(t, this.audioCodec, this.videoCodec, !1), o = this.initData); var s; var l = this.initPTS; if (void 0 === l) { var u = e.getStartDTS(o, t); this.initPTS = l = u - r, this.observer.trigger(n.default.INIT_PTS_FOUND, { initPTS: l }) }e.offsetStartDTS(o, t, l), s = e.getStartDTS(o, t), this.remuxer.remux(o.audio, o.video, null, null, s, i, a, t) }, e.prototype.destroy = function () {}, e }()); t.default = o },
        './src/demux/mpegaudio.js':
        /*! ********************************!*\
  !*** ./src/demux/mpegaudio.js ***!
  \********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = { BitratesMap: [32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160], SamplingRateMap: [44100, 48e3, 32e3, 22050, 24e3, 16e3, 11025, 12e3, 8e3], SamplesCoefficients: [[0, 72, 144, 12], [0, 0, 0, 0], [0, 72, 144, 12], [0, 144, 144, 12]], BytesInSlot: [0, 1, 1, 4], appendFrame: function (e, t, r, i, n) { if (!(r + 24 > t.length)) { var a = this.parseHeader(t, r); if (a && r + a.frameLength <= t.length) { var o = 9e4 * a.samplesPerFrame / a.sampleRate; var s = i + n * o; var l = { unit: t.subarray(r, r + a.frameLength), pts: s, dts: s }; return e.config = [], e.channelCount = a.channelCount, e.samplerate = a.sampleRate, e.samples.push(l), e.len += a.frameLength, { sample: l, length: a.frameLength } } } }, parseHeader: function (e, t) { var r = e[t + 1] >> 3 & 3; var n = e[t + 1] >> 1 & 3; var a = e[t + 2] >> 4 & 15; var o = e[t + 2] >> 2 & 3; var s = e[t + 2] >> 1 & 1; if (r !== 1 && a !== 0 && a !== 15 && o !== 3) { var l = r === 3 ? 3 - n : n === 3 ? 3 : 4; var u = 1e3 * i.BitratesMap[14 * l + a - 1]; var c = r === 3 ? 0 : r === 2 ? 1 : 2; var d = i.SamplingRateMap[3 * c + o]; var f = e[t + 3] >> 6 === 3 ? 1 : 2; var h = i.SamplesCoefficients[r][n]; var p = i.BytesInSlot[n]; var g = 8 * h * p; var v = parseInt(h * u / d + s, 10) * p; return { sampleRate: d, channelCount: f, frameLength: v, samplesPerFrame: g } } }, isHeaderPattern: function (e, t) { return e[t] === 255 && (224 & e[t + 1]) === 224 && (6 & e[t + 1]) !== 0 }, isHeader: function (e, t) { return !!(t + 1 < e.length && this.isHeaderPattern(e, t)) }, probe: function (e, t) { if (t + 1 < e.length && this.isHeaderPattern(e, t)) { var r = 4; var i = this.parseHeader(e, t); var n = r; i && i.frameLength && (n = i.frameLength); var a = t + n; if (a === e.length || a + 1 < e.length && this.isHeaderPattern(e, a)) return !0 } return !1 } }; t.default = i },
        './src/demux/sample-aes.js':
        /*! *********************************!*\
  !*** ./src/demux/sample-aes.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../crypt/decrypter */'./src/crypt/decrypter.js'); var n = (function () { function e (e, t, r, n) { this.decryptdata = r, this.discardEPB = n, this.decrypter = new i.default(e, t, { removePKCS7Padding: !1 }) } return e.prototype.decryptBuffer = function (e, t) { this.decrypter.decrypt(e, this.decryptdata.key.buffer, this.decryptdata.iv.buffer, t) }, e.prototype.decryptAacSample = function (e, t, r, i) { var n = e[t].unit; var a = n.subarray(16, n.length - n.length % 16); var o = a.buffer.slice(a.byteOffset, a.byteOffset + a.length); var s = this; this.decryptBuffer(o, function (a) { a = new Uint8Array(a), n.set(a, 16), i || s.decryptAacSamples(e, t + 1, r) }) }, e.prototype.decryptAacSamples = function (e, t, r) { for (;;t++) { if (t >= e.length) return void r(); if (!(e[t].unit.length < 32)) { var i = this.decrypter.isSync(); if (this.decryptAacSample(e, t, r, i), !i) return } } }, e.prototype.getAvcEncryptedData = function (e) { for (var t = 16 * Math.floor((e.length - 48) / 160) + 16, r = new Int8Array(t), i = 0, n = 32; n <= e.length - 16; n += 160, i += 16)r.set(e.subarray(n, n + 16), i); return r }, e.prototype.getAvcDecryptedUnit = function (e, t) { t = new Uint8Array(t); for (var r = 0, i = 32; i <= e.length - 16; i += 160, r += 16)e.set(t.subarray(r, r + 16), i); return e }, e.prototype.decryptAvcSample = function (e, t, r, i, n, a) { var o = this.discardEPB(n.data); var s = this.getAvcEncryptedData(o); var l = this; this.decryptBuffer(s.buffer, function (s) { n.data = l.getAvcDecryptedUnit(o, s), a || l.decryptAvcSamples(e, t, r + 1, i) }) }, e.prototype.decryptAvcSamples = function (e, t, r, i) { for (;;t++, r = 0) { if (t >= e.length) return void i(); for (var n = e[t].units; ;r++) { if (r >= n.length) break; var a = n[r]; if (!(a.length <= 48 || a.type !== 1 && a.type !== 5)) { var o = this.decrypter.isSync(); if (this.decryptAvcSample(e, t, r, i, a, o), !o) return } } } }, e }()); t.default = n },
        './src/demux/tsdemuxer.js':
        /*! ********************************!*\
  !*** ./src/demux/tsdemuxer.js ***!
  \********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./adts */'./src/demux/adts.js'); var n = r(/*! ./mpegaudio */'./src/demux/mpegaudio.js'); var a = r(/*! ../events */'./src/events.js'); var o = r(/*! ./exp-golomb */'./src/demux/exp-golomb.js'); var s = r(/*! ./sample-aes */'./src/demux/sample-aes.js'); var l = r(/*! ../utils/logger */'./src/utils/logger.js'); var u = r(/*! ../errors */'./src/errors.js'); var c = { video: 1, audio: 2, id3: 3, text: 4 }; var d = (function () { function e (e, t, r, i) { this.observer = e, this.config = r, this.typeSupported = i, this.remuxer = t, this.sampleAes = null } return e.prototype.setDecryptData = function (e) { e != null && e.key != null && e.method === 'SAMPLE-AES' ? this.sampleAes = new s.default(this.observer, this.config, e, this.discardEPB) : this.sampleAes = null }, e.probe = function (t) { var r = e._syncOffset(t); return !(r < 0) && (r && l.logger.warn('MPEG2-TS detected but first sync word found @ offset ' + r + ', junk ahead ?'), !0) }, e._syncOffset = function (e) { var t = Math.min(1e3, e.length - 564); var r = 0; while (r < t) { if (e[r] === 71 && e[r + 188] === 71 && e[r + 376] === 71) return r; r++ } return -1 }, e.createTrack = function (e, t) { return { container: e === 'video' || e === 'audio' ? 'video/mp2t' : void 0, type: e, id: c[e], pid: -1, inputTimeScale: 9e4, sequenceNumber: 0, samples: [], len: 0, dropped: e === 'video' ? 0 : void 0, isAAC: e === 'audio' || void 0, duration: e === 'audio' ? t : void 0 } }, e.prototype.resetInitSegment = function (t, r, i, n) { this.pmtParsed = !1, this._pmtId = -1, this._avcTrack = e.createTrack('video', n), this._audioTrack = e.createTrack('audio', n), this._id3Track = e.createTrack('id3', n), this._txtTrack = e.createTrack('text', n), this.aacOverFlow = null, this.aacLastPTS = null, this.avcSample = null, this.audioCodec = r, this.videoCodec = i, this._duration = n }, e.prototype.resetTimeStamp = function () {}, e.prototype.append = function (t, r, i, n) { var o; var s; var c; var d; var f; var h; var p = t.length; var g = !1; this.contiguous = i; var v = this.pmtParsed; var y = this._avcTrack; var m = this._audioTrack; var b = this._id3Track; var E = y.pid; var _ = m.pid; var S = b.pid; var T = this._pmtId; var w = y.pesData; var A = m.pesData; var L = b.pesData; var R = this._parsePAT; var k = this._parsePMT; var D = this._parsePES; var O = this._parseAVCPES.bind(this); var P = this._parseAACPES.bind(this); var I = this._parseMPEGPES.bind(this); var x = this._parseID3PES.bind(this); var C = e._syncOffset(t); for (p -= (p + C) % 188, o = C; o < p; o += 188) if (t[o] === 71) { if (s = !!(64 & t[o + 1]), c = ((31 & t[o + 1]) << 8) + t[o + 2], d = (48 & t[o + 3]) >> 4, d > 1) { if (f = o + 5 + t[o + 4], f === o + 188) continue } else f = o + 4; switch (c) { case E:s && (w && (h = D(w)) && void 0 !== h.pts && O(h, !1), w = { data: [], size: 0 }), w && (w.data.push(t.subarray(f, o + 188)), w.size += o + 188 - f); break; case _:s && (A && (h = D(A)) && void 0 !== h.pts && (m.isAAC ? P(h) : I(h)), A = { data: [], size: 0 }), A && (A.data.push(t.subarray(f, o + 188)), A.size += o + 188 - f); break; case S:s && (L && (h = D(L)) && void 0 !== h.pts && x(h), L = { data: [], size: 0 }), L && (L.data.push(t.subarray(f, o + 188)), L.size += o + 188 - f); break; case 0:s && (f += t[f] + 1), T = this._pmtId = R(t, f); break; case T:s && (f += t[f] + 1); var F = k(t, f, !0 === this.typeSupported.mpeg || !0 === this.typeSupported.mp3, this.sampleAes != null); E = F.avc, E > 0 && (y.pid = E), _ = F.audio, _ > 0 && (m.pid = _, m.isAAC = F.isAAC), S = F.id3, S > 0 && (b.pid = S), g && !v && (l.logger.log('reparse from beginning'), g = !1, o = C - 188), v = this.pmtParsed = !0; break; case 17:case 8191:break; default:g = !0; break } } else this.observer.trigger(a.default.ERROR, { type: u.ErrorTypes.MEDIA_ERROR, details: u.ErrorDetails.FRAG_PARSING_ERROR, fatal: !1, reason: 'TS packet did not start with 0x47' }); w && (h = D(w)) && void 0 !== h.pts ? (O(h, !0), y.pesData = null) : y.pesData = w, A && (h = D(A)) && void 0 !== h.pts ? (m.isAAC ? P(h) : I(h), m.pesData = null) : (A && A.size && l.logger.log('last AAC PES packet truncated,might overlap between fragments'), m.pesData = A), L && (h = D(L)) && void 0 !== h.pts ? (x(h), b.pesData = null) : b.pesData = L, this.sampleAes == null ? this.remuxer.remux(m, y, b, this._txtTrack, r, i, n) : this.decryptAndRemux(m, y, b, this._txtTrack, r, i, n) }, e.prototype.decryptAndRemux = function (e, t, r, i, n, a, o) { if (e.samples && e.isAAC) { var s = this; this.sampleAes.decryptAacSamples(e.samples, 0, function () { s.decryptAndRemuxAvc(e, t, r, i, n, a, o) }) } else this.decryptAndRemuxAvc(e, t, r, i, n, a, o) }, e.prototype.decryptAndRemuxAvc = function (e, t, r, i, n, a, o) { if (t.samples) { var s = this; this.sampleAes.decryptAvcSamples(t.samples, 0, 0, function () { s.remuxer.remux(e, t, r, i, n, a, o) }) } else this.remuxer.remux(e, t, r, i, n, a, o) }, e.prototype.destroy = function () { this._initPTS = this._initDTS = void 0, this._duration = 0 }, e.prototype._parsePAT = function (e, t) { return (31 & e[t + 10]) << 8 | e[t + 11] }, e.prototype._parsePMT = function (e, t, r, i) { var n; var a; var o; var s; var u = { audio: -1, avc: -1, id3: -1, isAAC: !0 }; n = (15 & e[t + 1]) << 8 | e[t + 2], a = t + 3 + n - 4, o = (15 & e[t + 10]) << 8 | e[t + 11], t += 12 + o; while (t < a) { switch (s = (31 & e[t + 1]) << 8 | e[t + 2], e[t]) { case 207:if (!i) { l.logger.log('unkown stream type:' + e[t]); break } case 15:u.audio === -1 && (u.audio = s); break; case 21:u.id3 === -1 && (u.id3 = s); break; case 219:if (!i) { l.logger.log('unkown stream type:' + e[t]); break } case 27:u.avc === -1 && (u.avc = s); break; case 3:case 4:r ? u.audio === -1 && (u.audio = s, u.isAAC = !1) : l.logger.log('MPEG audio found, not supported in this browser for now'); break; case 36:l.logger.warn('HEVC stream type found, not supported for now'); break; default:l.logger.log('unkown stream type:' + e[t]); break }t += 5 + ((15 & e[t + 3]) << 8 | e[t + 4]) } return u }, e.prototype._parsePES = function (e) { var t; var r; var i; var n; var a; var o; var s; var u; var c; var d = 0; var f = e.data; if (!e || e.size === 0) return null; while (f[0].length < 19 && f.length > 1) { var h = new Uint8Array(f[0].length + f[1].length); h.set(f[0]), h.set(f[1], f[0].length), f[0] = h, f.splice(1, 1) } if (t = f[0], i = (t[0] << 16) + (t[1] << 8) + t[2], i === 1) { if (n = (t[4] << 8) + t[5], n && n > e.size - 6) return null; r = t[7], 192 & r && (s = 536870912 * (14 & t[9]) + 4194304 * (255 & t[10]) + 16384 * (254 & t[11]) + 128 * (255 & t[12]) + (254 & t[13]) / 2, s > 4294967295 && (s -= 8589934592), 64 & r ? (u = 536870912 * (14 & t[14]) + 4194304 * (255 & t[15]) + 16384 * (254 & t[16]) + 128 * (255 & t[17]) + (254 & t[18]) / 2, u > 4294967295 && (u -= 8589934592), s - u > 54e5 && (l.logger.warn(Math.round((s - u) / 9e4) + 's delta between PTS and DTS, align them'), s = u)) : u = s), a = t[8], c = a + 9, e.size -= c, o = new Uint8Array(e.size); for (var p = 0, g = f.length; p < g; p++) { t = f[p]; var v = t.byteLength; if (c) { if (c > v) { c -= v; continue }t = t.subarray(c), v -= c, c = 0 }o.set(t, d), d += v } return n && (n -= a + 3), { data: o, pts: s, dts: u, len: n } } return null }, e.prototype.pushAccesUnit = function (e, t) { if (e.units.length && e.frame) { var r = t.samples; var i = r.length; !this.config.forceKeyFrameOnDiscontinuity || !0 === e.key || t.sps && (i || this.contiguous) ? (e.id = i, r.push(e)) : t.dropped++ }e.debug.length && l.logger.log(e.pts + '/' + e.dts + ':' + e.debug) }, e.prototype._parseAVCPES = function (e, t) { var r; var i; var n; var a = this; var s = this._avcTrack; var l = this._parseAVCNALu(e.data); var u = !1; var c = this.avcSample; var d = !1; var f = this.pushAccesUnit.bind(this); var h = function (e, t, r, i) { return { key: e, pts: t, dts: r, units: [], debug: i } }; e.data = null, c && l.length && !s.audFound && (f(c, s), c = this.avcSample = h(!1, e.pts, e.dts, '')), l.forEach(function (t) { switch (t.type) { case 1:i = !0, c || (c = a.avcSample = h(!0, e.pts, e.dts, '')), u && (c.debug += 'NDR '), c.frame = !0; var l = t.data; if (d && l.length > 4) { var p = new o.default(l).readSliceType(); p !== 2 && p !== 4 && p !== 7 && p !== 9 || (c.key = !0) } break; case 5:i = !0, c || (c = a.avcSample = h(!0, e.pts, e.dts, '')), u && (c.debug += 'IDR '), c.key = !0, c.frame = !0; break; case 6:i = !0, u && c && (c.debug += 'SEI '), r = new o.default(a.discardEPB(t.data)), r.readUByte(); var g = 0; var v = 0; var y = !1; var m = 0; while (!y && r.bytesAvailable > 1) { g = 0; do { m = r.readUByte(), g += m } while (m === 255);v = 0; do { m = r.readUByte(), v += m } while (m === 255);if (g === 4 && r.bytesAvailable !== 0) { y = !0; var b = r.readUByte(); if (b === 181) { var E = r.readUShort(); if (E === 49) { var _ = r.readUInt(); if (_ === 1195456820) { var S = r.readUByte(); if (S === 3) { var T = r.readUByte(); var w = r.readUByte(); var A = 31 & T; var L = [T, w]; for (n = 0; n < A; n++)L.push(r.readUByte()), L.push(r.readUByte()), L.push(r.readUByte()); a._insertSampleInOrder(a._txtTrack.samples, { type: 3, pts: e.pts, bytes: L }) } } } } } else if (v < r.bytesAvailable) for (n = 0; n < v; n++)r.readUByte() } break; case 7:if (i = !0, d = !0, u && c && (c.debug += 'SPS '), !s.sps) { r = new o.default(t.data); var R = r.readSPS(); s.width = R.width, s.height = R.height, s.pixelRatio = R.pixelRatio, s.sps = [t.data], s.duration = a._duration; var k = t.data.subarray(1, 4); var D = 'avc1.'; for (n = 0; n < 3; n++) { var O = k[n].toString(16); O.length < 2 && (O = '0' + O), D += O }s.codec = D } break; case 8:i = !0, u && c && (c.debug += 'PPS '), s.pps || (s.pps = [t.data]); break; case 9:i = !1, s.audFound = !0, c && f(c, s), c = a.avcSample = h(!1, e.pts, e.dts, u ? 'AUD ' : ''); break; case 12:i = !1; break; default:i = !1, c && (c.debug += 'unknown NAL ' + t.type + ' '); break } if (c && i) { var P = c.units; P.push(t) } }), t && c && (f(c, s), this.avcSample = null) }, e.prototype._insertSampleInOrder = function (e, t) { var r = e.length; if (r > 0) { if (t.pts >= e[r - 1].pts)e.push(t); else for (var i = r - 1; i >= 0; i--) if (t.pts < e[i].pts) { e.splice(i, 0, t); break } } else e.push(t) }, e.prototype._getLastNalUnit = function () { var e; var t = this.avcSample; if (!t || t.units.length === 0) { var r = this._avcTrack; var i = r.samples; t = i[i.length - 1] } if (t) { var n = t.units; e = n[n.length - 1] } return e }, e.prototype._parseAVCNALu = function (e) { var t; var r; var i; var n; var a; var o = 0; var s = e.byteLength; var l = this._avcTrack; var u = l.naluState || 0; var c = u; var d = []; var f = -1; u === -1 && (f = 0, a = 31 & e[0], u = 0, o = 1); while (o < s) if (t = e[o++], u) if (u !== 1) if (t) if (t === 1) { if (f >= 0)i = { data: e.subarray(f, o - u - 1), type: a }, d.push(i); else { var h = this._getLastNalUnit(); if (h && (c && o <= 4 - c && h.state && (h.data = h.data.subarray(0, h.data.byteLength - c)), r = o - u - 1, r > 0)) { var p = new Uint8Array(h.data.byteLength + r); p.set(h.data, 0), p.set(e.subarray(0, r), h.data.byteLength), h.data = p } }o < s ? (n = 31 & e[o], f = o, a = n, u = 0) : u = -1 } else u = 0; else u = 3; else u = t ? 0 : 2; else u = t ? 0 : 1; if (f >= 0 && u >= 0 && (i = { data: e.subarray(f, s), type: a, state: u }, d.push(i)), d.length === 0) { h = this._getLastNalUnit(); if (h) { p = new Uint8Array(h.data.byteLength + e.byteLength); p.set(h.data, 0), p.set(e, h.data.byteLength), h.data = p } } return l.naluState = u, d }, e.prototype.discardEPB = function (e) { var t; var r; var i = e.byteLength; var n = []; var a = 1; while (a < i - 2)e[a] === 0 && e[a + 1] === 0 && e[a + 2] === 3 ? (n.push(a + 2), a += 2) : a++; if (n.length === 0) return e; t = i - n.length, r = new Uint8Array(t); var o = 0; for (a = 0; a < t; o++, a++)o === n[0] && (o++, n.shift()), r[a] = e[o]; return r }, e.prototype._parseAACPES = function (e) { var t; var r; var n; var o; var s; var c = this._audioTrack; var d = e.data; var f = e.pts; var h = 0; var p = this.aacOverFlow; var g = this.aacLastPTS; if (p) { var v = new Uint8Array(p.byteLength + d.byteLength); v.set(p, 0), v.set(d, p.byteLength), d = v } for (n = h, s = d.length; n < s - 1; n++) if (i.isHeader(d, n)) break; if (n) { var y = void 0; var m = void 0; if (n < s - 1 ? (y = 'AAC PES did not start with ADTS header,offset:' + n, m = !1) : (y = 'no ADTS header found in AAC PES', m = !0), l.logger.warn('parsing error:' + y), this.observer.trigger(a.default.ERROR, { type: u.ErrorTypes.MEDIA_ERROR, details: u.ErrorDetails.FRAG_PARSING_ERROR, fatal: m, reason: y }), m) return } if (i.initTrackConfig(c, this.observer, d, n, this.audioCodec), r = 0, t = i.getFrameDuration(c.samplerate), p && g) { var b = g + t; Math.abs(b - f) > 1 && (l.logger.log('AAC: align PTS for overlapping frames by ' + Math.round((b - f) / 90)), f = b) } while (n < s) if (i.isHeader(d, n) && n + 5 < s) { var E = i.appendFrame(c, d, n, f, r); if (!E) break; n += E.length, o = E.sample.pts, r++ } else n++; p = n < s ? d.subarray(n, s) : null, this.aacOverFlow = p, this.aacLastPTS = o }, e.prototype._parseMPEGPES = function (e) { var t = e.data; var r = t.length; var i = 0; var a = 0; var o = e.pts; while (a < r) if (n.default.isHeader(t, a)) { var s = n.default.appendFrame(this._audioTrack, t, a, o, i); if (!s) break; a += s.length, i++ } else a++ }, e.prototype._parseID3PES = function (e) { this._id3Track.samples.push(e) }, e }()); t.default = d },
        './src/errors.js':
        /*! ***********************!*\
  !*** ./src/errors.js ***!
  \***********************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }), t.ErrorTypes = { NETWORK_ERROR: 'networkError', MEDIA_ERROR: 'mediaError', KEY_SYSTEM_ERROR: 'keySystemError', MUX_ERROR: 'muxError', OTHER_ERROR: 'otherError' }, t.ErrorDetails = { KEY_SYSTEM_NO_KEYS: 'keySystemNoKeys', KEY_SYSTEM_NO_ACCESS: 'keySystemNoAccess', KEY_SYSTEM_NO_SESSION: 'keySystemNoSession', KEY_SYSTEM_LICENSE_REQUEST_FAILED: 'keySystemLicenseRequestFailed', MANIFEST_LOAD_ERROR: 'manifestLoadError', MANIFEST_LOAD_TIMEOUT: 'manifestLoadTimeOut', MANIFEST_PARSING_ERROR: 'manifestParsingError', MANIFEST_INCOMPATIBLE_CODECS_ERROR: 'manifestIncompatibleCodecsError', LEVEL_LOAD_ERROR: 'levelLoadError', LEVEL_LOAD_TIMEOUT: 'levelLoadTimeOut', LEVEL_SWITCH_ERROR: 'levelSwitchError', AUDIO_TRACK_LOAD_ERROR: 'audioTrackLoadError', AUDIO_TRACK_LOAD_TIMEOUT: 'audioTrackLoadTimeOut', FRAG_LOAD_ERROR: 'fragLoadError', FRAG_LOAD_TIMEOUT: 'fragLoadTimeOut', FRAG_DECRYPT_ERROR: 'fragDecryptError', FRAG_PARSING_ERROR: 'fragParsingError', REMUX_ALLOC_ERROR: 'remuxAllocError', KEY_LOAD_ERROR: 'keyLoadError', KEY_LOAD_TIMEOUT: 'keyLoadTimeOut', BUFFER_ADD_CODEC_ERROR: 'bufferAddCodecError', BUFFER_APPEND_ERROR: 'bufferAppendError', BUFFER_APPENDING_ERROR: 'bufferAppendingError', BUFFER_STALLED_ERROR: 'bufferStalledError', BUFFER_FULL_ERROR: 'bufferFullError', BUFFER_SEEK_OVER_HOLE: 'bufferSeekOverHole', BUFFER_NUDGE_ON_STALL: 'bufferNudgeOnStall', INTERNAL_EXCEPTION: 'internalException' } },
        './src/event-handler.js':
        /*! ******************************!*\
  !*** ./src/event-handler.js ***!
  \******************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./utils/logger */'./src/utils/logger.js'); var n = r(/*! ./errors */'./src/errors.js'); var a = r(/*! ./events */'./src/events.js'); var o = { hlsEventGeneric: !0, hlsHandlerDestroying: !0, hlsHandlerDestroyed: !0 }; var s = (function () { function e (e) { for (var t = [], r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; this.hls = e, this.onEvent = this.onEvent.bind(this), this.handledEvents = t, this.useGenericHandler = !0, this.registerListeners() } return e.prototype.destroy = function () { this.onHandlerDestroying(), this.unregisterListeners(), this.onHandlerDestroyed() }, e.prototype.onHandlerDestroying = function () {}, e.prototype.onHandlerDestroyed = function () {}, e.prototype.isEventHandler = function () { return typeof this.handledEvents === 'object' && this.handledEvents.length && typeof this.onEvent === 'function' }, e.prototype.registerListeners = function () { this.isEventHandler() && this.handledEvents.forEach(function (e) { if (o[e]) throw new Error('Forbidden event-name: ' + e); this.hls.on(e, this.onEvent) }, this) }, e.prototype.unregisterListeners = function () { this.isEventHandler() && this.handledEvents.forEach(function (e) { this.hls.off(e, this.onEvent) }, this) }, e.prototype.onEvent = function (e, t) { this.onEventGeneric(e, t) }, e.prototype.onEventGeneric = function (e, t) { var r = function (e, t) { var r = 'on' + e.replace('hls', ''); if (typeof this[r] !== 'function') throw new Error('Event ' + e + ' has no generic handler in this ' + this.constructor.name + ' class (tried ' + r + ')'); return this[r].bind(this, t) }; try { r.call(this, e, t).call() } catch (o) { i.logger.error('An internal error happened while handling event ' + e + '. Error message: "' + o.message + '". Here is a stacktrace:', o), this.hls.trigger(a.default.ERROR, { type: n.ErrorTypes.OTHER_ERROR, details: n.ErrorDetails.INTERNAL_EXCEPTION, fatal: !1, event: e, err: o }) } }, e }()); t.default = s },
        './src/events.js':
        /*! ***********************!*\
  !*** ./src/events.js ***!
  \***********************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = { MEDIA_ATTACHING: 'hlsMediaAttaching', MEDIA_ATTACHED: 'hlsMediaAttached', MEDIA_DETACHING: 'hlsMediaDetaching', MEDIA_DETACHED: 'hlsMediaDetached', BUFFER_RESET: 'hlsBufferReset', BUFFER_CODECS: 'hlsBufferCodecs', BUFFER_CREATED: 'hlsBufferCreated', BUFFER_APPENDING: 'hlsBufferAppending', BUFFER_APPENDED: 'hlsBufferAppended', BUFFER_EOS: 'hlsBufferEos', BUFFER_FLUSHING: 'hlsBufferFlushing', BUFFER_FLUSHED: 'hlsBufferFlushed', MANIFEST_LOADING: 'hlsManifestLoading', MANIFEST_LOADED: 'hlsManifestLoaded', MANIFEST_PARSED: 'hlsManifestParsed', LEVEL_SWITCHING: 'hlsLevelSwitching', LEVEL_SWITCHED: 'hlsLevelSwitched', LEVEL_LOADING: 'hlsLevelLoading', LEVEL_LOADED: 'hlsLevelLoaded', LEVEL_UPDATED: 'hlsLevelUpdated', LEVEL_PTS_UPDATED: 'hlsLevelPtsUpdated', AUDIO_TRACKS_UPDATED: 'hlsAudioTracksUpdated', AUDIO_TRACK_SWITCHING: 'hlsAudioTrackSwitching', AUDIO_TRACK_SWITCHED: 'hlsAudioTrackSwitched', AUDIO_TRACK_LOADING: 'hlsAudioTrackLoading', AUDIO_TRACK_LOADED: 'hlsAudioTrackLoaded', SUBTITLE_TRACKS_UPDATED: 'hlsSubtitleTracksUpdated', SUBTITLE_TRACK_SWITCH: 'hlsSubtitleTrackSwitch', SUBTITLE_TRACK_LOADING: 'hlsSubtitleTrackLoading', SUBTITLE_TRACK_LOADED: 'hlsSubtitleTrackLoaded', SUBTITLE_FRAG_PROCESSED: 'hlsSubtitleFragProcessed', INIT_PTS_FOUND: 'hlsInitPtsFound', FRAG_LOADING: 'hlsFragLoading', FRAG_LOAD_PROGRESS: 'hlsFragLoadProgress', FRAG_LOAD_EMERGENCY_ABORTED: 'hlsFragLoadEmergencyAborted', FRAG_LOADED: 'hlsFragLoaded', FRAG_DECRYPTED: 'hlsFragDecrypted', FRAG_PARSING_INIT_SEGMENT: 'hlsFragParsingInitSegment', FRAG_PARSING_USERDATA: 'hlsFragParsingUserdata', FRAG_PARSING_METADATA: 'hlsFragParsingMetadata', FRAG_PARSING_DATA: 'hlsFragParsingData', FRAG_PARSED: 'hlsFragParsed', FRAG_BUFFERED: 'hlsFragBuffered', FRAG_CHANGED: 'hlsFragChanged', FPS_DROP: 'hlsFpsDrop', FPS_DROP_LEVEL_CAPPING: 'hlsFpsDropLevelCapping', ERROR: 'hlsError', DESTROYING: 'hlsDestroying', KEY_LOADING: 'hlsKeyLoading', KEY_LOADED: 'hlsKeyLoaded', STREAM_STATE_TRANSITION: 'hlsStreamStateTransition' }; t.default = i },
        './src/hls.js':
        /*! ********************!*\
  !*** ./src/hls.js ***!
  \********************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! url-toolkit */'./node_modules/url-toolkit/src/url-toolkit.js'); var a = r(/*! ./errors */'./src/errors.js'); var o = r(/*! ./loader/playlist-loader */'./src/loader/playlist-loader.js'); var s = r(/*! ./loader/fragment-loader */'./src/loader/fragment-loader.js'); var l = r(/*! ./loader/key-loader */'./src/loader/key-loader.js'); var u = r(/*! ./controller/fragment-tracker */'./src/controller/fragment-tracker.js'); var c = r(/*! ./controller/stream-controller */'./src/controller/stream-controller.js'); var d = r(/*! ./controller/level-controller */'./src/controller/level-controller.js'); var f = r(/*! ./controller/id3-track-controller */'./src/controller/id3-track-controller.js'); var h = r(/*! ./is-supported */'./src/is-supported.js'); var p = r(/*! ./utils/logger */'./src/utils/logger.js'); var g = r(/*! ./config */'./src/config.js'); var v = r(/*! ./events */'./src/events.js'); var y = r(/*! ./observer */'./src/observer.js'); var m = (function (e) { function t (r) { void 0 === r && (r = {}); var i = e.call(this) || this; var n = t.DefaultConfig; if ((r.liveSyncDurationCount || r.liveMaxLatencyDurationCount) && (r.liveSyncDuration || r.liveMaxLatencyDuration)) throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration"); for (var a in n)a in r || (r[a] = n[a]); if (void 0 !== r.liveMaxLatencyDurationCount && r.liveMaxLatencyDurationCount <= r.liveSyncDurationCount) throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"'); if (void 0 !== r.liveMaxLatencyDuration && (r.liveMaxLatencyDuration <= r.liveSyncDuration || void 0 === r.liveSyncDuration)) throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"'); p.enableLogs(r.debug), i.config = r, i._autoLevelCapping = -1; var h = i.abrController = new r.abrController(i); var g = new r.bufferController(i); var v = new r.capLevelController(i); var y = new r.fpsController(i); var m = new o.default(i); var b = new s.default(i); var E = new l.default(i); var _ = new f.default(i); var S = i.levelController = new d.default(i); var T = new u.FragmentTracker(i); var w = i.streamController = new c.default(i, T); var A = [S, w]; var L = r.audioStreamController; L && A.push(new L(i, T)), i.networkControllers = A; var R = [m, b, E, h, g, v, y, _, T]; if (L = r.audioTrackController, L) { var k = new L(i); i.audioTrackController = k, R.push(k) } if (L = r.subtitleTrackController, L) { var D = new L(i); i.subtitleTrackController = D, A.push(D) } if (L = r.emeController, L) { var O = new L(i); i.emeController = O, R.push(O) } return L = r.subtitleStreamController, L && A.push(new L(i, T)), L = r.timelineController, L && R.push(new L(i)), i.coreComponents = R, i } return i(t, e), Object.defineProperty(t, 'version', { get: function () { return '0.12.4' }, enumerable: !0, configurable: !0 }), t.isSupported = function () { return h.isSupported() }, Object.defineProperty(t, 'Events', { get: function () { return v.default }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, 'ErrorTypes', { get: function () { return a.ErrorTypes }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, 'ErrorDetails', { get: function () { return a.ErrorDetails }, enumerable: !0, configurable: !0 }), Object.defineProperty(t, 'DefaultConfig', { get: function () { return t.defaultConfig ? t.defaultConfig : g.hlsDefaultConfig }, set: function (e) { t.defaultConfig = e }, enumerable: !0, configurable: !0 }), t.prototype.destroy = function () { p.logger.log('destroy'), this.trigger(v.default.DESTROYING), this.detachMedia(), this.coreComponents.concat(this.networkControllers).forEach(function (e) { e.destroy() }), this.url = null, this.removeAllListeners(), this._autoLevelCapping = -1 }, t.prototype.attachMedia = function (e) { p.logger.log('attachMedia'), this.media = e, this.trigger(v.default.MEDIA_ATTACHING, { media: e }) }, t.prototype.detachMedia = function () { p.logger.log('detachMedia'), this.trigger(v.default.MEDIA_DETACHING), this.media = null }, t.prototype.loadSource = function (e) { e = n.buildAbsoluteURL(window.location.href, e, { alwaysNormalize: !0 }), p.logger.log('loadSource:' + e), this.url = e, this.trigger(v.default.MANIFEST_LOADING, { url: e }) }, t.prototype.startLoad = function (e) { void 0 === e && (e = -1), p.logger.log('startLoad(' + e + ')'), this.networkControllers.forEach(function (t) { t.startLoad(e) }) }, t.prototype.stopLoad = function () { p.logger.log('stopLoad'), this.networkControllers.forEach(function (e) { e.stopLoad() }) }, t.prototype.swapAudioCodec = function () { p.logger.log('swapAudioCodec'), this.streamController.swapAudioCodec() }, t.prototype.recoverMediaError = function () { p.logger.log('recoverMediaError'); var e = this.media; this.detachMedia(), this.attachMedia(e) }, Object.defineProperty(t.prototype, 'levels', { get: function () { return this.levelController.levels }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'currentLevel', { get: function () { return this.streamController.currentLevel }, set: function (e) { p.logger.log('set currentLevel:' + e), this.loadLevel = e, this.streamController.immediateLevelSwitch() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'nextLevel', { get: function () { return this.streamController.nextLevel }, set: function (e) { p.logger.log('set nextLevel:' + e), this.levelController.manualLevel = e, this.streamController.nextLevelSwitch() }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'loadLevel', { get: function () { return this.levelController.level }, set: function (e) { p.logger.log('set loadLevel:' + e), this.levelController.manualLevel = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'nextLoadLevel', { get: function () { return this.levelController.nextLoadLevel }, set: function (e) { this.levelController.nextLoadLevel = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'firstLevel', { get: function () { return Math.max(this.levelController.firstLevel, this.minAutoLevel) }, set: function (e) { p.logger.log('set firstLevel:' + e), this.levelController.firstLevel = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'startLevel', { get: function () { return this.levelController.startLevel }, set: function (e) { p.logger.log('set startLevel:' + e); var t = this; e !== -1 && (e = Math.max(e, t.minAutoLevel)), t.levelController.startLevel = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'autoLevelCapping', { get: function () { return this._autoLevelCapping }, set: function (e) { p.logger.log('set autoLevelCapping:' + e), this._autoLevelCapping = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'autoLevelEnabled', { get: function () { return this.levelController.manualLevel === -1 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'manualLevel', { get: function () { return this.levelController.manualLevel }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'minAutoLevel', { get: function () { for (var e = this, t = e.levels, r = e.config.minAutoBitrate, i = t ? t.length : 0, n = 0; n < i; n++) { var a = t[n].realBitrate ? Math.max(t[n].realBitrate, t[n].bitrate) : t[n].bitrate; if (a > r) return n } return 0 }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'maxAutoLevel', { get: function () { var e; var t = this; var r = t.levels; var i = t.autoLevelCapping; return e = i === -1 && r && r.length ? r.length - 1 : i, e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'nextAutoLevel', { get: function () { var e = this; return Math.min(Math.max(e.abrController.nextAutoLevel, e.minAutoLevel), e.maxAutoLevel) }, set: function (e) { var t = this; t.abrController.nextAutoLevel = Math.max(t.minAutoLevel, e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'audioTracks', { get: function () { var e = this.audioTrackController; return e ? e.audioTracks : [] }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'audioTrack', { get: function () { var e = this.audioTrackController; return e ? e.audioTrack : -1 }, set: function (e) { var t = this.audioTrackController; t && (t.audioTrack = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'liveSyncPosition', { get: function () { return this.streamController.liveSyncPosition }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'subtitleTracks', { get: function () { var e = this.subtitleTrackController; return e ? e.subtitleTracks : [] }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'subtitleTrack', { get: function () { var e = this.subtitleTrackController; return e ? e.subtitleTrack : -1 }, set: function (e) { var t = this.subtitleTrackController; t && (t.subtitleTrack = e) }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'subtitleDisplay', { get: function () { var e = this.subtitleTrackController; return !!e && e.subtitleDisplay }, set: function (e) { var t = this.subtitleTrackController; t && (t.subtitleDisplay = e) }, enumerable: !0, configurable: !0 }), t }(y.Observer)); t.default = m },
        './src/is-supported.js':
        /*! *****************************!*\
  !*** ./src/is-supported.js ***!
  \*****************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./utils/mediasource-helper */'./src/utils/mediasource-helper.js'); function n () { var e = i.getMediaSource(); var t = window.SourceBuffer || window.WebKitSourceBuffer; var r = e && typeof e.isTypeSupported === 'function' && e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'); var n = !t || t.prototype && typeof t.prototype.appendBuffer === 'function' && typeof t.prototype.remove === 'function'; return !!r && !!n }t.isSupported = n },
        './src/loader/fragment-loader.js':
        /*! ***************************************!*\
  !*** ./src/loader/fragment-loader.js ***!
  \***************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = r(/*! ../errors */'./src/errors.js'); var s = r(/*! ../utils/logger */'./src/utils/logger.js'); var l = (function (t) { function r (e) { var r = t.call(this, e, n.default.FRAG_LOADING) || this; return r.loaders = {}, r } return i(r, t), r.prototype.destroy = function () { var e = this.loaders; for (var r in e) { var i = e[r]; i && i.destroy() } this.loaders = {}, t.prototype.destroy.call(this) }, r.prototype.onFragLoading = function (t) { var r = t.frag; var i = r.type; var n = this.loaders; var a = this.hls.config; var o = a.fLoader; var l = a.loader; r.loaded = 0; var u; var c; var d; var f = n[i]; f && (s.logger.warn('abort previous fragment loader for type: ' + i), f.abort()), f = n[i] = r.loader = a.fLoader ? new o(a) : new l(a), u = { url: r.url, frag: r, responseType: 'arraybuffer', progressData: !1 }; var h = r.byteRangeStartOffset; var p = r.byteRangeEndOffset; e.isFinite(h) && e.isFinite(p) && (u.rangeStart = h, u.rangeEnd = p), c = { timeout: a.fragLoadingTimeOut, maxRetry: 0, retryDelay: 0, maxRetryDelay: a.fragLoadingMaxRetryTimeout }, d = { onSuccess: this.loadsuccess.bind(this), onError: this.loaderror.bind(this), onTimeout: this.loadtimeout.bind(this), onProgress: this.loadprogress.bind(this) }, f.load(u, c, d) }, r.prototype.loadsuccess = function (e, t, r, i) { void 0 === i && (i = null); var a = e.data; var o = r.frag; o.loader = void 0, this.loaders[o.type] = void 0, this.hls.trigger(n.default.FRAG_LOADED, { payload: a, frag: o, stats: t, networkDetails: i }) }, r.prototype.loaderror = function (e, t, r) { void 0 === r && (r = null); var i = t.frag; var a = i.loader; a && a.abort(), this.loaders[i.type] = void 0, this.hls.trigger(n.default.ERROR, { type: o.ErrorTypes.NETWORK_ERROR, details: o.ErrorDetails.FRAG_LOAD_ERROR, fatal: !1, frag: t.frag, response: e, networkDetails: r }) }, r.prototype.loadtimeout = function (e, t, r) { void 0 === r && (r = null); var i = t.frag; var a = i.loader; a && a.abort(), this.loaders[i.type] = void 0, this.hls.trigger(n.default.ERROR, { type: o.ErrorTypes.NETWORK_ERROR, details: o.ErrorDetails.FRAG_LOAD_TIMEOUT, fatal: !1, frag: t.frag, networkDetails: r }) }, r.prototype.loadprogress = function (e, t, r, i) { void 0 === i && (i = null); var a = t.frag; a.loaded = e.loaded, this.hls.trigger(n.default.FRAG_LOAD_PROGRESS, { frag: a, stats: e, networkDetails: i }) }, r }(a.default)); t.default = l }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/loader/fragment.js':
        /*! ********************************!*\
  !*** ./src/loader/fragment.js ***!
  \********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! url-toolkit */'./node_modules/url-toolkit/src/url-toolkit.js'); var n = r(/*! ./level-key */'./src/loader/level-key.js'); var a = (function () { function t () { var e; this._url = null, this._byteRange = null, this._decryptdata = null, this.tagList = [], this.programDateTime = null, this.rawProgramDateTime = null, this._elementaryStreams = (e = {}, e[t.ElementaryStreamTypes.AUDIO] = !1, e[t.ElementaryStreamTypes.VIDEO] = !1, e) } return Object.defineProperty(t, 'ElementaryStreamTypes', { get: function () { return { AUDIO: 'audio', VIDEO: 'video' } }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'url', { get: function () { return !this._url && this.relurl && (this._url = i.buildAbsoluteURL(this.baseurl, this.relurl, { alwaysNormalize: !0 })), this._url }, set: function (e) { this._url = e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'byteRange', { get: function () { if (!this._byteRange && !this.rawByteRange) return []; if (this._byteRange) return this._byteRange; var e = []; if (this.rawByteRange) { var t = this.rawByteRange.split('@', 2); if (t.length === 1) { var r = this.lastByteRangeEndOffset; e[0] = r || 0 } else e[0] = parseInt(t[1]); e[1] = parseInt(t[0]) + e[0], this._byteRange = e } return e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'byteRangeStartOffset', { get: function () { return this.byteRange[0] }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'byteRangeEndOffset', { get: function () { return this.byteRange[1] }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'decryptdata', { get: function () { return this._decryptdata || (this._decryptdata = this.fragmentDecryptdataFromLevelkey(this.levelkey, this.sn)), this._decryptdata }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'endProgramDateTime', { get: function () { if (!e.isFinite(this.programDateTime)) return null; var t = e.isFinite(this.duration) ? this.duration : 0; return this.programDateTime + 1e3 * t }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, 'encrypted', { get: function () { return !(!this.decryptdata || this.decryptdata.uri === null || this.decryptdata.key !== null) }, enumerable: !0, configurable: !0 }), t.prototype.addElementaryStream = function (e) { this._elementaryStreams[e] = !0 }, t.prototype.hasElementaryStream = function (e) { return !0 === this._elementaryStreams[e] }, t.prototype.createInitializationVector = function (e) { for (var t = new Uint8Array(16), r = 12; r < 16; r++)t[r] = e >> 8 * (15 - r) & 255; return t }, t.prototype.fragmentDecryptdataFromLevelkey = function (e, t) { var r = e; return e && e.method && e.uri && !e.iv && (r = new n.default(), r.method = e.method, r.baseuri = e.baseuri, r.reluri = e.reluri, r.iv = this.createInitializationVector(t)), r }, t }()); t.default = a }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/loader/key-loader.js':
        /*! **********************************!*\
  !*** ./src/loader/key-loader.js ***!
  \**********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = r(/*! ../errors */'./src/errors.js'); var s = r(/*! ../utils/logger */'./src/utils/logger.js'); var l = (function (e) { function t (t) { var r = e.call(this, t, n.default.KEY_LOADING) || this; return r.loaders = {}, r.decryptkey = null, r.decrypturl = null, r } return i(t, e), t.prototype.destroy = function () { for (var e in this.loaders) { var t = this.loaders[e]; t && t.destroy() } this.loaders = {}, a.default.prototype.destroy.call(this) }, t.prototype.onKeyLoading = function (e) { var t = e.frag; var r = t.type; var i = this.loaders[r]; var a = t.decryptdata; var o = a.uri; if (o !== this.decrypturl || this.decryptkey === null) { var l = this.hls.config; i && (s.logger.warn('abort previous key loader for type:' + r), i.abort()), t.loader = this.loaders[r] = new l.loader(l), this.decrypturl = o, this.decryptkey = null; var u = void 0; var c = void 0; var d = void 0; u = { url: o, frag: t, responseType: 'arraybuffer' }, c = { timeout: l.fragLoadingTimeOut, maxRetry: 0, retryDelay: l.fragLoadingRetryDelay, maxRetryDelay: l.fragLoadingMaxRetryTimeout }, d = { onSuccess: this.loadsuccess.bind(this), onError: this.loaderror.bind(this), onTimeout: this.loadtimeout.bind(this) }, t.loader.load(u, c, d) } else this.decryptkey && (a.key = this.decryptkey, this.hls.trigger(n.default.KEY_LOADED, { frag: t })) }, t.prototype.loadsuccess = function (e, t, r) { var i = r.frag; this.decryptkey = i.decryptdata.key = new Uint8Array(e.data), i.loader = void 0, this.loaders[i.type] = void 0, this.hls.trigger(n.default.KEY_LOADED, { frag: i }) }, t.prototype.loaderror = function (e, t) { var r = t.frag; var i = r.loader; i && i.abort(), this.loaders[t.type] = void 0, this.hls.trigger(n.default.ERROR, { type: o.ErrorTypes.NETWORK_ERROR, details: o.ErrorDetails.KEY_LOAD_ERROR, fatal: !1, frag: r, response: e }) }, t.prototype.loadtimeout = function (e, t) { var r = t.frag; var i = r.loader; i && i.abort(), this.loaders[t.type] = void 0, this.hls.trigger(n.default.ERROR, { type: o.ErrorTypes.NETWORK_ERROR, details: o.ErrorDetails.KEY_LOAD_TIMEOUT, fatal: !1, frag: r }) }, t }(a.default)); t.default = l },
        './src/loader/level-key.js':
        /*! *********************************!*\
  !*** ./src/loader/level-key.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! url-toolkit */'./node_modules/url-toolkit/src/url-toolkit.js'); var n = (function () { function e () { this.method = null, this.key = null, this.iv = null, this._uri = null } return Object.defineProperty(e.prototype, 'uri', { get: function () { return !this._uri && this.reluri && (this._uri = i.buildAbsoluteURL(this.baseuri, this.reluri, { alwaysNormalize: !0 })), this._uri }, enumerable: !0, configurable: !0 }), e }()); t.default = n },
        './src/loader/level.js':
        /*! *****************************!*\
  !*** ./src/loader/level.js ***!
  \*****************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var r = (function () { function t (e) { this.endCC = 0, this.endSN = 0, this.fragments = [], this.initSegment = null, this.live = !0, this.needSidxRanges = !1, this.startCC = 0, this.startSN = 0, this.startTimeOffset = null, this.targetduration = 0, this.totalduration = 0, this.type = null, this.url = e, this.version = null } return Object.defineProperty(t.prototype, 'hasProgramDateTime', { get: function () { return !(!this.fragments[0] || !e.isFinite(this.fragments[0].programDateTime)) }, enumerable: !0, configurable: !0 }), t }()); t.default = r }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/loader/m3u8-parser.js':
        /*! ***********************************!*\
  !*** ./src/loader/m3u8-parser.js ***!
  \***********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! url-toolkit */'./node_modules/url-toolkit/src/url-toolkit.js'); var n = r(/*! ./fragment */'./src/loader/fragment.js'); var a = r(/*! ./level */'./src/loader/level.js'); var o = r(/*! ./level-key */'./src/loader/level-key.js'); var s = r(/*! ../utils/attr-list */'./src/utils/attr-list.js'); var l = r(/*! ../utils/logger */'./src/utils/logger.js'); var u = r(/*! ../utils/codecs */'./src/utils/codecs.js'); var c = /#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g; var d = /#EXT-X-MEDIA:(.*)/g; var f = new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source, /|(?!#)([\S+ ?]+)/.source, /|#EXT-X-BYTERANGE:*(.+)/.source, /|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source, /|#.*/.source].join(''), 'g'); var h = /(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/; var p = /\.(mp4|m4s|m4v|m4a)$/i; var g = (function () { function t () {} return t.findGroup = function (e, t) { if (!e) return null; for (var r = null, i = 0; i < e.length; i++) { var n = e[i]; n.id === t && (r = n) } return r }, t.convertAVC1ToAVCOTI = function (e) { var t; var r = e.split('.'); return r.length > 2 ? (t = r.shift() + '.', t += parseInt(r.shift()).toString(16), t += ('000' + parseInt(r.shift()).toString(16)).substr(-4)) : t = e, t }, t.resolve = function (e, t) { return i.buildAbsoluteURL(t, e, { alwaysNormalize: !0 }) }, t.parseMasterPlaylist = function (e, r) { var i; var n = []; function a (e, t) { ['video', 'audio'].forEach(function (r) { var i = e.filter(function (e) { return u.isCodecType(e, r) }); if (i.length) { var n = i.filter(function (e) { return e.lastIndexOf('avc1', 0) === 0 || e.lastIndexOf('mp4a', 0) === 0 }); t[r + 'Codec'] = n.length > 0 ? n[0] : i[0], e = e.filter(function (e) { return i.indexOf(e) === -1 }) } }), t.unknownCodecs = e }c.lastIndex = 0; while ((i = c.exec(e)) != null) { var o = {}; var l = o.attrs = new s.default(i[1]); o.url = t.resolve(i[2], r); var d = l.decimalResolution('RESOLUTION'); d && (o.width = d.width, o.height = d.height), o.bitrate = l.decimalInteger('AVERAGE-BANDWIDTH') || l.decimalInteger('BANDWIDTH'), o.name = l.NAME, a([].concat((l.CODECS || '').split(/[ ,]+/)), o), o.videoCodec && o.videoCodec.indexOf('avc1') !== -1 && (o.videoCodec = t.convertAVC1ToAVCOTI(o.videoCodec)), n.push(o) } return n }, t.parseMasterPlaylistMedia = function (e, r, i, n) { var a; void 0 === n && (n = []); var o = []; var l = 0; d.lastIndex = 0; while ((a = d.exec(e)) !== null) { var u = {}; var c = new s.default(a[1]); if (c.TYPE === i) { if (u.groupId = c['GROUP-ID'], u.name = c.NAME, u.type = i, u.default = c.DEFAULT === 'YES', u.autoselect = c.AUTOSELECT === 'YES', u.forced = c.FORCED === 'YES', c.URI && (u.url = t.resolve(c.URI, r)), u.lang = c.LANGUAGE, u.name || (u.name = u.lang), n.length) { var f = t.findGroup(n, u.groupId); u.audioCodec = f ? f.codec : n[0].codec }u.id = l++, o.push(u) } } return o }, t.parseLevelPlaylist = function (t, r, i, u, c) { var d; var g; var m = 0; var b = 0; var E = new a.default(r); var _ = new o.default(); var S = 0; var T = null; var w = new n.default(); var A = null; f.lastIndex = 0; while ((d = f.exec(t)) !== null) { var L = d[1]; if (L) { w.duration = parseFloat(L); var R = (' ' + d[2]).slice(1); w.title = R || null, w.tagList.push(R ? ['INF', L, R] : ['INF', L]) } else if (d[3]) { if (e.isFinite(w.duration)) { var k = m++; w.type = u, w.start = b, w.levelkey = _, w.sn = k, w.level = i, w.cc = S, w.urlId = c, w.baseurl = r, w.relurl = (' ' + d[3]).slice(1), y(w, T), E.fragments.push(w), T = w, b += w.duration, w = new n.default() } } else if (d[4]) { if (w.rawByteRange = (' ' + d[4]).slice(1), T) { var D = T.byteRangeEndOffset; D && (w.lastByteRangeEndOffset = D) } } else if (d[5])w.rawProgramDateTime = (' ' + d[5]).slice(1), w.tagList.push(['PROGRAM-DATE-TIME', w.rawProgramDateTime]), A === null && (A = E.fragments.length); else { for (d = d[0].match(h), g = 1; g < d.length; g++) if (void 0 !== d[g]) break; var O = (' ' + d[g + 1]).slice(1); var P = (' ' + d[g + 2]).slice(1); switch (d[g]) { case '#':w.tagList.push(P ? [O, P] : [O]); break; case 'PLAYLIST-TYPE':E.type = O.toUpperCase(); break; case 'MEDIA-SEQUENCE':m = E.startSN = parseInt(O); break; case 'TARGETDURATION':E.targetduration = parseFloat(O); break; case 'VERSION':E.version = parseInt(O); break; case 'EXTM3U':break; case 'ENDLIST':E.live = !1; break; case 'DIS':S++, w.tagList.push(['DIS']); break; case 'DISCONTINUITY-SEQ':S = parseInt(O); break; case 'KEY':var I = O; var x = new s.default(I); var C = x.enumeratedString('METHOD'); var F = x.URI; var M = x.hexadecimalInteger('IV'); C && (_ = new o.default(), F && ['AES-128', 'SAMPLE-AES', 'SAMPLE-AES-CENC'].indexOf(C) >= 0 && (_.method = C, _.baseuri = r, _.reluri = F, _.key = null, _.iv = M)); break; case 'START':var j = O; var N = new s.default(j); var B = N.decimalFloatingPoint('TIME-OFFSET'); e.isFinite(B) && (E.startTimeOffset = B); break; case 'MAP':var U = new s.default(O); w.relurl = U.URI, w.rawByteRange = U.BYTERANGE, w.baseurl = r, w.level = i, w.type = u, w.sn = 'initSegment', E.initSegment = w, w = new n.default(), w.rawProgramDateTime = E.initSegment.rawProgramDateTime; break; default:l.logger.warn('line parsed but not handled: ' + d); break } } } return w = T, w && !w.relurl && (E.fragments.pop(), b -= w.duration), E.totalduration = b, E.averagetargetduration = b / E.fragments.length, E.endSN = m - 1, E.startCC = E.fragments[0] ? E.fragments[0].cc : 0, E.endCC = S, !E.initSegment && E.fragments.length && E.fragments.every(function (e) { return p.test(e.relurl) }) && (l.logger.warn('MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX'), w = new n.default(), w.relurl = E.fragments[0].relurl, w.baseurl = r, w.level = i, w.type = u, w.sn = 'initSegment', E.initSegment = w, E.needSidxRanges = !0), A && v(E.fragments, A), E }, t }()); function v (e, t) { for (var r = e[t], i = t - 1; i >= 0; i--) { var n = e[i]; n.programDateTime = r.programDateTime - 1e3 * n.duration, r = n } } function y (t, r) { t.rawProgramDateTime ? t.programDateTime = Date.parse(t.rawProgramDateTime) : r && r.programDateTime && (t.programDateTime = r.endProgramDateTime), e.isFinite(t.programDateTime) || (t.programDateTime = null, t.rawProgramDateTime = null) }t.default = g }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/loader/playlist-loader.js':
        /*! ***************************************!*\
  !*** ./src/loader/playlist-loader.js ***!
  \***************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ../events */'./src/events.js'); var a = r(/*! ../event-handler */'./src/event-handler.js'); var o = r(/*! ../errors */'./src/errors.js'); var s = r(/*! ../utils/logger */'./src/utils/logger.js'); var l = r(/*! ../demux/mp4demuxer */'./src/demux/mp4demuxer.js'); var u = r(/*! ./m3u8-parser */'./src/loader/m3u8-parser.js'); var c = window.performance; var d = { MANIFEST: 'manifest', LEVEL: 'level', AUDIO_TRACK: 'audioTrack', SUBTITLE_TRACK: 'subtitleTrack' }; var f = { MAIN: 'main', AUDIO: 'audio', SUBTITLE: 'subtitle' }; var h = (function (t) { function r (e) { var r = t.call(this, e, n.default.MANIFEST_LOADING, n.default.LEVEL_LOADING, n.default.AUDIO_TRACK_LOADING, n.default.SUBTITLE_TRACK_LOADING) || this; return r.loaders = {}, r } return i(r, t), Object.defineProperty(r, 'ContextType', { get: function () { return d }, enumerable: !0, configurable: !0 }), Object.defineProperty(r, 'LevelType', { get: function () { return f }, enumerable: !0, configurable: !0 }), r.canHaveQualityLevels = function (e) { return e !== d.AUDIO_TRACK && e !== d.SUBTITLE_TRACK }, r.mapContextToLevelType = function (e) { var t = e.type; switch (t) { case d.AUDIO_TRACK:return f.AUDIO; case d.SUBTITLE_TRACK:return f.SUBTITLE; default:return f.MAIN } }, r.getResponseUrl = function (e, t) { var r = e.url; return void 0 !== r && r.indexOf('data:') !== 0 || (r = t.url), r }, r.prototype.createInternalLoader = function (e) { var t = this.hls.config; var r = t.pLoader; var i = t.loader; var n = r || i; var a = new n(t); return e.loader = a, this.loaders[e.type] = a, a }, r.prototype.getInternalLoader = function (e) { return this.loaders[e.type] }, r.prototype.resetInternalLoader = function (e) { this.loaders[e] && delete this.loaders[e] }, r.prototype.destroyInternalLoaders = function () { for (var e in this.loaders) { var t = this.loaders[e]; t && t.destroy(), this.resetInternalLoader(e) } }, r.prototype.destroy = function () { this.destroyInternalLoaders(), t.prototype.destroy.call(this) }, r.prototype.onManifestLoading = function (e) { this.load(e.url, { type: d.MANIFEST, level: 0, id: null }) }, r.prototype.onLevelLoading = function (e) { this.load(e.url, { type: d.LEVEL, level: e.level, id: e.id }) }, r.prototype.onAudioTrackLoading = function (e) { this.load(e.url, { type: d.AUDIO_TRACK, level: null, id: e.id }) }, r.prototype.onSubtitleTrackLoading = function (e) { this.load(e.url, { type: d.SUBTITLE_TRACK, level: null, id: e.id }) }, r.prototype.load = function (e, t) { var r = this.hls.config; s.logger.debug('Loading playlist of type ' + t.type + ', level: ' + t.level + ', id: ' + t.id); var i; var n; var a; var o; var l = this.getInternalLoader(t); if (l) { var u = l.context; if (u && u.url === e) return s.logger.trace('playlist request ongoing'), !1; s.logger.warn('aborting previous loader for type: ' + t.type), l.abort() } switch (t.type) { case d.MANIFEST:i = r.manifestLoadingMaxRetry, n = r.manifestLoadingTimeOut, a = r.manifestLoadingRetryDelay, o = r.manifestLoadingMaxRetryTimeout; break; case d.LEVEL:i = 0, n = r.levelLoadingTimeOut; break; default:i = r.levelLoadingMaxRetry, n = r.levelLoadingTimeOut, a = r.levelLoadingRetryDelay, o = r.levelLoadingMaxRetryTimeout; break }l = this.createInternalLoader(t), t.url = e, t.responseType = t.responseType || ''; var c = { timeout: n, maxRetry: i, retryDelay: a, maxRetryDelay: o }; var f = { onSuccess: this.loadsuccess.bind(this), onError: this.loaderror.bind(this), onTimeout: this.loadtimeout.bind(this) }; return s.logger.debug('Calling internal loader delegate for URL: ' + e), l.load(t, c, f), !0 }, r.prototype.loadsuccess = function (e, t, r, i) { if (void 0 === i && (i = null), r.isSidxRequest) return this._handleSidxRequest(e, r), void this._handlePlaylistLoaded(e, t, r, i); this.resetInternalLoader(r.type); var n = e.data; t.tload = c.now(), n.indexOf('#EXTM3U') === 0 ? n.indexOf('#EXTINF:') > 0 || n.indexOf('#EXT-X-TARGETDURATION:') > 0 ? this._handleTrackOrLevelPlaylist(e, t, r, i) : this._handleMasterPlaylist(e, t, r, i) : this._handleManifestParsingError(e, r, 'no EXTM3U delimiter', i) }, r.prototype.loaderror = function (e, t, r) { void 0 === r && (r = null), this._handleNetworkError(t, r, !1, e) }, r.prototype.loadtimeout = function (e, t, r) { void 0 === r && (r = null), this._handleNetworkError(t, r, !0) }, r.prototype._handleMasterPlaylist = function (e, t, i, a) { var o = this.hls; var l = e.data; var c = r.getResponseUrl(e, i); var d = u.default.parseMasterPlaylist(l, c); if (d.length) { var f = d.map(function (e) { return { id: e.attrs.AUDIO, codec: e.audioCodec } }); var h = u.default.parseMasterPlaylistMedia(l, c, 'AUDIO', f); var p = u.default.parseMasterPlaylistMedia(l, c, 'SUBTITLES'); if (h.length) { var g = !1; h.forEach(function (e) { e.url || (g = !0) }), !1 === g && d[0].audioCodec && !d[0].attrs.AUDIO && (s.logger.log('audio codec signaled in quality level, but no embedded audio track signaled, create one'), h.unshift({ type: 'main', name: 'main' })) }o.trigger(n.default.MANIFEST_LOADED, { levels: d, audioTracks: h, subtitles: p, url: c, stats: t, networkDetails: a }) } else this._handleManifestParsingError(e, i, 'no level found in manifest', a) }, r.prototype._handleTrackOrLevelPlaylist = function (t, i, a, o) { var s = this.hls; var l = a.id; var f = a.level; var h = a.type; var p = r.getResponseUrl(t, a); var g = e.isFinite(l) ? l : 0; var v = e.isFinite(f) ? f : g; var y = r.mapContextToLevelType(a); var m = u.default.parseLevelPlaylist(t.data, p, v, y, g); if (m.tload = i.tload, h === d.MANIFEST) { var b = { url: p, details: m }; s.trigger(n.default.MANIFEST_LOADED, { levels: [b], audioTracks: [], url: p, stats: i, networkDetails: o }) } if (i.tparsed = c.now(), m.needSidxRanges) { var E = m.initSegment.url; this.load(E, { isSidxRequest: !0, type: h, level: f, levelDetails: m, id: l, rangeStart: 0, rangeEnd: 2048, responseType: 'arraybuffer' }) } else a.levelDetails = m, this._handlePlaylistLoaded(t, i, a, o) }, r.prototype._handleSidxRequest = function (e, t) { var r = l.default.parseSegmentIndex(new Uint8Array(e.data)); if (r) { var i = r.references; var n = t.levelDetails; i.forEach(function (e, t) { var r = e.info; var i = n.fragments[t]; i.byteRange.length === 0 && (i.rawByteRange = String(1 + r.end - r.start) + '@' + String(r.start)) }), n.initSegment.rawByteRange = String(r.moovEndOffset) + '@0' } }, r.prototype._handleManifestParsingError = function (e, t, r, i) { this.hls.trigger(n.default.ERROR, { type: o.ErrorTypes.NETWORK_ERROR, details: o.ErrorDetails.MANIFEST_PARSING_ERROR, fatal: !0, url: e.url, reason: r, networkDetails: i }) }, r.prototype._handleNetworkError = function (e, t, r, i) { var a, l; void 0 === r && (r = !1), void 0 === i && (i = null), s.logger.info('A network error occured while loading a ' + e.type + '-type playlist'); var u = this.getInternalLoader(e); switch (e.type) { case d.MANIFEST:a = r ? o.ErrorDetails.MANIFEST_LOAD_TIMEOUT : o.ErrorDetails.MANIFEST_LOAD_ERROR, l = !0; break; case d.LEVEL:a = r ? o.ErrorDetails.LEVEL_LOAD_TIMEOUT : o.ErrorDetails.LEVEL_LOAD_ERROR, l = !1; break; case d.AUDIO_TRACK:a = r ? o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT : o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR, l = !1; break; default:l = !1 }u && (u.abort(), this.resetInternalLoader(e.type)); var c = { type: o.ErrorTypes.NETWORK_ERROR, details: a, fatal: l, url: u.url, loader: u, context: e, networkDetails: t }; i && (c.response = i), this.hls.trigger(n.default.ERROR, c) }, r.prototype._handlePlaylistLoaded = function (e, t, i, a) { var o = i.type; var s = i.level; var l = i.id; var u = i.levelDetails; if (u.targetduration) { var c = r.canHaveQualityLevels(i.type); if (c) this.hls.trigger(n.default.LEVEL_LOADED, { details: u, level: s || 0, id: l || 0, stats: t, networkDetails: a }); else switch (o) { case d.AUDIO_TRACK:this.hls.trigger(n.default.AUDIO_TRACK_LOADED, { details: u, id: l, stats: t, networkDetails: a }); break; case d.SUBTITLE_TRACK:this.hls.trigger(n.default.SUBTITLE_TRACK_LOADED, { details: u, id: l, stats: t, networkDetails: a }); break } } else this._handleManifestParsingError(e, i, 'invalid target duration', a) }, r }(a.default)); t.default = h }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/observer.js':
        /*! *************************!*\
  !*** ./src/observer.js ***!
  \*************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! eventemitter3 */'./node_modules/eventemitter3/index.js'); var a = (function (e) { function t () { return e !== null && e.apply(this, arguments) || this } return i(t, e), t.prototype.trigger = function (e) { for (var t = [], r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; this.emit.apply(this, [e, e].concat(t)) }, t }(n.EventEmitter)); t.Observer = a },
        './src/polyfills/number.js':
        /*! *********************************!*\
  !*** ./src/polyfills/number.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../utils/get-self-scope */'./src/utils/get-self-scope.js'); var n = i.getSelfScope(); var a = n.Number; t.Number = a, a.isFinite = a.isFinite || function (e) { return typeof e === 'number' && isFinite(e) } },
        './src/remux/aac-helper.js':
        /*! *********************************!*\
  !*** ./src/remux/aac-helper.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = (function () { function e () {} return e.getSilentFrame = function (e, t) { switch (e) { case 'mp4a.40.2':if (t === 1) return new Uint8Array([0, 200, 0, 128, 35, 128]); if (t === 2) return new Uint8Array([33, 0, 73, 144, 2, 25, 0, 35, 128]); if (t === 3) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 142]); if (t === 4) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 128, 44, 128, 8, 2, 56]); if (t === 5) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 56]); if (t === 6) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 0, 178, 0, 32, 8, 224]); break; default:if (t === 1) return new Uint8Array([1, 64, 34, 128, 163, 78, 230, 128, 186, 8, 0, 0, 0, 28, 6, 241, 193, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]); if (t === 2) return new Uint8Array([1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]); if (t === 3) return new Uint8Array([1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]); break } return null }, e }()); t.default = i },
        './src/remux/mp4-generator.js':
        /*! ************************************!*\
  !*** ./src/remux/mp4-generator.js ***!
  \************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = Math.pow(2, 32) - 1; var n = (function () { function e () {} return e.init = function () { var t; for (t in e.types = { avc1: [], avcC: [], btrt: [], dinf: [], dref: [], esds: [], ftyp: [], hdlr: [], mdat: [], mdhd: [], mdia: [], mfhd: [], minf: [], moof: [], moov: [], mp4a: [], '.mp3': [], mvex: [], mvhd: [], pasp: [], sdtp: [], stbl: [], stco: [], stsc: [], stsd: [], stsz: [], stts: [], tfdt: [], tfhd: [], traf: [], trak: [], trun: [], trex: [], tkhd: [], vmhd: [], smhd: [] }, e.types)e.types.hasOwnProperty(t) && (e.types[t] = [t.charCodeAt(0), t.charCodeAt(1), t.charCodeAt(2), t.charCodeAt(3)]); var r = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]); var i = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]); e.HDLR_TYPES = { video: r, audio: i }; var n = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]); var a = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]); e.STTS = e.STSC = e.STCO = a, e.STSZ = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]), e.VMHD = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]), e.SMHD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), e.STSD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]); var o = new Uint8Array([105, 115, 111, 109]); var s = new Uint8Array([97, 118, 99, 49]); var l = new Uint8Array([0, 0, 0, 1]); e.FTYP = e.box(e.types.ftyp, o, l, o, s), e.DINF = e.box(e.types.dinf, e.box(e.types.dref, n)) }, e.box = function (e) { var t; var r = Array.prototype.slice.call(arguments, 1); var i = 8; var n = r.length; var a = n; while (n--)i += r[n].byteLength; for (t = new Uint8Array(i), t[0] = i >> 24 & 255, t[1] = i >> 16 & 255, t[2] = i >> 8 & 255, t[3] = 255 & i, t.set(e, 4), n = 0, i = 8; n < a; n++)t.set(r[n], i), i += r[n].byteLength; return t }, e.hdlr = function (t) { return e.box(e.types.hdlr, e.HDLR_TYPES[t]) }, e.mdat = function (t) { return e.box(e.types.mdat, t) }, e.mdhd = function (t, r) { r *= t; var n = Math.floor(r / (i + 1)); var a = Math.floor(r % (i + 1)); return e.box(e.types.mdhd, new Uint8Array([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3, t >> 24 & 255, t >> 16 & 255, t >> 8 & 255, 255 & t, n >> 24, n >> 16 & 255, n >> 8 & 255, 255 & n, a >> 24, a >> 16 & 255, a >> 8 & 255, 255 & a, 85, 196, 0, 0])) }, e.mdia = function (t) { return e.box(e.types.mdia, e.mdhd(t.timescale, t.duration), e.hdlr(t.type), e.minf(t)) }, e.mfhd = function (t) { return e.box(e.types.mfhd, new Uint8Array([0, 0, 0, 0, t >> 24, t >> 16 & 255, t >> 8 & 255, 255 & t])) }, e.minf = function (t) { return t.type === 'audio' ? e.box(e.types.minf, e.box(e.types.smhd, e.SMHD), e.DINF, e.stbl(t)) : e.box(e.types.minf, e.box(e.types.vmhd, e.VMHD), e.DINF, e.stbl(t)) }, e.moof = function (t, r, i) { return e.box(e.types.moof, e.mfhd(t), e.traf(i, r)) }, e.moov = function (t) { var r = t.length; var i = []; while (r--)i[r] = e.trak(t[r]); return e.box.apply(null, [e.types.moov, e.mvhd(t[0].timescale, t[0].duration)].concat(i).concat(e.mvex(t))) }, e.mvex = function (t) { var r = t.length; var i = []; while (r--)i[r] = e.trex(t[r]); return e.box.apply(null, [e.types.mvex].concat(i)) }, e.mvhd = function (t, r) { r *= t; var n = Math.floor(r / (i + 1)); var a = Math.floor(r % (i + 1)); var o = new Uint8Array([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3, t >> 24 & 255, t >> 16 & 255, t >> 8 & 255, 255 & t, n >> 24, n >> 16 & 255, n >> 8 & 255, 255 & n, a >> 24, a >> 16 & 255, a >> 8 & 255, 255 & a, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255]); return e.box(e.types.mvhd, o) }, e.sdtp = function (t) { var r; var i; var n = t.samples || []; var a = new Uint8Array(4 + n.length); for (i = 0; i < n.length; i++)r = n[i].flags, a[i + 4] = r.dependsOn << 4 | r.isDependedOn << 2 | r.hasRedundancy; return e.box(e.types.sdtp, a) }, e.stbl = function (t) { return e.box(e.types.stbl, e.stsd(t), e.box(e.types.stts, e.STTS), e.box(e.types.stsc, e.STSC), e.box(e.types.stsz, e.STSZ), e.box(e.types.stco, e.STCO)) }, e.avc1 = function (t) { var r; var i; var n; var a = []; var o = []; for (r = 0; r < t.sps.length; r++)i = t.sps[r], n = i.byteLength, a.push(n >>> 8 & 255), a.push(255 & n), a = a.concat(Array.prototype.slice.call(i)); for (r = 0; r < t.pps.length; r++)i = t.pps[r], n = i.byteLength, o.push(n >>> 8 & 255), o.push(255 & n), o = o.concat(Array.prototype.slice.call(i)); var s = e.box(e.types.avcC, new Uint8Array([1, a[3], a[4], a[5], 255, 224 | t.sps.length].concat(a).concat([t.pps.length]).concat(o))); var l = t.width; var u = t.height; var c = t.pixelRatio[0]; var d = t.pixelRatio[1]; return e.box(e.types.avc1, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, l >> 8 & 255, 255 & l, u >> 8 & 255, 255 & u, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 18, 100, 97, 105, 108, 121, 109, 111, 116, 105, 111, 110, 47, 104, 108, 115, 46, 106, 115, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 17, 17]), s, e.box(e.types.btrt, new Uint8Array([0, 28, 156, 128, 0, 45, 198, 192, 0, 45, 198, 192])), e.box(e.types.pasp, new Uint8Array([c >> 24, c >> 16 & 255, c >> 8 & 255, 255 & c, d >> 24, d >> 16 & 255, d >> 8 & 255, 255 & d]))) }, e.esds = function (e) { var t = e.config.length; return new Uint8Array([0, 0, 0, 0, 3, 23 + t, 0, 1, 0, 4, 15 + t, 64, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5].concat([t]).concat(e.config).concat([6, 1, 2])) }, e.mp4a = function (t) { var r = t.samplerate; return e.box(e.types.mp4a, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, t.channelCount, 0, 16, 0, 0, 0, 0, r >> 8 & 255, 255 & r, 0, 0]), e.box(e.types.esds, e.esds(t))) }, e.mp3 = function (t) { var r = t.samplerate; return e.box(e.types['.mp3'], new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, t.channelCount, 0, 16, 0, 0, 0, 0, r >> 8 & 255, 255 & r, 0, 0])) }, e.stsd = function (t) { return t.type === 'audio' ? t.isAAC || t.codec !== 'mp3' ? e.box(e.types.stsd, e.STSD, e.mp4a(t)) : e.box(e.types.stsd, e.STSD, e.mp3(t)) : e.box(e.types.stsd, e.STSD, e.avc1(t)) }, e.tkhd = function (t) { var r = t.id; var n = t.duration * t.timescale; var a = t.width; var o = t.height; var s = Math.floor(n / (i + 1)); var l = Math.floor(n % (i + 1)); return e.box(e.types.tkhd, new Uint8Array([1, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3, r >> 24 & 255, r >> 16 & 255, r >> 8 & 255, 255 & r, 0, 0, 0, 0, s >> 24, s >> 16 & 255, s >> 8 & 255, 255 & s, l >> 24, l >> 16 & 255, l >> 8 & 255, 255 & l, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, a >> 8 & 255, 255 & a, 0, 0, o >> 8 & 255, 255 & o, 0, 0])) }, e.traf = function (t, r) { var n = e.sdtp(t); var a = t.id; var o = Math.floor(r / (i + 1)); var s = Math.floor(r % (i + 1)); return e.box(e.types.traf, e.box(e.types.tfhd, new Uint8Array([0, 0, 0, 0, a >> 24, a >> 16 & 255, a >> 8 & 255, 255 & a])), e.box(e.types.tfdt, new Uint8Array([1, 0, 0, 0, o >> 24, o >> 16 & 255, o >> 8 & 255, 255 & o, s >> 24, s >> 16 & 255, s >> 8 & 255, 255 & s])), e.trun(t, n.length + 16 + 20 + 8 + 16 + 8 + 8), n) }, e.trak = function (t) { return t.duration = t.duration || 4294967295, e.box(e.types.trak, e.tkhd(t), e.mdia(t)) }, e.trex = function (t) { var r = t.id; return e.box(e.types.trex, new Uint8Array([0, 0, 0, 0, r >> 24, r >> 16 & 255, r >> 8 & 255, 255 & r, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1])) }, e.trun = function (t, r) { var i; var n; var a; var o; var s; var l; var u = t.samples || []; var c = u.length; var d = 12 + 16 * c; var f = new Uint8Array(d); for (r += 8 + d, f.set([0, 0, 15, 1, c >>> 24 & 255, c >>> 16 & 255, c >>> 8 & 255, 255 & c, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r], 0), i = 0; i < c; i++)n = u[i], a = n.duration, o = n.size, s = n.flags, l = n.cts, f.set([a >>> 24 & 255, a >>> 16 & 255, a >>> 8 & 255, 255 & a, o >>> 24 & 255, o >>> 16 & 255, o >>> 8 & 255, 255 & o, s.isLeading << 2 | s.dependsOn, s.isDependedOn << 6 | s.hasRedundancy << 4 | s.paddingValue << 1 | s.isNonSync, 61440 & s.degradPrio, 15 & s.degradPrio, l >>> 24 & 255, l >>> 16 & 255, l >>> 8 & 255, 255 & l], 12 + 16 * i); return e.box(e.types.trun, f) }, e.initSegment = function (t) { e.types || e.init(); var r; var i = e.moov(t); return r = new Uint8Array(e.FTYP.byteLength + i.byteLength), r.set(e.FTYP), r.set(i, e.FTYP.byteLength), r }, e }()); t.default = n },
        './src/remux/mp4-remuxer.js':
        /*! **********************************!*\
  !*** ./src/remux/mp4-remuxer.js ***!
  \**********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./aac-helper */'./src/remux/aac-helper.js'); var n = r(/*! ./mp4-generator */'./src/remux/mp4-generator.js'); var a = r(/*! ../events */'./src/events.js'); var o = r(/*! ../errors */'./src/errors.js'); var s = r(/*! ../utils/logger */'./src/utils/logger.js'); var l = 1e4; var u = (function () { function e (e, t, r, i) { this.observer = e, this.config = t, this.typeSupported = r; var n = navigator.userAgent; this.isSafari = i && i.indexOf('Apple') > -1 && n && !n.match('CriOS'), this.ISGenerated = !1 } return e.prototype.destroy = function () {}, e.prototype.resetTimeStamp = function (e) { this._initPTS = this._initDTS = e }, e.prototype.resetInitSegment = function () { this.ISGenerated = !1 }, e.prototype.remux = function (e, t, r, i, n, o, l) { if (this.ISGenerated || this.generateIS(e, t, n), this.ISGenerated) { var u = e.samples.length; var c = t.samples.length; var d = n; var f = n; if (u && c) { var h = (e.samples[0].pts - t.samples[0].pts) / t.inputTimeScale; d += Math.max(0, h), f += Math.max(0, -h) } if (u) { e.timescale || (s.logger.warn('regenerate InitSegment as audio detected'), this.generateIS(e, t, n)); var p = this.remuxAudio(e, d, o, l); if (c) { var g = void 0; p && (g = p.endPTS - p.startPTS), t.timescale || (s.logger.warn('regenerate InitSegment as video detected'), this.generateIS(e, t, n)), this.remuxVideo(t, f, o, g, l) } } else if (c) { var v = this.remuxVideo(t, f, o, 0, l); v && e.codec && this.remuxEmptyAudio(e, d, o, v) } }r.samples.length && this.remuxID3(r, n), i.samples.length && this.remuxText(i, n), this.observer.trigger(a.default.FRAG_PARSED) }, e.prototype.generateIS = function (e, t, r) { var i; var l; var u = this.observer; var c = e.samples; var d = t.samples; var f = this.typeSupported; var h = 'audio/mp4'; var p = {}; var g = { tracks: p }; var v = void 0 === this._initPTS; if (v && (i = l = 1 / 0), e.config && c.length && (e.timescale = e.samplerate, s.logger.log('audio sampling rate : ' + e.samplerate), e.isAAC || (f.mpeg ? (h = 'audio/mpeg', e.codec = '') : f.mp3 && (e.codec = 'mp3')), p.audio = { container: h, codec: e.codec, initSegment: !e.isAAC && f.mpeg ? new Uint8Array() : n.default.initSegment([e]), metadata: { channelCount: e.channelCount } }, v && (i = l = c[0].pts - e.inputTimeScale * r)), t.sps && t.pps && d.length) { var y = t.inputTimeScale; t.timescale = y, p.video = { container: 'video/mp4', codec: t.codec, initSegment: n.default.initSegment([t]), metadata: { width: t.width, height: t.height } }, v && (i = Math.min(i, d[0].pts - y * r), l = Math.min(l, d[0].dts - y * r), this.observer.trigger(a.default.INIT_PTS_FOUND, { initPTS: i })) }Object.keys(p).length ? (u.trigger(a.default.FRAG_PARSING_INIT_SEGMENT, g), this.ISGenerated = !0, v && (this._initPTS = i, this._initDTS = l)) : u.trigger(a.default.ERROR, { type: o.ErrorTypes.MEDIA_ERROR, details: o.ErrorDetails.FRAG_PARSING_ERROR, fatal: !1, reason: 'no audio/video samples found' }) }, e.prototype.remuxVideo = function (e, t, r, i, l) { var u; var c; var d; var f; var h; var p; var g; var v = 8; var y = e.timescale; var m = e.samples; var b = []; var E = m.length; var _ = this._PTSNormalize; var S = this._initPTS; var T = this.nextAvcDts; var w = this.isSafari; if (E !== 0) { w && (r |= m.length && T && (l && Math.abs(t - T / y) < 0.1 || Math.abs(m[0].pts - T - S) < y / 5)), r || (T = t * y), m.forEach(function (e) { e.pts = _(e.pts - S, T), e.dts = _(e.dts - S, T) }), m.sort(function (e, t) { var r = e.dts - t.dts; var i = e.pts - t.pts; return r || i || e.id - t.id }); var A = m.reduce(function (e, t) { return Math.max(Math.min(e, t.pts - t.dts), -18e3) }, 0); if (A < 0) { s.logger.warn('PTS < DTS detected in video samples, shifting DTS by ' + Math.round(A / 90) + ' ms to overcome this issue'); for (var L = 0; L < m.length; L++)m[L].dts += A } var R = m[0]; h = Math.max(R.dts, 0), f = Math.max(R.pts, 0); var k = Math.round((h - T) / 90); r && k && (k > 1 ? s.logger.log('AVC:' + k + ' ms hole between fragments detected,filling it') : k < -1 && s.logger.log('AVC:' + -k + ' ms overlapping between fragments detected'), h = T, m[0].dts = h, f = Math.max(f - k, T), m[0].pts = f, s.logger.log('Video/PTS/DTS adjusted: ' + Math.round(f / 90) + '/' + Math.round(h / 90) + ',delta:' + k + ' ms')), R = m[m.length - 1], g = Math.max(R.dts, 0), p = Math.max(R.pts, 0, g), w && (u = Math.round((g - h) / (m.length - 1))); var D = 0; var O = 0; for (L = 0; L < E; L++) { for (var P = m[L], I = P.units, x = I.length, C = 0, F = 0; F < x; F++)C += I[F].data.length; O += C, D += x, P.length = C, P.dts = w ? h + L * u : Math.max(P.dts, h), P.pts = Math.max(P.pts, P.dts) } var M = O + 4 * D + 8; try { c = new Uint8Array(M) } catch (J) { return void this.observer.trigger(a.default.ERROR, { type: o.ErrorTypes.MUX_ERROR, details: o.ErrorDetails.REMUX_ALLOC_ERROR, fatal: !1, bytes: M, reason: 'fail allocating video mdat ' + M }) } var j = new DataView(c.buffer); j.setUint32(0, M), c.set(n.default.types.mdat, 4); for (L = 0; L < E; L++) { var N = m[L]; var B = N.units; var U = 0; var G = void 0; for (F = 0, x = B.length; F < x; F++) { var $ = B[F]; var K = $.data; var H = $.data.byteLength; j.setUint32(v, H), v += 4, c.set(K, v), v += H, U += 4 + H } if (w)G = Math.max(0, u * Math.round((N.pts - N.dts) / u)); else { if (L < E - 1)u = m[L + 1].dts - N.dts; else { var Y = this.config; var W = N.dts - m[L > 0 ? L - 1 : L].dts; if (Y.stretchShortVideoTrack) { var q = Y.maxBufferHole; var V = Math.floor(q * y); var z = (i ? f + i * y : this.nextAudioPts) - N.pts; z > V ? (u = z - W, u < 0 && (u = W), s.logger.log('It is approximately ' + z / 90 + ' ms to the next segment; using duration ' + u / 90 + ' ms for the last video frame.')) : u = W } else u = W }G = Math.round(N.pts - N.dts) }b.push({ size: U, duration: u, cts: G, flags: { isLeading: 0, isDependedOn: 0, hasRedundancy: 0, degradPrio: 0, dependsOn: N.key ? 2 : 1, isNonSync: N.key ? 0 : 1 } }) } this.nextAvcDts = g + u; var X = e.dropped; if (e.len = 0, e.nbNalu = 0, e.dropped = 0, b.length && navigator.userAgent.toLowerCase().indexOf('chrome') > -1) { var Q = b[0].flags; Q.dependsOn = 2, Q.isNonSync = 0 }e.samples = b, d = n.default.moof(e.sequenceNumber++, h, e), e.samples = []; var Z = { data1: d, data2: c, startPTS: f / y, endPTS: (p + u) / y, startDTS: h / y, endDTS: this.nextAvcDts / y, type: 'video', hasAudio: !1, hasVideo: !0, nb: b.length, dropped: X }; return this.observer.trigger(a.default.FRAG_PARSING_DATA, Z), Z } }, e.prototype.remuxAudio = function (e, t, r, u) { var c; var d; var f; var h; var p; var g; var v; var y = e.inputTimeScale; var m = e.timescale; var b = y / m; var E = e.isAAC ? 1024 : 1152; var _ = E * b; var S = this._PTSNormalize; var T = this._initPTS; var w = !e.isAAC && this.typeSupported.mpeg; var A = e.samples; var L = []; var R = this.nextAudioPts; if (r |= A.length && R && (u && Math.abs(t - R / y) < 0.1 || Math.abs(A[0].pts - R - T) < 20 * _), A.forEach(function (e) { e.pts = e.dts = S(e.pts - T, t * y) }), A = A.filter(function (e) { return e.pts >= 0 }), A.length !== 0) { if (r || (R = u ? t * y : A[0].pts), e.isAAC) for (var k = this.config.maxAudioFramesDrift, D = 0, O = R; D < A.length;) { var P; var I = A[D]; var x = I.pts; P = x - O; var C = Math.abs(1e3 * P / y); if (P <= -k * _)s.logger.warn('Dropping 1 audio frame @ ' + (O / y).toFixed(3) + 's due to ' + Math.round(C) + ' ms overlap.'), A.splice(D, 1), e.len -= I.unit.length; else if (P >= k * _ && C < l && O) { var F = Math.round(P / _); s.logger.warn('Injecting ' + F + ' audio frame @ ' + (O / y).toFixed(3) + 's due to ' + Math.round(1e3 * P / y) + ' ms gap.'); for (var M = 0; M < F; M++) { var j = Math.max(O, 0); f = i.default.getSilentFrame(e.manifestCodec || e.codec, e.channelCount), f || (s.logger.log('Unable to get silent frame for given audio codec; duplicating last frame instead.'), f = I.unit.subarray()), A.splice(D, 0, { unit: f, pts: j, dts: j }), e.len += f.length, O += _, D++ }I.pts = I.dts = O, O += _, D++ } else Math.abs(P), I.pts = I.dts = O, O += _, D++ }M = 0; for (var N = A.length; M < N; M++) { var B = A[M]; var U = B.unit; x = B.pts; if (void 0 !== v)d.duration = Math.round((x - v) / b); else { var G = Math.round(1e3 * (x - R) / y); var $ = 0; if (r && e.isAAC && G) { if (G > 0 && G < l)$ = Math.round((x - R) / _), s.logger.log(G + ' ms hole between AAC samples detected,filling it'), $ > 0 && (f = i.default.getSilentFrame(e.manifestCodec || e.codec, e.channelCount), f || (f = U.subarray()), e.len += $ * f.length); else if (G < -12) { s.logger.log('drop overlapping AAC sample, expected/parsed/delta:' + (R / y).toFixed(3) + 's/' + (x / y).toFixed(3) + 's/' + -G + 'ms'), e.len -= U.byteLength; continue }x = R } if (g = x, !(e.len > 0)) return; var K = w ? e.len : e.len + 8; c = w ? 0 : 8; try { h = new Uint8Array(K) } catch (Q) { return void this.observer.trigger(a.default.ERROR, { type: o.ErrorTypes.MUX_ERROR, details: o.ErrorDetails.REMUX_ALLOC_ERROR, fatal: !1, bytes: K, reason: 'fail allocating audio mdat ' + K }) } if (!w) { var H = new DataView(h.buffer); H.setUint32(0, K), h.set(n.default.types.mdat, 4) } for (D = 0; D < $; D++)f = i.default.getSilentFrame(e.manifestCodec || e.codec, e.channelCount), f || (s.logger.log('Unable to get silent frame for given audio codec; duplicating this frame instead.'), f = U.subarray()), h.set(f, c), c += f.byteLength, d = { size: f.byteLength, cts: 0, duration: 1024, flags: { isLeading: 0, isDependedOn: 0, hasRedundancy: 0, degradPrio: 0, dependsOn: 1 } }, L.push(d) }h.set(U, c); var Y = U.byteLength; c += Y, d = { size: Y, cts: 0, duration: 0, flags: { isLeading: 0, isDependedOn: 0, hasRedundancy: 0, degradPrio: 0, dependsOn: 1 } }, L.push(d), v = x } var W = 0; var q = L.length; if (q >= 2 && (W = L[q - 2].duration, d.duration = W), q) { this.nextAudioPts = R = v + b * W, e.len = 0, e.samples = L, p = w ? new Uint8Array() : n.default.moof(e.sequenceNumber++, g / b, e), e.samples = []; var V = g / y; var z = R / y; var X = { data1: p, data2: h, startPTS: V, endPTS: z, startDTS: V, endDTS: z, type: 'audio', hasAudio: !0, hasVideo: !1, nb: q }; return this.observer.trigger(a.default.FRAG_PARSING_DATA, X), X } return null } }, e.prototype.remuxEmptyAudio = function (e, t, r, n) { var a = e.inputTimeScale; var o = e.samplerate ? e.samplerate : a; var l = a / o; var u = this.nextAudioPts; var c = (void 0 !== u ? u : n.startDTS * a) + this._initDTS; var d = n.endDTS * a + this._initDTS; var f = 1024; var h = l * f; var p = Math.ceil((d - c) / h); var g = i.default.getSilentFrame(e.manifestCodec || e.codec, e.channelCount); if (s.logger.warn('remux empty Audio'), g) { for (var v = [], y = 0; y < p; y++) { var m = c + y * h; v.push({ unit: g, pts: m, dts: m }), e.len += g.length }e.samples = v, this.remuxAudio(e, t, r) } else s.logger.trace('Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!') }, e.prototype.remuxID3 = function (e) { var t; var r = e.samples.length; var i = e.inputTimeScale; var n = this._initPTS; var o = this._initDTS; if (r) { for (var s = 0; s < r; s++)t = e.samples[s], t.pts = (t.pts - n) / i, t.dts = (t.dts - o) / i; this.observer.trigger(a.default.FRAG_PARSING_METADATA, { samples: e.samples }) }e.samples = [] }, e.prototype.remuxText = function (e) { e.samples.sort(function (e, t) { return e.pts - t.pts }); var t; var r = e.samples.length; var i = e.inputTimeScale; var n = this._initPTS; if (r) { for (var o = 0; o < r; o++)t = e.samples[o], t.pts = (t.pts - n) / i; this.observer.trigger(a.default.FRAG_PARSING_USERDATA, { samples: e.samples }) }e.samples = [] }, e.prototype._PTSNormalize = function (e, t) { var r; if (void 0 === t) return e; r = t < e ? -8589934592 : 8589934592; while (Math.abs(e - t) > 4294967296)e += r; return e }, e }()); t.default = u },
        './src/remux/passthrough-remuxer.js':
        /*! ******************************************!*\
  !*** ./src/remux/passthrough-remuxer.js ***!
  \******************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../events */'./src/events.js'); var n = (function () { function e (e) { this.observer = e } return e.prototype.destroy = function () {}, e.prototype.resetTimeStamp = function () {}, e.prototype.resetInitSegment = function () {}, e.prototype.remux = function (e, t, r, n, a, o, s, l) { var u = this.observer; var c = ''; e && (c += 'audio'), t && (c += 'video'), u.trigger(i.default.FRAG_PARSING_DATA, { data1: l, startPTS: a, startDTS: a, type: c, hasAudio: !!e, hasVideo: !!t, nb: 1, dropped: 0 }), u.trigger(i.default.FRAG_PARSED) }, e }()); t.default = n },
        './src/task-loop.js':
        /*! **************************!*\
  !*** ./src/task-loop.js ***!
  \**************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; var i = this && this.__extends || (function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t)t.hasOwnProperty(r) && (e[r] = t[r]) }; return function (t, r) { function i () { this.constructor = t }e(t, r), t.prototype = r === null ? Object.create(r) : (i.prototype = r.prototype, new i()) } }()); Object.defineProperty(t, '__esModule', { value: !0 }); var n = r(/*! ./event-handler */'./src/event-handler.js'); var a = (function (e) { function t (t) { for (var r = [], i = 1; i < arguments.length; i++)r[i - 1] = arguments[i]; var n = e.apply(this, [t].concat(r)) || this; return n._tickInterval = null, n._tickTimer = null, n._tickCallCount = 0, n._boundTick = n.tick.bind(n), n } return i(t, e), t.prototype.onHandlerDestroying = function () { this.clearNextTick(), this.clearInterval() }, t.prototype.hasInterval = function () { return !!this._tickInterval }, t.prototype.hasNextTick = function () { return !!this._tickTimer }, t.prototype.setInterval = function (e) { return !this._tickInterval && (this._tickInterval = setInterval(this._boundTick, e), !0) }, t.prototype.clearInterval = function () { return !!this._tickInterval && (clearInterval(this._tickInterval), this._tickInterval = null, !0) }, t.prototype.clearNextTick = function () { return !!this._tickTimer && (clearTimeout(this._tickTimer), this._tickTimer = null, !0) }, t.prototype.tick = function () { this._tickCallCount++, this._tickCallCount === 1 && (this.doTick(), this._tickCallCount > 1 && (this.clearNextTick(), this._tickTimer = setTimeout(this._boundTick, 0)), this._tickCallCount = 0) }, t.prototype.doTick = function () {}, t }(n.default)); t.default = a },
        './src/utils/attr-list.js':
        /*! ********************************!*\
  !*** ./src/utils/attr-list.js ***!
  \********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var r = /^(\d+)x(\d+)$/; var i = /\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g; var n = (function () { function t (e) { for (var r in typeof e === 'string' && (e = t.parseAttrList(e)), e)e.hasOwnProperty(r) && (this[r] = e[r]) } return t.prototype.decimalInteger = function (t) { var r = parseInt(this[t], 10); return r > e.MAX_SAFE_INTEGER ? 1 / 0 : r }, t.prototype.hexadecimalInteger = function (e) { if (this[e]) { var t = (this[e] || '0x').slice(2); t = (1 & t.length ? '0' : '') + t; for (var r = new Uint8Array(t.length / 2), i = 0; i < t.length / 2; i++)r[i] = parseInt(t.slice(2 * i, 2 * i + 2), 16); return r } return null }, t.prototype.hexadecimalIntegerAsNumber = function (t) { var r = parseInt(this[t], 16); return r > e.MAX_SAFE_INTEGER ? 1 / 0 : r }, t.prototype.decimalFloatingPoint = function (e) { return parseFloat(this[e]) }, t.prototype.enumeratedString = function (e) { return this[e] }, t.prototype.decimalResolution = function (e) { var t = r.exec(this[e]); if (t !== null) return { width: parseInt(t[1], 10), height: parseInt(t[2], 10) } }, t.parseAttrList = function (e) { var t; var r = {}; i.lastIndex = 0; while ((t = i.exec(e)) !== null) { var n = t[2]; var a = '"'; n.indexOf(a) === 0 && n.lastIndexOf(a) === n.length - 1 && (n = n.slice(1, -1)), r[t[1]] = n } return r }, t }()); t.default = n }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/utils/binary-search.js':
        /*! ************************************!*\
  !*** ./src/utils/binary-search.js ***!
  \************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = { search: function (e, t) { var r = 0; var i = e.length - 1; var n = null; var a = null; while (r <= i) { n = (r + i) / 2 | 0, a = e[n]; var o = t(a); if (o > 0)r = n + 1; else { if (!(o < 0)) return a; i = n - 1 } } return null } }; t.default = i },
        './src/utils/buffer-helper.js':
        /*! ************************************!*\
  !*** ./src/utils/buffer-helper.js ***!
  \************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = (function () { function e () {} return e.isBuffered = function (e, t) { try { if (e) for (var r = e.buffered, i = 0; i < r.length; i++) if (t >= r.start(i) && t <= r.end(i)) return !0 } catch (n) {} return !1 }, e.bufferInfo = function (e, t, r) { try { if (e) { var i = e.buffered; var n = []; var a = void 0; for (a = 0; a < i.length; a++)n.push({ start: i.start(a), end: i.end(a) }); return this.bufferedInfo(n, t, r) } } catch (o) {} return { len: 0, start: t, end: t, nextStart: void 0 } }, e.bufferedInfo = function (e, t, r) { var i; var n; var a; var o; var s; var l = []; for (e.sort(function (e, t) { var r = e.start - t.start; return r || t.end - e.end }), s = 0; s < e.length; s++) { var u = l.length; if (u) { var c = l[u - 1].end; e[s].start - c < r ? e[s].end > c && (l[u - 1].end = e[s].end) : l.push(e[s]) } else l.push(e[s]) } for (s = 0, i = 0, n = a = t; s < l.length; s++) { var d = l[s].start; var f = l[s].end; if (t + r >= d && t < f)n = d, a = f, i = a - t; else if (t + r < d) { o = d; break } } return { len: i, start: n, end: a, nextStart: o } }, e }()); t.BufferHelper = i },
        './src/utils/cea-608-parser.js':
        /*! *************************************!*\
  !*** ./src/utils/cea-608-parser.js ***!
  \*************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = { 42: 225, 92: 233, 94: 237, 95: 243, 96: 250, 123: 231, 124: 247, 125: 209, 126: 241, 127: 9608, 128: 174, 129: 176, 130: 189, 131: 191, 132: 8482, 133: 162, 134: 163, 135: 9834, 136: 224, 137: 32, 138: 232, 139: 226, 140: 234, 141: 238, 142: 244, 143: 251, 144: 193, 145: 201, 146: 211, 147: 218, 148: 220, 149: 252, 150: 8216, 151: 161, 152: 42, 153: 8217, 154: 9473, 155: 169, 156: 8480, 157: 8226, 158: 8220, 159: 8221, 160: 192, 161: 194, 162: 199, 163: 200, 164: 202, 165: 203, 166: 235, 167: 206, 168: 207, 169: 239, 170: 212, 171: 217, 172: 249, 173: 219, 174: 171, 175: 187, 176: 195, 177: 227, 178: 205, 179: 204, 180: 236, 181: 210, 182: 242, 183: 213, 184: 245, 185: 123, 186: 125, 187: 92, 188: 94, 189: 95, 190: 124, 191: 8764, 192: 196, 193: 228, 194: 214, 195: 246, 196: 223, 197: 165, 198: 164, 199: 9475, 200: 197, 201: 229, 202: 216, 203: 248, 204: 9487, 205: 9491, 206: 9495, 207: 9499 }; var n = function (e) { var t = e; return i.hasOwnProperty(e) && (t = i[e]), String.fromCharCode(t) }; var a = 15; var o = 100; var s = { 17: 1, 18: 3, 21: 5, 22: 7, 23: 9, 16: 11, 19: 12, 20: 14 }; var l = { 17: 2, 18: 4, 21: 6, 22: 8, 23: 10, 19: 13, 20: 15 }; var u = { 25: 1, 26: 3, 29: 5, 30: 7, 31: 9, 24: 11, 27: 12, 28: 14 }; var c = { 25: 2, 26: 4, 29: 6, 30: 8, 31: 10, 27: 13, 28: 15 }; var d = ['white', 'green', 'blue', 'cyan', 'red', 'yellow', 'magenta', 'black', 'transparent']; var f = { verboseFilter: { DATA: 3, DEBUG: 3, INFO: 2, WARNING: 2, TEXT: 1, ERROR: 0 }, time: null, verboseLevel: 0, setTime: function (e) { this.time = e }, log: function (e, t) { this.verboseFilter[e]; this.verboseLevel } }; var h = function (e) { for (var t = [], r = 0; r < e.length; r++)t.push(e[r].toString(16)); return t }; var p = (function () { function e (e, t, r, i, n) { this.foreground = e || 'white', this.underline = t || !1, this.italics = r || !1, this.background = i || 'black', this.flash = n || !1 } return e.prototype.reset = function () { this.foreground = 'white', this.underline = !1, this.italics = !1, this.background = 'black', this.flash = !1 }, e.prototype.setStyles = function (e) { for (var t = ['foreground', 'underline', 'italics', 'background', 'flash'], r = 0; r < t.length; r++) { var i = t[r]; e.hasOwnProperty(i) && (this[i] = e[i]) } }, e.prototype.isDefault = function () { return this.foreground === 'white' && !this.underline && !this.italics && this.background === 'black' && !this.flash }, e.prototype.equals = function (e) { return this.foreground === e.foreground && this.underline === e.underline && this.italics === e.italics && this.background === e.background && this.flash === e.flash }, e.prototype.copy = function (e) { this.foreground = e.foreground, this.underline = e.underline, this.italics = e.italics, this.background = e.background, this.flash = e.flash }, e.prototype.toString = function () { return 'color=' + this.foreground + ', underline=' + this.underline + ', italics=' + this.italics + ', background=' + this.background + ', flash=' + this.flash }, e }()); var g = (function () { function e (e, t, r, i, n, a) { this.uchar = e || ' ', this.penState = new p(t, r, i, n, a) } return e.prototype.reset = function () { this.uchar = ' ', this.penState.reset() }, e.prototype.setChar = function (e, t) { this.uchar = e, this.penState.copy(t) }, e.prototype.setPenState = function (e) { this.penState.copy(e) }, e.prototype.equals = function (e) { return this.uchar === e.uchar && this.penState.equals(e.penState) }, e.prototype.copy = function (e) { this.uchar = e.uchar, this.penState.copy(e.penState) }, e.prototype.isEmpty = function () { return this.uchar === ' ' && this.penState.isDefault() }, e }()); var v = (function () { function e () { this.chars = []; for (var e = 0; e < o; e++) this.chars.push(new g()); this.pos = 0, this.currPenState = new p() } return e.prototype.equals = function (e) { for (var t = !0, r = 0; r < o; r++) if (!this.chars[r].equals(e.chars[r])) { t = !1; break } return t }, e.prototype.copy = function (e) { for (var t = 0; t < o; t++) this.chars[t].copy(e.chars[t]) }, e.prototype.isEmpty = function () { for (var e = !0, t = 0; t < o; t++) if (!this.chars[t].isEmpty()) { e = !1; break } return e }, e.prototype.setCursor = function (e) { this.pos !== e && (this.pos = e), this.pos < 0 ? (f.log('ERROR', 'Negative cursor position ' + this.pos), this.pos = 0) : this.pos > o && (f.log('ERROR', 'Too large cursor position ' + this.pos), this.pos = o) }, e.prototype.moveCursor = function (e) { var t = this.pos + e; if (e > 1) for (var r = this.pos + 1; r < t + 1; r++) this.chars[r].setPenState(this.currPenState); this.setCursor(t) }, e.prototype.backSpace = function () { this.moveCursor(-1), this.chars[this.pos].setChar(' ', this.currPenState) }, e.prototype.insertChar = function (e) { e >= 144 && this.backSpace(); var t = n(e); this.pos >= o ? f.log('ERROR', 'Cannot insert ' + e.toString(16) + ' (' + t + ') at position ' + this.pos + '. Skipping it!') : (this.chars[this.pos].setChar(t, this.currPenState), this.moveCursor(1)) }, e.prototype.clearFromPos = function (e) { var t; for (t = e; t < o; t++) this.chars[t].reset() }, e.prototype.clear = function () { this.clearFromPos(0), this.pos = 0, this.currPenState.reset() }, e.prototype.clearToEndOfRow = function () { this.clearFromPos(this.pos) }, e.prototype.getTextString = function () { for (var e = [], t = !0, r = 0; r < o; r++) { var i = this.chars[r].uchar; i !== ' ' && (t = !1), e.push(i) } return t ? '' : e.join('') }, e.prototype.setPenStyles = function (e) { this.currPenState.setStyles(e); var t = this.chars[this.pos]; t.setPenState(this.currPenState) }, e }()); var y = (function () { function e () { this.rows = []; for (var e = 0; e < a; e++) this.rows.push(new v()); this.currRow = a - 1, this.nrRollUpRows = null, this.reset() } return e.prototype.reset = function () { for (var e = 0; e < a; e++) this.rows[e].clear(); this.currRow = a - 1 }, e.prototype.equals = function (e) { for (var t = !0, r = 0; r < a; r++) if (!this.rows[r].equals(e.rows[r])) { t = !1; break } return t }, e.prototype.copy = function (e) { for (var t = 0; t < a; t++) this.rows[t].copy(e.rows[t]) }, e.prototype.isEmpty = function () { for (var e = !0, t = 0; t < a; t++) if (!this.rows[t].isEmpty()) { e = !1; break } return e }, e.prototype.backSpace = function () { var e = this.rows[this.currRow]; e.backSpace() }, e.prototype.clearToEndOfRow = function () { var e = this.rows[this.currRow]; e.clearToEndOfRow() }, e.prototype.insertChar = function (e) { var t = this.rows[this.currRow]; t.insertChar(e) }, e.prototype.setPen = function (e) { var t = this.rows[this.currRow]; t.setPenStyles(e) }, e.prototype.moveCursor = function (e) { var t = this.rows[this.currRow]; t.moveCursor(e) }, e.prototype.setCursor = function (e) { f.log('INFO', 'setCursor: ' + e); var t = this.rows[this.currRow]; t.setCursor(e) }, e.prototype.setPAC = function (e) { f.log('INFO', 'pacData = ' + JSON.stringify(e)); var t = e.row - 1; if (this.nrRollUpRows && t < this.nrRollUpRows - 1 && (t = this.nrRollUpRows - 1), this.nrRollUpRows && this.currRow !== t) { for (var r = 0; r < a; r++) this.rows[r].clear(); var i = this.currRow + 1 - this.nrRollUpRows; var n = this.lastOutputScreen; if (n) { var o = n.rows[i].cueStartTime; if (o && o < f.time) for (r = 0; r < this.nrRollUpRows; r++) this.rows[t - this.nrRollUpRows + r + 1].copy(n.rows[i + r]) } } this.currRow = t; var s = this.rows[this.currRow]; if (e.indent !== null) { var l = e.indent; var u = Math.max(l - 1, 0); s.setCursor(e.indent), e.color = s.chars[u].penState.foreground } var c = { foreground: e.color, underline: e.underline, italics: e.italics, background: 'black', flash: !1 }; this.setPen(c) }, e.prototype.setBkgData = function (e) { f.log('INFO', 'bkgData = ' + JSON.stringify(e)), this.backSpace(), this.setPen(e), this.insertChar(32) }, e.prototype.setRollUpRows = function (e) { this.nrRollUpRows = e }, e.prototype.rollUp = function () { if (this.nrRollUpRows !== null) { f.log('TEXT', this.getDisplayText()); var e = this.currRow + 1 - this.nrRollUpRows; var t = this.rows.splice(e, 1)[0]; t.clear(), this.rows.splice(this.currRow, 0, t), f.log('INFO', 'Rolling up') } else f.log('DEBUG', 'roll_up but nrRollUpRows not set yet') }, e.prototype.getDisplayText = function (e) { e = e || !1; for (var t = [], r = '', i = -1, n = 0; n < a; n++) { var o = this.rows[n].getTextString(); o && (i = n + 1, e ? t.push('Row ' + i + ": '" + o + "'") : t.push(o.trim())) } return t.length > 0 && (r = e ? '[' + t.join(' | ') + ']' : t.join('\n')), r }, e.prototype.getTextAndFormat = function () { return this.rows }, e }()); var m = (function () { function e (e, t) { this.chNr = e, this.outputFilter = t, this.mode = null, this.verbose = 0, this.displayedMemory = new y(), this.nonDisplayedMemory = new y(), this.lastOutputScreen = new y(), this.currRollUpRow = this.displayedMemory.rows[a - 1], this.writeScreen = this.displayedMemory, this.mode = null, this.cueStartTime = null } return e.prototype.reset = function () { this.mode = null, this.displayedMemory.reset(), this.nonDisplayedMemory.reset(), this.lastOutputScreen.reset(), this.currRollUpRow = this.displayedMemory.rows[a - 1], this.writeScreen = this.displayedMemory, this.mode = null, this.cueStartTime = null, this.lastCueEndTime = null }, e.prototype.getHandler = function () { return this.outputFilter }, e.prototype.setHandler = function (e) { this.outputFilter = e }, e.prototype.setPAC = function (e) { this.writeScreen.setPAC(e) }, e.prototype.setBkgData = function (e) { this.writeScreen.setBkgData(e) }, e.prototype.setMode = function (e) { e !== this.mode && (this.mode = e, f.log('INFO', 'MODE=' + e), this.mode === 'MODE_POP-ON' ? this.writeScreen = this.nonDisplayedMemory : (this.writeScreen = this.displayedMemory, this.writeScreen.reset()), this.mode !== 'MODE_ROLL-UP' && (this.displayedMemory.nrRollUpRows = null, this.nonDisplayedMemory.nrRollUpRows = null), this.mode = e) }, e.prototype.insertChars = function (e) { for (var t = 0; t < e.length; t++) this.writeScreen.insertChar(e[t]); var r = this.writeScreen === this.displayedMemory ? 'DISP' : 'NON_DISP'; f.log('INFO', r + ': ' + this.writeScreen.getDisplayText(!0)), this.mode !== 'MODE_PAINT-ON' && this.mode !== 'MODE_ROLL-UP' || (f.log('TEXT', 'DISPLAYED: ' + this.displayedMemory.getDisplayText(!0)), this.outputDataUpdate()) }, e.prototype.ccRCL = function () { f.log('INFO', 'RCL - Resume Caption Loading'), this.setMode('MODE_POP-ON') }, e.prototype.ccBS = function () { f.log('INFO', 'BS - BackSpace'), this.mode !== 'MODE_TEXT' && (this.writeScreen.backSpace(), this.writeScreen === this.displayedMemory && this.outputDataUpdate()) }, e.prototype.ccAOF = function () {}, e.prototype.ccAON = function () {}, e.prototype.ccDER = function () { f.log('INFO', 'DER- Delete to End of Row'), this.writeScreen.clearToEndOfRow(), this.outputDataUpdate() }, e.prototype.ccRU = function (e) { f.log('INFO', 'RU(' + e + ') - Roll Up'), this.writeScreen = this.displayedMemory, this.setMode('MODE_ROLL-UP'), this.writeScreen.setRollUpRows(e) }, e.prototype.ccFON = function () { f.log('INFO', 'FON - Flash On'), this.writeScreen.setPen({ flash: !0 }) }, e.prototype.ccRDC = function () { f.log('INFO', 'RDC - Resume Direct Captioning'), this.setMode('MODE_PAINT-ON') }, e.prototype.ccTR = function () { f.log('INFO', 'TR'), this.setMode('MODE_TEXT') }, e.prototype.ccRTD = function () { f.log('INFO', 'RTD'), this.setMode('MODE_TEXT') }, e.prototype.ccEDM = function () { f.log('INFO', 'EDM - Erase Displayed Memory'), this.displayedMemory.reset(), this.outputDataUpdate(!0) }, e.prototype.ccCR = function () { f.log('CR - Carriage Return'), this.writeScreen.rollUp(), this.outputDataUpdate(!0) }, e.prototype.ccENM = function () { f.log('INFO', 'ENM - Erase Non-displayed Memory'), this.nonDisplayedMemory.reset() }, e.prototype.ccEOC = function () { if (f.log('INFO', 'EOC - End Of Caption'), this.mode === 'MODE_POP-ON') { var e = this.displayedMemory; this.displayedMemory = this.nonDisplayedMemory, this.nonDisplayedMemory = e, this.writeScreen = this.nonDisplayedMemory, f.log('TEXT', 'DISP: ' + this.displayedMemory.getDisplayText()) } this.outputDataUpdate(!0) }, e.prototype.ccTO = function (e) { f.log('INFO', 'TO(' + e + ') - Tab Offset'), this.writeScreen.moveCursor(e) }, e.prototype.ccMIDROW = function (e) { var t = { flash: !1 }; if (t.underline = e % 2 === 1, t.italics = e >= 46, t.italics)t.foreground = 'white'; else { var r = Math.floor(e / 2) - 16; var i = ['white', 'green', 'blue', 'cyan', 'red', 'yellow', 'magenta']; t.foreground = i[r] }f.log('INFO', 'MIDROW: ' + JSON.stringify(t)), this.writeScreen.setPen(t) }, e.prototype.outputDataUpdate = function (e) { void 0 === e && (e = !1); var t = f.time; t !== null && this.outputFilter && (this.cueStartTime !== null || this.displayedMemory.isEmpty() ? this.displayedMemory.equals(this.lastOutputScreen) || (this.outputFilter.newCue && (this.outputFilter.newCue(this.cueStartTime, t, this.lastOutputScreen), !0 === e && this.outputFilter.dispatchCue && this.outputFilter.dispatchCue()), this.cueStartTime = this.displayedMemory.isEmpty() ? null : t) : this.cueStartTime = t, this.lastOutputScreen.copy(this.displayedMemory)) }, e.prototype.cueSplitAtTime = function (e) { this.outputFilter && (this.displayedMemory.isEmpty() || (this.outputFilter.newCue && this.outputFilter.newCue(this.cueStartTime, e, this.displayedMemory), this.cueStartTime = e)) }, e }()); var b = (function () { function e (e, t, r) { this.field = e || 1, this.outputs = [t, r], this.channels = [new m(1, t), new m(2, r)], this.currChNr = -1, this.lastCmdA = null, this.lastCmdB = null, this.bufferedData = [], this.startTime = null, this.lastTime = null, this.dataCounters = { padding: 0, char: 0, cmd: 0, other: 0 } } return e.prototype.getHandler = function (e) { return this.channels[e].getHandler() }, e.prototype.setHandler = function (e, t) { this.channels[e].setHandler(t) }, e.prototype.addData = function (e, t) { var r; var i; var n; var a = !1; this.lastTime = e, f.setTime(e); for (var o = 0; o < t.length; o += 2) if (i = 127 & t[o], n = 127 & t[o + 1], i !== 0 || n !== 0) { if (f.log('DATA', '[' + h([t[o], t[o + 1]]) + '] -> (' + h([i, n]) + ')'), r = this.parseCmd(i, n), r || (r = this.parseMidrow(i, n)), r || (r = this.parsePAC(i, n)), r || (r = this.parseBackgroundAttributes(i, n)), !r && (a = this.parseChars(i, n), a)) if (this.currChNr && this.currChNr >= 0) { var s = this.channels[this.currChNr - 1]; s.insertChars(a) } else f.log('WARNING', 'No channel found yet. TEXT-MODE?'); r ? this.dataCounters.cmd += 2 : a ? this.dataCounters.char += 2 : (this.dataCounters.other += 2, f.log('WARNING', "Couldn't parse cleaned data " + h([i, n]) + ' orig: ' + h([t[o], t[o + 1]]))) } else this.dataCounters.padding += 2 }, e.prototype.parseCmd = function (e, t) { var r = null; var i = (e === 20 || e === 28) && t >= 32 && t <= 47; var n = (e === 23 || e === 31) && t >= 33 && t <= 35; if (!i && !n) return !1; if (e === this.lastCmdA && t === this.lastCmdB) return this.lastCmdA = null, this.lastCmdB = null, f.log('DEBUG', 'Repeated command (' + h([e, t]) + ') is dropped'), !0; r = e === 20 || e === 23 ? 1 : 2; var a = this.channels[r - 1]; return e === 20 || e === 28 ? t === 32 ? a.ccRCL() : t === 33 ? a.ccBS() : t === 34 ? a.ccAOF() : t === 35 ? a.ccAON() : t === 36 ? a.ccDER() : t === 37 ? a.ccRU(2) : t === 38 ? a.ccRU(3) : t === 39 ? a.ccRU(4) : t === 40 ? a.ccFON() : t === 41 ? a.ccRDC() : t === 42 ? a.ccTR() : t === 43 ? a.ccRTD() : t === 44 ? a.ccEDM() : t === 45 ? a.ccCR() : t === 46 ? a.ccENM() : t === 47 && a.ccEOC() : a.ccTO(t - 32), this.lastCmdA = e, this.lastCmdB = t, this.currChNr = r, !0 }, e.prototype.parseMidrow = function (e, t) { var r = null; if ((e === 17 || e === 25) && t >= 32 && t <= 47) { if (r = e === 17 ? 1 : 2, r !== this.currChNr) return f.log('ERROR', 'Mismatch channel in midrow parsing'), !1; var i = this.channels[r - 1]; return i.ccMIDROW(t), f.log('DEBUG', 'MIDROW (' + h([e, t]) + ')'), !0 } return !1 }, e.prototype.parsePAC = function (e, t) { var r = null; var i = null; var n = (e >= 17 && e <= 23 || e >= 25 && e <= 31) && t >= 64 && t <= 127; var a = (e === 16 || e === 24) && t >= 64 && t <= 95; if (!n && !a) return !1; if (e === this.lastCmdA && t === this.lastCmdB) return this.lastCmdA = null, this.lastCmdB = null, !0; r = e <= 23 ? 1 : 2, i = t >= 64 && t <= 95 ? r === 1 ? s[e] : u[e] : r === 1 ? l[e] : c[e]; var o = this.interpretPAC(i, t); var d = this.channels[r - 1]; return d.setPAC(o), this.lastCmdA = e, this.lastCmdB = t, this.currChNr = r, !0 }, e.prototype.interpretPAC = function (e, t) { var r = t; var i = { color: null, italics: !1, indent: null, underline: !1, row: e }; return r = t > 95 ? t - 96 : t - 64, i.underline = (1 & r) === 1, r <= 13 ? i.color = ['white', 'green', 'blue', 'cyan', 'red', 'yellow', 'magenta', 'white'][Math.floor(r / 2)] : r <= 15 ? (i.italics = !0, i.color = 'white') : i.indent = 4 * Math.floor((r - 16) / 2), i }, e.prototype.parseChars = function (e, t) { var r = null; var i = null; var a = null; if (e >= 25 ? (r = 2, a = e - 8) : (r = 1, a = e), a >= 17 && a <= 19) { var o = t; o = a === 17 ? t + 80 : a === 18 ? t + 112 : t + 144, f.log('INFO', "Special char '" + n(o) + "' in channel " + r), i = [o] } else e >= 32 && e <= 127 && (i = t === 0 ? [e] : [e, t]); if (i) { var s = h(i); f.log('DEBUG', 'Char codes =  ' + s.join(',')), this.lastCmdA = null, this.lastCmdB = null } return i }, e.prototype.parseBackgroundAttributes = function (e, t) { var r; var i; var n; var a; var o = (e === 16 || e === 24) && t >= 32 && t <= 47; var s = (e === 23 || e === 31) && t >= 45 && t <= 47; return !(!o && !s) && (r = {}, e === 16 || e === 24 ? (i = Math.floor((t - 32) / 2), r.background = d[i], t % 2 === 1 && (r.background = r.background + '_semi')) : t === 45 ? r.background = 'transparent' : (r.foreground = 'black', t === 47 && (r.underline = !0)), n = e < 24 ? 1 : 2, a = this.channels[n - 1], a.setBkgData(r), this.lastCmdA = null, this.lastCmdB = null, !0) }, e.prototype.reset = function () { for (var e = 0; e < this.channels.length; e++) this.channels[e] && this.channels[e].reset(); this.lastCmdA = null, this.lastCmdB = null }, e.prototype.cueSplitAtTime = function (e) { for (var t = 0; t < this.channels.length; t++) this.channels[t] && this.channels[t].cueSplitAtTime(e) }, e }()); t.default = b },
        './src/utils/codecs.js':
        /*! *****************************!*\
  !*** ./src/utils/codecs.js ***!
  \*****************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = { audio: { a3ds: !0, 'ac-3': !0, 'ac-4': !0, alac: !0, alaw: !0, dra1: !0, 'dts+': !0, 'dts-': !0, dtsc: !0, dtse: !0, dtsh: !0, 'ec-3': !0, enca: !0, g719: !0, g726: !0, m4ae: !0, mha1: !0, mha2: !0, mhm1: !0, mhm2: !0, mlpa: !0, mp4a: !0, 'raw ': !0, Opus: !0, samr: !0, sawb: !0, sawp: !0, sevc: !0, sqcp: !0, ssmv: !0, twos: !0, ulaw: !0 }, video: { avc1: !0, avc2: !0, avc3: !0, avc4: !0, avcp: !0, drac: !0, dvav: !0, dvhe: !0, encv: !0, hev1: !0, hvc1: !0, mjp2: !0, mp4v: !0, mvc1: !0, mvc2: !0, mvc3: !0, mvc4: !0, resv: !0, rv60: !0, s263: !0, svc1: !0, svc2: !0, 'vc-1': !0, vp08: !0, vp09: !0 } }; function n (e, t) { var r = i[t]; return !!r && !0 === r[e.slice(0, 4)] } function a (e, t) { return window.MediaSource.isTypeSupported((t || 'video') + '/mp4;codecs="' + e + '"') }t.isCodecType = n, t.isCodecSupportedInMp4 = a },
        './src/utils/cues.js':
        /*! ***************************!*\
  !*** ./src/utils/cues.js ***!
  \***************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./vttparser */'./src/utils/vttparser.js'); function n (e, t, r, n) { for (var a, o, s, l, u, c = window.VTTCue || window.TextTrackCue, d = 0; d < n.rows.length; d++) if (a = n.rows[d], s = !0, l = 0, u = '', !a.isEmpty()) { for (var f = 0; f < a.chars.length; f++)a.chars[f].uchar.match(/\s/) && s ? l++ : (u += a.chars[f].uchar, s = !1); a.cueStartTime = t, t === r && (r += 1e-4), o = new c(t, r, i.fixLineBreaks(u.trim())), l >= 16 ? l-- : l++, navigator.userAgent.match(/Firefox\//) ? o.line = d + 1 : o.line = d > 7 ? d - 2 : d + 1, o.align = 'left', o.position = Math.max(0, Math.min(100, l / 32 * 100 + (navigator.userAgent.match(/Firefox\//) ? 50 : 0))), e.addCue(o) } }t.newCue = n },
        './src/utils/discontinuities.js':
        /*! **************************************!*\
  !*** ./src/utils/discontinuities.js ***!
  \**************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./binary-search */'./src/utils/binary-search.js'); var n = r(/*! ../utils/logger */'./src/utils/logger.js'); function a (e, t) { for (var r = null, i = 0; i < e.length; i += 1) { var n = e[i]; if (n && n.cc === t) { r = n; break } } return r } function o (e, t) { return i.default.search(e, function (e) { return e.cc < t ? 1 : e.cc > t ? -1 : 0 }) } function s (e, t, r) { var i = !1; return t && t.details && r && (r.endCC > r.startCC || e && e.cc < r.startCC) && (i = !0), i } function l (e, t) { var r = e.fragments; var i = t.fragments; if (i.length && r.length) { var o = a(r, i[0].cc); if (o && (!o || o.startPTS)) return o; n.logger.log('No frag in previous level to align on') } else n.logger.log('No fragments to align') } function u (e, t) { t.fragments.forEach(function (t) { if (t) { var r = t.start + e; t.start = t.startPTS = r, t.endPTS = r + t.duration } }), t.PTSKnown = !0 } function c (e, t, r) { d(e, r, t), !r.PTSKnown && t && f(r, t.details) } function d (e, t, r) { if (s(e, r, t)) { var i = l(r.details, t); i && (n.logger.log('Adjusting PTS using last level due to CC increase within current level'), u(i.start, t)) } } function f (t, r) { if (r && r.fragments.length) { if (!t.hasProgramDateTime || !r.hasProgramDateTime) return; var i = r.fragments[0].programDateTime; var a = t.fragments[0].programDateTime; var o = (a - i) / 1e3 + r.fragments[0].start; e.isFinite(o) && (n.logger.log('adjusting PTS using programDateTime delta, sliding:' + o.toFixed(3)), u(o, t)) } }t.findFirstFragWithCC = a, t.findFragWithCC = o, t.shouldAlignOnDiscontinuities = s, t.findDiscontinuousReferenceFrag = l, t.adjustPts = u, t.alignStream = c, t.alignDiscontinuities = d, t.alignPDT = f }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/utils/ewma-bandwidth-estimator.js':
        /*! ***********************************************!*\
  !*** ./src/utils/ewma-bandwidth-estimator.js ***!
  \***********************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../utils/ewma */'./src/utils/ewma.js'); var n = (function () { function e (e, t, r, n) { this.hls = e, this.defaultEstimate_ = n, this.minWeight_ = 0.001, this.minDelayMs_ = 50, this.slow_ = new i.default(t), this.fast_ = new i.default(r) } return e.prototype.sample = function (e, t) { e = Math.max(e, this.minDelayMs_); var r = 8e3 * t / e; var i = e / 1e3; this.fast_.sample(i, r), this.slow_.sample(i, r) }, e.prototype.canEstimate = function () { var e = this.fast_; return e && e.getTotalWeight() >= this.minWeight_ }, e.prototype.getEstimate = function () { return this.canEstimate() ? Math.min(this.fast_.getEstimate(), this.slow_.getEstimate()) : this.defaultEstimate_ }, e.prototype.destroy = function () {}, e }()); t.default = n },
        './src/utils/ewma.js':
        /*! ***************************!*\
  !*** ./src/utils/ewma.js ***!
  \***************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = (function () { function e (e) { this.alpha_ = e ? Math.exp(Math.log(0.5) / e) : 0, this.estimate_ = 0, this.totalWeight_ = 0 } return e.prototype.sample = function (e, t) { var r = Math.pow(this.alpha_, e); this.estimate_ = t * (1 - r) + r * this.estimate_, this.totalWeight_ += e }, e.prototype.getTotalWeight = function () { return this.totalWeight_ }, e.prototype.getEstimate = function () { if (this.alpha_) { var e = 1 - Math.pow(this.alpha_, this.totalWeight_); return this.estimate_ / e } return this.estimate_ }, e }()); t.default = i },
        './src/utils/get-self-scope.js':
        /*! *************************************!*\
  !*** ./src/utils/get-self-scope.js ***!
  \*************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; function i () { return typeof window === 'undefined' ? self : window }Object.defineProperty(t, '__esModule', { value: !0 }), t.getSelfScope = i },
        './src/utils/logger.js':
        /*! *****************************!*\
  !*** ./src/utils/logger.js ***!
  \*****************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./get-self-scope */'./src/utils/get-self-scope.js'); function n () {} var a = { trace: n, debug: n, log: n, warn: n, info: n, error: n }; var o = a; function s (e, t) { return t = '[' + e + '] > ' + t, t } var l = i.getSelfScope(); function u (e) { var t = l.console[e]; return t ? function () { for (var r = [], i = 0; i < arguments.length; i++)r[i] = arguments[i]; r[0] && (r[0] = s(e, r[0])), t.apply(l.console, r) } : n } function c (e) { for (var t = [], r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; t.forEach(function (t) { o[t] = e[t] ? e[t].bind(e) : u(t) }) }t.enableLogs = function (e) { if (!0 === e || typeof e === 'object') { c(e, 'debug', 'log', 'info', 'warn', 'error'); try { o.log() } catch (t) { o = a } } else o = a }, t.logger = o },
        './src/utils/mediakeys-helper.js':
        /*! ***************************************!*\
  !*** ./src/utils/mediakeys-helper.js ***!
  \***************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = (function () { return typeof window !== 'undefined' && window.navigator && window.navigator.requestMediaKeySystemAccess ? window.navigator.requestMediaKeySystemAccess.bind(window.navigator) : null }()); t.requestMediaKeySystemAccess = i },
        './src/utils/mediasource-helper.js':
        /*! *****************************************!*\
  !*** ./src/utils/mediasource-helper.js ***!
  \*****************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; function i () { if (typeof window !== 'undefined') return window.MediaSource || window.WebKitMediaSource }Object.defineProperty(t, '__esModule', { value: !0 }), t.getMediaSource = i },
        './src/utils/output-filter.js':
        /*! ************************************!*\
  !*** ./src/utils/output-filter.js ***!
  \************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = (function () { function e (e, t) { this.timelineController = e, this.trackName = t, this.startTime = null, this.endTime = null, this.screen = null } return e.prototype.dispatchCue = function () { this.startTime !== null && (this.timelineController.addCues(this.trackName, this.startTime, this.endTime, this.screen), this.startTime = null) }, e.prototype.newCue = function (e, t, r) { (this.startTime === null || this.startTime > e) && (this.startTime = e), this.endTime = t, this.screen = r, this.timelineController.createCaptionsTrack(this.trackName) }, e }()); t.default = i },
        './src/utils/texttrack-utils.js':
        /*! **************************************!*\
  !*** ./src/utils/texttrack-utils.js ***!
  \**************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; function i (e, t) { var r = null; try { r = new window.Event('addtrack') } catch (i) { r = document.createEvent('Event'), r.initEvent('addtrack', !1, !1) }r.track = e, t.dispatchEvent(r) } function n (e) { if (e && e.cues) while (e.cues.length > 0)e.removeCue(e.cues[0]) }Object.defineProperty(t, '__esModule', { value: !0 }), t.sendAddTrackEvent = i, t.clearCurrentCues = n },
        './src/utils/time-ranges.js':
        /*! **********************************!*\
  !*** ./src/utils/time-ranges.js ***!
  \**********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = { toString: function (e) { for (var t = '', r = e.length, i = 0; i < r; i++)t += '[' + e.start(i).toFixed(3) + ',' + e.end(i).toFixed(3) + ']'; return t } }; t.default = i },
        './src/utils/vttcue.js':
        /*! *****************************!*\
  !*** ./src/utils/vttcue.js ***!
  \*****************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }), t.default = (function () { if (typeof window !== 'undefined' && window.VTTCue) return window.VTTCue; var e = 'auto'; var t = { '': !0, lr: !0, rl: !0 }; var r = { start: !0, middle: !0, end: !0, left: !0, right: !0 }; function i (e) { if (typeof e !== 'string') return !1; var r = t[e.toLowerCase()]; return !!r && e.toLowerCase() } function n (e) { if (typeof e !== 'string') return !1; var t = r[e.toLowerCase()]; return !!t && e.toLowerCase() } function a (e) { for (var t = 1; t < arguments.length; t++) { var r = arguments[t]; for (var i in r)e[i] = r[i] } return e } function o (t, r, o) { var s = this; var l = (function () { if (typeof navigator !== 'undefined') return /MSIE\s8\.0/.test(navigator.userAgent) }()); var u = {}; l ? s = document.createElement('custom') : u.enumerable = !0, s.hasBeenReset = !1; var c = ''; var d = !1; var f = t; var h = r; var p = o; var g = null; var v = ''; var y = !0; var m = 'auto'; var b = 'start'; var E = 50; var _ = 'middle'; var S = 50; var T = 'middle'; if (Object.defineProperty(s, 'id', a({}, u, { get: function () { return c }, set: function (e) { c = '' + e } })), Object.defineProperty(s, 'pauseOnExit', a({}, u, { get: function () { return d }, set: function (e) { d = !!e } })), Object.defineProperty(s, 'startTime', a({}, u, { get: function () { return f }, set: function (e) { if (typeof e !== 'number') throw new TypeError('Start time must be set to a number.'); f = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'endTime', a({}, u, { get: function () { return h }, set: function (e) { if (typeof e !== 'number') throw new TypeError('End time must be set to a number.'); h = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'text', a({}, u, { get: function () { return p }, set: function (e) { p = '' + e, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'region', a({}, u, { get: function () { return g }, set: function (e) { g = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'vertical', a({}, u, { get: function () { return v }, set: function (e) { var t = i(e); if (!1 === t) throw new SyntaxError('An invalid or illegal string was specified.'); v = t, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'snapToLines', a({}, u, { get: function () { return y }, set: function (e) { y = !!e, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'line', a({}, u, { get: function () { return m }, set: function (t) { if (typeof t !== 'number' && t !== e) throw new SyntaxError('An invalid number or illegal string was specified.'); m = t, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'lineAlign', a({}, u, { get: function () { return b }, set: function (e) { var t = n(e); if (!t) throw new SyntaxError('An invalid or illegal string was specified.'); b = t, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'position', a({}, u, { get: function () { return E }, set: function (e) { if (e < 0 || e > 100) throw new Error('Position must be between 0 and 100.'); E = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'positionAlign', a({}, u, { get: function () { return _ }, set: function (e) { var t = n(e); if (!t) throw new SyntaxError('An invalid or illegal string was specified.'); _ = t, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'size', a({}, u, { get: function () { return S }, set: function (e) { if (e < 0 || e > 100) throw new Error('Size must be between 0 and 100.'); S = e, this.hasBeenReset = !0 } })), Object.defineProperty(s, 'align', a({}, u, { get: function () { return T }, set: function (e) { var t = n(e); if (!t) throw new SyntaxError('An invalid or illegal string was specified.'); T = t, this.hasBeenReset = !0 } })), s.displayState = void 0, l) return s } return o.prototype.getCueAsHTML = function () { var e = window.WebVTT; return e.convertCueToDOMTree(window, this.text) }, o }()) },
        './src/utils/vttparser.js':
        /*! ********************************!*\
  !*** ./src/utils/vttparser.js ***!
  \********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./vttcue */'./src/utils/vttcue.js'); var n = function () { return { decode: function (e) { if (!e) return ''; if (typeof e !== 'string') throw new Error('Error - expected string data.'); return decodeURIComponent(encodeURIComponent(e)) } } }; function a () { this.window = window, this.state = 'INITIAL', this.buffer = '', this.decoder = new n(), this.regionList = [] } function o (e) { function t (e, t, r, i) { return 3600 * (0 | e) + 60 * (0 | t) + (0 | r) + (0 | i) / 1e3 } var r = e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/); return r ? r[3] ? t(r[1], r[2], r[3].replace(':', ''), r[4]) : r[1] > 59 ? t(r[1], r[2], 0, r[4]) : t(0, r[1], r[2], r[4]) : null } function s () { this.values = Object.create(null) } function l (e, t, r, i) { var n = i ? e.split(i) : [e]; for (var a in n) if (typeof n[a] === 'string') { var o = n[a].split(r); if (o.length === 2) { var s = o[0]; var l = o[1]; t(s, l) } } }s.prototype = { set: function (e, t) { this.get(e) || t === '' || (this.values[e] = t) }, get: function (e, t, r) { return r ? this.has(e) ? this.values[e] : t[r] : this.has(e) ? this.values[e] : t }, has: function (e) { return e in this.values }, alt: function (e, t, r) { for (var i = 0; i < r.length; ++i) if (t === r[i]) { this.set(e, t); break } }, integer: function (e, t) { /^-?\d+$/.test(t) && this.set(e, parseInt(t, 10)) }, percent: function (e, t) { return !!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/) && (t = parseFloat(t), t >= 0 && t <= 100)) && (this.set(e, t), !0) } }; var u = new i.default(0, 0, 0); var c = u.align === 'middle' ? 'middle' : 'center'; function d (e, t, r) { var i = e; function n () { var t = o(e); if (t === null) throw new Error('Malformed timestamp: ' + i); return e = e.replace(/^[^\sa-zA-Z-]+/, ''), t } function a (e, t) { var i = new s(); l(e, function (e, t) { switch (e) { case 'region':for (var n = r.length - 1; n >= 0; n--) if (r[n].id === t) { i.set(e, r[n].region); break } break; case 'vertical':i.alt(e, t, ['rl', 'lr']); break; case 'line':var a = t.split(','); var o = a[0]; i.integer(e, o), i.percent(e, o) && i.set('snapToLines', !1), i.alt(e, o, ['auto']), a.length === 2 && i.alt('lineAlign', a[1], ['start', c, 'end']); break; case 'position':a = t.split(','), i.percent(e, a[0]), a.length === 2 && i.alt('positionAlign', a[1], ['start', c, 'end', 'line-left', 'line-right', 'auto']); break; case 'size':i.percent(e, t); break; case 'align':i.alt(e, t, ['start', c, 'end', 'left', 'right']); break } }, /:/, /\s/), t.region = i.get('region', null), t.vertical = i.get('vertical', ''); var n = i.get('line', 'auto'); n === 'auto' && u.line === -1 && (n = -1), t.line = n, t.lineAlign = i.get('lineAlign', 'start'), t.snapToLines = i.get('snapToLines', !0), t.size = i.get('size', 100), t.align = i.get('align', c); var a = i.get('position', 'auto'); a === 'auto' && u.position === 50 && (a = t.align === 'start' || t.align === 'left' ? 0 : t.align === 'end' || t.align === 'right' ? 100 : 50), t.position = a } function d () { e = e.replace(/^\s+/, '') } if (d(), t.startTime = n(), d(), e.substr(0, 3) !== '--\x3e') throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): " + i); e = e.substr(3), d(), t.endTime = n(), d(), a(e, t) } function f (e) { return e.replace(/<br(?: \/)?>/gi, '\n') }t.fixLineBreaks = f, a.prototype = { parse: function (e) { var t = this; function r () { var e = t.buffer; var r = 0; e = f(e); while (r < e.length && e[r] !== '\r' && e[r] !== '\n')++r; var i = e.substr(0, r); return e[r] === '\r' && ++r, e[r] === '\n' && ++r, t.buffer = e.substr(r), i } function n (e) { l(e, function (e, t) { switch (e) { case 'Region':break } }, /:/) }e && (t.buffer += t.decoder.decode(e, { stream: !0 })); try { var a = void 0; if (t.state === 'INITIAL') { if (!/\r\n|\n/.test(t.buffer)) return this; a = r(); var o = a.match(/^(ï»¿)?WEBVTT([ \t].*)?$/); if (!o || !o[0]) throw new Error('Malformed WebVTT signature.'); t.state = 'HEADER' } var s = !1; while (t.buffer) { if (!/\r\n|\n/.test(t.buffer)) return this; switch (s ? s = !1 : a = r(), t.state) { case 'HEADER':/:/.test(a) ? n(a) : a || (t.state = 'ID'); continue; case 'NOTE':a || (t.state = 'ID'); continue; case 'ID':if (/^NOTE($|[ \t])/.test(a)) { t.state = 'NOTE'; break } if (!a) continue; if (t.cue = new i.default(0, 0, ''), t.state = 'CUE', a.indexOf('--\x3e') === -1) { t.cue.id = a; continue } case 'CUE':try { d(a, t.cue, t.regionList) } catch (c) { t.cue = null, t.state = 'BADCUE'; continue }t.state = 'CUETEXT'; continue; case 'CUETEXT':var u = a.indexOf('--\x3e') !== -1; if (!a || u && (s = !0)) { t.oncue && t.oncue(t.cue), t.cue = null, t.state = 'ID'; continue }t.cue.text && (t.cue.text += '\n'), t.cue.text += a; continue; case 'BADCUE':a || (t.state = 'ID'); continue } } } catch (c) { t.state === 'CUETEXT' && t.cue && t.oncue && t.oncue(t.cue), t.cue = null, t.state = t.state === 'INITIAL' ? 'BADWEBVTT' : 'BADCUE' } return this }, flush: function () { var e = this; try { if (e.buffer += e.decoder.decode(), (e.cue || e.state === 'HEADER') && (e.buffer += '\n\n', e.parse()), e.state === 'INITIAL') throw new Error('Malformed WebVTT signature.') } catch (t) { throw t } return e.onflush && e.onflush(), this } }, t.default = a },
        './src/utils/webvtt-parser.js':
        /*! ************************************!*\
  !*** ./src/utils/webvtt-parser.js ***!
  \************************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; (function (e) { Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ./vttparser */'./src/utils/vttparser.js'); var n = r(/*! ../demux/id3 */'./src/demux/id3.js'); var a = function (e, t, r) { return e.substr(r || 0, t.length) === t }; var o = function (t) { var r = parseInt(t.substr(-3)); var i = parseInt(t.substr(-6, 2)); var n = parseInt(t.substr(-9, 2)); var a = t.length > 9 ? parseInt(t.substr(0, t.indexOf(':'))) : 0; return e.isFinite(r) && e.isFinite(i) && e.isFinite(n) && e.isFinite(a) ? (r += 1e3 * i, r += 6e4 * n, r += 36e5 * a, r) : -1 }; var s = function (e) { var t = 5381; var r = e.length; while (r)t = 33 * t ^ e.charCodeAt(--r); return (t >>> 0).toString() }; var l = function (e, t, r) { var i = e[t]; var n = e[i.prevCC]; if (!n || !n.new && i.new) return e.ccOffset = e.presentationOffset = i.start, void (i.new = !1); while (n && n.new)e.ccOffset += i.start - n.start, i.new = !1, i = n, n = e[i.prevCC]; e.presentationOffset = r }; var u = { parse: function (e, t, r, u, c, d) { var f; var h = /\r\n|\n\r|\n|\r/g; var p = n.utf8ArrayToStr(new Uint8Array(e)).trim().replace(h, '\n').split('\n'); var g = '00:00.000'; var v = 0; var y = 0; var m = 0; var b = []; var E = !0; var _ = new i.default(); _.oncue = function (e) { var t = r[u]; var i = r.ccOffset; t && t.new && (void 0 !== y ? i = r.ccOffset = t.start : l(r, u, m)), m && (i = m - r.presentationOffset), e.startTime += i - y, e.endTime += i - y, e.id = s(e.startTime.toString()) + s(e.endTime.toString()) + s(e.text), e.text = decodeURIComponent(encodeURIComponent(e.text)), e.endTime > 0 && b.push(e) }, _.onparsingerror = function (e) { f = e }, _.onflush = function () { f && d ? d(f) : c(b) }, p.forEach(function (e) { if (E) { if (a(e, 'X-TIMESTAMP-MAP=')) { E = !1, e.substr(16).split(',').forEach(function (e) { a(e, 'LOCAL:') ? g = e.substr(6) : a(e, 'MPEGTS:') && (v = parseInt(e.substr(7))) }); try { t + (9e4 * r[u].start || 0) < 0 && (t += 8589934592), v -= t, y = o(g) / 1e3, m = v / 9e4, y === -1 && (f = new Error('Malformed X-TIMESTAMP-MAP: ' + e)) } catch (i) { f = new Error('Malformed X-TIMESTAMP-MAP: ' + e) } return }e === '' && (E = !1) }_.parse(e + '\n') }), _.flush() } }; t.default = u }).call(this, r(/*! ./src/polyfills/number */'./src/polyfills/number.js')['Number']) },
        './src/utils/xhr-loader.js':
        /*! *********************************!*\
  !*** ./src/utils/xhr-loader.js ***!
  \*********************************/
        /*! no static exports found */
        /*! ModuleConcatenation bailout: Module is not an ECMAScript module */function (e, t, r) { 'use strict'; Object.defineProperty(t, '__esModule', { value: !0 }); var i = r(/*! ../utils/logger */'./src/utils/logger.js'); var n = window.performance; var a = window.XMLHttpRequest; var o = (function () { function e (e) { e && e.xhrSetup && (this.xhrSetup = e.xhrSetup) } return e.prototype.destroy = function () { this.abort(), this.loader = null }, e.prototype.abort = function () { var e = this.loader; e && e.readyState !== 4 && (this.stats.aborted = !0, e.abort()), window.clearTimeout(this.requestTimeout), this.requestTimeout = null, window.clearTimeout(this.retryTimeout), this.retryTimeout = null }, e.prototype.load = function (e, t, r) { this.context = e, this.config = t, this.callbacks = r, this.stats = { trequest: n.now(), retry: 0 }, this.retryDelay = t.retryDelay, this.loadInternal() }, e.prototype.loadInternal = function () { var e; var t = this.context; e = this.loader = new a(); var r = this.stats; r.tfirst = 0, r.loaded = 0; var i = this.xhrSetup; try { if (i) try { i(e, t.url) } catch (n) { e.open('GET', t.url, !0), i(e, t.url) }e.readyState || e.open('GET', t.url, !0) } catch (n) { return void this.callbacks.onError({ code: e.status, text: n.message }, t, e) }t.rangeEnd && e.setRequestHeader('Range', 'bytes=' + t.rangeStart + '-' + (t.rangeEnd - 1)), e.onreadystatechange = this.readystatechange.bind(this), e.onprogress = this.loadprogress.bind(this), e.responseType = t.responseType, this.requestTimeout = window.setTimeout(this.loadtimeout.bind(this), this.config.timeout), e.send() }, e.prototype.readystatechange = function (e) { var t = e.currentTarget; var r = t.readyState; var a = this.stats; var o = this.context; var s = this.config; if (!a.aborted && r >= 2) if (window.clearTimeout(this.requestTimeout), a.tfirst === 0 && (a.tfirst = Math.max(n.now(), a.trequest)), r === 4) { var l = t.status; if (l >= 200 && l < 300) { a.tload = Math.max(a.tfirst, n.now()); var u = void 0; var c = void 0; o.responseType === 'arraybuffer' ? (u = t.response, c = u.byteLength) : (u = t.responseText, c = u.length), a.loaded = a.total = c; var d = { url: t.responseURL, data: u }; this.callbacks.onSuccess(d, a, o, t) } else a.retry >= s.maxRetry || l >= 400 && l < 499 ? (i.logger.error(l + ' while loading ' + o.url), this.callbacks.onError({ code: l, text: t.statusText }, o, t)) : (i.logger.warn(l + ' while loading ' + o.url + ', retrying in ' + this.retryDelay + '...'), this.destroy(), this.retryTimeout = window.setTimeout(this.loadInternal.bind(this), this.retryDelay), this.retryDelay = Math.min(2 * this.retryDelay, s.maxRetryDelay), a.retry++) } else this.requestTimeout = window.setTimeout(this.loadtimeout.bind(this), s.timeout) }, e.prototype.loadtimeout = function () { i.logger.warn('timeout while loading ' + this.context.url), this.callbacks.onTimeout(this.stats, this.context, null) }, e.prototype.loadprogress = function (e) { var t = e.currentTarget; var r = this.stats; r.loaded = e.loaded, e.lengthComputable && (r.total = e.total); var i = this.callbacks.onProgress; i && i(r, this.context, null, t) }, e }()); t.default = o } }))['default']
      }))
    },
    f6fd: function (e, t) { (function (e) { var t = 'currentScript'; var r = e.getElementsByTagName('script'); t in e || Object.defineProperty(e, t, { get: function () { try { throw new Error() } catch (i) { var e; var t = (/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(i.stack) || [!1])[1]; for (e in r) if (r[e].src == t || r[e].readyState == 'interactive') return r[e]; return null } } }) })(document) },
    faa1: function (e, t, r) { 'use strict'; var i; var n = typeof Reflect === 'object' ? Reflect : null; var a = n && typeof n.apply === 'function' ? n.apply : function (e, t, r) { return Function.prototype.apply.call(e, t, r) }; function o (e) { console && console.warn && console.warn(e) }i = n && typeof n.ownKeys === 'function' ? n.ownKeys : Object.getOwnPropertySymbols ? function (e) { return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)) } : function (e) { return Object.getOwnPropertyNames(e) }; var s = Number.isNaN || function (e) { return e !== e }; function l () { l.init.call(this) }e.exports = l, l.EventEmitter = l, l.prototype._events = void 0, l.prototype._eventsCount = 0, l.prototype._maxListeners = void 0; var u = 10; function c (e) { return void 0 === e._maxListeners ? l.defaultMaxListeners : e._maxListeners } function d (e, t, r, i) { var n, a, s; if (typeof r !== 'function') throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof r); if (a = e._events, void 0 === a ? (a = e._events = Object.create(null), e._eventsCount = 0) : (void 0 !== a.newListener && (e.emit('newListener', t, r.listener ? r.listener : r), a = e._events), s = a[t]), void 0 === s)s = a[t] = r, ++e._eventsCount; else if (typeof s === 'function' ? s = a[t] = i ? [r, s] : [s, r] : i ? s.unshift(r) : s.push(r), n = c(e), n > 0 && s.length > n && !s.warned) { s.warned = !0; var l = new Error('Possible EventEmitter memory leak detected. ' + s.length + ' ' + String(t) + ' listeners added. Use emitter.setMaxListeners() to increase limit'); l.name = 'MaxListenersExceededWarning', l.emitter = e, l.type = t, l.count = s.length, o(l) } return e } function f () { for (var e = [], t = 0; t < arguments.length; t++)e.push(arguments[t]); this.fired || (this.target.removeListener(this.type, this.wrapFn), this.fired = !0, a(this.listener, this.target, e)) } function h (e, t, r) { var i = { fired: !1, wrapFn: void 0, target: e, type: t, listener: r }; var n = f.bind(i); return n.listener = r, i.wrapFn = n, n } function p (e, t, r) { var i = e._events; if (void 0 === i) return []; var n = i[t]; return void 0 === n ? [] : typeof n === 'function' ? r ? [n.listener || n] : [n] : r ? m(n) : v(n, n.length) } function g (e) { var t = this._events; if (void 0 !== t) { var r = t[e]; if (typeof r === 'function') return 1; if (void 0 !== r) return r.length } return 0 } function v (e, t) { for (var r = new Array(t), i = 0; i < t; ++i)r[i] = e[i]; return r } function y (e, t) { for (;t + 1 < e.length; t++)e[t] = e[t + 1]; e.pop() } function m (e) { for (var t = new Array(e.length), r = 0; r < t.length; ++r)t[r] = e[r].listener || e[r]; return t }Object.defineProperty(l, 'defaultMaxListeners', { enumerable: !0, get: function () { return u }, set: function (e) { if (typeof e !== 'number' || e < 0 || s(e)) throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + e + '.'); u = e } }), l.init = function () { void 0 !== this._events && this._events !== Object.getPrototypeOf(this)._events || (this._events = Object.create(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0 }, l.prototype.setMaxListeners = function (e) { if (typeof e !== 'number' || e < 0 || s(e)) throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + e + '.'); return this._maxListeners = e, this }, l.prototype.getMaxListeners = function () { return c(this) }, l.prototype.emit = function (e) { for (var t = [], r = 1; r < arguments.length; r++)t.push(arguments[r]); var i = e === 'error'; var n = this._events; if (void 0 !== n)i = i && void 0 === n.error; else if (!i) return !1; if (i) { var o; if (t.length > 0 && (o = t[0]), o instanceof Error) throw o; var s = new Error('Unhandled error.' + (o ? ' (' + o.message + ')' : '')); throw s.context = o, s } var l = n[e]; if (void 0 === l) return !1; if (typeof l === 'function')a(l, this, t); else { var u = l.length; var c = v(l, u); for (r = 0; r < u; ++r)a(c[r], this, t) } return !0 }, l.prototype.addListener = function (e, t) { return d(this, e, t, !1) }, l.prototype.on = l.prototype.addListener, l.prototype.prependListener = function (e, t) { return d(this, e, t, !0) }, l.prototype.once = function (e, t) { if (typeof t !== 'function') throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof t); return this.on(e, h(this, e, t)), this }, l.prototype.prependOnceListener = function (e, t) { if (typeof t !== 'function') throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof t); return this.prependListener(e, h(this, e, t)), this }, l.prototype.removeListener = function (e, t) { var r, i, n, a, o; if (typeof t !== 'function') throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof t); if (i = this._events, void 0 === i) return this; if (r = i[e], void 0 === r) return this; if (r === t || r.listener === t)--this._eventsCount === 0 ? this._events = Object.create(null) : (delete i[e], i.removeListener && this.emit('removeListener', e, r.listener || t)); else if (typeof r !== 'function') { for (n = -1, a = r.length - 1; a >= 0; a--) if (r[a] === t || r[a].listener === t) { o = r[a].listener, n = a; break } if (n < 0) return this; n === 0 ? r.shift() : y(r, n), r.length === 1 && (i[e] = r[0]), void 0 !== i.removeListener && this.emit('removeListener', e, o || t) } return this }, l.prototype.off = l.prototype.removeListener, l.prototype.removeAllListeners = function (e) { var t, r, i; if (r = this._events, void 0 === r) return this; if (void 0 === r.removeListener) return arguments.length === 0 ? (this._events = Object.create(null), this._eventsCount = 0) : void 0 !== r[e] && (--this._eventsCount === 0 ? this._events = Object.create(null) : delete r[e]), this; if (arguments.length === 0) { var n; var a = Object.keys(r); for (i = 0; i < a.length; ++i)n = a[i], n !== 'removeListener' && this.removeAllListeners(n); return this.removeAllListeners('removeListener'), this._events = Object.create(null), this._eventsCount = 0, this } if (t = r[e], typeof t === 'function') this.removeListener(e, t); else if (void 0 !== t) for (i = t.length - 1; i >= 0; i--) this.removeListener(e, t[i]); return this }, l.prototype.listeners = function (e) { return p(this, e, !0) }, l.prototype.rawListeners = function (e) { return p(this, e, !1) }, l.listenerCount = function (e, t) { return typeof e.listenerCount === 'function' ? e.listenerCount(t) : g.call(e, t) }, l.prototype.listenerCount = g, l.prototype.eventNames = function () { return this._eventsCount > 0 ? i(this._events) : [] } },
    fae3: function (e, t, r) { 'use strict'; var i; (r.r(t), typeof window !== 'undefined') && (r('f6fd'), (i = window.document.currentScript) && (i = i.src.match(/(.+\/)[^\/]+\.js(\?.*)?$/)) && (r.p = i[1])); var n = r('a34a'); var a = r.n(n); var o = (r('1441'), r('ba56')); var s = r.n(o); var l = r('5fe9'); var u = r.n(l); function c (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function d (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function f (e, t, r) { return t && d(e.prototype, t), r && d(e, r), e } var h = (function () { function e (t) { c(this, e), this.layerHideDelay = 200, this.bottomOffset = 40, this.hideTimeout = -1, this._isShow = !1, this.ui = t, this.player = t.player } return f(e, [{ key: 'init', value: function () { var e = this; var t = function () { clearTimeout(e.hideTimeout), e.ui.isMouseInUI = !0, e.showLayer() }; var r = function () { e.ui.isMouseInUI = !1, clearTimeout(e.hideTimeout), e.hideTimeout = setTimeout(function () { e.hideLayer() }, e.layerHideDelay) }; this.$btn.addEventListener('mouseenter', t), this.$btn.addEventListener('mouseleave', r), this.$layer.addEventListener('mouseenter', t), this.$layer.addEventListener('mouseleave', r) } }, { key: 'showLayer', value: function () { this._isShow = !0, this.$layer.classList.add('show'), this.updateLayerPosition() } }, { key: 'hideLayer', value: function () { this._isShow = !1, this.$layer.classList.remove('show') } }, { key: 'toggleLayer', value: function () { this._isShow ? this.hideLayer() : this.showLayer() } }, { key: 'showButton', value: function () { this.$btn.style.display = '' } }, { key: 'hideButton', value: function () { this.$btn.style.display = 'none' } }, { key: 'updateLayerPosition', value: function () { if (this._isShow) { var e = this.ui.player.$root.getBoundingClientRect(); var t = this.$btn.getBoundingClientRect(); var r = this.$layer.getBoundingClientRect(); var i = t.left + t.width / 2 - e.left - r.width / 2; this.$layer.style.left = i + 'px', this.$layer.style.bottom = this.bottomOffset + 'px' } } }, { key: 'destroy', value: function () { clearTimeout(this.hideTimeout) } }, { key: 'isShow', get: function () { return this._isShow } }]), e }()); function p (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function g (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function v (e, t, r) { return t && g(e.prototype, t), r && g(e, r), e } var y = (function () { function e (t) { p(this, e), this.$root = t, this.$use = this.$root.querySelector('use') } return v(e, [{ key: 'switch', value: function (e, t) { this.switchIcon(e), t && this.switchTitle(t) } }, { key: 'switchIcon', value: function (e) { this.$use.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + this.$root.getAttribute(e)) } }, { key: 'switchTitle', value: function (e) { this.$root.setAttribute('title', this.$root.getAttribute(e)) } }]), e }()); function m (e) { return m = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (e) { return typeof e } : function (e) { return e && typeof Symbol === 'function' && e.constructor === Symbol && e !== Symbol.prototype ? 'symbol' : typeof e }, m(e) } function b (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function E (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function _ (e, t, r) { return t && E(e.prototype, t), r && E(e, r), e } function S (e, t) { return !t || m(t) !== 'object' && typeof t !== 'function' ? T(e) : t } function T (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function w (e, t, r) { return w = typeof Reflect !== 'undefined' && Reflect.get ? Reflect.get : function (e, t, r) { var i = A(e, t); if (i) { var n = Object.getOwnPropertyDescriptor(i, t); return n.get ? n.get.call(r) : n.value } }, w(e, t, r || e) } function A (e, t) { while (!Object.prototype.hasOwnProperty.call(e, t)) if (e = L(e), e === null) break; return e } function L (e) { return L = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, L(e) } function R (e, t) { if (typeof t !== 'function' && t !== null) throw new TypeError('Super expression must either be null or a function'); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && k(e, t) } function k (e, t) { return k = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, k(e, t) }u.a.enableBoundaryChecking(!1); var D = (function (e) { function t (e) { var r; b(this, t), r = S(this, L(t).call(this, e)), r.volumeValue = 0, r.areaHeight = 0, r.$video = r.player.$video, r.$video.addEventListener('volumechange', function () { return r.updateController() }), r.$layer = r.player.$root.querySelector('.interactive-layer .volume-bar'), r.$valueLabel = r.$layer.querySelector('.volume-num-label'), r.$btn = r.player.$root.querySelector('.interactive-layer .buttons .button.volume'), r.btn = new y(r.$btn), r.$btn.addEventListener('click', function () { return r.toggleMuted() }), r.$dragArea = r.$layer.querySelector('.volume-column-bar'), r.$controller = r.$dragArea.querySelector('.bar-controller'), r.$current = r.$dragArea.querySelector('.bar-current'), r.volumeValue = r.$video.volume = r.player.options.volume, r.volumeValue === 0 && (r.volumeValue = 0.7); var i = function (e) { var t = e.pageY; var i = r.$dragArea.getBoundingClientRect(); if (t < i.top)r.$video.volume = 1; else if (t > i.bottom)r.$video.volume = 0; else { var n = i.bottom - i.top; t -= i.top; var a = t / n; r.$video.volume = u.a.round(1 - a, 2) }r.volumeValue = r.$video.volume, r.updateController() }; var n = function e (t) { document.removeEventListener('mousemove', i), document.removeEventListener('mouseup', e), i(t) }; return r.$dragArea.addEventListener('mousedown', function () { document.addEventListener('mousemove', i), document.addEventListener('mouseup', n) }), r.init(), r.updateController(), r } return R(t, e), _(t, [{ key: 'up', value: function () { this.$video.volume <= 0.9 ? this.$video.volume = u.a.plus(this.$video.volume, 0.1) : this.$video.volume = 1, this.volumeValue = this.$video.volume } }, { key: 'down', value: function () { this.$video.volume >= 0.1 ? this.$video.volume = u.a.minus(this.$video.volume, 0.1) : this.$video.volume = 0, this.volumeValue = this.$video.volume } }, { key: 'toggleMuted', value: function () { this.$video.volume > 0 ? this.$video.volume = 0 : this.volumeValue === 0 ? this.$video.volume = 1 : this.$video.volume = this.volumeValue, this.updateButton() } }, { key: 'updateButton', value: function () { var e; e = this.$video.volume > 0 ? 'data-on' : 'data-off', this.btn.switch(e) } }, { key: 'updateController', value: function () { var e = u.a.round(100 * this.$video.volume, 0); this.$valueLabel.innerText = e.toString(); var t = this.$video.volume * this.areaHeight; this.$current.style.height = t + 'px', t = this.areaHeight - t, this.$controller.style.transform = 'translateY('.concat(t, 'px)'), this.updateButton() } }, { key: 'showLayer', value: function () { w(L(t.prototype), 'showLayer', this).call(this), this.areaHeight = this.$dragArea.clientHeight, this.updateController() } }, { key: 'update', value: function () { this.$controller.style.background = this.$current.style.background = this.player.options.color } }]), t }(h)); function O (e) { return O = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (e) { return typeof e } : function (e) { return e && typeof Symbol === 'function' && e.constructor === Symbol && e !== Symbol.prototype ? 'symbol' : typeof e }, O(e) } function P (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function I (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function x (e, t, r) { return t && I(e.prototype, t), r && I(e, r), e } function C (e, t) { return !t || O(t) !== 'object' && typeof t !== 'function' ? F(e) : t } function F (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function M (e, t, r) { return M = typeof Reflect !== 'undefined' && Reflect.get ? Reflect.get : function (e, t, r) { var i = j(e, t); if (i) { var n = Object.getOwnPropertyDescriptor(i, t); return n.get ? n.get.call(r) : n.value } }, M(e, t, r || e) } function j (e, t) { while (!Object.prototype.hasOwnProperty.call(e, t)) if (e = N(e), e === null) break; return e } function N (e) { return N = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, N(e) } function B (e, t) { if (typeof t !== 'function' && t !== null) throw new TypeError('Super expression must either be null or a function'); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && U(e, t) } function U (e, t) { return U = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, U(e, t) } var G = (function (e) { function t (e) { var r; return P(this, t), r = C(this, N(t).call(this, e)), r.currentLevel = -1, r.$btn = r.player.$root.querySelector('.button.quality'), r.$layer = r.player.$root.querySelector('.float.quality-menu'), r.$autoLevel = document.createElement('div'), r.$autoLevel.innerHTML = '自动', r.$autoLevel.setAttribute('data-value', (-1).toString()), r.init(), r.$layer.addEventListener('click', function (e) { if (e.target) { var t = e.target; if (t.hasAttribute('data-value')) { var i = parseInt(t.getAttribute('data-value')); console.log('click', i), r.player.hls && (r.player.hls.currentLevel = r.player.hls.loadLevel = i, r.currentLevel = i) } }r.updateButton(), r.hideLayer() }), r } return B(t, e), x(t, [{ key: 'showButton', value: function () { this.$btn.style.display = '' } }, { key: 'hideButton', value: function () { this.$btn.style.display = 'none' } }, { key: 'showLayer', value: function () { M(N(t.prototype), 'showLayer', this).call(this), this._updateLevel(), this.updateLayerPosition() } }, { key: 'updateButton', value: function () { var e = '自动'; this.currentLevel > -1 && this.hls.levels[this.hls.loadLevel] && (e = this.hls.levels[this.hls.loadLevel].name + 'p'), this.$btn.innerText = e } }, { key: '_updateLevel', value: function () { var e = this; this.$layer.innerHTML = '', this.hls.levels.forEach(function (t, r) { if (t.name) { var i = document.createElement('div'); r === e.currentLevel && i.classList.add('current'), i.innerText = t.name + 'P', i.setAttribute('data-value', r.toString()), e.$layer.append(i) } }), this.currentLevel === -1 ? this.$autoLevel.classList.add('current') : this.$autoLevel.classList.remove('current'), this.$layer.append(this.$autoLevel) } }, { key: 'updateLevel', value: function (e) { this.hls = e, this._updateLevel(), this.updateLayerPosition(), this.updateButton() } }]), t }(h)); function $ (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function K (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function H (e, t, r) { return t && K(e.prototype, t), r && K(e, r), e } var Y; var W = (function () { function e (t) { var r = this; $(this, e), this.barWidth = 0, this._currentTime = 0, this.percent = 0, this.offsetWidth = 0, this.player = t.player, this.ui = t, this.$root = this.player.$root.querySelector('.progress-bar'), this.$controller = this.$root.querySelector('.bar-controller'), this.$current = this.$root.querySelector('.bar-current'), this.$time = this.player.$root.querySelector('.controller-bottom-bar .time'), this.$buffer = this.$root.querySelector('.bar-buffer'), this.player.$video.addEventListener('timeupdate', function () { r._currentTime = r.player.$video.currentTime, r.percent = r._currentTime / r.player.$video.duration, r.time(), r.update() }), this.player.$video.addEventListener('progress', function () { r.updateBufferBar(), r.time() }); var i = function (e) { var t = r.player.$root.getBoundingClientRect(); var i = e.pageX - t.left - r.offsetWidth / 2; i < 0 ? i = 0 : i > r.barWidth && (i = r.barWidth), r.percent = i / r.barWidth, r.player.$video.currentTime = r.percent * r.player.$video.duration, r.update(), r.ui.isMouseInUI = !0 }; var n = function e () { document.removeEventListener('mousemove', i), document.removeEventListener('mouseup', e) }; this.$root.addEventListener('mousedown', function () { document.addEventListener('mousemove', i), document.addEventListener('mouseup', n) }), this.$root.addEventListener('click', i), this.offsetWidth = this.player.width - this.$root.clientWidth, this.resize() } return H(e, [{ key: 'time', value: function () { this.player.options.live || (this.$time.innerText = e.getTimeString(this.player.$video.currentTime) + ' / ' + e.getTimeString(this.player.$video.duration)) } }, { key: 'resize', value: function () { this.barWidth = this.player.width - this.offsetWidth, this.update(), this.updateBufferBar() } }, { key: 'update', value: function () { var e = this.barWidth * this.percent; this.$current.style.width = e + 'px', this.$controller.style.transform = 'translateX('.concat(e, 'px)'), this.$controller.style.background = this.player.options.color, this.$current.style.background = this.player.options.color } }, { key: 'resetTimeZone', value: function () { this.player.options.live ? this.$time.innerText = '直播' : this.$time.innerText = '' } }, { key: 'updateBufferBar', value: function () { for (var e = 0; e < this.player.$video.buffered.length; e++) { var t = this.player.$video.buffered.start(e); var r = this.player.$video.buffered.end(e); t < this._currentTime && this._currentTime < r && (this.$buffer.style.width = r / this.player.$video.duration * this.barWidth + 'px') } } }], [{ key: 'getTimeString', value: function (e) { var t = []; var r = Math.floor(e / 3600); return r > 0 && (r.toString().length === 1 && (r = '0' + r), t.push(r)), r = Math.floor(e / 60) - 60 * Math.floor(e / 3600), r.toString().length === 1 && (r = '0' + r), t.push(r), r = Math.floor(e) - 60 * Math.floor(e / 60), r.toString().length === 1 && (r = '0' + r), t.push(r), t.join(':') } }]), e }()); function q (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function V (e) { var t = e.currentTime; var r = void 0 === t ? 0 : t; var i = e.borderColor; var n = void 0 === i ? '' : i; var a = e.fill; var o = void 0 === a ? '#ffffff' : a; var s = e.type; var l = void 0 === s ? Y.Flow : s; var u = e.id; var c = void 0 === u ? '' : u; var d = e.fontSize; var f = void 0 === d ? 28 : d; return { currentTime: r, type: l, borderColor: n, fill: o, id: c, fontSize: f } }(function (e) { e[e['Top'] = 0] = 'Top', e[e['Flow'] = 1] = 'Flow', e[e['Bottom'] = 2] = 'Bottom' })(Y || (Y = {})); var z = function e (t, r) { q(this, e), this.text = t, Object.assign(this, V(r || {})) }; function X (e) { return X = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (e) { return typeof e } : function (e) { return e && typeof Symbol === 'function' && e.constructor === Symbol && e !== Symbol.prototype ? 'symbol' : typeof e }, X(e) } function Q (e, t) { return !t || X(t) !== 'object' && typeof t !== 'function' ? Z(e) : t } function Z (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function J (e) { return J = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, J(e) } function ee (e, t) { if (typeof t !== 'function' && t !== null) throw new TypeError('Super expression must either be null or a function'); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && te(e, t) } function te (e, t) { return te = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, te(e, t) } function re (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function ie (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function ne (e, t, r) { return t && ie(e.prototype, t), r && ie(e, r), e } var ae = 'px "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif'; var oe = (function () { function e () { re(this, e), this.top = 0, this.left = 0, this.width = 0, this.height = 0, this.enable = !1, this.selfCanvas = document.createElement('canvas'), this.selfCanvas.width = 100, this.selfCanvas.height = 100, this.ctx = this.selfCanvas.getContext('2d') } return ne(e, [{ key: 'getSize', value: function () { this.ctx.textBaseline = 'top', this.ctx.textAlign = 'left', this.ctx.font = this.danmaku.fontSize + ae, this.width = this.ctx.measureText(this.danmaku.text).width, this.height = 1.2 * this.ctx.measureText('M').width } }, { key: 'draw', value: function () { var e = this.width + 4; var t = this.height; this.selfCanvas.width = e, this.selfCanvas.height = t, this.ctx.textBaseline = 'top', this.ctx.textAlign = 'left', this.ctx.font = this.danmaku.fontSize + ae, this.ctx.clearRect(0, 0, e, t), this.danmaku.borderColor && (this.ctx.strokeStyle = this.danmaku.borderColor, this.ctx.strokeRect(1, 1, e - 4, t - 4)), this.ctx.strokeStyle = '#000000', this.ctx.strokeText(this.danmaku.text, 1, 1), this.ctx.fillStyle = this.danmaku.fill, this.ctx.fillText(this.danmaku.text, 1, 1) } }]), e }()); var se = (function (e) { function t () { return re(this, t), Q(this, J(t).apply(this, arguments)) } return ee(t, e), ne(t, [{ key: 'set', value: function (e, t, r) { this.danmaku = e, this.enable = !0, this.left = t, this.top = r, this.getSize(), this.draw() } }, { key: 'update', value: function (e, t, r) { var i = (e + this.width) / t * r; this.left = this.left - i, this.enable = this.left + this.width > 0 } }]), t }(oe)); var le = (function (e) { function t () { var e; return re(this, t), e = Q(this, J(t).apply(this, arguments)), e.timeout = 0, e } return ee(t, e), ne(t, [{ key: 'set', value: function (e, t, r, i) { this.danmaku = e, this.timeout = t, this.enable = !0, this.getSize(), this.left = (r - this.width) / 2, this.top = i, this.draw(), this.update(0) } }, { key: 'update', value: function (e) { console.log({ timeout: this.timeout, lastFrameTime: e }), this.timeout -= e, this.enable = this.timeout > 0 } }]), t }(oe)); var ue = r('faa1'); function ce (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function de (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function fe (e, t, r) { return t && de(e.prototype, t), r && de(e, r), e } var he; var pe = 'px "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif'; var ge = (function () { function e (t) { ce(this, e), this.caches = [], this.player = t, this.$canvas = t.$root.querySelector('canvas'), this.ctx = this.$canvas.getContext('2d'), this.$canvas.addEventListener('click', function () { t.toggle() }) } return fe(e, [{ key: 'addDrawer', value: function (e) { this.caches.push(e) } }, { key: 'removeDrawer', value: function (e) { var t = this.caches.indexOf(e); t > -1 && this.caches.splice(t, 1) } }, { key: 'renderAll', value: function () { if (this.clear(), this.caches.length > 0) for (var e = 0; e < this.caches.length; e++) { var t = this.caches[e]; this.ctx.drawImage(t.selfCanvas, t.left, t.top) } } }, { key: 'clear', value: function () { this.ctx.clearRect(0, 0, this.player.width, this.player.height) } }, { key: 'clearCache', value: function () { this.caches.length = 0 } }, { key: 'fontHeight', value: function (e) { this.ctx.font = e + pe; var t = this.ctx.measureText('M'); return 1.2 * t.width } }, { key: 'fontWidth', value: function (e) { this.ctx.font = e.danmaku.fontSize + pe; var t = this.ctx.measureText(e.danmaku.text); return t.width } }, { key: 'resize', value: function () { this.$canvas.setAttribute('width', this.player.width + 'px'), this.$canvas.setAttribute('height', this.player.height + 'px') } }, { key: 'alpha', set: function (e) { this.ctx.globalAlpha = e } }]), e }()); function ve (e) { return be(e) || me(e) || ye() } function ye () { throw new TypeError('Invalid attempt to spread non-iterable instance') } function me (e) { if (Symbol.iterator in Object(e) || Object.prototype.toString.call(e) === '[object Arguments]') return Array.from(e) } function be (e) { if (Array.isArray(e)) { for (var t = 0, r = new Array(e.length); t < e.length; t++)r[t] = e[t]; return r } } function Ee (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function _e (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function Se (e, t, r) { return t && _e(e.prototype, t), r && _e(e, r), e }(function (e) { e[e['UnLimited'] = 0] = 'UnLimited', e[e['UnOverlap'] = 1] = 'UnOverlap', e[e['Percent25'] = 0.25] = 'Percent25', e[e['Half'] = 0.5] = 'Half', e[e['Percent75'] = 0.25] = 'Percent75' })(he || (he = {})); var Te = '<div class="content"></div><div class="buttons"><span class="copy">复制</span></div>'; function we (e, t, r) { var i = document.createElement('div'); i.innerHTML = Te; var n = i.querySelector('.content'); n.innerText = e.danmaku.text; var a = i.querySelector('.buttons'); for (var o in t) { var s = document.createElement('span'); s.innerText = o, s.onclick = t[o], a.prepend(s) } var l = i.querySelector('.copy'); return l && l.addEventListener('click', function () { return r(e.danmaku.text) }), i } function Ae () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; var t = e.alpha; var r = void 0 === t ? 1 : t; var i = e.enable; var n = void 0 === i || i; var a = e.flowDuration; var o = void 0 === a ? 8 : a; var s = e.fadeoutDuration; var l = void 0 === s ? 5 : s; var u = e.limit; var c = void 0 === u ? he.UnOverlap : u; var d = e.contextMenu; var f = void 0 === d ? void 0 : d; return { alpha: r, enable: n, flowDuration: o, limit: c, fadeoutDuration: l, contextMenu: f } } var Le = (function () { function e (t) { var r = this; Ee(this, e), this.danmakus = [], this.showed = [], this.topEnables = [], this.topAndBottomDisables = [], this.bottomEnables = [], this.flowEnables = [], this.flowDisables = [], this.lineHeights = [], this.topLines = {}, this.bottomLines = {}, this.flowLines = {}, this.displayArea = 0, this.topY = 0, this.flowY = 0, this.bottomY = 0, this.frameTime = 0, this.calcDanmakuTime = 0, this.isShow = !0, this.width = 0, this.height = 0, this.calcTopInterval = -1, this.destroied = !1, this.addDanmakuToCanvasTime = 0, this.lastFrame = 0, this.player = t, this.event = new ue['EventEmitter'](), this.canvas = new ge(t); var i = function e () { document.removeEventListener('click', e), document.removeEventListener('contextmenu', e), r.$menu.remove() }; this.canvas.$canvas.addEventListener('contextmenu', function (e) { var t = r.findDrawers(e); if (t.length > 0) { r.createDanmakuMenu(t); var n = e.pageX; var a = e.pageY; var o = e.clientX + r.$menu.clientWidth; var s = e.clientY + r.$menu.clientHeight; o > document.body.clientWidth && (n -= o - document.body.clientWidth), s > document.body.clientHeight && (a -= s - document.body.clientHeight), r.$menu.style.left = n + 'px', r.$menu.style.top = a + 'px', document.addEventListener('click', i), document.addEventListener('touchstart', i), document.addEventListener('contextmenu', i) } return e.preventDefault(), e.stopPropagation(), !1 }), this.player.$video.addEventListener('seeked', function () { r.clear() }), this.player.options.danmaku.enable ? this.show() : this.hide(), this.loop() } return Se(e, [{ key: 'createDanmakuMenu', value: function (e) { var t = this; this.$menu && this.$menu.remove(), this.$menu = document.createElement('div'), this.$menu.className = 'float show danmaku-context-menu'; for (var r = 0; r < e.length; r++) { var i = e[r]; if (this.player.options.danmaku.contextMenu) { var n = we(i, this.player.options.danmaku.contextMenu(i), function (e) { return t.copyText(e) }); this.$menu.append(n) } }document.body.append(this.$menu) } }, { key: 'show', value: function () { this.isShow = !0 } }, { key: 'hide', value: function () { this.isShow = !1, this.canvas.clear() } }, { key: 'clear', value: function () { var e, t; this.showed.length = 0, this.canvas.clear(), this.canvas.clearCache(), (e = this.topAndBottomDisables).push.apply(e, ve(this.topEnables)), this.topEnables.length = 0, (t = this.flowDisables).push.apply(t, ve(this.flowEnables)), this.flowEnables.length = 0 } }, { key: 'resize', value: function () { this.width = this.player.$root.clientWidth, this.height = this.player.$root.clientHeight, this.lineHeight = Math.round(this.canvas.fontHeight(this.player.options.fontSize)), this.lineHeights.length = 0; for (var e = 0; e < window.screen.height; e++) { var t = e * this.lineHeight; if (t > window.screen.height) break; this.lineHeights.push(t), this.topLines.hasOwnProperty(t) || (this.topLines[t] = null), this.bottomLines.hasOwnProperty(t) || (this.bottomLines[t] = []), this.flowLines.hasOwnProperty(t) || (this.flowLines[t] = []) } this.canvas.resize(); var r = this.player.options.danmaku.limit; r === he.Percent75 ? this.displayArea = 0.75 * this.player.height : r === he.Half ? this.displayArea = 0.5 * this.player.height : r === he.Percent25 ? this.displayArea = 0.25 * this.player.height : this.displayArea = this.player.height, this.canvas.alpha = this.player.options.danmaku.alpha, this.canvas.renderAll() } }, { key: 'toggle', value: function () { this.isShow ? this.hide() : this.show() } }, { key: 'send', value: function (e) { e.text = e.text.trim(), this.danmakus.push(e) } }, { key: 'findDrawers', value: function (t) { return [].concat(ve(this.topEnables.filter(function (r) { return e.find(t, r) })), ve(this.bottomEnables.filter(function (r) { return e.find(t, r) })), ve(this.flowEnables.filter(function (r) { return e.find(t, r) }))) } }, { key: 'addDanmakuToCanvas', value: function () { if (this.danmakus.length !== 0) for (var e = 0; e < this.danmakus.length; e++) { var t = this.danmakus[e]; var r = Math.abs(this.player.currentTime - t.currentTime); if (!this.showed.includes(t) && !(r > 0.1)) { this.showed.push(t); if (t.type === Y.Flow) { var i = this.flowDisables.shift() || new se(); i.enable = !0, i.set(t, this.width, this.calcFlowTop(i)), i.update(this.width, this.player.options.danmaku.flowDuration, 0), this.flowEnables.push(i), this.canvas.addDrawer(i) } else { var n = this.topAndBottomDisables.shift() || new le(); if (n.enable = !0, t.type === Y.Top)n.set(t, this.player.options.danmaku.fadeoutDuration, this.width, this.calcTopTop(n)), this.topEnables.push(n); else { var a = this.calcBottomTop(n) + this.lineHeight; a = this.height - a, n.set(t, this.player.options.danmaku.fadeoutDuration, this.width, a), this.bottomEnables.push(n) }n.update(0), this.canvas.addDrawer(n) } this.canvas.renderAll() } } } }, { key: 'copyText', value: function (e) { this.$input || (this.$input = this.player.$root.querySelector('input.copy-tool')), this.$input.value = e, this.$input.select(), document.execCommand('copy') } }, { key: 'calcFlowTop', value: function (e) { for (var t in this.flowLines) { var r = this.flowLines[t]; var i = Number(t); var n = r.left + r.width; if (!(r && r.enable && n > this.width)) { if (i > this.displayArea) break; return console.log('发现空行', t), this.flowLines[t] = e, this.flowY = i, i } } return this.flowY += this.lineHeight, this.flowY > this.displayArea && (this.flowY = 0), this.flowLines[this.flowY] = e, this.flowY } }, { key: 'calcTopTop', value: function (e) { for (var t in this.topLines) { var r = this.topLines[t]; var i = Number(t); if (!r || !r.enable) { if (i > this.displayArea) break; return console.log('发现空行', t), this.topLines[t] = e, this.topY = i, i } } return this.topY += this.lineHeight, this.topY > this.displayArea && (this.topY = 0), this.topLines[this.topY] = e, this.topY } }, { key: 'calcBottomTop', value: function (e) { for (var t in this.bottomLines) { var r = this.bottomLines[t]; var i = Number(t); if (!r || !r.enable) { if (i > this.displayArea) break; return console.log('发现空行', t), this.bottomLines[t] = e, this.bottomY = i, i } } return this.bottomY += this.lineHeight, this.bottomY > this.displayArea && (this.bottomY = 0), this.bottomLines[this.bottomY] = e, this.bottomY } }, { key: 'drawDanmaku', value: function () { var e = this; this.topEnables = this.topEnables.filter(function (t) { return t.enable ? (t.update(e.frameTime), !0) : (e.canvas.removeDrawer(t), e.topAndBottomDisables.push(t), !1) }), this.bottomEnables = this.bottomEnables.filter(function (t) { return t.enable ? (t.update(e.frameTime), !0) : (e.canvas.removeDrawer(t), e.topAndBottomDisables.push(t), !1) }), this.flowEnables = this.flowEnables.filter(function (t) { return t.enable ? (t.update(e.width, e.player.options.danmaku.flowDuration, e.frameTime), !0) : (e.canvas.removeDrawer(t), e.flowDisables.push(t), !1) }) } }, { key: 'loop', value: function () { var e = this; this.destroied || (this.addDanmakuToCanvas(), this.addDanmakuToCanvasTime = (Date.now() - this.lastFrame) / 1e3, this.player.paused || (this.drawDanmaku(), this.calcDanmakuTime = (Date.now() - this.lastFrame) / 1e3, this.isShow ? this.canvas.renderAll() : this.canvas.clear()), this.frameTime = (Date.now() - this.lastFrame) / 1e3, this.lastFrame = Date.now(), window.requestAnimationFrame(function () { e.loop() })) } }, { key: 'destroy', value: function () { this.destroied = !0, clearInterval(this.calcTopInterval), this.$menu && this.$menu.remove() } }, { key: 'debug', get: function () { return { isShow: this.isShow, all: this.danmakus.length, showed: this.showed.length, time: { addDanmakuToCanvas: this.addDanmakuToCanvasTime, drawDanmaku: this.calcDanmakuTime, frameTime: this.frameTime }, 'on screen danmakus': { top: this.topEnables.length, bottom: this.bottomEnables.length, flow: this.flowEnables.length }, 'danmaku pool': { fixed: this.topAndBottomDisables.length, flow: this.flowDisables.length }, positionY: { top: this.topY, flow: this.flowY, bottom: this.bottomY } } } }], [{ key: 'find', value: function (e, t) { return e.offsetX > t.left && e.offsetX < t.left + t.width && e.offsetY > t.top && e.offsetY < t.top + t.height } }]), e }()); function Re (e) { return Re = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (e) { return typeof e } : function (e) { return e && typeof Symbol === 'function' && e.constructor === Symbol && e !== Symbol.prototype ? 'symbol' : typeof e }, Re(e) } function ke (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function De (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function Oe (e, t, r) { return t && De(e.prototype, t), r && De(e, r), e } function Pe (e, t) { return !t || Re(t) !== 'object' && typeof t !== 'function' ? Ie(e) : t } function Ie (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function xe (e) { return xe = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, xe(e) } function Ce (e, t) { if (typeof t !== 'function' && t !== null) throw new TypeError('Super expression must either be null or a function'); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && Fe(e, t) } function Fe (e, t) { return Fe = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, Fe(e, t) } var Me = '<div>类型\n<div class="types">\n  <div class="type" data-type="1"><div><svg class="icon"><use xlink:href="#danplayer-danmugundongkai"></use></svg></div>流动</div>\n  <div class="type" data-type="0"><div><svg class="icon"><use xlink:href="#danplayer-danmudingbukai"></use></svg></div>顶部</div>\n  <div class="type" data-type="2"><div><svg class="icon"><use xlink:href="#danplayer-danmudibukai"></use></svg></div>底部</div>\n</div>\n</div>\n<div>颜色\n<div class="colors">\n{colors}\n</div>\n</div>'; var je = (function (e) { function t (e) { var r; return ke(this, t), r = Pe(this, xe(t).call(this, e)), r.fill = '#ffffff', r.type = Y.Flow, r.$layer = r.player.$root.querySelector('.float.danmaku-style-layer'), r.$btn = r.player.$root.querySelector('.intern-button.danmaku-style'), r.$layer.innerHTML = Me.replace('{colors}', t.colors.map(function (e) { return '<span style="background: '.concat(e, '" data-color="').concat(e, '"></span>') }).join('')), r.init(), r.$types = Array.from(r.$layer.querySelectorAll('.types > .type')), r.$colors = Array.from(r.$layer.querySelectorAll('.colors > span')), r.$types.forEach(function (e) { return e.addEventListener('click', function () { r.$types.forEach(function (e) { return e.classList.remove('selected') }), e.classList.add('selected'), r.type = Number(e.getAttribute('data-type')) }) }), r.$colors.forEach(function (e) { return e.addEventListener('click', function () { r.$colors.forEach(function (e) { return e.classList.remove('selected') }), e.classList.add('selected'), r.fill = e.getAttribute('data-color') }) }), r.$types[0].classList.add('selected'), r.$colors[r.$colors.length - 1].classList.add('selected'), r } return Ce(t, e), Oe(t, [{ key: 'getStyle', value: function () { return { fill: this.fill, type: this.type, borderColor: 'white' } } }]), t }(h)); function Ne (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function Be (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function Ue (e, t, r) { return t && Be(e.prototype, t), r && Be(e, r), e }je.colors = ['#FE0302', '#FF7204', '#FFAA02', '#FFD302', '#FFFF00', '#A0EE00', '#00CD00', '#019899', '#4266BE', '#89D5FF', '#CC0273', '#222222', '#9B9B9B', '#FFFFFF']; var Ge = (function () { function e (t) { var r = this; Ne(this, e), this.isShow = !1, this.ui = t, this.styleLayer = new je(t), this.$root = t.player.$root.querySelector('.danmaku-form'), this.$input = this.$root.querySelector('input'), this.$btn = this.$root.querySelector('.send'), this.$btn.addEventListener('click', function () { return r.send() }), this.$input.addEventListener('keypress', function (e) { e.key === 'Enter' && r.ui.isShow && r.$input.value && r.send() }), this.$input.addEventListener('keydown', function (e) { (e.key.startsWith('Arrow') || e.key === ' ') && e.stopPropagation() }), this.$input.addEventListener('keyup', function (e) { e.key === 'Escape' && (r.ui.player.$root.focus(), r.ui.hide()), e.stopPropagation() }), this.$input.addEventListener('focus', function () { r.ui.isMouseInUI = !0 }), this.$input.addEventListener('blur', function () { r.ui.isMouseInUI = !1 }) } return Ue(e, [{ key: 'send', value: function () { var e = this.styleLayer.getStyle(); e.currentTime = this.ui.player.currentTime, this.ui.danmakuLayer.send(new z(this.$input.value, e)), this.$input.value = '', this.ui.player.$root.focus() } }, { key: 'toggle', value: function () { this.isShow ? this.hide() : this.show() } }, { key: 'show', value: function () { this.isShow = !0, this.$root.style.display = '' } }, { key: 'hide', value: function () { this.isShow = !1, this.$root.style.display = 'none' } }, { key: 'update', value: function () {} }, { key: 'focus', value: function () { this.$input.focus() } }]), e }()); function $e (e) { return Ye(e) || He(e) || Ke() } function Ke () { throw new TypeError('Invalid attempt to spread non-iterable instance') } function He (e) { if (Symbol.iterator in Object(e) || Object.prototype.toString.call(e) === '[object Arguments]') return Array.from(e) } function Ye (e) { if (Array.isArray(e)) { for (var t = 0, r = new Array(e.length); t < e.length; t++)r[t] = e[t]; return r } } function We (e, t, r, i, n, a, o) { try { var s = e[a](o); var l = s.value } catch (u) { return void r(u) }s.done ? t(l) : Promise.resolve(l).then(i, n) } function qe (e) { return function () { var t = this; var r = arguments; return new Promise(function (i, n) { var a = e.apply(t, r); function o (e) { We(a, i, n, o, s, 'next', e) } function s (e) { We(a, i, n, o, s, 'throw', e) }o(void 0) }) } } function Ve (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function ze (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function Xe (e, t, r) { return t && ze(e.prototype, t), r && ze(e, r), e } var Qe = (function () { function e (t) { var r = this; Ve(this, e), this._isMouseInUI = !1, this.isShow = !1, this.extraButtons = [], this.hideTimeout = -1, this.player = t, this.$root = t.$root.querySelector('.interactive-layer .controller-bottom-bar'), this.$root.addEventListener('mouseenter', function () { r.isMouseInUI = !0 }), this.$root.addEventListener('mouseleave', function () { r.isMouseInUI = !1 }), this.$gradientBG = t.$root.querySelector('.bg-gradient'), this.volume = new D(this), this.qualitySelector = new G(this), this.progressBar = new W(this), this.styleLayer = new je(this), this.danmakuForm = new Ge(this), this.$controllerButtonsRightLayout = this.$root.querySelector('.buttons .right'), this.btnFullScreen = new y(this.$root.querySelector('.button.full-screen')), this.btnFullScreen.$root.addEventListener('click', qe(a.a.mark(function e () { return a.a.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:return e.next = 2, r.player.toggleFullScreen(); case 2:r.updateFullScreenButton(); case 3:case 'end':return e.stop() } }, e) }))), this.btnPlay = new y(this.$root.querySelector('.button.play')), this.btnPlay.$root.addEventListener('click', function () { r.player.toggle(), r.updatePlayButton() }), this.btnShowDanmaku = new y(this.$root.querySelector('.button.toggle-danamaku')), this.btnShowDanmaku.$root.addEventListener('click', function () { r.danmakuLayer.toggle(), r.updateDanmakuButton() }), this.danmakuLayer = new Le(t), this.insertExtraButtons() } return Xe(e, [{ key: 'show', value: function () { this.isShow = !0, this.$root.classList.add('show'), this.$gradientBG.classList.add('show') } }, { key: 'hide', value: function () { this.isShow = !1, this.$root.classList.remove('show'), this.$gradientBG.classList.remove('show'), this.qualitySelector.hideLayer(), this.volume.hideLayer(), this.danmakuForm.styleLayer.hideLayer(), this.player.$root.focus() } }, { key: 'hideUIDelay', value: function () { var e = this; return this.cancelHideUIDelay(), new Promise(function (t) { e.hideTimeout = window.setTimeout(function () { e.hide(), t() }, e.player.options.uiFadeOutDelay) }) } }, { key: 'cancelHideUIDelay', value: function () { clearTimeout(this.hideTimeout) } }, { key: 'clearExtraButtons', value: function () { this.extraButtons.forEach(function (e) { return e.remove() }), this.extraButtons.length = 0 } }, { key: 'insertExtraButtons', value: function () { var e, t; (this.clearExtraButtons(), this.player.options.extraButtons) && (this.player.options.extraButtons.forEach(function (e) { e.classList.add('button'), e.classList.remove('intern-button') }), (e = this.$controllerButtonsRightLayout).prepend.apply(e, $e(this.player.options.extraButtons)), (t = this.extraButtons).push.apply(t, $e(this.player.options.extraButtons))) } }, { key: 'update', value: function () { this.updateDanmakuButton(), this.updateFullScreenButton(), this.updatePlayButton(), this.danmakuForm.update(), this.progressBar.update(), this.volume.update() } }, { key: 'updatePlayButton', value: function () { this.player.paused ? this.btnPlay.switch('data-on', 'data-on-title') : this.btnPlay.switch('data-off', 'data-off-title') } }, { key: 'updateFullScreenButton', value: function () { this.player.isFullScreen ? this.btnFullScreen.switch('data-off', 'data-off-title') : this.btnFullScreen.switch('data-on', 'data-on-title') } }, { key: 'updateDanmakuButton', value: function () { var e, t; this.danmakuLayer.isShow ? (e = 'data-off', t = 'data-off-title') : (e = 'data-on', t = 'data-on-title'), this.btnShowDanmaku.switch(e, t) } }, { key: 'resize', value: function () { this.volume.isShow && this.volume.updateLayerPosition(), this.qualitySelector.isShow && this.qualitySelector.updateLayerPosition(), this.progressBar.resize(), this.danmakuLayer.resize() } }, { key: 'destroy', value: function () { clearTimeout(this.hideTimeout), this.danmakuLayer.destroy(), this.qualitySelector.destroy(), this.volume.destroy() } }, { key: 'isMouseInUI', set: function (e) { this._isMouseInUI = e, this.cancelHideUIDelay() }, get: function () { return this._isMouseInUI } }, { key: 'debug', get: function () { return { isShow: this.isShow, isMouseInUI: this._isMouseInUI, danmakuLayer: this.danmakuLayer.debug } } }]), e }()); function Ze (e) { return tt(e) || et(e) || Je() } function Je () { throw new TypeError('Invalid attempt to spread non-iterable instance') } function et (e) { if (Symbol.iterator in Object(e) || Object.prototype.toString.call(e) === '[object Arguments]') return Array.from(e) } function tt (e) { if (Array.isArray(e)) { for (var t = 0, r = new Array(e.length); t < e.length; t++)r[t] = e[t]; return r } } function rt (e, t, r, i, n, a, o) { try { var s = e[a](o); var l = s.value } catch (u) { return void r(u) }s.done ? t(l) : Promise.resolve(l).then(i, n) } function it (e) { return function () { var t = this; var r = arguments; return new Promise(function (i, n) { var a = e.apply(t, r); function o (e) { rt(a, i, n, o, s, 'next', e) } function s (e) { rt(a, i, n, o, s, 'throw', e) }o(void 0) }) } } function nt (e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') } function at (e, t) { for (var r = 0; r < t.length; r++) { var i = t[r]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(e, i.key, i) } } function ot (e, t, r) { return t && at(e.prototype, t), r && at(e, r), e } var st; var lt = '//at.alicdn.com/t/font_1373341_m9a3piei0s.js'; var ut = '{video-layer}\n<input class="copy-tool" />\n<div class="interactive-layer">\n  <canvas class="danmaku-layer"></canvas>\n  \n  <div class="bg-gradient show"></div>\n  \n  \n  <div class="float danmaku-style-layer"></div>\n  \n  <div class="float volume-bar">\n    <div class="volume-num-label"></div>\n    <div class="volume-column-bar">\n      <div class="bar-ui bar-full"></div>\n      <div class="bar-ui bar-current"></div>\n      <div class="bar-controller"></div>\n    </div>\n  </div>\n  \n  <div class="float quality-menu"></div>\n  \n  <div class="controller-bottom-bar">\n    <div class="progress-bar live-hide">\n      <div class="bar-full"></div>\n      <div class="bar-buffer"></div>\n      <div class="bar-current"></div>\n      <div class="bar-controller"></div>    \n    </div>\n    \n    <div class="buttons">\n      <div class="left">\n        <div class="button intern-button play" data-on="danplayer-bofang" data-off="danplayer-zanting"\n          data-on-title="播放视频" data-off-title="暂停播放">\n          <svg class="icon" aria-hidden="true"><use xlink:href="#danplayer-bofang"></use></svg>\n        </div>\n        <div class="time"></div>\n      </div>\n      \n      <div class="middle danmaku-form">\n        <div class="button intern-button danmaku-style">\n          <svg class="icon"><use xlink:href="#danplayer-style"></use></svg>\n        </div>\n        <input placeholder="输入弹幕内容" tabindex="1">\n        <div class="send">发送</div>\n      </div>\n      <div class="right">\n      \n        <div class="button intern-button volume" data-on="danplayer-yinliang" data-off="danplayer-jingyin" title="音量">\n          <svg class="icon"><use xlink:href="#danplayer-yinliang"></use></svg>\n        </div>\n        \n        <div class="button intern-button toggle-danamaku" title="隐藏弹幕"\n          data-on="danplayer-danmukai" data-off="danplayer-danmuguan" \n          data-on-title="显示弹幕" data-off-title="隐藏弹幕">\n          <svg class="icon"><use xlink:href="#danplayer-danmukai"></use></svg>\n        </div>\n        \n        <div class="button quality" title="切换画质"></div>\n        \n        <div class="button intern-button full-screen" data-on="danplayer-quanping" data-off="danplayer-zuixiaohua"\n        data-on-title="全屏观看" data-off-title="取消全屏">\n          <svg class="icon"><use xlink:href="#danplayer-quanping"></use></svg>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'; function ct (e) { var t = e.autoplay; var r = void 0 !== t && t; var i = e.color; var n = void 0 === i ? '#00a1d6' : i; var a = e.live; var o = void 0 !== a && a; var s = e.volume; var l = void 0 === s ? 0.7 : s; var u = e.fontSize; var c = void 0 === u ? 28 : u; var d = e.width; var f = void 0 === d ? 600 : d; var h = e.height; var p = void 0 === h ? 350 : h; var g = e.uiFadeOutDelay; var v = void 0 === g ? 3e3 : g; var y = e.extraButtons; var m = void 0 === y ? [] : y; var b = e.src; var E = void 0 === b ? '' : b; var _ = e.iconSrc; var S = void 0 === _ ? lt : _; var T = e.danmakuForm; var w = void 0 === T || T; var A = e.fullScreen; var L = void 0 === A || A; var R = e.danmaku; var k = void 0 === R ? {} : R; var D = e.onlyOne; var O = void 0 !== D && D; return { autoplay: r, color: n, live: o, fontSize: c, height: p, danmaku: Ae(k), danmakuForm: w, fullScreen: L, src: E, iconSrc: S, uiFadeOutDelay: v, extraButtons: m, onlyOne: O, volume: l, width: f } }(function (e) { e[e['Normal'] = 0] = 'Normal', e[e['Hls'] = 1] = 'Hls', e[e['Dash'] = 2] = 'Dash' })(st || (st = {})); var dt = (function () { function e (t, r) { var i = this; if (nt(this, e), this.type = st.Normal, this._width = '', this._height = '', this.isFullScreen = !1, this._duration = 0, this._loading = !0, this._paused = !0, this.delayResize = -1, !document.querySelector('script#danplayer-icon')) { var n = document.createElement('script'); n.src = lt, n.id = 'danplayer-icon', document.body.append(n) }e.instances.push(this); var a = t.parentElement; this.$root = document.createElement('div'), this.$root.setAttribute('tabIndex', '0'), this.$root.classList.add('video-player'), a.insertBefore(this.$root, t), t.classList.add('video-layer'), t.removeAttribute('id'), this.$root.innerHTML = ut.replace('{video-layer}', t.outerHTML), t.remove(), this.$root.addEventListener('keypress', function (e) { var t = !0; e.key === 'Enter' ? (i.ui.show(), i.ui.danmakuForm.focus()) : t = !1, t && (e.stopPropagation(), e.preventDefault()) }), this.$root.addEventListener('keyup', function (e) { e.key === ' ' && i.toggle() }), document.addEventListener('fullscreenchange', function () { i.isFullScreen = document.fullscreenElement === i.$root, i.ui.updateFullScreenButton() }), this.$root.addEventListener('keydown', function (e) { var t = !0; e.key !== 'ArrowLeft' || i.options.live ? e.key !== 'ArrowRight' || i.options.live ? e.key === 'ArrowUp' ? i.ui.volume.up() : e.key === 'ArrowDown' ? i.ui.volume.down() : t = !1 : i.$video.currentTime += 5 : i.$video.currentTime -= 5, t && (e.stopPropagation(), e.preventDefault()) }), this.$root.addEventListener('mousemove', function () { if (i.$root.classList.remove('mouse-idle'), i.ui.show(), i.paused);else { if (i.ui.isMouseInUI) return; i.ui.hideUIDelay().then(function () { i.$root.classList.add('mouse-idle') }) } }), this.$root.addEventListener('mouseenter', function () { i.ui.show(), i.ui.cancelHideUIDelay() }), this.$root.addEventListener('mouseleave', function () { i.ui.hide(), i.ui.cancelHideUIDelay() }), this.$video = this.$root.querySelector('.video-layer'), this.$video.removeAttribute('controls'), this.$video.addEventListener('durationchange', function () { i._duration = i.$video.duration }), this.$video.addEventListener('playing', function () { return i.ui.hideUIDelay() }), this.$video.addEventListener('play', function () { return i.ui.updatePlayButton() }), this.$video.addEventListener('pause', function () { return i.ui.updatePlayButton() }), window.addEventListener('resize', function () { return i.resizeEvt(1e3) }), this.options = ct(r || { autoplay: this.$video.hasAttribute('autoplay') }), this.ui = new Qe(this), this.ui.update(), this._setSrc().then(), this._setUI() } return ot(e, [{ key: '_setSrc', value: (function () { var e = it(a.a.mark(function e () { var t = this; return a.a.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:return this.options.src && this.$video.setAttribute('src', this.options.src), e.next = 3, this.getContentType(); case 3:this.ui.qualitySelector.hideButton(), this.hls && (this.hls.on(s.a.Events.LEVEL_LOADED, function () { t.ui.qualitySelector.updateLevel(t.hls) }), this.ui.qualitySelector.showButton()), console.log('_set', { autoplay: this.options.autoplay, paused: this._paused }), !this.options.autoplay && this.paused || (console.log('_set 播放'), this.play()), this.options.live ? this.$root.classList.add('live') : this.$root.classList.remove('live'); case 8:case 'end':return e.stop() } }, e, this) })); function t () { return e.apply(this, arguments) } return t }()) }, { key: '_setUI', value: function () { this.ui.insertExtraButtons(), this.ui.update(), this.ui.progressBar.resize(), this.ui.progressBar.resetTimeZone(), this.resize() } }, { key: 'set', value: function (e) { e.danmaku = Object.assign({}, this.options.danmaku, e.danmaku); var t = Object.assign({}, this.options, e); var r = t.src !== this.options.src || this.options.live !== t.live; this.options = t, r && (this.hls && (this.hls.detachMedia(), this.hls = void 0), this._setSrc().then()), this._setUI() } }, { key: 'resize', value: function () { this.options.width && (typeof this.options.width === 'number' || parseInt(this.options.width).toString() === this.options.width ? this._width = this.options.width + 'px' : this._width = this.options.width), this.options.height && (typeof this.options.height === 'number' || parseInt(this.options.height).toString() === this.options.height ? this._height = this.options.height + 'px' : this._height = this.options.height), this.isFullScreen || (this.$root.style.width = this._width, this.$root.style.height = this._height), this.ui.resize() } }, { key: 'resizeEvt', value: function (e) { var t = this; window.clearTimeout(this.delayResize), this.delayResize = window.setTimeout(function () { t.resize() }, e) } }, { key: 'fillDanmakus', value: function (e) { var t; (t = this.ui.danmakuLayer.danmakus).push.apply(t, Ze(e)) } }, { key: 'sendDanmaku', value: function (e) { this.ui.danmakuLayer.send(e) } }, { key: 'toggle', value: function () { this.paused ? this.play() : this.pause() } }, { key: 'play', value: function () { var t = this; this._paused = !1, this.$video.play().then(), this.options.onlyOne && e.instances.forEach(function (e) { e !== t && e.pause() }) } }, { key: 'pause', value: function () { this._paused = !0, this.$video.pause() } }, { key: 'getContentType', value: (function () { var e = it(a.a.mark(function e () { var t, r, i; return a.a.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:if (t = this.$video.getAttribute('src'), console.log('视频网址', t), t && (t.match(/\.m3u[8]/) && (this.type = st.Hls), t.match(/\.mpd/) && (this.type = st.Dash), this.options.src = t), this.type !== st.Hls) { e.next = 22; break } if (console.log('使用Hls.js'), !s.a.isSupported()) { e.next = 12; break } this.hls = new s.a(), this.hls.config.capLevelToPlayerSize = !0, this.hls.attachMedia(this.$video), this.hls.loadSource(t), e.next = 20; break; case 12:return r = new XMLHttpRequest(), r.open('Get', t), r.send(), e.next = 17, new Promise(function (e) { r.onreadystatechange = function () { r.readyState === XMLHttpRequest.HEADERS_RECEIVED && (r.status === 200 ? e(r.getResponseHeader('Content-Type')) : e(null), r.abort()) } }); case 17:i = e.sent, console.log({ contentType: i }), i && this.$video.canPlayType(i) && (this.options.src = this.$video.src = t); case 20:e.next = 23; break; case 22:this.type === st.Dash && console.log('使用dash.js'); case 23:case 'end':return e.stop() } }, e, this) })); function t () { return e.apply(this, arguments) } return t }()) }, { key: 'toggleFullScreen', value: (function () { var e = it(a.a.mark(function e () { return a.a.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:if (this.isFullScreen = !this.isFullScreen, !this.isFullScreen) { e.next = 6; break } return e.next = 4, this.$root.requestFullscreen(); case 4:e.next = 8; break; case 6:return e.next = 8, document.exitFullscreen(); case 8:this.resize(); case 9:case 'end':return e.stop() } }, e, this) })); function t () { return e.apply(this, arguments) } return t }()) }, { key: 'destroy', value: function () { e.instances.splice(e.instances.indexOf(this), 1), this.ui.destroy(), this.hls && this.hls.detachMedia() } }, { key: 'width', get: function () { return this.$root.clientWidth } }, { key: 'height', get: function () { return this.$root.clientHeight } }, { key: 'loading', get: function () { return this._loading } }, { key: 'currentTime', get: function () { return this.$video.currentTime } }, { key: 'paused', get: function () { return this._paused } }, { key: 'debug', get: function () { var e = '默认'; var t = this.options.src; return this.hls && (e = this.ui.qualitySelector.currentLevel === -1 ? '自动 ' : '', this.hls.currentLevel !== -1 && (e += this.hls.levels[this.hls.currentLevel].name + 'P')), { width: this.width, height: this.height, src: t, quality: e, ui: this.ui.debug } } }]), e }()); dt.instances = [], r.d(t, 'Player', function () { return dt }) } }))
})
// # sourceMappingURL=danplayer.umd.min.js.map
