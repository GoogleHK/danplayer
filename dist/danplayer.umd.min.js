(function (t, e) { typeof exports === 'object' && typeof module === 'object' ? module.exports = e() : typeof define === 'function' && define.amd ? define([], e) : typeof exports === 'object' ? exports['danplayer'] = e() : t['danplayer'] = e() })(typeof self !== 'undefined' ? self : this, function () { return (function (t) { var e = {}; function n (i) { if (e[i]) return e[i].exports; var r = e[i] = { i: i, l: !1, exports: {} }; return t[i].call(r.exports, r, r.exports, n), r.l = !0, r.exports } return n.m = t, n.c = e, n.d = function (t, e, i) { n.o(t, e) || Object.defineProperty(t, e, { enumerable: !0, get: i }) }, n.r = function (t) { typeof Symbol !== 'undefined' && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, { value: 'Module' }), Object.defineProperty(t, '__esModule', { value: !0 }) }, n.t = function (t, e) { if (1 & e && (t = n(t)), 8 & e) return t; if (4 & e && typeof t === 'object' && t && t.__esModule) return t; var i = Object.create(null); if (n.r(i), Object.defineProperty(i, 'default', { enumerable: !0, value: t }), 2 & e && typeof t !== 'string') for (var r in t)n.d(i, r, function (e) { return t[e] }.bind(null, r)); return i }, n.n = function (t) { var e = t && t.__esModule ? function () { return t['default'] } : function () { return t }; return n.d(e, 'a', e), e }, n.o = function (t, e) { return Object.prototype.hasOwnProperty.call(t, e) }, n.p = '', n(n.s = 'fb15') }({ 1441: function (t, e, n) {}, '5fe9': function (t, e, n) { 'use strict'; function i (t, e) { return void 0 === e && (e = 12), +parseFloat(t.toPrecision(e)) } function r (t) { var e = t.toString().split(/[eE]/); var n = (e[0].split('.')[1] || '').length - +(e[1] || 0); return n > 0 ? n : 0 } function o (t) { if (t.toString().indexOf('e') === -1) return Number(t.toString().replace('.', '')); var e = r(t); return e > 0 ? i(t * Math.pow(10, e)) : t } function s (t) { f && (t > Number.MAX_SAFE_INTEGER || t < Number.MIN_SAFE_INTEGER) && console.warn(t + ' is beyond boundary when transfer to integer, the results may not be accurate') } function a (t, e) { for (var n = [], i = 2; i < arguments.length; i++)n[i - 2] = arguments[i]; if (n.length > 0) return a.apply(void 0, [a(t, e), n[0]].concat(n.slice(1))); var u = o(t); var l = o(e); var c = r(t) + r(e); var h = u * l; return s(h), h / Math.pow(10, c) } function u (t, e) { for (var n = [], i = 2; i < arguments.length; i++)n[i - 2] = arguments[i]; if (n.length > 0) return u.apply(void 0, [u(t, e), n[0]].concat(n.slice(1))); var o = Math.pow(10, Math.max(r(t), r(e))); return (a(t, o) + a(e, o)) / o } function l (t, e) { for (var n = [], i = 2; i < arguments.length; i++)n[i - 2] = arguments[i]; if (n.length > 0) return l.apply(void 0, [l(t, e), n[0]].concat(n.slice(1))); var o = Math.pow(10, Math.max(r(t), r(e))); return (a(t, o) - a(e, o)) / o } function c (t, e) { for (var n = [], i = 2; i < arguments.length; i++)n[i - 2] = arguments[i]; if (n.length > 0) return c.apply(void 0, [c(t, e), n[0]].concat(n.slice(1))); var u = o(t); var l = o(e); return s(u), s(l), a(u / l, Math.pow(10, r(e) - r(t))) } function h (t, e) { var n = Math.pow(10, e); return c(Math.round(a(t, n)), n) }Object.defineProperty(e, '__esModule', { value: !0 }); var f = !0; function d (t) { void 0 === t && (t = !0), f = t } var p = { strip: i, plus: u, minus: l, times: a, divide: c, round: h, digitLength: r, float2Fixed: o, enableBoundaryChecking: d }; e.strip = i, e.plus = u, e.minus = l, e.times = a, e.divide = c, e.round = h, e.digitLength = r, e.float2Fixed = o, e.enableBoundaryChecking = d, e['default'] = p }, '96cf': function (t, e, n) { var i = (function (t) { 'use strict'; var e; var n = Object.prototype; var i = n.hasOwnProperty; var r = typeof Symbol === 'function' ? Symbol : {}; var o = r.iterator || '@@iterator'; var s = r.asyncIterator || '@@asyncIterator'; var a = r.toStringTag || '@@toStringTag'; function u (t, e, n, i) { var r = e && e.prototype instanceof v ? e : v; var o = Object.create(r.prototype); var s = new _(i || []); return o._invoke = x(t, n, s), o } function l (t, e, n) { try { return { type: 'normal', arg: t.call(e, n) } } catch (i) { return { type: 'throw', arg: i } } }t.wrap = u; var c = 'suspendedStart'; var h = 'suspendedYield'; var f = 'executing'; var d = 'completed'; var p = {}; function v () {} function y () {} function m () {} var b = {}; b[o] = function () { return this }; var g = Object.getPrototypeOf; var w = g && g(g(O([]))); w && w !== n && i.call(w, o) && (b = w); var k = m.prototype = v.prototype = Object.create(b); function $ (t) { ['next', 'throw', 'return'].forEach(function (e) { t[e] = function (t) { return this._invoke(e, t) } }) } function L (t) { function e (n, r, o, s) { var a = l(t[n], t, r); if (a.type !== 'throw') { var u = a.arg; var c = u.value; return c && typeof c === 'object' && i.call(c, '__await') ? Promise.resolve(c.__await).then(function (t) { e('next', t, o, s) }, function (t) { e('throw', t, o, s) }) : Promise.resolve(c).then(function (t) { u.value = t, o(u) }, function (t) { return e('throw', t, o, s) }) }s(a.arg) } var n; function r (t, i) { function r () { return new Promise(function (n, r) { e(t, i, n, r) }) } return n = n ? n.then(r, r) : r() } this._invoke = r } function x (t, e, n) { var i = c; return function (r, o) { if (i === f) throw new Error('Generator is already running'); if (i === d) { if (r === 'throw') throw o; return j() }n.method = r, n.arg = o; while (1) { var s = n.delegate; if (s) { var a = E(s, n); if (a) { if (a === p) continue; return a } } if (n.method === 'next')n.sent = n._sent = n.arg; else if (n.method === 'throw') { if (i === c) throw i = d, n.arg; n.dispatchException(n.arg) } else n.method === 'return' && n.abrupt('return', n.arg); i = f; var u = l(t, e, n); if (u.type === 'normal') { if (i = n.done ? d : h, u.arg === p) continue; return { value: u.arg, done: n.done } }u.type === 'throw' && (i = d, n.method = 'throw', n.arg = u.arg) } } } function E (t, n) { var i = t.iterator[n.method]; if (i === e) { if (n.delegate = null, n.method === 'throw') { if (t.iterator['return'] && (n.method = 'return', n.arg = e, E(t, n), n.method === 'throw')) return p; n.method = 'throw', n.arg = new TypeError("The iterator does not provide a 'throw' method") } return p } var r = l(i, t.iterator, n.arg); if (r.type === 'throw') return n.method = 'throw', n.arg = r.arg, n.delegate = null, p; var o = r.arg; return o ? o.done ? (n[t.resultName] = o.value, n.next = t.nextLoc, n.method !== 'return' && (n.method = 'next', n.arg = e), n.delegate = null, p) : o : (n.method = 'throw', n.arg = new TypeError('iterator result is not an object'), n.delegate = null, p) } function S (t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e) } function T (t) { var e = t.completion || {}; e.type = 'normal', delete e.arg, t.completion = e } function _ (t) { this.tryEntries = [{ tryLoc: 'root' }], t.forEach(S, this), this.reset(!0) } function O (t) { if (t) { var n = t[o]; if (n) return n.call(t); if (typeof t.next === 'function') return t; if (!isNaN(t.length)) { var r = -1; var s = function n () { while (++r < t.length) if (i.call(t, r)) return n.value = t[r], n.done = !1, n; return n.value = e, n.done = !0, n }; return s.next = s } } return { next: j } } function j () { return { value: e, done: !0 } } return y.prototype = k.constructor = m, m.constructor = y, m[a] = y.displayName = 'GeneratorFunction', t.isGeneratorFunction = function (t) { var e = typeof t === 'function' && t.constructor; return !!e && (e === y || (e.displayName || e.name) === 'GeneratorFunction') }, t.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, m) : (t.__proto__ = m, a in t || (t[a] = 'GeneratorFunction')), t.prototype = Object.create(k), t }, t.awrap = function (t) { return { __await: t } }, $(L.prototype), L.prototype[s] = function () { return this }, t.AsyncIterator = L, t.async = function (e, n, i, r) { var o = new L(u(e, n, i, r)); return t.isGeneratorFunction(n) ? o : o.next().then(function (t) { return t.done ? t.value : o.next() }) }, $(k), k[a] = 'Generator', k[o] = function () { return this }, k.toString = function () { return '[object Generator]' }, t.keys = function (t) { var e = []; for (var n in t)e.push(n); return e.reverse(), function n () { while (e.length) { var i = e.pop(); if (i in t) return n.value = i, n.done = !1, n } return n.done = !0, n } }, t.values = O, _.prototype = { constructor: _, reset: function (t) { if (this.prev = 0, this.next = 0, this.sent = this._sent = e, this.done = !1, this.delegate = null, this.method = 'next', this.arg = e, this.tryEntries.forEach(T), !t) for (var n in this)n.charAt(0) === 't' && i.call(this, n) && !isNaN(+n.slice(1)) && (this[n] = e) }, stop: function () { this.done = !0; var t = this.tryEntries[0]; var e = t.completion; if (e.type === 'throw') throw e.arg; return this.rval }, dispatchException: function (t) { if (this.done) throw t; var n = this; function r (i, r) { return a.type = 'throw', a.arg = t, n.next = i, r && (n.method = 'next', n.arg = e), !!r } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var s = this.tryEntries[o]; var a = s.completion; if (s.tryLoc === 'root') return r('end'); if (s.tryLoc <= this.prev) { var u = i.call(s, 'catchLoc'); var l = i.call(s, 'finallyLoc'); if (u && l) { if (this.prev < s.catchLoc) return r(s.catchLoc, !0); if (this.prev < s.finallyLoc) return r(s.finallyLoc) } else if (u) { if (this.prev < s.catchLoc) return r(s.catchLoc, !0) } else { if (!l) throw new Error('try statement without catch or finally'); if (this.prev < s.finallyLoc) return r(s.finallyLoc) } } } }, abrupt: function (t, e) { for (var n = this.tryEntries.length - 1; n >= 0; --n) { var r = this.tryEntries[n]; if (r.tryLoc <= this.prev && i.call(r, 'finallyLoc') && this.prev < r.finallyLoc) { var o = r; break } }o && (t === 'break' || t === 'continue') && o.tryLoc <= e && e <= o.finallyLoc && (o = null); var s = o ? o.completion : {}; return s.type = t, s.arg = e, o ? (this.method = 'next', this.next = o.finallyLoc, p) : this.complete(s) }, complete: function (t, e) { if (t.type === 'throw') throw t.arg; return t.type === 'break' || t.type === 'continue' ? this.next = t.arg : t.type === 'return' ? (this.rval = this.arg = t.arg, this.method = 'return', this.next = 'end') : t.type === 'normal' && e && (this.next = e), p }, finish: function (t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var n = this.tryEntries[e]; if (n.finallyLoc === t) return this.complete(n.completion, n.afterLoc), T(n), p } }, catch: function (t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var n = this.tryEntries[e]; if (n.tryLoc === t) { var i = n.completion; if (i.type === 'throw') { var r = i.arg; T(n) } return r } } throw new Error('illegal catch attempt') }, delegateYield: function (t, n, i) { return this.delegate = { iterator: O(t), resultName: n, nextLoc: i }, this.method === 'next' && (this.arg = e), p } }, t }(t.exports)); try { regeneratorRuntime = i } catch (r) { Function('r', 'regeneratorRuntime = r')(i) } }, a34a: function (t, e, n) { t.exports = n('96cf') }, f6fd: function (t, e) { (function (t) { var e = 'currentScript'; var n = t.getElementsByTagName('script'); e in t || Object.defineProperty(t, e, { get: function () { try { throw new Error() } catch (i) { var t; var e = (/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(i.stack) || [!1])[1]; for (t in n) if (n[t].src == e || n[t].readyState == 'interactive') return n[t]; return null } } }) })(document) }, faa1: function (t, e, n) { 'use strict'; var i; var r = typeof Reflect === 'object' ? Reflect : null; var o = r && typeof r.apply === 'function' ? r.apply : function (t, e, n) { return Function.prototype.apply.call(t, e, n) }; function s (t) { console && console.warn && console.warn(t) }i = r && typeof r.ownKeys === 'function' ? r.ownKeys : Object.getOwnPropertySymbols ? function (t) { return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)) } : function (t) { return Object.getOwnPropertyNames(t) }; var a = Number.isNaN || function (t) { return t !== t }; function u () { u.init.call(this) }t.exports = u, u.EventEmitter = u, u.prototype._events = void 0, u.prototype._eventsCount = 0, u.prototype._maxListeners = void 0; var l = 10; function c (t) { return void 0 === t._maxListeners ? u.defaultMaxListeners : t._maxListeners } function h (t, e, n, i) { var r, o, a; if (typeof n !== 'function') throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof n); if (o = t._events, void 0 === o ? (o = t._events = Object.create(null), t._eventsCount = 0) : (void 0 !== o.newListener && (t.emit('newListener', e, n.listener ? n.listener : n), o = t._events), a = o[e]), void 0 === a)a = o[e] = n, ++t._eventsCount; else if (typeof a === 'function' ? a = o[e] = i ? [n, a] : [a, n] : i ? a.unshift(n) : a.push(n), r = c(t), r > 0 && a.length > r && !a.warned) { a.warned = !0; var u = new Error('Possible EventEmitter memory leak detected. ' + a.length + ' ' + String(e) + ' listeners added. Use emitter.setMaxListeners() to increase limit'); u.name = 'MaxListenersExceededWarning', u.emitter = t, u.type = e, u.count = a.length, s(u) } return t } function f () { for (var t = [], e = 0; e < arguments.length; e++)t.push(arguments[e]); this.fired || (this.target.removeListener(this.type, this.wrapFn), this.fired = !0, o(this.listener, this.target, t)) } function d (t, e, n) { var i = { fired: !1, wrapFn: void 0, target: t, type: e, listener: n }; var r = f.bind(i); return r.listener = n, i.wrapFn = r, r } function p (t, e, n) { var i = t._events; if (void 0 === i) return []; var r = i[e]; return void 0 === r ? [] : typeof r === 'function' ? n ? [r.listener || r] : [r] : n ? b(r) : y(r, r.length) } function v (t) { var e = this._events; if (void 0 !== e) { var n = e[t]; if (typeof n === 'function') return 1; if (void 0 !== n) return n.length } return 0 } function y (t, e) { for (var n = new Array(e), i = 0; i < e; ++i)n[i] = t[i]; return n } function m (t, e) { for (;e + 1 < t.length; e++)t[e] = t[e + 1]; t.pop() } function b (t) { for (var e = new Array(t.length), n = 0; n < e.length; ++n)e[n] = t[n].listener || t[n]; return e }Object.defineProperty(u, 'defaultMaxListeners', { enumerable: !0, get: function () { return l }, set: function (t) { if (typeof t !== 'number' || t < 0 || a(t)) throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + t + '.'); l = t } }), u.init = function () { void 0 !== this._events && this._events !== Object.getPrototypeOf(this)._events || (this._events = Object.create(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0 }, u.prototype.setMaxListeners = function (t) { if (typeof t !== 'number' || t < 0 || a(t)) throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + t + '.'); return this._maxListeners = t, this }, u.prototype.getMaxListeners = function () { return c(this) }, u.prototype.emit = function (t) { for (var e = [], n = 1; n < arguments.length; n++)e.push(arguments[n]); var i = t === 'error'; var r = this._events; if (void 0 !== r)i = i && void 0 === r.error; else if (!i) return !1; if (i) { var s; if (e.length > 0 && (s = e[0]), s instanceof Error) throw s; var a = new Error('Unhandled error.' + (s ? ' (' + s.message + ')' : '')); throw a.context = s, a } var u = r[t]; if (void 0 === u) return !1; if (typeof u === 'function')o(u, this, e); else { var l = u.length; var c = y(u, l); for (n = 0; n < l; ++n)o(c[n], this, e) } return !0 }, u.prototype.addListener = function (t, e) { return h(this, t, e, !1) }, u.prototype.on = u.prototype.addListener, u.prototype.prependListener = function (t, e) { return h(this, t, e, !0) }, u.prototype.once = function (t, e) { if (typeof e !== 'function') throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof e); return this.on(t, d(this, t, e)), this }, u.prototype.prependOnceListener = function (t, e) { if (typeof e !== 'function') throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof e); return this.prependListener(t, d(this, t, e)), this }, u.prototype.removeListener = function (t, e) { var n, i, r, o, s; if (typeof e !== 'function') throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof e); if (i = this._events, void 0 === i) return this; if (n = i[t], void 0 === n) return this; if (n === e || n.listener === e)--this._eventsCount === 0 ? this._events = Object.create(null) : (delete i[t], i.removeListener && this.emit('removeListener', t, n.listener || e)); else if (typeof n !== 'function') { for (r = -1, o = n.length - 1; o >= 0; o--) if (n[o] === e || n[o].listener === e) { s = n[o].listener, r = o; break } if (r < 0) return this; r === 0 ? n.shift() : m(n, r), n.length === 1 && (i[t] = n[0]), void 0 !== i.removeListener && this.emit('removeListener', t, s || e) } return this }, u.prototype.off = u.prototype.removeListener, u.prototype.removeAllListeners = function (t) { var e, n, i; if (n = this._events, void 0 === n) return this; if (void 0 === n.removeListener) return arguments.length === 0 ? (this._events = Object.create(null), this._eventsCount = 0) : void 0 !== n[t] && (--this._eventsCount === 0 ? this._events = Object.create(null) : delete n[t]), this; if (arguments.length === 0) { var r; var o = Object.keys(n); for (i = 0; i < o.length; ++i)r = o[i], r !== 'removeListener' && this.removeAllListeners(r); return this.removeAllListeners('removeListener'), this._events = Object.create(null), this._eventsCount = 0, this } if (e = n[t], typeof e === 'function') this.removeListener(t, e); else if (void 0 !== e) for (i = e.length - 1; i >= 0; i--) this.removeListener(t, e[i]); return this }, u.prototype.listeners = function (t) { return p(this, t, !0) }, u.prototype.rawListeners = function (t) { return p(this, t, !1) }, u.listenerCount = function (t, e) { return typeof t.listenerCount === 'function' ? t.listenerCount(e) : v.call(t, e) }, u.prototype.listenerCount = v, u.prototype.eventNames = function () { return this._eventsCount > 0 ? i(this._events) : [] } }, fb15: function (t, e, n) { 'use strict'; var i; (n.r(e), typeof window !== 'undefined') && (n('f6fd'), (i = window.document.currentScript) && (i = i.src.match(/(.+\/)[^\/]+\.js(\?.*)?$/)) && (n.p = i[1])); var r = n('a34a'); var o = n.n(r); var s = (n('1441'), n('5fe9')); var a = n.n(s); function u (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function l (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function c (t, e, n) { return e && l(t.prototype, e), n && l(t, n), t } var h = (function () { function t (e) { u(this, t), this.layerHideDelay = 200, this.bottomOffset = 40, this.hideTimeout = -1, this._isShow = !1, this.ui = e, this.player = e.player } return c(t, [{ key: 'init', value: function () { var t = this; var e = function () { clearTimeout(t.hideTimeout), t.ui.isMouseInUI = !0, t.showLayer() }; var n = function () { t.ui.isMouseInUI = !1, clearTimeout(t.hideTimeout), t.hideTimeout = setTimeout(function () { t.hideLayer() }, t.layerHideDelay) }; this.$btn.addEventListener('mouseenter', e), this.$btn.addEventListener('mouseleave', n), this.$layer.addEventListener('mouseenter', e), this.$layer.addEventListener('mouseleave', n) } }, { key: 'showLayer', value: function () { this._isShow = !0, this.$layer.classList.add('show'), this.updateLayerPosition() } }, { key: 'hideLayer', value: function () { this._isShow = !1, this.$layer.classList.remove('show') } }, { key: 'toggleLayer', value: function () { this._isShow ? this.hideLayer() : this.showLayer() } }, { key: 'showButton', value: function () { this.$btn.style.display = '' } }, { key: 'hideButton', value: function () { this.$btn.style.display = 'none' } }, { key: 'updateLayerPosition', value: function () { if (this._isShow) { var t = this.ui.player.$root.getBoundingClientRect(); var e = this.$btn.getBoundingClientRect(); var n = this.$layer.getBoundingClientRect(); var i = e.left + e.width / 2 - t.left - n.width / 2; this.$layer.style.left = i + 'px', this.$layer.style.bottom = this.bottomOffset + 'px' } } }, { key: 'destroy', value: function () { clearTimeout(this.hideTimeout) } }, { key: 'isShow', get: function () { return this._isShow } }]), t }()); function f (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function d (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function p (t, e, n) { return e && d(t.prototype, e), n && d(t, n), t } var v = (function () { function t (e) { f(this, t), this.$root = e, this.$use = this.$root.querySelector('use') } return p(t, [{ key: 'switch', value: function (t, e) { this.switchIcon(t), e && this.switchTitle(e) } }, { key: 'switchIcon', value: function (t) { this.$use.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + this.$root.getAttribute(t)) } }, { key: 'switchTitle', value: function (t) { this.$root.setAttribute('title', this.$root.getAttribute(t)) } }]), t }()); function y (t) { return y = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (t) { return typeof t } : function (t) { return t && typeof Symbol === 'function' && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t }, y(t) } function m (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function b (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function g (t, e, n) { return e && b(t.prototype, e), n && b(t, n), t } function w (t, e) { return !e || y(e) !== 'object' && typeof e !== 'function' ? k(t) : e } function k (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t } function $ (t, e, n) { return $ = typeof Reflect !== 'undefined' && Reflect.get ? Reflect.get : function (t, e, n) { var i = L(t, e); if (i) { var r = Object.getOwnPropertyDescriptor(i, e); return r.get ? r.get.call(n) : r.value } }, $(t, e, n || t) } function L (t, e) { while (!Object.prototype.hasOwnProperty.call(t, e)) if (t = x(t), t === null) break; return t } function x (t) { return x = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t) }, x(t) } function E (t, e) { if (typeof e !== 'function' && e !== null) throw new TypeError('Super expression must either be null or a function'); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && S(t, e) } function S (t, e) { return S = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t }, S(t, e) }a.a.enableBoundaryChecking(!1); var T = (function (t) { function e (t) { var n; m(this, e), n = w(this, x(e).call(this, t)), n.volumeValue = 0, n.areaHeight = 0, n.$video = n.player.$video, n.$video.addEventListener('volumechange', function () { return n.updateController() }), n.$layer = n.player.$root.querySelector('.interactive-layer .volume-bar'), n.$valueLabel = n.$layer.querySelector('.volume-num-label'), n.$btn = n.player.$root.querySelector('.interactive-layer .buttons .button.volume'), n.btn = new v(n.$btn), n.$btn.addEventListener('click', function () { return n.toggleMuted() }), n.$dragArea = n.$layer.querySelector('.volume-column-bar'), n.$controller = n.$dragArea.querySelector('.bar-controller'), n.$current = n.$dragArea.querySelector('.bar-current'), n.volumeValue = n.$video.volume = n.player.options.volume, n.volumeValue === 0 && (n.volumeValue = 0.7); var i = function (t) { var e = t.pageY; var i = n.$dragArea.getBoundingClientRect(); if (e < i.top)n.$video.volume = 1; else if (e > i.bottom)n.$video.volume = 0; else { var r = i.bottom - i.top; e -= i.top; var o = e / r; n.$video.volume = a.a.round(1 - o, 2) }n.volumeValue = n.$video.volume, n.updateController() }; var r = function t (e) { document.removeEventListener('mousemove', i), document.removeEventListener('mouseup', t), i(e) }; return n.$dragArea.addEventListener('mousedown', function () { document.addEventListener('mousemove', i), document.addEventListener('mouseup', r) }), n.init(), n.updateController(), n } return E(e, t), g(e, [{ key: 'up', value: function () { this.$video.volume <= 0.9 ? this.$video.volume = a.a.plus(this.$video.volume, 0.1) : this.$video.volume = 1, this.volumeValue = this.$video.volume } }, { key: 'down', value: function () { this.$video.volume >= 0.1 ? this.$video.volume = a.a.minus(this.$video.volume, 0.1) : this.$video.volume = 0, this.volumeValue = this.$video.volume } }, { key: 'toggleMuted', value: function () { this.$video.volume > 0 ? this.$video.volume = 0 : this.volumeValue === 0 ? this.$video.volume = 1 : this.$video.volume = this.volumeValue, this.updateButton() } }, { key: 'updateButton', value: function () { var t; t = this.$video.volume > 0 ? 'data-on' : 'data-off', this.btn.switch(t) } }, { key: 'updateController', value: function () { var t = a.a.round(100 * this.$video.volume, 0); this.$valueLabel.innerText = t.toString(); var e = this.$video.volume * this.areaHeight; this.$current.style.height = e + 'px', e = this.areaHeight - e, this.$controller.style.transform = 'translateY('.concat(e, 'px)'), this.updateButton() } }, { key: 'showLayer', value: function () { $(x(e.prototype), 'showLayer', this).call(this), this.areaHeight = this.$dragArea.clientHeight, this.updateController() } }, { key: 'update', value: function () { this.$controller.style.background = this.$current.style.background = this.player.options.color } }]), e }(h)); function _ (t) { return _ = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (t) { return typeof t } : function (t) { return t && typeof Symbol === 'function' && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t }, _(t) } function O (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function j (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function P (t, e, n) { return e && j(t.prototype, e), n && j(t, n), t } function A (t, e) { return !e || _(e) !== 'object' && typeof e !== 'function' ? D(t) : e } function D (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t } function B (t, e, n) { return B = typeof Reflect !== 'undefined' && Reflect.get ? Reflect.get : function (t, e, n) { var i = F(t, e); if (i) { var r = Object.getOwnPropertyDescriptor(i, e); return r.get ? r.get.call(n) : r.value } }, B(t, e, n || t) } function F (t, e) { while (!Object.prototype.hasOwnProperty.call(t, e)) if (t = M(t), t === null) break; return t } function M (t) { return M = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t) }, M(t) } function C (t, e) { if (typeof e !== 'function' && e !== null) throw new TypeError('Super expression must either be null or a function'); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && I(t, e) } function I (t, e) { return I = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t }, I(t, e) } var H = (function (t) { function e (t) { var n; return O(this, e), n = A(this, M(e).call(this, t)), n.currentLevel = -1, n.$btn = n.player.$root.querySelector('.button.quality'), n.$layer = n.player.$root.querySelector('.float.quality-menu'), n.$autoLevel = document.createElement('div'), n.$autoLevel.innerHTML = '自动', n.$autoLevel.setAttribute('data-value', (-1).toString()), n.init(), n.$layer.addEventListener('click', function (t) { if (t.target) { var e = t.target; if (e.hasAttribute('data-value')) { var i = parseInt(e.getAttribute('data-value')); console.log('click', i), n.player.hls && (n.player.hls.currentLevel = n.player.hls.loadLevel = i, n.currentLevel = i) } }n.updateButton(), n.hideLayer() }), n } return C(e, t), P(e, [{ key: 'showButton', value: function () { this.$btn.style.display = '' } }, { key: 'hideButton', value: function () { this.$btn.style.display = 'none' } }, { key: 'showLayer', value: function () { B(M(e.prototype), 'showLayer', this).call(this), this._updateLevel(), this.updateLayerPosition() } }, { key: 'updateButton', value: function () { var t = '自动'; this.currentLevel > -1 && this.hls.levels[this.hls.loadLevel] && (t = this.hls.levels[this.hls.loadLevel].name + 'p'), this.$btn.innerText = t } }, { key: '_updateLevel', value: function () { var t = this; this.$layer.innerHTML = '', this.hls.levels.forEach(function (e, n) { if (e.name) { var i = document.createElement('div'); n === t.currentLevel && i.classList.add('current'), i.innerText = e.name + 'P', i.setAttribute('data-value', n.toString()), t.$layer.append(i) } }), this.currentLevel === -1 ? this.$autoLevel.classList.add('current') : this.$autoLevel.classList.remove('current'), this.$layer.append(this.$autoLevel) } }, { key: 'updateLevel', value: function (t) { this.hls = t, this._updateLevel(), this.updateLayerPosition(), this.updateButton() } }]), e }(h)); function q (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function R (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function Y (t, e, n) { return e && R(t.prototype, e), n && R(t, n), t } var z; var U = (function () { function t (e) { var n = this; q(this, t), this.barWidth = 0, this._currentTime = 0, this.percent = 0, this.offsetWidth = 0, this.player = e.player, this.ui = e, this.$root = this.player.$root.querySelector('.progress-bar'), this.$controller = this.$root.querySelector('.bar-controller'), this.$current = this.$root.querySelector('.bar-current'), this.$time = this.player.$root.querySelector('.controller-bottom-bar .time'), this.$buffer = this.$root.querySelector('.bar-buffer'), this.player.$video.addEventListener('timeupdate', function () { n._currentTime = n.player.$video.currentTime, n.percent = n._currentTime / n.player.$video.duration, n.time(), n.update() }), this.player.$video.addEventListener('progress', function () { n.updateBufferBar(), n.time() }); var i = function (t) { var e = n.player.$root.getBoundingClientRect(); var i = t.pageX - e.left - n.offsetWidth / 2; i < 0 ? i = 0 : i > n.barWidth && (i = n.barWidth), n.percent = i / n.barWidth, n.player.$video.currentTime = n.percent * n.player.$video.duration, n.update(), n.ui.isMouseInUI = !0 }; var r = function t () { document.removeEventListener('mousemove', i), document.removeEventListener('mouseup', t) }; this.$root.addEventListener('mousedown', function () { document.addEventListener('mousemove', i), document.addEventListener('mouseup', r) }), this.$root.addEventListener('click', i), this.offsetWidth = this.player.width - this.$root.clientWidth, this.resize() } return Y(t, [{ key: 'time', value: function () { this.player.options.live || (this.$time.innerText = t.getTimeString(this.player.$video.currentTime) + ' / ' + t.getTimeString(this.player.$video.duration)) } }, { key: 'resize', value: function () { this.barWidth = this.player.width - this.offsetWidth, this.update(), this.updateBufferBar() } }, { key: 'update', value: function () { var t = this.barWidth * this.percent; this.$current.style.width = t + 'px', this.$controller.style.transform = 'translateX('.concat(t, 'px)'), this.$controller.style.background = this.player.options.color, this.$current.style.background = this.player.options.color } }, { key: 'resetTimeZone', value: function () { this.player.options.live ? this.$time.innerText = '直播' : this.$time.innerText = '' } }, { key: 'updateBufferBar', value: function () { for (var t = 0; t < this.player.$video.buffered.length; t++) { var e = this.player.$video.buffered.start(t); var n = this.player.$video.buffered.end(t); e < this._currentTime && this._currentTime < n && (this.$buffer.style.width = n / this.player.$video.duration * this.barWidth + 'px') } } }], [{ key: 'getTimeString', value: function (t) { var e = []; var n = Math.floor(t / 3600); return n > 0 && (n.toString().length === 1 && (n = '0' + n), e.push(n)), n = Math.floor(t / 60) - 60 * Math.floor(t / 3600), n.toString().length === 1 && (n = '0' + n), e.push(n), n = Math.floor(t) - 60 * Math.floor(t / 60), n.toString().length === 1 && (n = '0' + n), e.push(n), e.join(':') } }]), t }()); function N (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function W (t) { var e = t.currentTime; var n = void 0 === e ? 0 : e; var i = t.borderColor; var r = void 0 === i ? '' : i; var o = t.fill; var s = void 0 === o ? '#ffffff' : o; var a = t.type; var u = void 0 === a ? z.Flow : a; var l = t.id; var c = void 0 === l ? '' : l; var h = t.fontSize; var f = void 0 === h ? 28 : h; return { currentTime: n, type: u, borderColor: r, fill: s, id: c, fontSize: f } }(function (t) { t[t['Top'] = 0] = 'Top', t[t['Flow'] = 1] = 'Flow', t[t['Bottom'] = 2] = 'Bottom' })(z || (z = {})); var G = function t (e, n) { N(this, t), this.text = e, Object.assign(this, W(n || {})) }; function V (t) { return V = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (t) { return typeof t } : function (t) { return t && typeof Symbol === 'function' && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t }, V(t) } function X (t, e) { return !e || V(e) !== 'object' && typeof e !== 'function' ? K(t) : e } function K (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t } function Q (t) { return Q = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t) }, Q(t) } function Z (t, e) { if (typeof e !== 'function' && e !== null) throw new TypeError('Super expression must either be null or a function'); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && J(t, e) } function J (t, e) { return J = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t }, J(t, e) } function tt (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function et (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function nt (t, e, n) { return e && et(t.prototype, e), n && et(t, n), t } var it = 'px "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif'; var rt = (function () { function t () { tt(this, t), this.top = 0, this.left = 0, this.width = 0, this.height = 0, this.enable = !1, this.selfCanvas = document.createElement('canvas'), this.selfCanvas.width = 100, this.selfCanvas.height = 100, this.ctx = this.selfCanvas.getContext('2d') } return nt(t, [{ key: 'getSize', value: function () { this.ctx.textBaseline = 'top', this.ctx.textAlign = 'left', this.ctx.font = this.danmaku.fontSize + it, this.width = this.ctx.measureText(this.danmaku.text).width, this.height = 1.2 * this.ctx.measureText('M').width } }, { key: 'draw', value: function () { var t = this.width + 4; var e = this.height; this.selfCanvas.width = t, this.selfCanvas.height = e, this.ctx.textBaseline = 'top', this.ctx.textAlign = 'left', this.ctx.font = this.danmaku.fontSize + it, this.ctx.clearRect(0, 0, t, e), this.danmaku.borderColor && (this.ctx.strokeStyle = this.danmaku.borderColor, this.ctx.strokeRect(1, 1, t - 4, e - 4)), this.ctx.strokeStyle = '#000000', this.ctx.strokeText(this.danmaku.text, 1, 1), this.ctx.fillStyle = this.danmaku.fill, this.ctx.fillText(this.danmaku.text, 1, 1) } }]), t }()); var ot = (function (t) { function e () { return tt(this, e), X(this, Q(e).apply(this, arguments)) } return Z(e, t), nt(e, [{ key: 'set', value: function (t, e, n) { this.danmaku = t, this.enable = !0, this.left = e, this.top = n, this.getSize(), this.draw() } }, { key: 'update', value: function (t, e, n) { var i = (t + this.width) / e * n; this.left = this.left - i, this.enable = this.left + this.width > 0 } }]), e }(rt)); var st = (function (t) { function e () { var t; return tt(this, e), t = X(this, Q(e).apply(this, arguments)), t.timeout = 0, t } return Z(e, t), nt(e, [{ key: 'set', value: function (t, e, n, i) { this.danmaku = t, this.timeout = e, this.enable = !0, this.getSize(), this.left = (n - this.width) / 2, this.top = i, this.draw(), this.update(0) } }, { key: 'update', value: function (t) { console.log({ timeout: this.timeout, lastFrameTime: t }), this.timeout -= t, this.enable = this.timeout > 0 } }]), e }(rt)); var at = n('faa1'); function ut (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function lt (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function ct (t, e, n) { return e && lt(t.prototype, e), n && lt(t, n), t } var ht; var ft = 'px "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif'; var dt = (function () { function t (e) { ut(this, t), this.caches = [], this.player = e, this.$canvas = e.$root.querySelector('canvas'), this.ctx = this.$canvas.getContext('2d'), this.$canvas.addEventListener('click', function () { e.toggle() }) } return ct(t, [{ key: 'addDrawer', value: function (t) { this.caches.push(t) } }, { key: 'removeDrawer', value: function (t) { var e = this.caches.indexOf(t); e > -1 && this.caches.splice(e, 1) } }, { key: 'renderAll', value: function () { if (this.clear(), this.caches.length > 0) for (var t = 0; t < this.caches.length; t++) { var e = this.caches[t]; this.ctx.drawImage(e.selfCanvas, e.left, e.top) } } }, { key: 'clear', value: function () { this.ctx.clearRect(0, 0, this.player.width, this.player.height) } }, { key: 'clearCache', value: function () { this.caches.length = 0 } }, { key: 'fontHeight', value: function (t) { this.ctx.font = t + ft; var e = this.ctx.measureText('M'); return 1.2 * e.width } }, { key: 'fontWidth', value: function (t) { this.ctx.font = t.danmaku.fontSize + ft; var e = this.ctx.measureText(t.danmaku.text); return e.width } }, { key: 'resize', value: function () { this.$canvas.setAttribute('width', this.player.width + 'px'), this.$canvas.setAttribute('height', this.player.height + 'px') } }, { key: 'alpha', set: function (t) { this.ctx.globalAlpha = t } }]), t }()); function pt (t) { return mt(t) || yt(t) || vt() } function vt () { throw new TypeError('Invalid attempt to spread non-iterable instance') } function yt (t) { if (Symbol.iterator in Object(t) || Object.prototype.toString.call(t) === '[object Arguments]') return Array.from(t) } function mt (t) { if (Array.isArray(t)) { for (var e = 0, n = new Array(t.length); e < t.length; e++)n[e] = t[e]; return n } } function bt (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function gt (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function wt (t, e, n) { return e && gt(t.prototype, e), n && gt(t, n), t }(function (t) { t[t['UnLimited'] = 0] = 'UnLimited', t[t['UnOverlap'] = 1] = 'UnOverlap', t[t['Percent25'] = 0.25] = 'Percent25', t[t['Half'] = 0.5] = 'Half', t[t['Percent75'] = 0.25] = 'Percent75' })(ht || (ht = {})); var kt = '<div class="content"></div><div class="buttons"><span class="copy">复制</span></div>'; function $t (t, e, n) { var i = document.createElement('div'); i.innerHTML = kt; var r = i.querySelector('.content'); r.innerText = t.danmaku.text; var o = i.querySelector('.buttons'); for (var s in e) { var a = document.createElement('span'); a.innerText = s, a.onclick = e[s], o.prepend(a) } var u = i.querySelector('.copy'); return u && u.addEventListener('click', function () { return n(t.danmaku.text) }), i } function Lt () { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; var e = t.alpha; var n = void 0 === e ? 1 : e; var i = t.enable; var r = void 0 === i || i; var o = t.flowDuration; var s = void 0 === o ? 8 : o; var a = t.fadeoutDuration; var u = void 0 === a ? 5 : a; var l = t.limit; var c = void 0 === l ? ht.UnOverlap : l; var h = t.contextMenu; var f = void 0 === h ? void 0 : h; return { alpha: n, enable: r, flowDuration: s, limit: c, fadeoutDuration: u, contextMenu: f } } var xt = (function () { function t (e) { var n = this; bt(this, t), this.danmakus = [], this.showed = [], this.topEnables = [], this.topAndBottomDisables = [], this.bottomEnables = [], this.flowEnables = [], this.flowDisables = [], this.lineHeights = [], this.topLines = {}, this.bottomLines = {}, this.flowLines = {}, this.displayArea = 0, this.topY = 0, this.flowY = 0, this.bottomY = 0, this.frameTime = 0, this.calcDanmakuTime = 0, this.isShow = !0, this.width = 0, this.height = 0, this.calcTopInterval = -1, this.destroied = !1, this.addDanmakuToCanvasTime = 0, this.lastFrame = 0, this.player = e, this.event = new at['EventEmitter'](), this.canvas = new dt(e); var i = function t () { document.removeEventListener('click', t), document.removeEventListener('contextmenu', t), n.$menu.remove() }; this.canvas.$canvas.addEventListener('contextmenu', function (t) { var e = n.findDrawers(t); if (e.length > 0) { n.createDanmakuMenu(e); var r = t.pageX; var o = t.pageY; var s = t.clientX + n.$menu.clientWidth; var a = t.clientY + n.$menu.clientHeight; s > document.body.clientWidth && (r -= s - document.body.clientWidth), a > document.body.clientHeight && (o -= a - document.body.clientHeight), n.$menu.style.left = r + 'px', n.$menu.style.top = o + 'px', document.addEventListener('click', i), document.addEventListener('touchstart', i), document.addEventListener('contextmenu', i) } return t.preventDefault(), t.stopPropagation(), !1 }), this.player.$video.addEventListener('seeked', function () { n.clear() }), this.player.options.danmaku.enable ? this.show() : this.hide(), this.loop() } return wt(t, [{ key: 'createDanmakuMenu', value: function (t) { var e = this; this.$menu && this.$menu.remove(), this.$menu = document.createElement('div'), this.$menu.className = 'float show danmaku-context-menu'; for (var n = 0; n < t.length; n++) { var i = t[n]; if (this.player.options.danmaku.contextMenu) { var r = $t(i, this.player.options.danmaku.contextMenu(i), function (t) { return e.copyText(t) }); this.$menu.append(r) } }document.body.append(this.$menu) } }, { key: 'show', value: function () { this.isShow = !0 } }, { key: 'hide', value: function () { this.isShow = !1, this.canvas.clear() } }, { key: 'clear', value: function () { var t, e; this.showed.length = 0, this.canvas.clear(), this.canvas.clearCache(), (t = this.topAndBottomDisables).push.apply(t, pt(this.topEnables)), this.topEnables.length = 0, (e = this.flowDisables).push.apply(e, pt(this.flowEnables)), this.flowEnables.length = 0 } }, { key: 'resize', value: function () { this.width = this.player.$root.clientWidth, this.height = this.player.$root.clientHeight, this.lineHeight = Math.round(this.canvas.fontHeight(this.player.options.fontSize)), this.lineHeights.length = 0; for (var t = 0; t < window.screen.height; t++) { var e = t * this.lineHeight; if (e > window.screen.height) break; this.lineHeights.push(e), this.topLines.hasOwnProperty(e) || (this.topLines[e] = null), this.bottomLines.hasOwnProperty(e) || (this.bottomLines[e] = []), this.flowLines.hasOwnProperty(e) || (this.flowLines[e] = []) } this.canvas.resize(); var n = this.player.options.danmaku.limit; n === ht.Percent75 ? this.displayArea = 0.75 * this.player.height : n === ht.Half ? this.displayArea = 0.5 * this.player.height : n === ht.Percent25 ? this.displayArea = 0.25 * this.player.height : this.displayArea = this.player.height, this.canvas.alpha = this.player.options.danmaku.alpha, this.canvas.renderAll() } }, { key: 'toggle', value: function () { this.isShow ? this.hide() : this.show() } }, { key: 'send', value: function (t) { t.text = t.text.trim(), this.danmakus.push(t) } }, { key: 'findDrawers', value: function (e) { return [].concat(pt(this.topEnables.filter(function (n) { return t.find(e, n) })), pt(this.bottomEnables.filter(function (n) { return t.find(e, n) })), pt(this.flowEnables.filter(function (n) { return t.find(e, n) }))) } }, { key: 'addDanmakuToCanvas', value: function () { if (this.danmakus.length !== 0) for (var t = 0; t < this.danmakus.length; t++) { var e = this.danmakus[t]; var n = Math.abs(this.player.currentTime - e.currentTime); if (!this.showed.includes(e) && !(n > 0.1)) { this.showed.push(e); if (e.type === z.Flow) { var i = this.flowDisables.shift() || new ot(); i.enable = !0, i.set(e, this.width, this.calcFlowTop(i)), i.update(this.width, this.player.options.danmaku.flowDuration, 0), this.flowEnables.push(i), this.canvas.addDrawer(i) } else { var r = this.topAndBottomDisables.shift() || new st(); if (r.enable = !0, e.type === z.Top)r.set(e, this.player.options.danmaku.fadeoutDuration, this.width, this.calcTopTop(r)), this.topEnables.push(r); else { var o = this.calcBottomTop(r) + this.lineHeight; o = this.height - o, r.set(e, this.player.options.danmaku.fadeoutDuration, this.width, o), this.bottomEnables.push(r) }r.update(0), this.canvas.addDrawer(r) } this.canvas.renderAll() } } } }, { key: 'copyText', value: function (t) { this.$input || (this.$input = this.player.$root.querySelector('input.copy-tool')), this.$input.value = t, this.$input.select(), document.execCommand('copy') } }, { key: 'calcFlowTop', value: function (t) { for (var e in this.flowLines) { var n = this.flowLines[e]; var i = Number(e); var r = n.left + n.width; if (!(n && n.enable && r > this.width)) { if (i > this.displayArea) break; return console.log('发现空行', e), this.flowLines[e] = t, this.flowY = i, i } } return this.flowY += this.lineHeight, this.flowY > this.displayArea && (this.flowY = 0), this.flowLines[this.flowY] = t, this.flowY } }, { key: 'calcTopTop', value: function (t) { for (var e in this.topLines) { var n = this.topLines[e]; var i = Number(e); if (!n || !n.enable) { if (i > this.displayArea) break; return console.log('发现空行', e), this.topLines[e] = t, this.topY = i, i } } return this.topY += this.lineHeight, this.topY > this.displayArea && (this.topY = 0), this.topLines[this.topY] = t, this.topY } }, { key: 'calcBottomTop', value: function (t) { for (var e in this.bottomLines) { var n = this.bottomLines[e]; var i = Number(e); if (!n || !n.enable) { if (i > this.displayArea) break; return console.log('发现空行', e), this.bottomLines[e] = t, this.bottomY = i, i } } return this.bottomY += this.lineHeight, this.bottomY > this.displayArea && (this.bottomY = 0), this.bottomLines[this.bottomY] = t, this.bottomY } }, { key: 'drawDanmaku', value: function () { var t = this; this.topEnables = this.topEnables.filter(function (e) { return e.enable ? (e.update(t.frameTime), !0) : (t.canvas.removeDrawer(e), t.topAndBottomDisables.push(e), !1) }), this.bottomEnables = this.bottomEnables.filter(function (e) { return e.enable ? (e.update(t.frameTime), !0) : (t.canvas.removeDrawer(e), t.topAndBottomDisables.push(e), !1) }), this.flowEnables = this.flowEnables.filter(function (e) { return e.enable ? (e.update(t.width, t.player.options.danmaku.flowDuration, t.frameTime), !0) : (t.canvas.removeDrawer(e), t.flowDisables.push(e), !1) }) } }, { key: 'loop', value: function () { var t = this; this.destroied || (this.addDanmakuToCanvas(), this.addDanmakuToCanvasTime = (Date.now() - this.lastFrame) / 1e3, this.player.paused || (this.drawDanmaku(), this.calcDanmakuTime = (Date.now() - this.lastFrame) / 1e3, this.isShow ? this.canvas.renderAll() : this.canvas.clear()), this.frameTime = (Date.now() - this.lastFrame) / 1e3, this.lastFrame = Date.now(), window.requestAnimationFrame(function () { t.loop() })) } }, { key: 'destroy', value: function () { this.destroied = !0, clearInterval(this.calcTopInterval), this.$menu && this.$menu.remove() } }, { key: 'debug', get: function () { return { isShow: this.isShow, all: this.danmakus.length, showed: this.showed.length, time: { addDanmakuToCanvas: this.addDanmakuToCanvasTime, drawDanmaku: this.calcDanmakuTime, frameTime: this.frameTime }, 'on screen danmakus': { top: this.topEnables.length, bottom: this.bottomEnables.length, flow: this.flowEnables.length }, 'danmaku pool': { fixed: this.topAndBottomDisables.length, flow: this.flowDisables.length }, positionY: { top: this.topY, flow: this.flowY, bottom: this.bottomY } } } }], [{ key: 'find', value: function (t, e) { return t.offsetX > e.left && t.offsetX < e.left + e.width && t.offsetY > e.top && t.offsetY < e.top + e.height } }]), t }()); function Et (t) { return Et = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (t) { return typeof t } : function (t) { return t && typeof Symbol === 'function' && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t }, Et(t) } function St (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function Tt (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function _t (t, e, n) { return e && Tt(t.prototype, e), n && Tt(t, n), t } function Ot (t, e) { return !e || Et(e) !== 'object' && typeof e !== 'function' ? jt(t) : e } function jt (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t } function Pt (t) { return Pt = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t) }, Pt(t) } function At (t, e) { if (typeof e !== 'function' && e !== null) throw new TypeError('Super expression must either be null or a function'); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && Dt(t, e) } function Dt (t, e) { return Dt = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t }, Dt(t, e) } var Bt = '<div>类型\n<div class="types">\n  <div class="type" data-type="1"><div><svg class="icon"><use xlink:href="#danplayer-danmugundongkai"></use></svg></div>流动</div>\n  <div class="type" data-type="0"><div><svg class="icon"><use xlink:href="#danplayer-danmudingbukai"></use></svg></div>顶部</div>\n  <div class="type" data-type="2"><div><svg class="icon"><use xlink:href="#danplayer-danmudibukai"></use></svg></div>底部</div>\n</div>\n</div>\n<div>颜色\n<div class="colors">\n{colors}\n</div>\n</div>'; var Ft = (function (t) { function e (t) { var n; return St(this, e), n = Ot(this, Pt(e).call(this, t)), n.fill = '#ffffff', n.type = z.Flow, n.$layer = n.player.$root.querySelector('.float.danmaku-style-layer'), n.$btn = n.player.$root.querySelector('.intern-button.danmaku-style'), n.$layer.innerHTML = Bt.replace('{colors}', e.colors.map(function (t) { return '<span style="background: '.concat(t, '" data-color="').concat(t, '"></span>') }).join('')), n.init(), n.$types = Array.from(n.$layer.querySelectorAll('.types > .type')), n.$colors = Array.from(n.$layer.querySelectorAll('.colors > span')), n.$types.forEach(function (t) { return t.addEventListener('click', function () { n.$types.forEach(function (t) { return t.classList.remove('selected') }), t.classList.add('selected'), n.type = Number(t.getAttribute('data-type')) }) }), n.$colors.forEach(function (t) { return t.addEventListener('click', function () { n.$colors.forEach(function (t) { return t.classList.remove('selected') }), t.classList.add('selected'), n.fill = t.getAttribute('data-color') }) }), n.$types[0].classList.add('selected'), n.$colors[n.$colors.length - 1].classList.add('selected'), n } return At(e, t), _t(e, [{ key: 'getStyle', value: function () { return { fill: this.fill, type: this.type, borderColor: 'white' } } }]), e }(h)); function Mt (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function Ct (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function It (t, e, n) { return e && Ct(t.prototype, e), n && Ct(t, n), t }Ft.colors = ['#FE0302', '#FF7204', '#FFAA02', '#FFD302', '#FFFF00', '#A0EE00', '#00CD00', '#019899', '#4266BE', '#89D5FF', '#CC0273', '#222222', '#9B9B9B', '#FFFFFF']; var Ht = (function () { function t (e) { var n = this; Mt(this, t), this.isShow = !1, this.ui = e, this.styleLayer = new Ft(e), this.$root = e.player.$root.querySelector('.danmaku-form'), this.$input = this.$root.querySelector('input'), this.$btn = this.$root.querySelector('.send'), this.$btn.addEventListener('click', function () { return n.send() }), this.$input.addEventListener('keypress', function (t) { t.key === 'Enter' && n.ui.isShow && n.$input.value && n.send() }), this.$input.addEventListener('keydown', function (t) { (t.key.startsWith('Arrow') || t.key === ' ') && t.stopPropagation() }), this.$input.addEventListener('keyup', function (t) { t.key === 'Escape' && (n.ui.player.$root.focus(), n.ui.hide()), t.stopPropagation() }), this.$input.addEventListener('focus', function () { n.ui.isMouseInUI = !0 }), this.$input.addEventListener('blur', function () { n.ui.isMouseInUI = !1 }) } return It(t, [{ key: 'send', value: function () { var t = this.styleLayer.getStyle(); t.currentTime = this.ui.player.currentTime, this.ui.danmakuLayer.send(new G(this.$input.value, t)), this.$input.value = '', this.ui.player.$root.focus() } }, { key: 'toggle', value: function () { this.isShow ? this.hide() : this.show() } }, { key: 'show', value: function () { this.isShow = !0, this.$root.style.display = '' } }, { key: 'hide', value: function () { this.isShow = !1, this.$root.style.display = 'none' } }, { key: 'update', value: function () {} }, { key: 'focus', value: function () { this.$input.focus() } }]), t }()); function qt (t) { return zt(t) || Yt(t) || Rt() } function Rt () { throw new TypeError('Invalid attempt to spread non-iterable instance') } function Yt (t) { if (Symbol.iterator in Object(t) || Object.prototype.toString.call(t) === '[object Arguments]') return Array.from(t) } function zt (t) { if (Array.isArray(t)) { for (var e = 0, n = new Array(t.length); e < t.length; e++)n[e] = t[e]; return n } } function Ut (t, e, n, i, r, o, s) { try { var a = t[o](s); var u = a.value } catch (l) { return void n(l) }a.done ? e(u) : Promise.resolve(u).then(i, r) } function Nt (t) { return function () { var e = this; var n = arguments; return new Promise(function (i, r) { var o = t.apply(e, n); function s (t) { Ut(o, i, r, s, a, 'next', t) } function a (t) { Ut(o, i, r, s, a, 'throw', t) }s(void 0) }) } } function Wt (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function Gt (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function Vt (t, e, n) { return e && Gt(t.prototype, e), n && Gt(t, n), t } var Xt = (function () { function t (e) { var n = this; Wt(this, t), this._isMouseInUI = !1, this.isShow = !1, this.extraButtons = [], this.hideTimeout = -1, this.player = e, this.$root = e.$root.querySelector('.interactive-layer .controller-bottom-bar'), this.$root.addEventListener('mouseenter', function () { n.isMouseInUI = !0 }), this.$root.addEventListener('mouseleave', function () { n.isMouseInUI = !1 }), this.$gradientBG = e.$root.querySelector('.bg-gradient'), this.volume = new T(this), this.qualitySelector = new H(this), this.progressBar = new U(this), this.styleLayer = new Ft(this), this.danmakuForm = new Ht(this), this.$controllerButtonsRightLayout = this.$root.querySelector('.buttons .right'), this.btnFullScreen = new v(this.$root.querySelector('.button.full-screen')), this.btnFullScreen.$root.addEventListener('click', Nt(o.a.mark(function t () { return o.a.wrap(function (t) { while (1) switch (t.prev = t.next) { case 0:return t.next = 2, n.player.toggleFullScreen(); case 2:n.updateFullScreenButton(); case 3:case 'end':return t.stop() } }, t) }))), this.btnPlay = new v(this.$root.querySelector('.button.play')), this.btnPlay.$root.addEventListener('click', function () { n.player.toggle(), n.updatePlayButton() }), this.btnShowDanmaku = new v(this.$root.querySelector('.button.toggle-danamaku')), this.btnShowDanmaku.$root.addEventListener('click', function () { n.danmakuLayer.toggle(), n.updateDanmakuButton() }), this.danmakuLayer = new xt(e), this.insertExtraButtons() } return Vt(t, [{ key: 'show', value: function () { this.isShow = !0, this.$root.classList.add('show'), this.$gradientBG.classList.add('show') } }, { key: 'hide', value: function () { this.isShow = !1, this.$root.classList.remove('show'), this.$gradientBG.classList.remove('show'), this.qualitySelector.hideLayer(), this.volume.hideLayer(), this.danmakuForm.styleLayer.hideLayer(), this.player.$root.focus() } }, { key: 'hideUIDelay', value: function () { var t = this; return this.cancelHideUIDelay(), new Promise(function (e) { t.hideTimeout = window.setTimeout(function () { t.hide(), e() }, t.player.options.uiFadeOutDelay) }) } }, { key: 'cancelHideUIDelay', value: function () { clearTimeout(this.hideTimeout) } }, { key: 'clearExtraButtons', value: function () { this.extraButtons.forEach(function (t) { return t.remove() }), this.extraButtons.length = 0 } }, { key: 'insertExtraButtons', value: function () { var t, e; (this.clearExtraButtons(), this.player.options.extraButtons) && (this.player.options.extraButtons.forEach(function (t) { t.classList.add('button'), t.classList.remove('intern-button') }), (t = this.$controllerButtonsRightLayout).prepend.apply(t, qt(this.player.options.extraButtons)), (e = this.extraButtons).push.apply(e, qt(this.player.options.extraButtons))) } }, { key: 'update', value: function () { this.updateDanmakuButton(), this.updateFullScreenButton(), this.updatePlayButton(), this.danmakuForm.update(), this.progressBar.update(), this.volume.update() } }, { key: 'updatePlayButton', value: function () { this.player.paused ? this.btnPlay.switch('data-on', 'data-on-title') : this.btnPlay.switch('data-off', 'data-off-title') } }, { key: 'updateFullScreenButton', value: function () { this.player.isFullScreen ? this.btnFullScreen.switch('data-off', 'data-off-title') : this.btnFullScreen.switch('data-on', 'data-on-title') } }, { key: 'updateDanmakuButton', value: function () { var t, e; this.danmakuLayer.isShow ? (t = 'data-off', e = 'data-off-title') : (t = 'data-on', e = 'data-on-title'), this.btnShowDanmaku.switch(t, e) } }, { key: 'resize', value: function () { this.volume.isShow && this.volume.updateLayerPosition(), this.qualitySelector.isShow && this.qualitySelector.updateLayerPosition(), this.progressBar.resize(), this.danmakuLayer.resize() } }, { key: 'destroy', value: function () { clearTimeout(this.hideTimeout), this.danmakuLayer.destroy(), this.qualitySelector.destroy(), this.volume.destroy() } }, { key: 'isMouseInUI', set: function (t) { this._isMouseInUI = t, this.cancelHideUIDelay() }, get: function () { return this._isMouseInUI } }, { key: 'debug', get: function () { return { isShow: this.isShow, isMouseInUI: this._isMouseInUI, danmakuLayer: this.danmakuLayer.debug } } }]), t }()); function Kt (t) { return Jt(t) || Zt(t) || Qt() } function Qt () { throw new TypeError('Invalid attempt to spread non-iterable instance') } function Zt (t) { if (Symbol.iterator in Object(t) || Object.prototype.toString.call(t) === '[object Arguments]') return Array.from(t) } function Jt (t) { if (Array.isArray(t)) { for (var e = 0, n = new Array(t.length); e < t.length; e++)n[e] = t[e]; return n } } function te (t, e, n, i, r, o, s) { try { var a = t[o](s); var u = a.value } catch (l) { return void n(l) }a.done ? e(u) : Promise.resolve(u).then(i, r) } function ee (t) { return function () { var e = this; var n = arguments; return new Promise(function (i, r) { var o = t.apply(e, n); function s (t) { te(o, i, r, s, a, 'next', t) } function a (t) { te(o, i, r, s, a, 'throw', t) }s(void 0) }) } } function ne (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function') } function ie (t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, 'value' in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function re (t, e, n) { return e && ie(t.prototype, e), n && ie(t, n), t } var oe; var se = '//at.alicdn.com/t/font_1373341_m9a3piei0s.js'; var ae = '{video-layer}\n<input class="copy-tool" />\n<div class="interactive-layer">\n  <canvas class="danmaku-layer"></canvas>\n  \n  <div class="bg-gradient show"></div>\n  \n  \n  <div class="float danmaku-style-layer"></div>\n  \n  <div class="float volume-bar">\n    <div class="volume-num-label"></div>\n    <div class="volume-column-bar">\n      <div class="bar-ui bar-full"></div>\n      <div class="bar-ui bar-current"></div>\n      <div class="bar-controller"></div>\n    </div>\n  </div>\n  \n  <div class="float quality-menu"></div>\n  \n  <div class="controller-bottom-bar">\n    <div class="progress-bar live-hide">\n      <div class="bar-full"></div>\n      <div class="bar-buffer"></div>\n      <div class="bar-current"></div>\n      <div class="bar-controller"></div>    \n    </div>\n    \n    <div class="buttons">\n      <div class="left">\n        <div class="button intern-button play" data-on="danplayer-bofang" data-off="danplayer-zanting"\n          data-on-title="播放视频" data-off-title="暂停播放">\n          <svg class="icon" aria-hidden="true"><use xlink:href="#danplayer-bofang"></use></svg>\n        </div>\n        <div class="time"></div>\n      </div>\n      \n      <div class="middle danmaku-form">\n        <div class="button intern-button danmaku-style">\n          <svg class="icon"><use xlink:href="#danplayer-style"></use></svg>\n        </div>\n        <input placeholder="输入弹幕内容" tabindex="1">\n        <div class="send">发送</div>\n      </div>\n      <div class="right">\n      \n        <div class="button intern-button volume" data-on="danplayer-yinliang" data-off="danplayer-jingyin" title="音量">\n          <svg class="icon"><use xlink:href="#danplayer-yinliang"></use></svg>\n        </div>\n        \n        <div class="button intern-button toggle-danamaku" title="隐藏弹幕"\n          data-on="danplayer-danmukai" data-off="danplayer-danmuguan" \n          data-on-title="显示弹幕" data-off-title="隐藏弹幕">\n          <svg class="icon"><use xlink:href="#danplayer-danmukai"></use></svg>\n        </div>\n        \n        <div class="button quality" title="切换画质"></div>\n        \n        <div class="button intern-button full-screen" data-on="danplayer-quanping" data-off="danplayer-zuixiaohua"\n        data-on-title="全屏观看" data-off-title="取消全屏">\n          <svg class="icon"><use xlink:href="#danplayer-quanping"></use></svg>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'; function ue (t) { var e = t.autoplay; var n = void 0 !== e && e; var i = t.color; var r = void 0 === i ? '#00a1d6' : i; var o = t.live; var s = void 0 !== o && o; var a = t.volume; var u = void 0 === a ? 0.7 : a; var l = t.fontSize; var c = void 0 === l ? 28 : l; var h = t.width; var f = void 0 === h ? 600 : h; var d = t.height; var p = void 0 === d ? 350 : d; var v = t.uiFadeOutDelay; var y = void 0 === v ? 3e3 : v; var m = t.extraButtons; var b = void 0 === m ? [] : m; var g = t.src; var w = void 0 === g ? '' : g; var k = t.iconSrc; var $ = void 0 === k ? se : k; var L = t.danmakuForm; var x = void 0 === L || L; var E = t.fullScreen; var S = void 0 === E || E; var T = t.danmaku; var _ = void 0 === T ? {} : T; var O = t.onlyOne; var j = void 0 !== O && O; return { autoplay: n, color: r, live: s, fontSize: c, height: p, danmaku: Lt(_), danmakuForm: x, fullScreen: S, src: w, iconSrc: $, uiFadeOutDelay: y, extraButtons: b, onlyOne: j, volume: u, width: f } }(function (t) { t[t['Normal'] = 0] = 'Normal', t[t['Hls'] = 1] = 'Hls', t[t['Dash'] = 2] = 'Dash' })(oe || (oe = {})); var le = (function () { function t (e, n) { var i = this; if (ne(this, t), this.type = oe.Normal, this._width = '', this._height = '', this.isFullScreen = !1, this._duration = 0, this._loading = !0, this._paused = !0, this.delayResize = -1, !document.querySelector('script#danplayer-icon')) { var r = document.createElement('script'); r.src = se, r.id = 'danplayer-icon', document.body.append(r) }t.instances.push(this); var o = e.parentElement; this.$root = document.createElement('div'), this.$root.setAttribute('tabIndex', '0'), this.$root.classList.add('video-player'), o.insertBefore(this.$root, e), e.classList.add('video-layer'), e.removeAttribute('id'), this.$root.innerHTML = ae.replace('{video-layer}', e.outerHTML), e.remove(), this.$root.addEventListener('keypress', function (t) { var e = !0; t.key === 'Enter' ? (i.ui.show(), i.ui.danmakuForm.focus()) : e = !1, e && (t.stopPropagation(), t.preventDefault()) }), this.$root.addEventListener('keyup', function (t) { t.key === ' ' && i.toggle() }), document.addEventListener('fullscreenchange', function () { i.isFullScreen = document.fullscreenElement === i.$root, i.ui.updateFullScreenButton() }), this.$root.addEventListener('keydown', function (t) { var e = !0; t.key !== 'ArrowLeft' || i.options.live ? t.key !== 'ArrowRight' || i.options.live ? t.key === 'ArrowUp' ? i.ui.volume.up() : t.key === 'ArrowDown' ? i.ui.volume.down() : e = !1 : i.$video.currentTime += 5 : i.$video.currentTime -= 5, e && (t.stopPropagation(), t.preventDefault()) }), this.$root.addEventListener('mousemove', function () { if (i.$root.classList.remove('mouse-idle'), i.ui.show(), i.paused);else { if (i.ui.isMouseInUI) return; i.ui.hideUIDelay().then(function () { i.$root.classList.add('mouse-idle') }) } }), this.$root.addEventListener('mouseenter', function () { i.ui.show(), i.ui.cancelHideUIDelay() }), this.$root.addEventListener('mouseleave', function () { i.ui.hide(), i.ui.cancelHideUIDelay() }), this.$video = this.$root.querySelector('.video-layer'), this.$video.removeAttribute('controls'), this.$video.addEventListener('durationchange', function () { i._duration = i.$video.duration }), this.$video.addEventListener('playing', function () { return i.ui.hideUIDelay() }), this.$video.addEventListener('play', function () { return i.ui.updatePlayButton() }), this.$video.addEventListener('pause', function () { return i.ui.updatePlayButton() }), window.addEventListener('resize', function () { return i.resizeEvt(1e3) }), this.options = ue(n || { autoplay: this.$video.hasAttribute('autoplay') }), this.ui = new Xt(this), this.ui.update(), this._setSrc().then(), this._setUI() } return re(t, [{ key: '_setSrc', value: (function () { var t = ee(o.a.mark(function t () { var e = this; return o.a.wrap(function (t) { while (1) switch (t.prev = t.next) { case 0:return this.options.src && this.$video.setAttribute('src', this.options.src), t.next = 3, this.getContentType(); case 3:this.ui.qualitySelector.hideButton(), this.hls && (this.hls.on(Hls.Events.LEVEL_LOADED, function () { e.ui.qualitySelector.updateLevel(e.hls) }), this.ui.qualitySelector.showButton()), console.log('_set', { autoplay: this.options.autoplay, paused: this._paused }), !this.options.autoplay && this.paused || (console.log('_set 播放'), this.play()), this.options.live ? this.$root.classList.add('live') : this.$root.classList.remove('live'); case 8:case 'end':return t.stop() } }, t, this) })); function e () { return t.apply(this, arguments) } return e }()) }, { key: '_setUI', value: function () { this.ui.insertExtraButtons(), this.ui.update(), this.ui.progressBar.resize(), this.ui.progressBar.resetTimeZone(), this.resize() } }, { key: 'set', value: function (t) { t.danmaku = Object.assign({}, this.options.danmaku, t.danmaku); var e = Object.assign({}, this.options, t); var n = e.src !== this.options.src || this.options.live !== e.live; this.options = e, n && (this.hls && (this.hls.detachMedia(), this.hls = void 0), this._setSrc().then()), this._setUI() } }, { key: 'resize', value: function () { this.options.width && (typeof this.options.width === 'number' || parseInt(this.options.width).toString() === this.options.width ? this._width = this.options.width + 'px' : this._width = this.options.width), this.options.height && (typeof this.options.height === 'number' || parseInt(this.options.height).toString() === this.options.height ? this._height = this.options.height + 'px' : this._height = this.options.height), this.isFullScreen || (this.$root.style.width = this._width, this.$root.style.height = this._height), this.ui.resize() } }, { key: 'resizeEvt', value: function (t) { var e = this; window.clearTimeout(this.delayResize), this.delayResize = window.setTimeout(function () { e.resize() }, t) } }, { key: 'fillDanmakus', value: function (t) { var e; (e = this.ui.danmakuLayer.danmakus).push.apply(e, Kt(t)) } }, { key: 'sendDanmaku', value: function (t) { this.ui.danmakuLayer.send(t) } }, { key: 'toggle', value: function () { this.paused ? this.play() : this.pause() } }, { key: 'play', value: function () { var e = this; this._paused = !1, this.$video.play().then(), this.options.onlyOne && t.instances.forEach(function (t) { t !== e && t.pause() }) } }, { key: 'pause', value: function () { this._paused = !0, this.$video.pause() } }, { key: 'getContentType', value: (function () { var t = ee(o.a.mark(function t () { var e, n, i; return o.a.wrap(function (t) { while (1) switch (t.prev = t.next) { case 0:if (e = this.$video.getAttribute('src'), console.log('视频网址', e), e && (e.match(/\.m3u[8]/) && (this.type = oe.Hls), e.match(/\.mpd/) && (this.type = oe.Dash), this.options.src = e), this.type !== oe.Hls) { t.next = 22; break } if (console.log('使用Hls.js'), !Hls.isSupported()) { t.next = 12; break } this.hls = new Hls(), this.hls.config.capLevelToPlayerSize = !0, this.hls.attachMedia(this.$video), this.hls.loadSource(e), t.next = 20; break; case 12:return n = new XMLHttpRequest(), n.open('Get', e), n.send(), t.next = 17, new Promise(function (t) { n.onreadystatechange = function () { n.readyState === XMLHttpRequest.HEADERS_RECEIVED && (n.status === 200 ? t(n.getResponseHeader('Content-Type')) : t(null), n.abort()) } }); case 17:i = t.sent, console.log({ contentType: i }), i && this.$video.canPlayType(i) && (this.options.src = this.$video.src = e); case 20:t.next = 23; break; case 22:this.type === oe.Dash && console.log('使用dash.js'); case 23:case 'end':return t.stop() } }, t, this) })); function e () { return t.apply(this, arguments) } return e }()) }, { key: 'toggleFullScreen', value: (function () { var t = ee(o.a.mark(function t () { return o.a.wrap(function (t) { while (1) switch (t.prev = t.next) { case 0:if (this.isFullScreen = !this.isFullScreen, !this.isFullScreen) { t.next = 6; break } return t.next = 4, this.$root.requestFullscreen(); case 4:t.next = 8; break; case 6:return t.next = 8, document.exitFullscreen(); case 8:this.resize(); case 9:case 'end':return t.stop() } }, t, this) })); function e () { return t.apply(this, arguments) } return e }()) }, { key: 'destroy', value: function () { t.instances.splice(t.instances.indexOf(this), 1), this.ui.destroy(), this.hls && this.hls.detachMedia() } }, { key: 'width', get: function () { return this.$root.clientWidth } }, { key: 'height', get: function () { return this.$root.clientHeight } }, { key: 'loading', get: function () { return this._loading } }, { key: 'currentTime', get: function () { return this.$video.currentTime } }, { key: 'paused', get: function () { return this._paused } }, { key: 'debug', get: function () { var t = '默认'; var e = this.options.src; return this.hls && (t = this.ui.qualitySelector.currentLevel === -1 ? '自动 ' : '', this.hls.currentLevel !== -1 && (t += this.hls.levels[this.hls.currentLevel].name + 'P')), { width: this.width, height: this.height, src: e, quality: t, ui: this.ui.debug } } }]), t }()); le.instances = []; var ce = { Player: le, MakeDanmakuOptions: W, MakeDanmakuLayerOptions: Lt }; e['default'] = ce } }))['default'] })
// # sourceMappingURL=danplayer.umd.min.js.map
