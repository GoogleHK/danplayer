!function(u){function t(t){for(var e,n,i=t[0],o=t[1],r=t[2],a=0,s=[];a<i.length;a++)n=i[a],Object.prototype.hasOwnProperty.call(c,n)&&c[n]&&s.push(c[n][0]),c[n]=0;for(e in o)Object.prototype.hasOwnProperty.call(o,e)&&(u[e]=o[e]);for(d&&d(t);s.length;)s.shift()();return h.push.apply(h,r||[]),l()}function l(){for(var t,e=0;e<h.length;e++){for(var n=h[e],i=!0,o=1;o<n.length;o++){var r=n[o];0!==c[r]&&(i=!1)}i&&(h.splice(e--,1),t=a(a.s=n[0]))}return t}var n={},c={app:0},h=[];function a(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return u[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=u,a.c=n,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var e=window.webpackJsonp=window.webpackJsonp||[],i=e.push.bind(e);e.push=t,e=e.slice();for(var o=0;o<e.length;o++)t(e[o]);var d=i;h.push([0,"chunk-vendors"]),l()}({0:function(t,e,n){t.exports=n("cd49")},1441:function(t,e,n){},"5c0b":function(t,e,n){"use strict";var i=n("e332");n.n(i).a},cd49:function(t,e,n){"use strict";n.r(e);var i=n("2b0e"),o=n("9ab4"),r=n("60a3"),a=n("a34a"),s=n.n(a),u=(n("1441"),n("5fe9")),l=n.n(u),c=n("ba10");function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function f(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var y,m,b,g=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(w,c.EventEmitter),y=w,(m=[{key:"init",value:function(){function t(){clearTimeout(n.hideTimeout),n.ui.isMouseInUI=!0,n.showLayer()}function e(){n.ui.isMouseInUI=!1,clearTimeout(n.hideTimeout),n.hideTimeout=setTimeout(function(){n.hideLayer()},n.layerHideDelay)}var n=this;this.$btn.addEventListener("mouseenter",t),this.$btn.addEventListener("mouseleave",e),this.$layer.addEventListener("mouseenter",t),this.$layer.addEventListener("mouseleave",e)}},{key:"showLayer",value:function(){this._isShow=!0,this.$layer.classList.add("show"),this.updateLayerPosition()}},{key:"hideLayer",value:function(){this._isShow=!1,this.$layer.classList.remove("show")}},{key:"toggleLayer",value:function(){this._isShow?this.hideLayer():this.showLayer()}},{key:"showButton",value:function(){this.$btn.style.display=""}},{key:"hideButton",value:function(){this.$btn.style.display="none"}},{key:"updateLayerPosition",value:function(){if(this._isShow){var t=this.ui.player.$root.getBoundingClientRect(),e=this.$btn.getBoundingClientRect(),n=this.$layer.getBoundingClientRect(),i=e.left+e.width/2-t.left-n.width/2;this.$layer.style.left=i+"px",this.$layer.style.bottom=this.bottomOffset+"px"}}},{key:"destroy",value:function(){clearTimeout(this.hideTimeout)}},{key:"isShow",get:function(){return this._isShow}}])&&d(y.prototype,m),void(b&&d(y,b)),w);function w(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,w),(e=f(this,p(w).call(this))).layerHideDelay=200,e.bottomOffset=40,e.hideTimeout=-1,e._isShow=!1,e.ui=t,e.player=t.player,e}function k(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var $,S,x,L=($=E,(S=[{key:"switch",value:function(t,e){this.switchIcon(t),e&&this.switchTitle(e)}},{key:"switchIcon",value:function(t){this.$use.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.$root.getAttribute(t))}},{key:"switchTitle",value:function(t){this.$root.setAttribute("title",this.$root.getAttribute(t))}}])&&k($.prototype,S),void(x&&k($,x)),E);function E(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,E),this.$root=t,this.$use=this.$root.querySelector("use")}function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function T(t,e){return!e||"object"!==_(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function D(t,e,n){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=j(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}l.a.enableBoundaryChecking(!1);var B,A,M,F=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(I,g),B=I,(A=[{key:"up",value:function(){this.$video.volume<=.9?this.$video.volume=l.a.plus(this.$video.volume,.1):this.$video.volume=1,this.volumeValue=this.$video.volume}},{key:"down",value:function(){.1<=this.$video.volume?this.$video.volume=l.a.minus(this.$video.volume,.1):this.$video.volume=0,this.volumeValue=this.$video.volume}},{key:"toggleMuted",value:function(){0<this.$video.volume?this.$video.volume=0:0===this.volumeValue?this.$video.volume=1:this.$video.volume=this.volumeValue,this.updateButton()}},{key:"updateButton",value:function(){var t;t=0<this.$video.volume?"data-on":"data-off",this.btn.switch(t)}},{key:"updateController",value:function(){var t=l.a.round(100*this.$video.volume,0);this.$valueLabel.innerText=t.toString();var e=this.$video.volume*this.areaHeight;this.$current.style.height=e+"px",e=this.areaHeight-e,this.$controller.style.transform="translateY(".concat(e,"px)"),this.updateButton()}},{key:"showLayer",value:function(){D(j(I.prototype),"showLayer",this).call(this),this.areaHeight=this.$dragArea.clientHeight,this.updateController()}},{key:"update",value:function(){this.$controller.style.background=this.$current.style.background=this.player.options.color}}])&&O(B.prototype,A),void(M&&O(B,M)),I);function I(t){var r;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,I),(r=T(this,j(I).call(this,t))).volumeValue=0,r.areaHeight=0,r.$video=r.player.$video,r.$video.addEventListener("volumechange",function(){return r.updateController()}),r.$layer=r.player.$root.querySelector(".interactive-layer .volume-bar"),r.$valueLabel=r.$layer.querySelector(".volume-num-label"),r.$btn=r.player.$root.querySelector(".interactive-layer .buttons .button.volume"),r.btn=new L(r.$btn),r.$btn.addEventListener("click",function(){return r.toggleMuted()}),r.$dragArea=r.$layer.querySelector(".volume-column-bar"),r.$controller=r.$dragArea.querySelector(".bar-controller"),r.$current=r.$dragArea.querySelector(".bar-current"),r.volumeValue=r.$video.volume=r.player.options.volume,0===r.volumeValue&&(r.volumeValue=.7);function e(t){var e=t.pageY,n=r.$dragArea.getBoundingClientRect();if(e<n.top)r.$video.volume=1;else if(e>n.bottom)r.$video.volume=0;else{var i=n.bottom-n.top,o=(e-=n.top)/i;r.$video.volume=l.a.round(1-o,2)}r.volumeValue=r.$video.volume,r.updateController()}function n(t){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",n),e(t)}return r.$dragArea.addEventListener("mousedown",function(){document.addEventListener("mousemove",e),document.addEventListener("mouseup",n)}),r.init(),r.updateController(),r}function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function H(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function q(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function z(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function R(t,e,n){return(R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Y(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Y(t){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function U(t,e){return(U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var W,N,V,X=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&U(t,e)}(G,g),W=G,(N=[{key:"showButton",value:function(){this.$btn.style.display=""}},{key:"hideButton",value:function(){this.$btn.style.display="none"}},{key:"showLayer",value:function(){R(Y(G.prototype),"showLayer",this).call(this),this._updateLevel(),this.updateLayerPosition(),this.updateButton()}},{key:"updateButton",value:function(){var e=this;this.levels.every(function(t){return t.selected&&(e.$btn.innerText=t.name),!t.selected})}},{key:"reset",value:function(){this.currentLevel=-1,this.$layer.innerHTML=""}},{key:"_updateLevel",value:function(){var n=this;this.$layer.innerHTML="",this.levels.forEach(function(t){var e=document.createElement("div");t.index===n.currentLevel&&e.classList.add("current"),e.innerText=t.name,e.setAttribute("data-value",t.index.toString()),n.$layer.append(e)})}},{key:"updateLevel",value:function(t){var e;this.levels.length=0,this.autoLevel.selected=!0,(e=this.levels).push.apply(e,H(t.reverse()).concat([this.autoLevel])),this._updateLevel(),this.updateLayerPosition(),this.updateButton()}}])&&q(W.prototype,N),void(V&&q(W,V)),G);function G(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,G),(i=z(this,Y(G).call(this,t))).autoLevel={selected:!1,name:"自动",index:-1,bitrate:0},i.levels=[],i.currentLevel=-1,i.$btn=i.player.$root.querySelector(".button.quality"),i.$layer=i.player.$root.querySelector(".float.quality-menu"),i.init(),i.$layer.addEventListener("click",function(t){var e=t.target;if(e.hasAttribute("data-value")){var n=parseInt(e.getAttribute("data-value"));i.levels.forEach(function(t){t.selected=t.index===n,t.selected&&(i.emit("selectLevel",t),i.currentLevel=n)}),i.updateButton(),i.hideLayer()}}),i}function J(t){var e=[],n=Math.floor(t/3600);return 0<n&&(1===n.toString().length&&(n="0"+n),e.push(n)),1===(n=Math.floor(t/60)-60*Math.floor(t/3600)).toString().length&&(n="0"+n),e.push(n),1===(n=Math.floor(t)-60*Math.floor(t/60)).toString().length&&(n="0"+n),e.push(n),e.join(":")}function Q(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Z,K,tt,et,nt,it=(K=ot,(tt=[{key:"time",value:function(){this.player.options.live||(this.$time.innerText=J(this.player.$video.currentTime)+" / "+J(this.player.$video.duration))}},{key:"resize",value:function(){this.offsetWidth=this.player.width-this.$root.offsetWidth,this.barWidth=this.player.width-this.offsetWidth,this.update(),this.updateBufferBar()}},{key:"update",value:function(){var t=this.barWidth*this.percent;this.$current.style.width=t+"px",this.$controller.style.transform="translateX(".concat(t,"px)"),this.$controller.style.background=this.player.options.color,this.$current.style.background=this.player.options.color}},{key:"resetTimeZone",value:function(){this.player.options.live?this.$time.innerText="直播":this.$time.innerText=""}},{key:"updateBufferBar",value:function(){for(var t=0;t<this.player.$video.buffered.length;t++){var e=this.player.$video.buffered.start(t),n=this.player.$video.buffered.end(t);e<this._currentTime&&this._currentTime<n&&(this.$buffer.style.width=n/this.player.$video.duration*this.barWidth+"px")}}}])&&Q(K.prototype,tt),void(et&&Q(K,et)),ot);function ot(t){var i=this;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,ot),this.barWidth=0,this._currentTime=0,this.percent=0,this.offsetWidth=0,this.player=t.player,this.ui=t,this.$root=this.player.$root.querySelector(".progress-bar"),this.$controller=this.$root.querySelector(".bar-controller"),this.$current=this.$root.querySelector(".bar-current"),this.$time=this.player.$root.querySelector(".controller-bottom-bar .time"),this.$buffer=this.$root.querySelector(".bar-buffer"),this.player.$video.addEventListener("timeupdate",function(){i._currentTime=i.player.$video.currentTime,i.percent=i._currentTime/i.player.$video.duration,i.time(),i.update()}),this.player.$video.addEventListener("progress",function(){i.updateBufferBar(),i.time()});function e(t){var e=i.player.$root.getBoundingClientRect(),n=t.pageX-e.left-i.offsetWidth/2;n<0?n=0:n>i.barWidth&&(n=i.barWidth),i.percent=n/i.barWidth,i.player.$video.currentTime=i.percent*i.player.$video.duration,i.update(),i.ui.isMouseInUI=!0}function n(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",n)}this.$root.addEventListener("mousedown",function(){document.addEventListener("mousemove",e),document.addEventListener("mouseup",n)}),this.$root.addEventListener("click",e),this.resize()}(nt=Z=Z||{})[nt.Top=0]="Top",nt[nt.Flow=1]="Flow",nt[nt.Bottom=2]="Bottom";function rt(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,rt),this.text=t,Object.assign(this,function(t){var e=t.currentTime,n=void 0===e?0:e,i=t.borderColor,o=void 0===i?"":i,r=t.fill,a=void 0===r?"#ffffff":r,s=t.type,u=void 0===s?Z.Flow:s,l=t.id,c=void 0===l?"":l,h=t.fontSize;return{currentTime:n,type:u,borderColor:o,fill:a,id:c,fontSize:void 0===h?28:h}}(e||{}))}function at(t){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function st(t,e){return!e||"object"!==at(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ut(t){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function lt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ct(t,e)}function ct(t,e){return(ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ft(t,e,n){return e&&dt(t.prototype,e),n&&dt(t,n),t}var pt='px "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif',vt=(ft(kt,[{key:"getSize",value:function(){this.ctx.textBaseline="top",this.ctx.textAlign="left",this.ctx.font=this.danmaku.fontSize+pt,this.width=this.ctx.measureText(this.danmaku.text).width,this.height=1.2*this.ctx.measureText("M").width}},{key:"draw",value:function(){var t=this.width+4,e=this.height;this.selfCanvas.width=t,this.selfCanvas.height=e,this.ctx.textBaseline="top",this.ctx.textAlign="left",this.ctx.font=this.danmaku.fontSize+pt,this.ctx.clearRect(0,0,t,e),this.danmaku.borderColor&&(this.ctx.strokeStyle=this.danmaku.borderColor,this.ctx.strokeRect(1,1,t-4,e-4)),this.ctx.strokeStyle="#000000",this.ctx.strokeText(this.danmaku.text,1,1),this.ctx.fillStyle=this.danmaku.fill,this.ctx.fillText(this.danmaku.text,1,1)}}]),kt),yt=(lt(wt,vt),ft(wt,[{key:"set",value:function(t,e,n){this.danmaku=t,this.enable=!0,this.left=e,this.top=n,this.getSize(),this.draw()}},{key:"update",value:function(t,e,n){var i=(t+this.width)/e*n;this.left=this.left-i,this.enable=0<this.left+this.width}}]),wt),mt=(lt(gt,vt),ft(gt,[{key:"set",value:function(t,e,n,i){this.danmaku=t,this.timeout=e,this.enable=!0,this.getSize(),this.left=(n-this.width)/2,this.top=i,this.draw(),this.update(0)}},{key:"update",value:function(t){this.timeout-=t,this.enable=0<this.timeout}}]),gt),bt=n("faa1");function gt(){var t;return ht(this,gt),(t=st(this,ut(gt).apply(this,arguments))).timeout=0,t}function wt(){return ht(this,wt),st(this,ut(wt).apply(this,arguments))}function kt(){ht(this,kt),this.top=0,this.left=0,this.width=0,this.height=0,this.enable=!1,this.selfCanvas=document.createElement("canvas"),this.selfCanvas.width=100,this.selfCanvas.height=100,this.ctx=this.selfCanvas.getContext("2d")}function $t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var St,xt,Lt,Et,_t,Ot='px "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif',Tt=(xt=Dt,(Lt=[{key:"addDrawer",value:function(t){this.caches.push(t)}},{key:"removeDrawer",value:function(t){var e=this.caches.indexOf(t);-1<e&&this.caches.splice(e,1)}},{key:"renderAll",value:function(){if(this.clear(),0<this.caches.length)for(var t=0;t<this.caches.length;t++){var e=this.caches[t];this.ctx.drawImage(e.selfCanvas,e.left,e.top)}}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.player.width,this.player.height)}},{key:"clearCache",value:function(){this.caches.length=0}},{key:"fontHeight",value:function(t){return this.ctx.font=t+Ot,1.2*this.ctx.measureText("M").width}},{key:"fontWidth",value:function(t){return this.ctx.font=t.danmaku.fontSize+Ot,this.ctx.measureText(t.danmaku.text).width}},{key:"resize",value:function(){this.$canvas.setAttribute("width",this.player.width+"px"),this.$canvas.setAttribute("height",this.player.height+"px")}},{key:"alpha",set:function(t){this.ctx.globalAlpha=t}}])&&$t(xt.prototype,Lt),void(Et&&$t(xt,Et)),Dt);function Dt(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,Dt),this.caches=[],this.player=t,this.$canvas=t.$root.querySelector("canvas"),this.ctx=this.$canvas.getContext("2d"),this.$canvas.addEventListener("click",function(){t.toggle()})}function jt(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Pt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(_t=St=St||{})[_t.UnLimited=0]="UnLimited",_t[_t.UnOverlap=1]="UnOverlap",_t[_t.Percent25=.25]="Percent25",_t[_t.Half=.5]="Half",_t[_t.Percent75=.25]="Percent75";var Bt='<div class="content"></div><div class="buttons"><span class="copy">复制</span></div>';function At(t,e,n){var i=document.createElement("div");i.innerHTML=Bt,i.querySelector(".content").innerText=t.danmaku.text;var o=i.querySelector(".buttons");for(var r in e){var a=document.createElement("span");a.innerText=r,a.onclick=e[r],o.prepend(a)}var s=i.querySelector(".copy");return s&&s.addEventListener("click",function(){return n(t.danmaku.text)}),i}var Mt,Ft,It,Ct=(Mt=Ht,It=[{key:"find",value:function(t,e){return t.offsetX>e.left&&t.offsetX<e.left+e.width&&t.offsetY>e.top&&t.offsetY<e.top+e.height}}],(Ft=[{key:"createDanmakuMenu",value:function(t){var e=this;this.$menu&&this.$menu.remove(),this.$menu=document.createElement("div"),this.$menu.className="float show danmaku-context-menu";for(var n=0;n<t.length;n++){var i=t[n];if(this.player.options.danmaku.contextMenu){var o=At(i,this.player.options.danmaku.contextMenu(i.danmaku),function(t){return e.copyText(t)});this.$menu.append(o)}}document.body.append(this.$menu)}},{key:"show",value:function(){this.isShow=!0}},{key:"hide",value:function(){this.isShow=!1,this.canvas.clear()}},{key:"clear",value:function(){var t,e;this.showed.length=0,this.canvas.clear(),this.canvas.clearCache(),(t=this.topAndBottomDisables).push.apply(t,jt(this.topEnables)),this.topEnables.length=0,(e=this.flowDisables).push.apply(e,jt(this.flowEnables)),this.flowEnables.length=0}},{key:"resize",value:function(){this.width=this.player.$root.clientWidth,this.height=this.player.$root.clientHeight,this.lineHeight=Math.round(this.canvas.fontHeight(this.player.options.fontSize));for(var t=this.lineHeights.length=0;t<window.screen.height;t++){var e=t*this.lineHeight;if(e>window.screen.height)break;this.lineHeights.push(e),this.topLines.hasOwnProperty(e)||(this.topLines[e]=null),this.bottomLines.hasOwnProperty(e)||(this.bottomLines[e]=[]),this.flowLines.hasOwnProperty(e)||(this.flowLines[e]=[])}this.canvas.resize();var n=this.player.options.danmaku.limit;n===St.Percent75?this.displayArea=.75*this.player.height:n===St.Half?this.displayArea=.5*this.player.height:n===St.Percent25?this.displayArea=.25*this.player.height:this.displayArea=this.player.height,this.canvas.alpha=this.player.options.danmaku.alpha,this.canvas.renderAll()}},{key:"toggle",value:function(){this.isShow?this.hide():this.show()}},{key:"send",value:function(t){t.text=t.text.trim(),this.danmakus.push(t)}},{key:"findDrawers",value:function(e){return[].concat(jt(this.topEnables.filter(function(t){return Ht.find(e,t)})),jt(this.bottomEnables.filter(function(t){return Ht.find(e,t)})),jt(this.flowEnables.filter(function(t){return Ht.find(e,t)})))}},{key:"addDanmakuToCanvas",value:function(){if(0!==this.danmakus.length)for(var t=0;t<this.danmakus.length;t++){var e=this.danmakus[t],n=Math.abs(this.player.currentTime-e.currentTime);if(!(this.showed.includes(e)||.1<n)){if(this.showed.push(e),e.type===Z.Flow){var i=this.flowDisables.shift()||new yt;i.enable=!0,i.set(e,this.width,this.calcFlowTop(i)),i.update(this.width,this.player.options.danmaku.flowDuration,0),this.flowEnables.push(i),this.canvas.addDrawer(i)}else{var o=this.topAndBottomDisables.shift()||new mt;if(o.enable=!0,e.type===Z.Top)o.set(e,this.player.options.danmaku.fadeoutDuration,this.width,this.calcTopTop(o)),this.topEnables.push(o);else{var r=this.calcBottomTop(o)+this.lineHeight;r=this.height-r,o.set(e,this.player.options.danmaku.fadeoutDuration,this.width,r),this.bottomEnables.push(o)}o.update(0),this.canvas.addDrawer(o)}this.canvas.renderAll()}}}},{key:"copyText",value:function(t){this.$input||(this.$input=this.player.$root.querySelector("input.copy-tool")),this.$input.value=t,this.$input.select(),document.execCommand("copy")}},{key:"calcFlowTop",value:function(t){for(var e in this.flowLines){var n=this.flowLines[e],i=Number(e),o=n.left+n.width;if(!(n&&n.enable&&o>this.width)){if(i>this.displayArea)break;return this.flowLines[e]=t,this.flowY=i}}return this.flowY+=this.lineHeight,this.flowY>this.displayArea&&(this.flowY=0),this.flowLines[this.flowY]=t,this.flowY}},{key:"calcTopTop",value:function(t){for(var e in this.topLines){var n=this.topLines[e],i=Number(e);if(!n||!n.enable){if(i>this.displayArea)break;return this.topLines[e]=t,this.topY=i}}return this.topY+=this.lineHeight,this.topY>this.displayArea&&(this.topY=0),this.topLines[this.topY]=t,this.topY}},{key:"calcBottomTop",value:function(t){for(var e in this.bottomLines){var n=this.bottomLines[e],i=Number(e);if(!n||!n.enable){if(i>this.displayArea)break;return this.bottomLines[e]=t,this.bottomY=i}}return this.bottomY+=this.lineHeight,this.bottomY>this.displayArea&&(this.bottomY=0),this.bottomLines[this.bottomY]=t,this.bottomY}},{key:"drawDanmaku",value:function(){var e=this;this.topEnables=this.topEnables.filter(function(t){return t.enable?(t.update(e.frameTime),!0):(e.canvas.removeDrawer(t),e.topAndBottomDisables.push(t),!1)}),this.bottomEnables=this.bottomEnables.filter(function(t){return t.enable?(t.update(e.frameTime),!0):(e.canvas.removeDrawer(t),e.topAndBottomDisables.push(t),!1)}),this.flowEnables=this.flowEnables.filter(function(t){return t.enable?(t.update(e.width,e.player.options.danmaku.flowDuration,e.frameTime),!0):(e.canvas.removeDrawer(t),e.flowDisables.push(t),!1)})}},{key:"loop",value:function(){var t=this;this.destroied||(this.addDanmakuToCanvas(),this.addDanmakuToCanvasTime=(Date.now()-this.lastFrame)/1e3,this.player.paused||(this.drawDanmaku(),this.calcDanmakuTime=(Date.now()-this.lastFrame)/1e3,this.isShow?this.canvas.renderAll():this.canvas.clear()),this.frameTime=(Date.now()-this.lastFrame)/1e3,this.lastFrame=Date.now(),window.requestAnimationFrame(function(){t.loop()}))}},{key:"destroy",value:function(){this.destroied=!0,clearInterval(this.calcTopInterval),this.$menu&&this.$menu.remove()}},{key:"debug",get:function(){return{isShow:this.isShow,all:this.danmakus.length,showed:this.showed.length,time:{addDanmakuToCanvas:this.addDanmakuToCanvasTime,drawDanmaku:this.calcDanmakuTime,frameTime:this.frameTime},"on screen danmakus":{top:this.topEnables.length,bottom:this.bottomEnables.length,flow:this.flowEnables.length},"danmaku pool":{fixed:this.topAndBottomDisables.length,flow:this.flowDisables.length},positionY:{top:this.topY,flow:this.flowY,bottom:this.bottomY}}}}])&&Pt(Mt.prototype,Ft),void(It&&Pt(Mt,It)),Ht);function Ht(t){var a=this;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,Ht),this.danmakus=[],this.showed=[],this.topEnables=[],this.topAndBottomDisables=[],this.bottomEnables=[],this.flowEnables=[],this.flowDisables=[],this.lineHeights=[],this.topLines={},this.bottomLines={},this.flowLines={},this.displayArea=0,this.topY=0,this.flowY=0,this.bottomY=0,this.frameTime=0,this.calcDanmakuTime=0,this.isShow=!0,this.width=0,this.height=0,this.calcTopInterval=-1,this.destroied=!1,this.addDanmakuToCanvasTime=0,this.lastFrame=0,this.player=t,this.event=new bt.EventEmitter,this.canvas=new Tt(t);function s(){document.removeEventListener("click",s),document.removeEventListener("contextmenu",s),a.$menu.remove()}this.canvas.$canvas.addEventListener("contextmenu",function(t){var e=a.findDrawers(t);if(0<e.length){a.createDanmakuMenu(e);var n=t.pageX,i=t.pageY,o=t.clientX+a.$menu.clientWidth,r=t.clientY+a.$menu.clientHeight;o>document.body.clientWidth&&(n-=o-document.body.clientWidth),r>document.body.clientHeight&&(i-=r-document.body.clientHeight),a.$menu.style.left=n+"px",a.$menu.style.top=i+"px",document.addEventListener("click",s),document.addEventListener("touchstart",s),document.addEventListener("contextmenu",s)}return t.preventDefault(),t.stopPropagation(),!1}),this.canvas.$canvas.addEventListener("dblclick",function(){a.player.toggleFullScreen()}),this.player.$video.addEventListener("seeked",function(){a.clear()}),this.player.options.danmaku.enable?this.show():this.hide(),this.loop()}function qt(t){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Rt(t,e){return!e||"object"!==qt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Yt(t){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ut(t,e){return(Ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Wt,Nt,Vt,Xt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ut(t,e)}(Gt,g),Wt=Gt,(Nt=[{key:"getStyle",value:function(){return{fill:this.fill,type:this.type,borderColor:"white"}}}])&&zt(Wt.prototype,Nt),void(Vt&&zt(Wt,Vt)),Gt);function Gt(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Gt),(e=Rt(this,Yt(Gt).call(this,t))).fill="#ffffff",e.type=Z.Flow,e.$layer=e.player.$root.querySelector(".float.danmaku-style-layer"),e.$btn=e.player.$root.querySelector(".intern-button.danmaku-style"),e.$layer.innerHTML='<div>类型\n<div class="types">\n  <div class="type" data-type="1"><div><svg class="icon"><use xlink:href="#danplayer-danmugundongkai"></use></svg></div>流动</div>\n  <div class="type" data-type="0"><div><svg class="icon"><use xlink:href="#danplayer-danmudingbukai"></use></svg></div>顶部</div>\n  <div class="type" data-type="2"><div><svg class="icon"><use xlink:href="#danplayer-danmudibukai"></use></svg></div>底部</div>\n</div>\n</div>\n<div>颜色\n<div class="colors">\n{colors}\n</div>\n</div>'.replace("{colors}",Gt.colors.map(function(t){return'<span style="background: '.concat(t,'" data-color="').concat(t,'"></span>')}).join("")),e.init(),e.$types=Array.from(e.$layer.querySelectorAll(".types > .type")),e.$colors=Array.from(e.$layer.querySelectorAll(".colors > span")),e.$types.forEach(function(t){return t.addEventListener("click",function(){e.$types.forEach(function(t){return t.classList.remove("selected")}),t.classList.add("selected"),e.type=Number(t.getAttribute("data-type"))})}),e.$colors.forEach(function(t){return t.addEventListener("click",function(){e.$colors.forEach(function(t){return t.classList.remove("selected")}),t.classList.add("selected"),e.fill=t.getAttribute("data-color")})}),e.$types[0].classList.add("selected"),e.$colors[e.$colors.length-1].classList.add("selected"),e}function Jt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Xt.colors=["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"];var Qt,Zt,Kt,te=(Qt=ee,(Zt=[{key:"send",value:function(){var t=this.styleLayer.getStyle();t.currentTime=this.ui.player.currentTime,this.ui.danmakuLayer.send(new rt(this.$input.value,t)),this.$input.value="",this.ui.player.$root.focus()}},{key:"toggle",value:function(){this.isShow?this.hide():this.show()}},{key:"show",value:function(){this.isShow=!0,this.$root.style.display=""}},{key:"hide",value:function(){this.isShow=!1,this.$root.style.display="none"}},{key:"update",value:function(){}},{key:"focus",value:function(){this.$input.focus()}}])&&Jt(Qt.prototype,Zt),void(Kt&&Jt(Qt,Kt)),ee);function ee(t){var e=this;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,ee),this.isShow=!1,this.ui=t,this.styleLayer=new Xt(t),this.$root=t.player.$root.querySelector(".danmaku-form"),this.$input=this.$root.querySelector("input"),this.$btn=this.$root.querySelector(".send"),this.$btn.addEventListener("click",function(){return e.send()}),this.$input.addEventListener("keypress",function(t){"Enter"===t.key&&e.ui.isShow&&e.$input.value&&e.send()}),this.$input.addEventListener("keydown",function(t){!t.key.startsWith("Arrow")&&" "!==t.key||t.stopPropagation()}),this.$input.addEventListener("keyup",function(t){"Escape"===t.key&&(e.ui.player.$root.focus(),e.ui.hide()),t.stopPropagation()}),this.$input.addEventListener("focus",function(){e.ui.isMouseInUI=!0}),this.$input.addEventListener("blur",function(){e.ui.isMouseInUI=!1})}function ne(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ie(t,e,n,i,o,r,a){try{var s=t[r](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,o)}function oe(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var re,ae,se,ue=(re=le,(ae=[{key:"show",value:function(){this.isShow=!0,this.$root.classList.add("show"),this.$gradientBG.classList.add("show"),this.progressBar.resize()}},{key:"hide",value:function(){this.isShow=!1,this.$root.classList.remove("show"),this.$gradientBG.classList.remove("show"),this.qualitySelector.hideLayer(),this.volume.hideLayer(),this.danmakuForm.styleLayer.hideLayer(),this.player.$root.focus()}},{key:"hideUIDelay",value:function(){var e=this;return this.cancelHideUIDelay(),new Promise(function(t){e.hideTimeout=window.setTimeout(function(){e.hide(),t()},e.player.options.uiFadeOutDelay)})}},{key:"cancelHideUIDelay",value:function(){clearTimeout(this.hideTimeout)}},{key:"clearExtraButtons",value:function(){this.extraButtons.forEach(function(t){return t.remove()}),this.extraButtons.length=0}},{key:"insertExtraButtons",value:function(){var t,e;this.clearExtraButtons(),this.player.options.extraButtons&&(this.player.options.extraButtons.forEach(function(t){t.classList.add("button"),t.classList.remove("intern-button")}),(t=this.$controllerButtonsRightLayout).prepend.apply(t,ne(this.player.options.extraButtons)),(e=this.extraButtons).push.apply(e,ne(this.player.options.extraButtons)))}},{key:"update",value:function(){this.updateDanmakuButton(),this.updateFullScreenButton(),this.updatePlayButton(),this.danmakuForm.update(),this.progressBar.update(),this.volume.update()}},{key:"updatePlayButton",value:function(){this.player.paused?this.btnPlay.switch("data-on","data-on-title"):this.btnPlay.switch("data-off","data-off-title")}},{key:"updateFullScreenButton",value:function(){this.player.isFullScreen?this.btnFullScreen.switch("data-off","data-off-title"):this.btnFullScreen.switch("data-on","data-on-title")}},{key:"updateDanmakuButton",value:function(){var t,e;e=this.danmakuLayer.isShow?(t="data-off","data-off-title"):(t="data-on","data-on-title"),this.btnShowDanmaku.switch(t,e)}},{key:"resize",value:function(){this.volume.isShow&&this.volume.updateLayerPosition(),this.qualitySelector.isShow&&this.qualitySelector.updateLayerPosition(),this.progressBar.resize(),this.danmakuLayer.resize()}},{key:"destroy",value:function(){clearTimeout(this.hideTimeout),this.danmakuLayer.destroy(),this.qualitySelector.destroy(),this.volume.destroy()}},{key:"isMouseInUI",set:function(t){this._isMouseInUI=t,this.cancelHideUIDelay()},get:function(){return this._isMouseInUI}},{key:"debug",get:function(){return{isShow:this.isShow,isMouseInUI:this._isMouseInUI,danmakuLayer:this.danmakuLayer.debug}}}])&&oe(re.prototype,ae),void(se&&oe(re,se)),le);function le(t){var e=this;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,le),this._isMouseInUI=!1,this.isShow=!1,this.extraButtons=[],this.hideTimeout=-1,this.player=t,this.$root=t.$root.querySelector(".interactive-layer .controller-bottom-bar"),this.$root.addEventListener("mouseenter",function(){e.isMouseInUI=!0}),this.$root.addEventListener("mouseleave",function(){e.isMouseInUI=!1}),this.$gradientBG=t.$root.querySelector(".bg-gradient"),this.volume=new F(this),this.qualitySelector=new X(this),this.progressBar=new it(this),this.styleLayer=new Xt(this),this.danmakuForm=new te(this),this.$controllerButtonsRightLayout=this.$root.querySelector(".buttons .right"),this.btnFullScreen=new L(this.$root.querySelector(".button.full-screen")),this.btnFullScreen.$root.addEventListener("click",function(s){return function(){var t=this,a=arguments;return new Promise(function(e,n){var i=s.apply(t,a);function o(t){ie(i,e,n,o,r,"next",t)}function r(t){ie(i,e,n,o,r,"throw",t)}o(void 0)})}}(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.player.toggleFullScreen();case 2:e.updateFullScreenButton();case 3:case"end":return t.stop()}},t)}))),this.btnPlay=new L(this.$root.querySelector(".button.play")),this.btnPlay.$root.addEventListener("click",function(){e.player.toggle(),e.updatePlayButton()}),this.btnShowDanmaku=new L(this.$root.querySelector(".button.toggle-danamaku")),this.btnShowDanmaku.$root.addEventListener("click",function(){e.danmakuLayer.toggle(),e.updateDanmakuButton()}),this.danmakuLayer=new Ct(t),this.insertExtraButtons()}function ce(t){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function he(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function de(t,e){return!e||"object"!==ce(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function fe(t){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pe(t,e){return(pe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ve,ye,me,be=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pe(t,e)}(ge,c.EventEmitter),ve=ge,(ye=[{key:"useHls",value:function(t){var e=this;this.hls=t,this.dash=void 0,t.on(Hls.Events.LEVEL_LOADED,function(){e.emit(ge.Events.OnLoad,function(t){var i={};return t.levels.forEach(function(t,e){var n=t.height+"p";i[n]&&i[n].bitrate>t.bitrate||(i[n]={selected:!1,name:n,index:e,bitrate:t.bitrate})}),Object.values(i)}(t))})}},{key:"useDash",value:function(t){var e=this;this.dash=t,this.hls=void 0,t.on("streamInitialized",function(){e.emit(ge.Events.OnLoad,function(t){var i={};return t.getBitrateInfoListFor("video").forEach(function(t,e){var n=t.height+"p";i[n]&&i[n].bitrate>t.bitrate||(i[n]={selected:!1,name:n,index:t.qualityIndex,bitrate:t.bitrate})}),Object.values(i)}(t))})}},{key:"changeLevelTo",value:function(t){if(this._level=t,this.hls)this.hls.currentLevel=t.index;else if(this.dash){var e=this.dash.getSettings();-1===t.index?(e.streaming.abr.autoSwitchBitrate.video=!0,e.streaming.abr.limitBitrateByPortal=!0):(this.dash.setQualityFor("video",t.index),e.streaming.abr.autoSwitchBitrate.video=!1,e.streaming.abr.limitBitrateByPortal=!1),this.dash.updateSettings(e)}}},{key:"currentLevel",get:function(){return this._level}}])&&he(ve.prototype,ye),void(me&&he(ve,me)),ge);function ge(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,ge),de(this,fe(ge).call(this))}function we(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ke(t,e,n,i,o,r,a){try{var s=t[r](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,o)}function $e(s){return function(){var t=this,a=arguments;return new Promise(function(e,n){var i=s.apply(t,a);function o(t){ke(i,e,n,o,r,"next",t)}function r(t){ke(i,e,n,o,r,"throw",t)}o(void 0)})}}function Se(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}be.Events={OnLoad:"OnLoaded",OnChanged:"OnChanged"};var xe,Le,Ee="//at.alicdn.com/t/font_1373341_m9a3piei0s.js";function _e(t){var e=t.autoplay,n=void 0!==e&&e,i=t.color,o=void 0===i?"#00a1d6":i,r=t.live,a=void 0!==r&&r,s=t.volume,u=void 0===s?.7:s,l=t.fontSize,c=void 0===l?28:l,h=t.width,d=void 0===h?600:h,f=t.height,p=void 0===f?350:f,v=t.uiFadeOutDelay,y=void 0===v?3e3:v,m=t.extraButtons,b=void 0===m?[]:m,g=t.src,w=void 0===g?"":g,k=t.iconSrc,$=void 0===k?Ee:k,S=t.danmakuForm,x=void 0===S||S,L=t.fullScreen,E=void 0===L||L,_=t.danmaku,O=void 0===_?{}:_,T=t.onlyOne,D=void 0!==T&&T;return{autoplay:n,color:o,live:a,fontSize:c,height:p,danmaku:function(t){var e=0<arguments.length&&void 0!==t?t:{},n=e.alpha,i=void 0===n?1:n,o=e.enable,r=void 0===o||o,a=e.flowDuration,s=void 0===a?8:a,u=e.fadeoutDuration,l=void 0===u?5:u,c=e.limit,h=void 0===c?St.UnOverlap:c,d=e.contextMenu;return{alpha:i,enable:r,flowDuration:s,limit:h,fadeoutDuration:l,contextMenu:void 0===d?void 0:d}}(O),danmakuForm:x,fullScreen:E,src:w,iconSrc:$,uiFadeOutDelay:y,extraButtons:b,onlyOne:D,volume:u,width:d}}(Le=xe=xe||{}).Normal="native",Le.Hls="hls.js",Le.Dash="dash.js";var Oe,Te,De,je,Pe,Be,Ae,Me=(Te=Fe,(De=[{key:"_setSrc",value:(Ae=$e(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.options.src&&this.$video.setAttribute("src",this.options.src),t.next=3,this.getContentType();case 3:this.hls?this.adapter.useHls(this.hls):this.dash&&this.adapter.useDash(this.dash),this.type===xe.Normal?this.ui.qualitySelector.hideButton():this.ui.qualitySelector.showButton(),!this.options.autoplay&&this.paused||this.play(),this.options.live?this.$root.classList.add("live"):this.$root.classList.remove("live");case 8:case"end":return t.stop()}},t,this)})),function(){return Ae.apply(this,arguments)})},{key:"_setUI",value:function(){this.ui.insertExtraButtons(),this.ui.update(),this.ui.progressBar.resize(),this.ui.progressBar.resetTimeZone(),this.resize(),this.$style&&this.$style.remove(),this.$style=document.createElement("style"),this.$style.innerHTML=".video-player .colors .selected{border-color:".concat(this.options.color," !important}\n.video-player .types .selected{color:").concat(this.options.color," !important}\n.video-player .quality-menu .current{color:").concat(this.options.color," !important}"),document.body.append(this.$style),this.ui.qualitySelector.reset()}},{key:"set",value:function(t){t.danmaku=Object.assign({},this.options.danmaku,t.danmaku);var e=Object.assign({},this.options,t),n=e.src!==this.options.src;this.options=e,n&&(this.hls&&(this.hls.detachMedia(),this.hls=void 0),this.dash&&(this.dash.reset(),this.dash=void 0),this._setSrc().then()),this._setUI()}},{key:"resize",value:function(){this.options.width&&("number"==typeof this.options.width||parseInt(this.options.width).toString()===this.options.width?this._width=this.options.width+"px":this._width=this.options.width),this.options.height&&("number"==typeof this.options.height||parseInt(this.options.height).toString()===this.options.height?this._height=this.options.height+"px":this._height=this.options.height),this.isFullScreen||(this.$root.style.width=this._width,this.$root.style.height=this._height),this.ui.resize()}},{key:"resizeEvt",value:function(t){var e=this;window.clearTimeout(this.delayResize),this.delayResize=window.setTimeout(function(){e.resize()},t)}},{key:"fillDanmakus",value:function(t){var e;(e=this.ui.danmakuLayer.danmakus).push.apply(e,we(t))}},{key:"sendDanmaku",value:function(t){this.ui.danmakuLayer.send(t)}},{key:"toggle",value:function(){this.paused?this.play():this.pause()}},{key:"play",value:function(){var e=this;this._paused=!1,this.$video.play().then(),this.options.onlyOne&&Fe.instances.forEach(function(t){t!==e&&t.pause()})}},{key:"pause",value:function(){this._paused=!0,this.$video.pause()}},{key:"getContentType",value:(Be=$e(s.a.mark(function t(){var e,n,i,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.$video.getAttribute("src"),this.type=xe.Normal,e&&((this.options.src=e).match(/\.m3u[8]/)&&(this.type=xe.Hls),e.match(/\.mpd/)&&(this.type=xe.Dash)),this.type!==xe.Hls){t.next=11;break}if(Hls){t.next=8;break}throw Error("播放Hls视频资源请加载hls.js的代码");case 8:Hls.isSupported()&&(this.hls=new Hls,this.hls.config.capLevelToPlayerSize=!0,this.hls.attachMedia(this.$video),this.hls.loadSource(e)),t.next=30;break;case 11:if(this.type!==xe.Dash){t.next=22;break}if(dashjs){t.next=15;break}throw Error("播放MPD视频资源前加载dash.js的代码");case 15:this.dash=dashjs.MediaPlayer().create(),this.dash.initialize(this.$video,e,!1),(n=this.dash.getSettings()).streaming.abr.limitBitrateByPortal=!0,this.dash.updateSettings(n),t.next=30;break;case 22:return(i=new XMLHttpRequest).open("Get",e),i.send(),t.next=27,new Promise(function(t){i.onreadystatechange=function(){i.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(200===i.status?t(i.getResponseHeader("Content-Type")):t(null),i.abort())}});case 27:(o=t.sent)&&this.$video.canPlayType(o)&&(this.$video.src=e);case 30:case"end":return t.stop()}},t,this)})),function(){return Be.apply(this,arguments)})},{key:"toggleFullScreen",value:(Pe=$e(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isFullScreen=!this.isFullScreen,this.isFullScreen)return t.next=4,this.$root.requestFullscreen();t.next=6;break;case 4:t.next=8;break;case 6:return t.next=8,document.exitFullscreen();case 8:this.resize();case 9:case"end":return t.stop()}},t,this)})),function(){return Pe.apply(this,arguments)})},{key:"destroy",value:function(){Fe.instances.splice(Fe.instances.indexOf(this),1),this.ui.destroy(),this.hls&&this.hls.detachMedia(),this.dash&&this.dash.reset(),this.$style&&this.$style.remove()}},{key:"width",get:function(){return this.$root.clientWidth}},{key:"height",get:function(){return this.$root.clientHeight}},{key:"loading",get:function(){return this._loading}},{key:"currentTime",get:function(){return this.$video.currentTime}},{key:"paused",get:function(){return this._paused}},{key:"debug",get:function(){var t="默认",e=this.options.src;return this.type!==xe.Normal&&(t=this.adapter.currentLevel?this.adapter.currentLevel.name:"自动"),{width:this.width,height:this.height,type:this.type,src:e,quality:t,ui:this.ui.debug}}}])&&Se(Te.prototype,De),void(je&&Se(Te,je)),Fe);function Fe(t,e){var n=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Fe),this.type=xe.Normal,this._width="",this._height="",this.isFullScreen=!1,this._duration=0,this._loading=!0,this._paused=!0,this.delayResize=-1,!document.querySelector("script#danplayer-icon")){var i=document.createElement("script");i.src=Ee,i.id="danplayer-icon",document.body.append(i)}Fe.instances.push(this);var o=t.parentElement;this.$root=document.createElement("div"),this.$root.setAttribute("tabIndex","0"),this.$root.classList.add("video-player"),o.insertBefore(this.$root,t),t.classList.add("video-layer"),t.removeAttribute("id"),this.$root.innerHTML='{video-layer}\n<input class="copy-tool" />\n<div class="interactive-layer">\n  <canvas class="danmaku-layer"></canvas>\n  \n  <div class="bg-gradient show"></div>\n  \n  \n  <div class="float danmaku-style-layer"></div>\n  \n  <div class="float volume-bar">\n    <div class="volume-num-label"></div>\n    <div class="volume-column-bar">\n      <div class="bar-ui bar-full"></div>\n      <div class="bar-ui bar-current"></div>\n      <div class="bar-controller"></div>\n    </div>\n  </div>\n  \n  <div class="float quality-menu"></div>\n  \n  <div class="controller-bottom-bar">\n    <div class="progress-bar live-hide">\n      <div class="bar-full"></div>\n      <div class="bar-buffer"></div>\n      <div class="bar-current"></div>\n      <div class="bar-controller"></div>    \n    </div>\n    \n    <div class="buttons">\n      <div class="left">\n        <div class="button intern-button play" data-on="danplayer-bofang" data-off="danplayer-zanting"\n          data-on-title="播放视频" data-off-title="暂停播放">\n          <svg class="icon" aria-hidden="true"><use xlink:href="#danplayer-bofang"></use></svg>\n        </div>\n        <div class="time"></div>\n      </div>\n      \n      <div class="middle danmaku-form">\n        <div class="button intern-button danmaku-style">\n          <svg class="icon"><use xlink:href="#danplayer-style"></use></svg>\n        </div>\n        <input placeholder="输入弹幕内容" tabindex="1">\n        <div class="send">发送</div>\n      </div>\n      <div class="right">\n      \n        <div class="button intern-button volume" data-on="danplayer-yinliang" data-off="danplayer-jingyin" title="音量">\n          <svg class="icon"><use xlink:href="#danplayer-yinliang"></use></svg>\n        </div>\n        \n        <div class="button intern-button toggle-danamaku" title="隐藏弹幕"\n          data-on="danplayer-danmukai" data-off="danplayer-danmuguan" \n          data-on-title="显示弹幕" data-off-title="隐藏弹幕">\n          <svg class="icon"><use xlink:href="#danplayer-danmukai"></use></svg>\n        </div>\n        \n        <div class="button quality" title="切换画质"></div>\n        \n        <div class="button intern-button full-screen" data-on="danplayer-quanping" data-off="danplayer-zuixiaohua"\n        data-on-title="全屏观看" data-off-title="取消全屏">\n          <svg class="icon"><use xlink:href="#danplayer-quanping"></use></svg>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'.replace("{video-layer}",t.outerHTML),t.remove(),this.$root.addEventListener("keypress",function(t){var e=!0;"Enter"===t.key?(n.ui.show(),n.ui.danmakuForm.focus()):" "===t.key||(e=!1),e&&(t.stopPropagation(),t.preventDefault())}),this.$root.addEventListener("keyup",function(t){" "===t.key&&(n.toggle(),t.stopPropagation(),t.preventDefault())}),document.addEventListener("fullscreenchange",function(){n.isFullScreen=document.fullscreenElement===n.$root,n.ui.updateFullScreenButton()}),this.$root.addEventListener("keydown",function(t){var e=!0;"ArrowLeft"!==t.key||n.options.live?"ArrowRight"!==t.key||n.options.live?"ArrowUp"===t.key?n.ui.volume.up():"ArrowDown"===t.key?n.ui.volume.down():e=!1:n.$video.currentTime+=5:n.$video.currentTime-=5,e&&(t.stopPropagation(),t.preventDefault())}),this.$root.addEventListener("mousemove",function(){if(n.$root.classList.remove("mouse-idle"),n.paused);else{if(n.ui.isMouseInUI)return;n.ui.hideUIDelay().then(function(){n.$root.classList.add("mouse-idle")})}}),this.$root.addEventListener("mouseover",function(){n.ui.isShow||(n.ui.show(),n.ui.cancelHideUIDelay())}),this.$root.addEventListener("mouseleave",function(){n.ui.isShow&&(n.ui.hide(),n.ui.cancelHideUIDelay())}),this.$video=this.$root.querySelector(".video-layer"),this.$video.removeAttribute("controls"),this.$video.addEventListener("durationchange",function(){n._duration=n.$video.duration}),this.$video.addEventListener("playing",function(){return n.ui.hideUIDelay()}),this.$video.addEventListener("play",function(){return n.ui.updatePlayButton()}),this.$video.addEventListener("pause",function(){return n.ui.updatePlayButton()}),window.addEventListener("resize",function(){return n.resizeEvt(1e3)}),this.options=_e(e||{autoplay:this.$video.hasAttribute("autoplay")}),this.adapter=new be,this.ui=new ue(this),this.ui.update(),this.adapter.on(be.Events.OnLoad,function(t){n.ui.qualitySelector.updateLevel(t)}),this.ui.qualitySelector.on("selectLevel",function(t){n.adapter.changeLevelTo(t)}),this._setSrc().then(),this._setUI()}function Ie(t){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ce(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function He(t,e){return!e||"object"!==Ie(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function qe(t){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ze(t,e){return(ze=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Me.instances=[];var Re,Ye,Ue,We=parseInt("4E00",16),Ne=parseInt("9FA5",16),Ve=-1,Xe=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ze(t,e)}(Ge,r.b),Re=Ge,(Ye=[{key:"sendDanmaku",value:function(){this.form.danmaku&&Oe.sendDanmaku(new rt(this.form.danmaku,{type:this.form.type,borderColor:"white",currentTime:Oe.currentTime,id:"myself"}))}},{key:"setSrc",value:function(){this.form.src&&Oe.set({live:this.form.live,src:this.form.src})}},{key:"playMp4",value:function(){Oe.set({src:"https://api.dogecloud.com/player/get.mp4?vcode=5ac682e6f8231991&userId=17&ext=.mp4"})}},{key:"playMpd",value:function(){Oe.set({src:"https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps.mpd"})}},{key:"playHls",value:function(){Oe.set({src:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"})}},{key:"sendRandomDanmaku",value:function(){for(var t=[],e=0;e<this.random.count;e++){var n=Math.random()*this.random.timeRange,i=Oe.currentTime+n,o=this.randomChinese(8),r=[0,1,2].indexOf(Math.round(3*Math.random())),a=new rt(o,{currentTime:i,type:r});t.push(a)}Oe.fillDanmakus(t)}},{key:"randomChinese",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;t=0<t?t:Math.round(10*Math.random());for(var e="",n=0;n<t;n++)e+="\\u"+Math.floor(Math.random()*(Ne-We+1)+We);return unescape(e.replace(/\\/g,"%"))}},{key:"mounted",value:function(){var t=this,e=document.getElementById("player");if(e){Oe=new Me(e,{color:"#f1f0cf",width:600,volume:0,danmaku:{alpha:.5,contextMenu:function(t){var e={};return"myself"===t.id?e["撤回"]=function(){alert("弹幕内容："+t.text)}:e["举报"]=function(){alert("举报内容："+t.text)},e}}});var n=document.createElement("div");n.innerText="扩展按钮",n.onclick=function(){alert("扩展按钮")},Oe.set({extraButtons:[n]}),this.form.flowDuration=Oe.options.danmaku.flowDuration,this.form.fadeoutDuration=Oe.options.danmaku.fadeoutDuration,this.form.alpha=Oe.options.danmaku.alpha,this.form.color=Oe.options.color,Ve=setInterval(function(){t.info=JSON.stringify(Oe.debug,null,2)},100)}}},{key:"beforeDestroy",value:function(){Oe.destroy(),clearInterval(Ve)}},{key:"flowDuration",get:function(){return this.form.flowDuration},set:function(t){this.form.flowDuration=t,Oe.options.danmaku.flowDuration=t}},{key:"danmakuAlpha",get:function(){return this.form.alpha},set:function(t){this.form.alpha=t,Oe.set({danmaku:{alpha:t}})}},{key:"fadeoutDuation",set:function(t){this.form.fadeoutDuration=t,Oe.options.danmaku.fadeoutDuration=t},get:function(){return this.form.fadeoutDuration}},{key:"color",set:function(t){this.form.color=t,Oe.set({color:t})},get:function(){return this.form.color}},{key:"danmakuEnable",get:function(){return this.form.danmaku_enable},set:function(t){this.form.danmaku_enable=t,Oe.set({})}}])&&Ce(Re.prototype,Ye),void(Ue&&Ce(Re,Ue)),Ge);function Ge(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ge),(t=He(this,qe(Ge).apply(this,arguments))).form={danmaku_enable:!0,danmaku:"",flowDuration:1,fadeoutDuration:1,type:1,alpha:1,live:!0,src:"",color:""},t.random={count:100,timeRange:10},t.info="",t}var Je=Xe=o.a([r.a],Xe),Qe=(n("5c0b"),n("2877")),Ze=Object(Qe.a)(Je,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-card",{attrs:{id:"app"}},[n("div",[n("img",{attrs:{src:"/logo.png"}}),e._v(" DanPlayer")]),n("video",{attrs:{id:"player",src:"https://api.dogecloud.com/player/get.mp4?vcode=5ac682e6f8231991&userId=17&ext=.mp4"}}),n("h3",[e._v("功能调试区域")]),n("el-tabs",{attrs:{value:"player"}},[n("el-tab-pane",{attrs:{label:"播放器相关",name:"player"}},[n("el-form",{attrs:{size:"mini","label-width":"120px"}},[n("el-form-item",{attrs:{label:"播放器形态"}},[n("el-radio-group",{model:{value:e.form.live,callback:function(t){e.$set(e.form,"live",t)},expression:"form.live"}},[n("el-radio-button",{attrs:{label:!0}},[e._v("直播")]),n("el-radio-button",{attrs:{label:!1}},[e._v("普通视频")])],1)],1),n("el-form-item",{attrs:{label:"弹幕功能"}},[n("el-radio-group",{model:{value:e.form.live,callback:function(t){e.$set(e.form,"live",t)},expression:"form.live"}},[n("el-radio-button",{attrs:{label:!0}},[e._v("开启")]),n("el-radio-button",{attrs:{label:!1}},[e._v("关闭")])],1)],1),n("el-form-item",{attrs:{label:"颜色"}},[n("el-color-picker",{model:{value:e.color,callback:function(t){e.color=t},expression:"color"}}),n("br"),e._v("\n            (视频进度条滑块，音量滑块，设置选项的高亮颜色)\n          ")],1),n("el-form-item",{attrs:{label:"视频网址"}},[n("div",[n("el-button",{on:{click:e.playMp4}},[e._v("播放Mp4视频资源(浏览器原生支持)")]),n("el-button",{on:{click:e.playHls}},[e._v("播放Hls视频资源(使用hls.js)")]),n("el-button",{on:{click:e.playMpd}},[e._v("播放MPD视频资源(使用dash.js)")])],1),n("br"),n("el-input",{attrs:{placeholder:"输入网址"},model:{value:e.form.src,callback:function(t){e.$set(e.form,"src",t)},expression:"form.src"}}),n("el-button",{on:{click:e.setSrc}},[e._v("播放器自定义资源")])],1)],1)],1),n("el-tab-pane",{attrs:{label:"弹幕相关",name:"danmaku_layer"}},[n("el-form",{attrs:{"label-position":"top",size:"mini"}},[n("el-form-item",[n("div",{attrs:{slot:"label"},slot:"label"},[e._v("流动式弹幕的速度: "+e._s(e.flowDuration)+" 值越大速度越慢")]),n("el-slider",{attrs:{min:1,max:20},model:{value:e.flowDuration,callback:function(t){e.flowDuration=t},expression:"flowDuration"}})],1),n("el-form-item",[n("div",{attrs:{slot:"label"},slot:"label"},[e._v("顶部 / 底部弹幕的隐藏时间: "+e._s(e.fadeoutDuation)+" 秒")]),n("el-slider",{attrs:{min:1,max:20},model:{value:e.fadeoutDuation,callback:function(t){e.fadeoutDuation=t},expression:"fadeoutDuation"}})],1),n("el-form-item",[n("div",{attrs:{slot:"label"},slot:"label"},[e._v("全局的弹幕透明度: "+e._s(e.danmakuAlpha)+" 范围在 0 ~ 1")]),n("el-slider",{attrs:{min:.1,max:1,step:.1},model:{value:e.danmakuAlpha,callback:function(t){e.danmakuAlpha=t},expression:"danmakuAlpha"}})],1),n("el-form-item",{attrs:{label:"发弹幕"}},[n("el-select",{attrs:{placeholder:"请选择",value:e.form.type},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[n("el-option",{attrs:{label:"顶部",value:0}},[e._v("顶部")]),n("el-option",{attrs:{label:"流动",value:1}},[e._v("流动")]),n("el-option",{attrs:{label:"底部",value:2}},[e._v("底部")])],1),n("el-input",{attrs:{placeholder:"回车发送"},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendDanmaku(t)}},model:{value:e.form.danmaku,callback:function(t){e.$set(e.form,"danmaku",t)},expression:"form.danmaku"}},[n("el-button",{attrs:{slot:"append",type:"primary"},on:{click:e.sendDanmaku},slot:"append"},[e._v("发送")])],1)],1),n("el-form-item",{attrs:{label:"随机填充大量弹幕"}},[n("div",{staticStyle:{width:"200px"}},[n("el-input",{model:{value:e.random.timeRange,callback:function(t){e.$set(e.random,"timeRange",t)},expression:"random.timeRange"}},[n("span",{attrs:{slot:"append"},slot:"append"},[e._v("秒内")])]),n("el-input",{model:{value:e.random.count,callback:function(t){e.$set(e.random,"count",t)},expression:"random.count"}},[n("span",{attrs:{slot:"append"},slot:"append"},[e._v("条弹幕")])])],1),n("el-button",{attrs:{type:"primary"},on:{click:e.sendRandomDanmaku}},[e._v("填充弹幕")])],1)],1)],1)],1)],1),n("div",{staticClass:"debug-info"},[n("h3",[e._v("\n      Debug信息\n    ")]),n("pre",[e._v(e._s(e.info))])])],1)},[],!1,null,null,null).exports,Ke=n("5c96"),tn=n.n(Ke);n("0fae"),i.default.use(tn.a),i.default.config.productionTip=!1,new i.default({render:function(t){return t(Ze)}}).$mount("#app")},e332:function(t,e,n){}});